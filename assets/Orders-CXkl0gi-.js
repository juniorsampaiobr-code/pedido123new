import{b as H,u as W,c as q,j as e}from"./tanstack-DS1wz2fm.js";import{r as p,f as Ie}from"./vendor-DPb28zz8.js";import{s as T}from"./client-BP8r4skJ.js";import{B as E,b as qe}from"./button-BeVziqmx.js";import{C as Y,a as ee,b as Le,c as Be}from"./card-CHsyZ6T7.js";import{S as se,a as ae,b as te,c as ne,d as re,C as _,T as Oe,e as ze,f as Fe,g as $e}from"./select-WQC_QIHB.js";import{D as Ve,a as Ke,b as He,c as Qe,d as Ge,e as Ue,B as Xe}from"./index-DYvNAtwX.js";import{S as L}from"./skeleton-Cp-bY9AK.js";import{A as Ze,a as Je,b as We}from"./alert-Qh0539HF.js";import{c as R,u as P,b as k,g as Ye,h as oe,P as Q,j as Z,i as es,m as ss,n as as,L as ts,X as le}from"./index-B6i9nglq.js";import{S as $}from"./separator-DYmUf3Fp.js";import{P as ns}from"./printer-DcVfUs1w.js";import{A as ie,a as ce,b as de,c as ue,d as me,e as he,f as pe,g as xe,h as fe,u as rs}from"./DashboardLayout-Bg6wOV9H.js";import{u as os}from"./index-CJmVBZLB.js";import{T as ls}from"./terminal-DUczJ5pt.js";import{S as ge}from"./shopping-cart-BImT3Gwr.js";import{D as is}from"./dollar-sign-bZlxoDY2.js";import{T as cs}from"./trash-2-CwbCXfe6.js";import"./supabase-BT-vd-uw.js";import"./index-Bvk2mSel.js";import"./index-Dm27xrF8.js";import"./index-D2OCKsID.js";import"./Logo-DecuKb2x.js";import"./package-L8dpTpm1.js";import"./clock-B8BcUOj7.js";import"./credit-card-BkoPDiJ7.js";import"./truck-D_GQ-45y.js";import"./settings-Eh6mAANp.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=R("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=R("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=R("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=R("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=R("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),J={pending:{label:"Pendente"},confirmed:{label:"Confirmado"},preparing:{label:"Em Preparação"},ready:{label:"Pronto"},delivering:{label:"Em Entrega"},delivered:{label:"Entregue"},cancelled:{label:"Cancelado"},pending_payment:{label:"Aguardando Pagamento"}},ps=async s=>{const{data:a,error:n}=await T.from("order_items").select("*, products(name)").eq("order_id",s);if(n)throw new Error(n.message);return a},xs=({order:s,isOpen:a,onClose:n})=>{var j,v;const m=H(),[o,t]=p.useState("pending");p.useEffect(()=>{s!=null&&s.status&&t(s.status)},[s]);const{data:c,isLoading:u}=W({queryKey:["orderItems",s==null?void 0:s.id],queryFn:()=>ps(s.id),enabled:!!s&&a}),l=q({mutationFn:async d=>{if(!s)throw new Error("Pedido não encontrado.");const{error:g}=await T.from("orders").update({status:d}).eq("id",s.id);if(g)throw new Error(g.message)},onSuccess:(d,g)=>{P.success(`Status do pedido atualizado para "${J[g].label}"`),m.invalidateQueries({queryKey:["orders"]}),n()},onError:d=>{P.error(`Erro ao atualizar status: ${d.message}`)}}),x=()=>{window.print()};if(!s)return null;const h=s.created_at?new Date(s.created_at).getTime().toString().slice(-4):"N/A";return e.jsx(Ve,{open:a,onOpenChange:n,children:e.jsxs(Ke,{className:"sm:max-w-lg",children:[e.jsxs(He,{children:[e.jsxs(Qe,{children:["Detalhes do Pedido #",h]}),e.jsx(Ge,{children:"Gerencie os detalhes e o status deste pedido."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold",children:"Cliente"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nome: ",((j=s.customer)==null?void 0:j.name)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Telefone: ",((v=s.customer)==null?void 0:v.phone)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Endereço: ",s.delivery_address||"N/A"]})]}),e.jsx($,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Itens do Pedido"}),u?e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{className:"h-8 w-full"}),e.jsx(L,{className:"h-8 w-full"})]}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto pr-2",children:c==null?void 0:c.map(d=>{var g;return e.jsxs("div",{className:"flex justify-between items-start text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[d.quantity,"x ",((g=d.products)==null?void 0:g.name)||"Produto desconhecido"]}),d.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground italic",children:["Obs: ",d.notes]})]}),e.jsx("span",{className:"text-muted-foreground",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d.subtotal)})]},d.id)})})]}),e.jsx($,{}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsx("span",{className:"font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.delivery_fee||0)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-base",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]})]}),e.jsx($,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Atualizar Status"}),e.jsxs(se,{value:o,onValueChange:d=>t(d),children:[e.jsx(ae,{children:e.jsx(te,{placeholder:"Selecione um status"})}),e.jsx(ne,{children:Object.entries(J).map(([d,{label:g}])=>e.jsx(re,{value:d,children:g},d))})]})]})]}),e.jsxs(Ue,{className:"flex-col sm:flex-row sm:justify-between sm:space-x-2",children:[e.jsxs(E,{variant:"outline",onClick:x,className:"w-full sm:w-auto mb-2 sm:mb-0",children:[e.jsx(ns,{className:"h-4 w-4 mr-2"})," Imprimir Pedido"]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(E,{variant:"outline",onClick:n,children:"Cancelar"}),e.jsx(E,{onClick:()=>l.mutate(o),disabled:l.isPending||o===s.status,children:l.isPending?"Salvando...":"Salvar Alterações"})]})]})]})})},be=({className:s,...a})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:k("mx-auto flex w-full justify-center",s),...a});be.displayName="Pagination";const ve=p.forwardRef(({className:s,...a},n)=>e.jsx("ul",{ref:n,className:k("flex flex-row items-center gap-1",s),...a}));ve.displayName="PaginationContent";const S=p.forwardRef(({className:s,...a},n)=>e.jsx("li",{ref:n,className:k("",s),...a}));S.displayName="PaginationItem";const D=({className:s,isActive:a,size:n="icon",...m})=>e.jsx("a",{"aria-current":a?"page":void 0,className:k(qe({variant:a?"outline":"ghost",size:n}),s),...m});D.displayName="PaginationLink";const ye=({className:s,...a})=>e.jsxs(D,{"aria-label":"Go to previous page",size:"default",className:k("gap-1 pl-2.5",s),...a,children:[e.jsx(ds,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});ye.displayName="PaginationPrevious";const Ne=({className:s,...a})=>e.jsxs(D,{"aria-label":"Go to next page",size:"default",className:k("gap-1 pr-2.5",s),...a,children:[e.jsx("span",{children:"Next"}),e.jsx(us,{className:"h-4 w-4"})]});Ne.displayName="PaginationNext";const V=({className:s,...a})=>e.jsxs("span",{"aria-hidden":!0,className:k("flex h-9 w-9 items-center justify-center",s),...a,children:[e.jsx(ms,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]});V.displayName="PaginationEllipsis";const fs=({currentPage:s,totalPages:a,onPageChange:n})=>{if(a<=1)return null;const o=(()=>{const t=[],u=Math.max(1,s-Math.floor(2.5)),l=Math.min(a,u+5-1);if(l-u+1<5){const x=Math.max(1,l-5+1);for(let h=x;h<=l;h++)t.push(h)}else for(let x=u;x<=l;x++)t.push(x);return t})();return e.jsx(be,{children:e.jsxs(ve,{children:[e.jsx(S,{children:e.jsx(ye,{onClick:()=>n(s-1),className:k(s===1&&"pointer-events-none opacity-50")})}),o[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx(S,{children:e.jsx(D,{onClick:()=>n(1),children:"1"})}),o[0]>2&&e.jsx(S,{children:e.jsx(V,{})})]}),o.map(t=>e.jsx(S,{children:e.jsx(D,{isActive:t===s,onClick:()=>n(t),children:t})},t)),o[o.length-1]<a&&e.jsxs(e.Fragment,{children:[o[o.length-1]<a-1&&e.jsx(S,{children:e.jsx(V,{})}),e.jsx(S,{children:e.jsx(D,{onClick:()=>n(a),children:a})})]}),e.jsx(S,{children:e.jsx(Ne,{onClick:()=>n(s+1),className:k(s===a&&"pointer-events-none opacity-50")})})]})})};var B="Checkbox",[gs,Ys]=Ye(B),[js,G]=gs(B);function bs(s){const{__scopeCheckbox:a,checked:n,children:m,defaultChecked:o,disabled:t,form:c,name:u,onCheckedChange:l,required:x,value:h="on",internal_do_not_use_render:j}=s,[v,d]=as({prop:n,defaultProp:o??!1,onChange:l,caller:B}),[g,b]=p.useState(null),[w,r]=p.useState(null),f=p.useRef(!1),y=g?!!c||!!g.closest("form"):!0,M={checked:v,disabled:t,setChecked:d,control:g,setControl:b,name:u,form:c,value:h,hasConsumerStoppedPropagationRef:f,required:x,defaultChecked:A(o)?!1:o,isFormControl:y,bubbleInput:w,setBubbleInput:r};return e.jsx(js,{scope:a,...M,children:vs(j)?j(M):m})}var Ce="CheckboxTrigger",we=p.forwardRef(({__scopeCheckbox:s,onKeyDown:a,onClick:n,...m},o)=>{const{control:t,value:c,disabled:u,checked:l,required:x,setControl:h,setChecked:j,hasConsumerStoppedPropagationRef:v,isFormControl:d,bubbleInput:g}=G(Ce,s),b=oe(o,h),w=p.useRef(l);return p.useEffect(()=>{const r=t==null?void 0:t.form;if(r){const f=()=>j(w.current);return r.addEventListener("reset",f),()=>r.removeEventListener("reset",f)}},[t,j]),e.jsx(Q.button,{type:"button",role:"checkbox","aria-checked":A(l)?"mixed":l,"aria-required":x,"data-state":Ae(l),"data-disabled":u?"":void 0,disabled:u,value:c,...m,ref:b,onKeyDown:Z(a,r=>{r.key==="Enter"&&r.preventDefault()}),onClick:Z(n,r=>{j(f=>A(f)?!0:!f),g&&d&&(v.current=r.isPropagationStopped(),v.current||r.stopPropagation())})})});we.displayName=Ce;var U=p.forwardRef((s,a)=>{const{__scopeCheckbox:n,name:m,checked:o,defaultChecked:t,required:c,disabled:u,value:l,onCheckedChange:x,form:h,...j}=s;return e.jsx(bs,{__scopeCheckbox:n,checked:o,defaultChecked:t,disabled:u,required:c,onCheckedChange:x,name:m,form:h,value:l,internal_do_not_use_render:({isFormControl:v})=>e.jsxs(e.Fragment,{children:[e.jsx(we,{...j,ref:a,__scopeCheckbox:n}),v&&e.jsx(Se,{__scopeCheckbox:n})]})})});U.displayName=B;var ke="CheckboxIndicator",Ee=p.forwardRef((s,a)=>{const{__scopeCheckbox:n,forceMount:m,...o}=s,t=G(ke,n);return e.jsx(es,{present:m||A(t.checked)||t.checked===!0,children:e.jsx(Q.span,{"data-state":Ae(t.checked),"data-disabled":t.disabled?"":void 0,...o,ref:a,style:{pointerEvents:"none",...s.style}})})});Ee.displayName=ke;var Pe="CheckboxBubbleInput",Se=p.forwardRef(({__scopeCheckbox:s,...a},n)=>{const{control:m,hasConsumerStoppedPropagationRef:o,checked:t,defaultChecked:c,required:u,disabled:l,name:x,value:h,form:j,bubbleInput:v,setBubbleInput:d}=G(Pe,s),g=oe(n,d),b=os(t),w=ss(m);p.useEffect(()=>{const f=v;if(!f)return;const y=window.HTMLInputElement.prototype,I=Object.getOwnPropertyDescriptor(y,"checked").set,O=!o.current;if(b!==t&&I){const z=new Event("click",{bubbles:O});f.indeterminate=A(t),I.call(f,A(t)?!1:t),f.dispatchEvent(z)}},[v,b,t,o]);const r=p.useRef(A(t)?!1:t);return e.jsx(Q.input,{type:"checkbox","aria-hidden":!0,defaultChecked:c??r.current,required:u,disabled:l,name:x,value:h,form:j,...a,tabIndex:-1,ref:g,style:{...a.style,...w,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Se.displayName=Pe;function vs(s){return typeof s=="function"}function A(s){return s==="indeterminate"}function Ae(s){return A(s)?"indeterminate":s?"checked":"unchecked"}const X=p.forwardRef(({className:s,...a},n)=>e.jsx(U,{ref:n,className:k("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(Ee,{className:k("flex items-center justify-center text-current"),children:e.jsx(_,{className:"h-4 w-4"})})}));X.displayName=U.displayName;const _e={pending:{label:"Pendente",icon:ge,color:"bg-yellow-500 hover:bg-yellow-600"},confirmed:{label:"Confirmado",icon:_,color:"bg-blue-500 hover:bg-blue-600"},preparing:{label:"Em Preparação",icon:_,color:"bg-orange-500 hover:bg-orange-600"},ready:{label:"Pronto",icon:_,color:"bg-green-500 hover:bg-green-600"},delivering:{label:"Em Entrega",icon:_,color:"bg-indigo-500 hover:bg-indigo-600"},delivered:{label:"Entregue",icon:_,color:"bg-primary hover:bg-primary/90"},cancelled:{label:"Cancelado",icon:le,color:"bg-destructive hover:bg-destructive/90"},pending_payment:{label:"Aguardando Pag.",icon:is,color:"bg-gray-500 hover:bg-gray-600"}},ys=[{value:"pending",label:"Mudar para Pendente"},{value:"confirmed",label:"Mudar para Confirmado"},{value:"preparing",label:"Mudar para Em Preparação"},{value:"ready",label:"Mudar para Pronto"},{value:"delivering",label:"Mudar para Em Entrega"},{value:"delivered",label:"Mudar para Entregue"},{value:"cancelled",label:"Mudar para Cancelado"},{value:"pending_payment",label:"Mudar para Aguardando Pag."},{value:"delete",label:"Excluir Permanentemente"}],K=12,Ns=async(s,a,n)=>{const m=n*K,o=m+K-1;let t=T.from("orders").select("*, customer:customers(name, phone)",{count:"exact"}).eq("restaurant_id",s);a!=="all"&&(t=t.eq("status",a));const{data:c,error:u,count:l}=await t.order("created_at",{ascending:!1}).range(m,o);if(u)throw new Error(`Erro ao buscar pedidos: ${u.message}`);return{orders:c,count:l||0}},Cs=({order:s,onViewDetails:a,onAccept:n,onDecline:m,onDelete:o,isSelected:t,onSelect:c})=>{var h;const u=_e[s.status||"pending"],l=((h=s.customer)==null?void 0:h.name)||"Cliente Desconhecido",x=s.created_at?new Date(s.created_at).getTime().toString().slice(-4):"N/A";return e.jsxs(Y,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col relative",children:[e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx(X,{checked:t,onCheckedChange:j=>c(s.id,!!j),className:"h-5 w-5"})}),e.jsxs(Le,{className:"flex flex-row items-center justify-between space-y-0 pb-2 pl-12",children:[e.jsxs(Be,{className:"text-lg font-bold flex items-center gap-2",children:["Pedido #",x]}),e.jsxs(Xe,{className:k("text-white",u.color),children:[e.jsx(u.icon,{className:"h-3 w-3 mr-1"}),u.label]})]}),e.jsxs(ee,{className:"space-y-2 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",l]}),e.jsx("p",{className:"text-2xl font-extrabold text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]}),e.jsxs("div",{className:"flex justify-end pt-2 border-t gap-2",children:[(s.status==="pending"||s.status==="pending_payment")&&e.jsxs(e.Fragment,{children:[e.jsxs(E,{variant:"destructive",size:"sm",onClick:()=>m(s.id),children:[e.jsx(le,{className:"h-4 w-4 mr-1"})," Recusar"]}),e.jsxs(E,{variant:"default",size:"sm",onClick:()=>n(s.id),children:[e.jsx(_,{className:"h-4 w-4 mr-1"})," Aceitar"]})]}),e.jsx(E,{variant:"outline",size:"sm",onClick:()=>a(s),children:"Detalhes"}),e.jsxs(ie,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",children:e.jsx(cs,{className:"h-4 w-4"})})}),e.jsxs(de,{children:[e.jsxs(ue,{children:[e.jsx(me,{children:"Tem certeza que deseja excluir?"}),e.jsxs(he,{children:["Esta ação é permanente. O pedido #",x," será excluído permanentemente do sistema, incluindo todos os itens associados."]})]}),e.jsxs(pe,{children:[e.jsx(xe,{children:"Cancelar"}),e.jsx(fe,{onClick:()=>o(s.id),className:"bg-destructive hover:bg-destructive/90",children:"Excluir Permanentemente"})]})]})]})]})]})]})},ws=({status:s,onViewDetails:a,restaurantId:n,selectedOrders:m,setSelectedOrders:o,totalOrdersInView:t})=>{const c=H(),{stopSoundLoop:u}=rs(),[l,x]=p.useState(0),{data:h,isLoading:j,isError:v,error:d,refetch:g}=W({queryKey:["orders",s,n,l],queryFn:()=>Ns(n,s,l),enabled:!!n}),b=(h==null?void 0:h.orders)||[],w=(h==null?void 0:h.count)||0,r=Math.ceil(w/K),f=q({mutationFn:async({orderId:i,newStatus:N})=>{const{error:C}=await T.from("orders").update({status:N}).eq("id",i);if(C)throw new Error(C.message);return N},onSuccess:i=>{P.success(`Pedido ${i==="confirmed"?"aceito":"recusado"} com sucesso!`),c.invalidateQueries({queryKey:["orders"]})},onError:i=>P.error(`Erro ao atualizar pedido: ${i.message}`)}),y=q({mutationFn:async i=>{const{error:N}=await T.from("orders").delete().eq("id",i);if(N)throw new Error(N.message)},onSuccess:()=>{P.success("Pedido excluído permanentemente."),c.invalidateQueries({queryKey:["orders"]})},onError:i=>P.error(`Erro ao excluir pedido: ${i.message}`)}),M=i=>{u(),f.mutate({orderId:i,newStatus:"confirmed"})},I=i=>{u(),f.mutate({orderId:i,newStatus:"cancelled"})},O=i=>{u(),a(i)},z=i=>{y.mutate(i)},Te=p.useCallback(i=>{x(i-1)},[]),De=p.useCallback((i,N)=>{o(C=>N?[...C,i]:C.filter(F=>F!==i))},[o]),Me=p.useCallback(i=>{if(i){const N=b.map(C=>C.id);o(C=>[...new Set([...C,...N])])}else{const N=new Set(b.map(C=>C.id));o(C=>C.filter(F=>!N.has(F)))}},[b,o]),Re=b.length>0&&b.every(i=>m.includes(i.id));return j?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((i,N)=>e.jsx(Y,{children:e.jsx(ee,{className:"p-4 space-y-3",children:e.jsx(L,{className:"h-32 w-full"})})},N))}):v?e.jsxs(Ze,{variant:"destructive",children:[e.jsx(ls,{className:"h-4 w-4"}),e.jsx(Je,{children:"Erro ao carregar pedidos"}),e.jsx(We,{children:d instanceof Error?d.message:"Ocorreu um erro desconhecido."}),e.jsxs(E,{onClick:()=>g(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(je,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]}):!b||b.length===0?e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg border",children:[e.jsx(ge,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifique o status selecionado ou aguarde novos pedidos."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg bg-muted/50",children:[e.jsx(X,{checked:Re,onCheckedChange:Me,className:"h-5 w-5"}),e.jsxs("span",{className:"text-sm font-medium",children:["Selecionar todos (",b.length,") nesta página."]}),t>0&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-auto",children:[t," pedidos selecionados no total."]})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:b.map(i=>e.jsx(Cs,{order:i,onViewDetails:O,onAccept:M,onDecline:I,onDelete:z,isSelected:m.includes(i.id),onSelect:De},i.id))}),r>1&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(fs,{currentPage:l+1,totalPages:r,onPageChange:Te})})]})},ea=()=>{const{restaurant:s}=Ie(),a=H(),[n,m]=p.useState(null),[o,t]=p.useState(!1),[c,u]=p.useState([]),[l,x]=p.useState(""),h=r=>{m(r),t(!0)},j=()=>{t(!1),m(null)},v=()=>{a.invalidateQueries({queryKey:["orders"]}),P.info("Atualizando pedidos...",{description:"Buscando novos dados no servidor."})},d=q({mutationFn:async({orderIds:r,action:f})=>{if(f==="delete"){const{error:y}=await T.from("orders").delete().in("id",r);if(y)throw new Error(y.message);return"deleted"}else{const{error:y}=await T.from("orders").update({status:f}).in("id",r);if(y)throw new Error(y.message);return"updated"}},onSuccess:(r,f)=>{if(r==="deleted")P.success(`${f.orderIds.length} pedidos excluídos permanentemente.`);else{const y=_e[f.action].label;P.success(`${f.orderIds.length} pedidos atualizados para "${y}".`)}u([]),x(""),a.invalidateQueries({queryKey:["orders"]})},onError:r=>{P.error(`Erro na ação em massa: ${r.message}`)}}),g=()=>{var r;!l||c.length===0||(l==="delete"?(r=document.getElementById("mass-delete-trigger"))==null||r.click():d.mutate({orderIds:c,action:l}))},b=[{value:"pending_payment",label:"Aguardando Pag."},{value:"pending",label:"Pendentes"},{value:"confirmed",label:"Confirmados"},{value:"preparing",label:"Em Preparação"},{value:"ready",label:"Prontos"},{value:"delivering",label:"Em Entrega"},{value:"delivered",label:"Entregues"},{value:"cancelled",label:"Cancelados"},{value:"all",label:"Todos"}],w=d.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(xs,{order:n,isOpen:o,onClose:j}),e.jsxs(ie,{children:[e.jsx(ce,{asChild:!0,children:e.jsx("button",{id:"mass-delete-trigger",className:"hidden"})}),e.jsxs(de,{children:[e.jsxs(ue,{children:[e.jsxs(me,{children:["Tem certeza que deseja excluir ",c.length," pedidos?"]}),e.jsxs(he,{children:["Esta ação é permanente. ",c.length," pedidos serão excluídos permanentemente do sistema."]})]}),e.jsxs(pe,{children:[e.jsx(xe,{children:"Cancelar"}),e.jsx(fe,{onClick:()=>d.mutate({orderIds:c,action:"delete"}),className:"bg-destructive hover:bg-destructive/90",disabled:w,children:w?"Excluindo...":"Excluir Permanentemente"})]})]})]}),e.jsxs("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(E,{variant:"outline",onClick:v,children:[e.jsx(je,{className:"h-4 w-4 mr-2"})," Atualizar Dados"]})}),c.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-lg bg-card shadow-lg animate-fade-in",children:[e.jsx(hs,{className:"h-5 w-5 text-primary mr-2"}),e.jsxs("span",{className:"text-sm font-medium mr-4",children:[c.length," selecionado(s)"]}),e.jsxs(se,{value:l,onValueChange:r=>x(r),children:[e.jsx(ae,{className:"w-[200px]",children:e.jsx(te,{placeholder:"Ação em Massa"})}),e.jsx(ne,{children:ys.map(r=>e.jsx(re,{value:r.value,children:r.label},r.value))})]}),e.jsx(E,{onClick:g,disabled:!l||w,children:w?e.jsx(ts,{className:"h-4 w-4 animate-spin"}):"Aplicar"})]})]}),s!=null&&s.id?e.jsxs(Oe,{defaultValue:"pending_payment",children:[e.jsx(ze,{className:"w-full overflow-x-auto justify-start",children:b.map(r=>e.jsx(Fe,{value:r.value,className:"whitespace-nowrap",children:r.label},r.value))}),b.map(r=>e.jsx($e,{value:r.value,className:"mt-6",children:e.jsx(ws,{status:r.value,onViewDetails:h,restaurantId:s.id,selectedOrders:c,setSelectedOrders:u,totalOrdersInView:c.length})},r.value))]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(L,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Carregando dados do restaurante..."})]})]})]})};export{ea as default};
