import{b as Q,u as K,c as B,j as e}from"./tanstack-DS1wz2fm.js";import{r as x,f as Le}from"./vendor-DPb28zz8.js";import{s as D}from"./client-BP8r4skJ.js";import{B as P,b as Be}from"./button-_j8oPIi3.js";import{C as se,a as ae,b as Fe,c as Oe}from"./card-Dk0N4EIb.js";import{S as te,a as re,b as ne,c as oe,d as le,C as T,T as ze,e as $e,f as Ke,g as Ve}from"./select-CGzenC0U.js";import{D as Z,a as W,b as He,c as Qe,d as Ge,e as Ue,B as Xe}from"./index-CXTxRRia.js";import{S as E}from"./skeleton-DN386mkj.js";import{A as Je,a as Ze,b as We}from"./alert-L5svLWqo.js";import{c as q,u as S,b as k,g as Ye,h as ie,P as G,j as Y,i as es,m as ss,n as as,L as ts,X as ce}from"./index-DBZg2ylP.js";import{S as M}from"./separator-Cya5-GtD.js";import{P as rs}from"./printer-Cv3xG9xO.js";import{A as de,a as me,b as ue,c as he,d as pe,e as xe,f as fe,g as ge,h as je,u as ns}from"./DashboardLayout-B2hfVAIH.js";import{u as os}from"./index-CJmVBZLB.js";import{T as ls}from"./terminal-Cth7ikQR.js";import{S as be}from"./shopping-cart-Drt7Kk0O.js";import{D as is}from"./dollar-sign-D4L2EPTK.js";import{T as cs}from"./trash-2-BAi4mgIW.js";import"./supabase-BT-vd-uw.js";import"./index-CWI7tbOH.js";import"./index-Dm27xrF8.js";import"./index-DCbVQLsn.js";import"./Logo-B2bcfFU7.js";import"./package-CrdXVLc7.js";import"./clock-B7x_poEz.js";import"./credit-card-DqK7gbmc.js";import"./truck-B59axV_a.js";import"./settings-J51JeWAu.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=q("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=q("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=q("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=q("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=q("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),ee={pending:{label:"Pendente"},confirmed:{label:"Confirmado"},preparing:{label:"Em Preparação"},ready:{label:"Pronto"},delivering:{label:"Em Entrega"},delivered:{label:"Entregue"},cancelled:{label:"Cancelado"},pending_payment:{label:"Aguardando Pagamento"}},ps=async s=>{const{data:t,error:r}=await D.from("order_items").select("*, products(name)").eq("order_id",s);if(r)throw new Error(r.message);return t},xs=async s=>{const{data:t,error:r}=await D.from("orders").select("*, customer:customers(name, phone, cpf_cnpj), payment_methods(name)").eq("id",s).limit(1).single();if(r)throw new Error(`Erro ao buscar detalhes do pedido: ${r.message}`);return t},fs=({order:s,isOpen:t,onClose:r})=>{var v;const u=Q(),[l,n]=x.useState("pending"),{data:o,isLoading:m,isError:c}=K({queryKey:["orderDetails",s==null?void 0:s.id],queryFn:()=>xs(s.id),enabled:!!s&&t});x.useEffect(()=>{o!=null&&o.status&&n(o.status)},[o]);const{data:h,isLoading:p}=K({queryKey:["orderItems",s==null?void 0:s.id],queryFn:()=>ps(s.id),enabled:!!s&&t}),j=B({mutationFn:async a=>{if(!s)throw new Error("Pedido não encontrado.");const{error:i}=await D.from("orders").update({status:a}).eq("id",s.id);if(i)throw new Error(i.message)},onSuccess:(a,i)=>{S.success(`Status do pedido atualizado para "${ee[i].label}"`),u.invalidateQueries({queryKey:["orders"]}),r()},onError:a=>{S.error(`Erro ao atualizar status: ${a.message}`)}}),b=()=>{window.print()};if(!s||m)return e.jsx(Z,{open:t,onOpenChange:r,children:e.jsxs(W,{className:"sm:max-w-lg",children:[e.jsx(E,{className:"h-6 w-1/2 mb-4"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(E,{className:"h-4 w-full"}),e.jsx(E,{className:"h-4 w-full"}),e.jsx(E,{className:"h-4 w-full"}),e.jsx(M,{}),e.jsx(E,{className:"h-48 w-full"}),e.jsx(M,{}),e.jsx(E,{className:"h-10 w-full"})]})]})});if(c||!o)return null;const y=o.created_at?new Date(o.created_at).getTime().toString().slice(-4):"N/A",f=o.customer,g=((v=o.payment_methods)==null?void 0:v.name)||"Não Informado";return e.jsx(Z,{open:t,onOpenChange:r,children:e.jsxs(W,{className:"sm:max-w-lg",children:[e.jsxs(He,{children:[e.jsxs(Qe,{children:["Detalhes do Pedido #",y]}),e.jsx(Ge,{children:"Gerencie os detalhes e o status deste pedido."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold",children:"Cliente"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nome: ",(f==null?void 0:f.name)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Telefone: ",(f==null?void 0:f.phone)||"N/A"]}),(f==null?void 0:f.cpf_cnpj)&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["CPF/CNPJ: ",f.cpf_cnpj]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Endereço: ",o.delivery_address||"Retirada no Local"]})]}),e.jsx(M,{}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold",children:"Pagamento"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Método: ",g]}),g==="Dinheiro"&&o.total_amount&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Troco para: ",o.total_amount>0?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o.total_amount):"Não precisa de troco"]})]}),e.jsx(M,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Itens do Pedido"}),p?e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{className:"h-8 w-full"}),e.jsx(E,{className:"h-8 w-full"})]}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto pr-2",children:h==null?void 0:h.map(a=>{var i;return e.jsxs("div",{className:"flex justify-between items-start text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[a.quantity,"x ",((i=a.products)==null?void 0:i.name)||"Produto desconhecido"]}),a.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground italic",children:["Obs: ",a.notes]})]}),e.jsx("span",{className:"text-muted-foreground",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.subtotal)})]},a.id)})})]}),e.jsx(M,{}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsx("span",{className:"font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o.delivery_fee||0)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-base",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o.total_amount)})]})]}),e.jsx(M,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Atualizar Status"}),e.jsxs(te,{value:l,onValueChange:a=>n(a),children:[e.jsx(re,{children:e.jsx(ne,{placeholder:"Selecione um status"})}),e.jsx(oe,{children:Object.entries(ee).map(([a,{label:i}])=>e.jsx(le,{value:a,children:i},a))})]})]})]}),e.jsxs(Ue,{className:"flex-col sm:flex-row sm:justify-between sm:space-x-2",children:[e.jsxs(P,{variant:"outline",onClick:b,className:"w-full sm:w-auto mb-2 sm:mb-0",children:[e.jsx(rs,{className:"h-4 w-4 mr-2"})," Imprimir Pedido"]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(P,{variant:"outline",onClick:r,children:"Cancelar"}),e.jsx(P,{onClick:()=>j.mutate(l),disabled:j.isPending||l===o.status,children:j.isPending?"Salvando...":"Salvar Alterações"})]})]})]})})},ye=({className:s,...t})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:k("mx-auto flex w-full justify-center",s),...t});ye.displayName="Pagination";const Ne=x.forwardRef(({className:s,...t},r)=>e.jsx("ul",{ref:r,className:k("flex flex-row items-center gap-1",s),...t}));Ne.displayName="PaginationContent";const A=x.forwardRef(({className:s,...t},r)=>e.jsx("li",{ref:r,className:k("",s),...t}));A.displayName="PaginationItem";const R=({className:s,isActive:t,size:r="icon",...u})=>e.jsx("a",{"aria-current":t?"page":void 0,className:k(Be({variant:t?"outline":"ghost",size:r}),s),...u});R.displayName="PaginationLink";const we=({className:s,...t})=>e.jsxs(R,{"aria-label":"Go to previous page",size:"default",className:k("gap-1 pl-2.5",s),...t,children:[e.jsx(ds,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});we.displayName="PaginationPrevious";const Ce=({className:s,...t})=>e.jsxs(R,{"aria-label":"Go to next page",size:"default",className:k("gap-1 pr-2.5",s),...t,children:[e.jsx("span",{children:"Next"}),e.jsx(ms,{className:"h-4 w-4"})]});Ce.displayName="PaginationNext";const V=({className:s,...t})=>e.jsxs("span",{"aria-hidden":!0,className:k("flex h-9 w-9 items-center justify-center",s),...t,children:[e.jsx(us,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]});V.displayName="PaginationEllipsis";const gs=({currentPage:s,totalPages:t,onPageChange:r})=>{if(t<=1)return null;const l=(()=>{const n=[],m=Math.max(1,s-Math.floor(2.5)),c=Math.min(t,m+5-1);if(c-m+1<5){const h=Math.max(1,c-5+1);for(let p=h;p<=c;p++)n.push(p)}else for(let h=m;h<=c;h++)n.push(h);return n})();return e.jsx(ye,{children:e.jsxs(Ne,{children:[e.jsx(A,{children:e.jsx(we,{onClick:()=>r(s-1),className:k(s===1&&"pointer-events-none opacity-50")})}),l[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx(A,{children:e.jsx(R,{onClick:()=>r(1),children:"1"})}),l[0]>2&&e.jsx(A,{children:e.jsx(V,{})})]}),l.map(n=>e.jsx(A,{children:e.jsx(R,{isActive:n===s,onClick:()=>r(n),children:n})},n)),l[l.length-1]<t&&e.jsxs(e.Fragment,{children:[l[l.length-1]<t-1&&e.jsx(A,{children:e.jsx(V,{})}),e.jsx(A,{children:e.jsx(R,{onClick:()=>r(t),children:t})})]}),e.jsx(A,{children:e.jsx(Ce,{onClick:()=>r(s+1),className:k(s===t&&"pointer-events-none opacity-50")})})]})})};var F="Checkbox",[js,ea]=Ye(F),[bs,U]=js(F);function vs(s){const{__scopeCheckbox:t,checked:r,children:u,defaultChecked:l,disabled:n,form:o,name:m,onCheckedChange:c,required:h,value:p="on",internal_do_not_use_render:j}=s,[b,y]=as({prop:r,defaultProp:l??!1,onChange:c,caller:F}),[f,g]=x.useState(null),[v,a]=x.useState(null),i=x.useRef(!1),N=f?!!o||!!f.closest("form"):!0,I={checked:b,disabled:n,setChecked:y,control:f,setControl:g,name:m,form:o,value:p,hasConsumerStoppedPropagationRef:i,required:h,defaultChecked:_(l)?!1:l,isFormControl:N,bubbleInput:v,setBubbleInput:a};return e.jsx(bs,{scope:t,...I,children:ys(j)?j(I):u})}var ke="CheckboxTrigger",Ee=x.forwardRef(({__scopeCheckbox:s,onKeyDown:t,onClick:r,...u},l)=>{const{control:n,value:o,disabled:m,checked:c,required:h,setControl:p,setChecked:j,hasConsumerStoppedPropagationRef:b,isFormControl:y,bubbleInput:f}=U(ke,s),g=ie(l,p),v=x.useRef(c);return x.useEffect(()=>{const a=n==null?void 0:n.form;if(a){const i=()=>j(v.current);return a.addEventListener("reset",i),()=>a.removeEventListener("reset",i)}},[n,j]),e.jsx(G.button,{type:"button",role:"checkbox","aria-checked":_(c)?"mixed":c,"aria-required":h,"data-state":De(c),"data-disabled":m?"":void 0,disabled:m,value:o,...u,ref:g,onKeyDown:Y(t,a=>{a.key==="Enter"&&a.preventDefault()}),onClick:Y(r,a=>{j(i=>_(i)?!0:!i),f&&y&&(b.current=a.isPropagationStopped(),b.current||a.stopPropagation())})})});Ee.displayName=ke;var X=x.forwardRef((s,t)=>{const{__scopeCheckbox:r,name:u,checked:l,defaultChecked:n,required:o,disabled:m,value:c,onCheckedChange:h,form:p,...j}=s;return e.jsx(vs,{__scopeCheckbox:r,checked:l,defaultChecked:n,disabled:m,required:o,onCheckedChange:h,name:u,form:p,value:c,internal_do_not_use_render:({isFormControl:b})=>e.jsxs(e.Fragment,{children:[e.jsx(Ee,{...j,ref:t,__scopeCheckbox:r}),b&&e.jsx(_e,{__scopeCheckbox:r})]})})});X.displayName=F;var Pe="CheckboxIndicator",Se=x.forwardRef((s,t)=>{const{__scopeCheckbox:r,forceMount:u,...l}=s,n=U(Pe,r);return e.jsx(es,{present:u||_(n.checked)||n.checked===!0,children:e.jsx(G.span,{"data-state":De(n.checked),"data-disabled":n.disabled?"":void 0,...l,ref:t,style:{pointerEvents:"none",...s.style}})})});Se.displayName=Pe;var Ae="CheckboxBubbleInput",_e=x.forwardRef(({__scopeCheckbox:s,...t},r)=>{const{control:u,hasConsumerStoppedPropagationRef:l,checked:n,defaultChecked:o,required:m,disabled:c,name:h,value:p,form:j,bubbleInput:b,setBubbleInput:y}=U(Ae,s),f=ie(r,y),g=os(n),v=ss(u);x.useEffect(()=>{const i=b;if(!i)return;const N=window.HTMLInputElement.prototype,L=Object.getOwnPropertyDescriptor(N,"checked").set,O=!l.current;if(g!==n&&L){const z=new Event("click",{bubbles:O});i.indeterminate=_(n),L.call(i,_(n)?!1:n),i.dispatchEvent(z)}},[b,g,n,l]);const a=x.useRef(_(n)?!1:n);return e.jsx(G.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??a.current,required:m,disabled:c,name:h,value:p,form:j,...t,tabIndex:-1,ref:f,style:{...t.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});_e.displayName=Ae;function ys(s){return typeof s=="function"}function _(s){return s==="indeterminate"}function De(s){return _(s)?"indeterminate":s?"checked":"unchecked"}const J=x.forwardRef(({className:s,...t},r)=>e.jsx(X,{ref:r,className:k("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Se,{className:k("flex items-center justify-center text-current"),children:e.jsx(T,{className:"h-4 w-4"})})}));J.displayName=X.displayName;const Te={pending:{label:"Pendente",icon:be,color:"bg-yellow-500 hover:bg-yellow-600"},confirmed:{label:"Confirmado",icon:T,color:"bg-blue-500 hover:bg-blue-600"},preparing:{label:"Em Preparação",icon:T,color:"bg-orange-500 hover:bg-orange-600"},ready:{label:"Pronto",icon:T,color:"bg-green-500 hover:bg-green-600"},delivering:{label:"Em Entrega",icon:T,color:"bg-indigo-500 hover:bg-indigo-600"},delivered:{label:"Entregue",icon:T,color:"bg-primary hover:bg-primary/90"},cancelled:{label:"Cancelado",icon:ce,color:"bg-destructive hover:bg-destructive/90"},pending_payment:{label:"Aguardando Pag.",icon:is,color:"bg-gray-500 hover:bg-gray-600"}},Ns=[{value:"pending",label:"Mudar para Pendente"},{value:"confirmed",label:"Mudar para Confirmado"},{value:"preparing",label:"Mudar para Em Preparação"},{value:"ready",label:"Mudar para Pronto"},{value:"delivering",label:"Mudar para Em Entrega"},{value:"delivered",label:"Mudar para Entregue"},{value:"cancelled",label:"Mudar para Cancelado"},{value:"pending_payment",label:"Mudar para Aguardando Pag."},{value:"delete",label:"Excluir Permanentemente"}],H=12,ws=async(s,t,r)=>{const u=r*H,l=u+H-1;let n=D.from("orders").select("*, customer:customers(name, phone)",{count:"exact"}).eq("restaurant_id",s);t!=="all"&&(n=n.eq("status",t));const{data:o,error:m,count:c}=await n.order("created_at",{ascending:!1}).range(u,l);if(m)throw new Error(`Erro ao buscar pedidos: ${m.message}`);return{orders:o,count:c||0}},Cs=({order:s,onViewDetails:t,onAccept:r,onDecline:u,onDelete:l,isSelected:n,onSelect:o})=>{var p;const m=Te[s.status||"pending"],c=((p=s.customer)==null?void 0:p.name)||"Cliente Desconhecido",h=s.created_at?new Date(s.created_at).getTime().toString().slice(-4):"N/A";return e.jsxs(se,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col relative",children:[e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx(J,{checked:n,onCheckedChange:j=>o(s.id,!!j),className:"h-5 w-5"})}),e.jsxs(Fe,{className:"flex flex-row items-center justify-between space-y-0 pb-2 pl-12",children:[e.jsxs(Oe,{className:"text-lg font-bold flex items-center gap-2",children:["Pedido #",h]}),e.jsxs(Xe,{className:k("text-white",m.color),children:[e.jsx(m.icon,{className:"h-3 w-3 mr-1"}),m.label]})]}),e.jsxs(ae,{className:"space-y-2 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",c]}),e.jsx("p",{className:"text-2xl font-extrabold text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]}),e.jsxs("div",{className:"flex justify-end pt-2 border-t gap-2",children:[(s.status==="pending"||s.status==="pending_payment")&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{variant:"destructive",size:"sm",onClick:()=>u(s.id),children:[e.jsx(ce,{className:"h-4 w-4 mr-1"})," Recusar"]}),e.jsxs(P,{variant:"default",size:"sm",onClick:()=>r(s.id),children:[e.jsx(T,{className:"h-4 w-4 mr-1"})," Aceitar"]})]}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>t(s),children:"Detalhes"}),e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",children:e.jsx(cs,{className:"h-4 w-4"})})}),e.jsxs(ue,{children:[e.jsxs(he,{children:[e.jsx(pe,{children:"Tem certeza que deseja excluir?"}),e.jsxs(xe,{children:["Esta ação é permanente. O pedido #",h," será excluído permanentemente do sistema, incluindo todos os itens associados."]})]}),e.jsxs(fe,{children:[e.jsx(ge,{children:"Cancelar"}),e.jsx(je,{onClick:()=>l(s.id),className:"bg-destructive hover:bg-destructive/90",children:"Excluir Permanentemente"})]})]})]})]})]})]})},ks=({status:s,onViewDetails:t,restaurantId:r,selectedOrders:u,setSelectedOrders:l,totalOrdersInView:n})=>{const o=Q(),{stopSoundLoop:m}=ns(),[c,h]=x.useState(0),{data:p,isLoading:j,isError:b,error:y,refetch:f}=K({queryKey:["orders",s,r,c],queryFn:()=>ws(r,s,c),enabled:!!r}),g=(p==null?void 0:p.orders)||[],v=(p==null?void 0:p.count)||0,a=Math.ceil(v/H),i=B({mutationFn:async({orderId:d,newStatus:w})=>{const{error:C}=await D.from("orders").update({status:w}).eq("id",d);if(C)throw new Error(C.message);return w},onSuccess:d=>{S.success(`Pedido ${d==="confirmed"?"aceito":"recusado"} com sucesso!`),o.invalidateQueries({queryKey:["orders"]})},onError:d=>S.error(`Erro ao atualizar pedido: ${d.message}`)}),N=B({mutationFn:async d=>{const{error:w}=await D.from("orders").delete().eq("id",d);if(w)throw new Error(w.message)},onSuccess:()=>{S.success("Pedido excluído permanentemente."),o.invalidateQueries({queryKey:["orders"]})},onError:d=>S.error(`Erro ao excluir pedido: ${d.message}`)}),I=d=>{m(),i.mutate({orderId:d,newStatus:"confirmed"})},L=d=>{m(),i.mutate({orderId:d,newStatus:"cancelled"})},O=d=>{m(),t(d)},z=d=>{N.mutate(d)},Me=x.useCallback(d=>{h(d-1)},[]),Re=x.useCallback((d,w)=>{l(C=>w?[...C,d]:C.filter($=>$!==d))},[l]),Ie=x.useCallback(d=>{if(d){const w=g.map(C=>C.id);l(C=>[...new Set([...C,...w])])}else{const w=new Set(g.map(C=>C.id));l(C=>C.filter($=>!w.has($)))}},[g,l]),qe=g.length>0&&g.every(d=>u.includes(d.id));return j?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((d,w)=>e.jsx(se,{children:e.jsx(ae,{className:"p-4 space-y-3",children:e.jsx(E,{className:"h-32 w-full"})})},w))}):b?e.jsxs(Je,{variant:"destructive",children:[e.jsx(ls,{className:"h-4 w-4"}),e.jsx(Ze,{children:"Erro ao carregar pedidos"}),e.jsx(We,{children:y instanceof Error?y.message:"Ocorreu um erro desconhecido."}),e.jsxs(P,{onClick:()=>f(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]}):!g||g.length===0?e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg border",children:[e.jsx(be,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifique o status selecionado ou aguarde novos pedidos."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg bg-muted/50",children:[e.jsx(J,{checked:qe,onCheckedChange:Ie,className:"h-5 w-5"}),e.jsxs("span",{className:"text-sm font-medium",children:["Selecionar todos (",g.length,") nesta página."]}),n>0&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-auto",children:[n," pedidos selecionados no total."]})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:g.map(d=>e.jsx(Cs,{order:d,onViewDetails:O,onAccept:I,onDecline:L,onDelete:z,isSelected:u.includes(d.id),onSelect:Re},d.id))}),a>1&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(gs,{currentPage:c+1,totalPages:a,onPageChange:Me})})]})},sa=()=>{const{restaurant:s}=Le(),t=Q(),[r,u]=x.useState(null),[l,n]=x.useState(!1),[o,m]=x.useState([]),[c,h]=x.useState(""),p=a=>{u(a),n(!0)},j=()=>{n(!1),u(null)},b=()=>{t.invalidateQueries({queryKey:["orders"]}),S.info("Atualizando pedidos...",{description:"Buscando novos dados no servidor."})},y=B({mutationFn:async({orderIds:a,action:i})=>{if(i==="delete"){const{error:N}=await D.from("orders").delete().in("id",a);if(N)throw new Error(N.message);return"deleted"}else{const{error:N}=await D.from("orders").update({status:i}).in("id",a);if(N)throw new Error(N.message);return"updated"}},onSuccess:(a,i)=>{if(a==="deleted")S.success(`${i.orderIds.length} pedidos excluídos permanentemente.`);else{const N=Te[i.action].label;S.success(`${i.orderIds.length} pedidos atualizados para "${N}".`)}m([]),h(""),t.invalidateQueries({queryKey:["orders"]})},onError:a=>{S.error(`Erro na ação em massa: ${a.message}`)}}),f=()=>{var a;!c||o.length===0||(c==="delete"?(a=document.getElementById("mass-delete-trigger"))==null||a.click():y.mutate({orderIds:o,action:c}))},g=[{value:"pending_payment",label:"Aguardando Pag."},{value:"pending",label:"Pendentes"},{value:"confirmed",label:"Confirmados"},{value:"preparing",label:"Em Preparação"},{value:"ready",label:"Prontos"},{value:"delivering",label:"Em Entrega"},{value:"delivered",label:"Entregues"},{value:"cancelled",label:"Cancelados"},{value:"all",label:"Todos"}],v=y.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(fs,{order:r,isOpen:l,onClose:j}),e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx("button",{id:"mass-delete-trigger",className:"hidden"})}),e.jsxs(ue,{children:[e.jsxs(he,{children:[e.jsxs(pe,{children:["Tem certeza que deseja excluir ",o.length," pedidos?"]}),e.jsxs(xe,{children:["Esta ação é permanente. ",o.length," pedidos serão excluídos permanentemente do sistema."]})]}),e.jsxs(fe,{children:[e.jsx(ge,{children:"Cancelar"}),e.jsx(je,{onClick:()=>y.mutate({orderIds:o,action:"delete"}),className:"bg-destructive hover:bg-destructive/90",disabled:v,children:v?"Excluindo...":"Excluir Permanentemente"})]})]})]}),e.jsxs("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(P,{variant:"outline",onClick:b,children:[e.jsx(ve,{className:"h-4 w-4 mr-2"})," Atualizar Dados"]})}),o.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-lg bg-card shadow-lg animate-fade-in",children:[e.jsx(hs,{className:"h-5 w-5 text-primary mr-2"}),e.jsxs("span",{className:"text-sm font-medium mr-4",children:[o.length," selecionado(s)"]}),e.jsxs(te,{value:c,onValueChange:a=>h(a),children:[e.jsx(re,{className:"w-[200px]",children:e.jsx(ne,{placeholder:"Ação em Massa"})}),e.jsx(oe,{children:Ns.map(a=>e.jsx(le,{value:a.value,children:a.label},a.value))})]}),e.jsx(P,{onClick:f,disabled:!c||v,children:v?e.jsx(ts,{className:"h-4 w-4 animate-spin"}):"Aplicar"})]})]}),s!=null&&s.id?e.jsxs(ze,{defaultValue:"pending_payment",children:[e.jsx($e,{className:"w-full overflow-x-auto justify-start",children:g.map(a=>e.jsx(Ke,{value:a.value,className:"whitespace-nowrap",children:a.label},a.value))}),g.map(a=>e.jsx(Ve,{value:a.value,className:"mt-6",children:e.jsx(ks,{status:a.value,onViewDetails:p,restaurantId:s.id,selectedOrders:o,setSelectedOrders:m,totalOrdersInView:o.length})},a.value))]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Carregando dados do restaurante..."})]})]})]})};export{sa as default};
