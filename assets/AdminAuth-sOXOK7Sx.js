import{j as e}from"./tanstack-D8i8yNxB.js";import{u as y,r as c,L as N}from"./vendor-Dl0Wzy4_.js";import{L as v}from"./Logo-icgQSIVU.js";import{B as b}from"./button-C55b2aF4.js";import{L as x,I as f}from"./label-DeCFX7p2.js";import{C as L,b as C,c as S,d as E,a as k}from"./card-Dznu5Au1.js";import{c as A,L as R,u as d}from"./index-CXegt8rb.js";import{s as n}from"./client-BmrnLCXS.js";import"./package-RV36HVPC.js";import"./supabase-A1WgB1xz.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=A("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),P=async i=>{const{data:t,error:o}=await n.from("user_roles").select("role").eq("user_id",i).in("role",["admin","moderator"]).limit(1).single();return o&&o.code!=="PGRST116"?(console.error("Error checking role:",o),null):(t==null?void 0:t.role)||null},M=()=>{const i=y(),[t,o]=c.useState(!1),[m,j]=c.useState(""),[u,g]=c.useState(""),[l,h]=c.useState(null),p=async r=>{const a=await P(r.id);a==="admin"||a==="moderator"?(d.success("Login de administrador efetuado com sucesso!"),i("/dashboard",{replace:!0})):(d.error("Acesso negado.",{description:"Esta conta não possui permissão de administrador/moderador. Redirecionando para o menu.",duration:5e3}),await n.auth.signOut(),i("/menu",{replace:!0}))};c.useEffect(()=>{const{data:{subscription:r}}=n.auth.onAuthStateChange((a,s)=>{h(s),s!=null&&s.user&&p(s.user)});return n.auth.getSession().then(({data:{session:a}})=>{h(a),a!=null&&a.user&&p(a.user)}),()=>r.unsubscribe()},[i]);const w=async r=>{r.preventDefault(),o(!0);try{const{data:a,error:s}=await n.auth.signInWithPassword({email:m,password:u});if(s)throw s}catch(a){d.error(a.message||"Erro ao processar autenticação")}finally{o(!1)}};return l!=null&&l.user?e.jsx(LoadingSpinner,{}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(v,{className:"justify-center mb-4"})}),e.jsxs(L,{className:"shadow-xl border-2",children:[e.jsxs(C,{className:"space-y-1",children:[e.jsxs(S,{className:"text-2xl font-bold text-center flex items-center justify-center gap-2",children:[e.jsx(I,{className:"h-6 w-6 text-destructive"}),"Acesso do Restaurante"]}),e.jsx(E,{className:"text-center",children:"Utilize seu email e senha de administrador para acessar o painel."})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"email",children:"Email *"}),e.jsx(f,{id:"email",type:"email",placeholder:"seu@email.com",value:m,onChange:r=>j(r.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"password",children:"Senha *"}),e.jsx(f,{id:"password",type:"password",placeholder:"••••••••",value:u,onChange:r=>g(r.target.value),required:!0,className:"h-12"})]}),e.jsx(b,{type:"submit",className:"w-full",size:"lg",disabled:t,children:t?e.jsx(R,{className:"h-4 w-4 animate-spin mr-2"}):"Entrar no Painel"})]}),e.jsx("div",{className:"text-center pt-2",children:e.jsx(N,{to:"/auth",className:"text-sm text-muted-foreground hover:underline",children:"Acessar como Cliente"})})]})]})]})})};export{M as default};
