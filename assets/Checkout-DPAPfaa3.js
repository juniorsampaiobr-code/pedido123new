import{b as pe,j as e,u as is,c as Ve}from"./tanstack-d4AvmB45.js";import{r as a,u as cs,h as ls,j as ds,L as Oe}from"./vendor-CnEXr6gt.js";import{s as A}from"./client-D5i5GwB9.js";import{c as ms,d as bt,e as Be,P as Se,f as Le,g as us,h as ps,i as fs,a as xe,u as $,L as he,p as hs,b as it}from"./index-BgU_Ohaw.js";import{L as xs,g as ct,c as lt}from"./location-DiOtnTsn.js";import{u as gs}from"./use-auth-status-b07NBuTX.js";import{o as vt,s as F,e as ys,u as dt,C as Ce,t as mt}from"./types-DKlirIXB.js";import{B as U}from"./button-uXpppU7y.js";import{C as Z,b as Q,c as X,a as H}from"./card--SleCluC.js";import{I as fe,L as z}from"./label-IGoAjKer.js";import{T as ws}from"./textarea-BUmbFYFk.js";import{c as _t,R as js,I as bs}from"./index-CtK-hltL.js";import{u as vs}from"./index-DrlxvCXN.js";import{u as _s}from"./index-KNP7Yozt.js";import{S as ut}from"./separator-D3Ut4vw7.js";import{A as re,a as me,b as ue}from"./alert-CjRC2f7z.js";import{P as Ns,M as Cs}from"./PhoneInput-BbDPJr9o.js";import{S as Es,C as Rs,L as Ps}from"./CustomerProfileModal-BtZaFCkT.js";import{D as pt,a as ft,b as Ss,c as $s,d as As}from"./dialog-BjTB0Ga_.js";import{C as Nt}from"./credit-card-DrGQU5NJ.js";import{C as Is}from"./CpfCnpjInput-C1dix2BI.js";import{M as ze}from"./map-pin-4dMEEEil.js";import{A as ks,a as Ds,b as Ms,c as Fs,d as Vs,e as Os,g as Ts}from"./alert-dialog-BE6A0FFb.js";import{C as Re}from"./circle-alert-CulH_yTG.js";import{F as ht}from"./form-X_aXjJ1S.js";import{T as xt}from"./terminal-CdIn6Bd-.js";import{R as Ls}from"./pt-BR-B0gCqQ6t.js";import{A as zs}from"./arrow-left-CvseTlpN.js";import{U as gt}from"./user-CcqPMsQY.js";import{T as Te}from"./truck-D3Mez6UO.js";import{C as qs}from"./circle-check-big-Cq_hHGo2.js";import{S as Bs}from"./save-Duw6Mz8g.js";import{D as Gs}from"./dollar-sign-V2hkfWQT.js";import"./supabase-BZV_3FV3.js";import"./skeleton-DtCViCAU.js";import"./store-CPo9G3GN.js";import"./package-DH0Rnva2.js";import"./check-DRUGtyiT.js";import"./circle-x-DZExYmnu.js";import"./euro-BDYQg11b.js";import"./format-BeKxgCCE.js";import"./index-CIroAndt.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=ms("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Us=async r=>{const{data:t,error:n}=await A.from("payment_settings").select("mercado_pago_public_key").eq("restaurant_id",r).limit(1).single();if(n&&n.code!=="PGRST116")throw new Error(`Error fetching payment settings: ${n.message}`);return(t==null?void 0:t.mercado_pago_public_key)||null},Ct=r=>pe({queryKey:["mercadoPagoPublicKey",r],queryFn:()=>Us(r),enabled:!!r,staleTime:1e3*60*60*24});var Ge="Radio",[Zs,Et]=bt(Ge),[Qs,Xs]=Zs(Ge),Rt=a.forwardRef((r,t)=>{const{__scopeRadio:n,name:d,checked:x=!1,required:f,disabled:u,value:l="on",onCheck:I,form:k,...P}=r,[i,b]=a.useState(null),v=Be(t,V=>b(V)),_=a.useRef(!1),M=i?k||!!i.closest("form"):!0;return e.jsxs(Qs,{scope:n,checked:x,disabled:u,children:[e.jsx(Se.button,{type:"button",role:"radio","aria-checked":x,"data-state":At(x),"data-disabled":u?"":void 0,disabled:u,value:l,...P,ref:v,onClick:Le(r.onClick,V=>{x||I==null||I(),M&&(_.current=V.isPropagationStopped(),_.current||V.stopPropagation())})}),M&&e.jsx($t,{control:i,bubbles:!_.current,name:d,value:l,checked:x,required:f,disabled:u,form:k,style:{transform:"translateX(-100%)"}})]})});Rt.displayName=Ge;var Pt="RadioIndicator",St=a.forwardRef((r,t)=>{const{__scopeRadio:n,forceMount:d,...x}=r,f=Xs(Pt,n);return e.jsx(us,{present:d||f.checked,children:e.jsx(Se.span,{"data-state":At(f.checked),"data-disabled":f.disabled?"":void 0,...x,ref:t})})});St.displayName=Pt;var Hs="RadioBubbleInput",$t=a.forwardRef(({__scopeRadio:r,control:t,checked:n,bubbles:d=!0,...x},f)=>{const u=a.useRef(null),l=Be(u,f),I=_s(n),k=ps(t);return a.useEffect(()=>{const P=u.current;if(!P)return;const i=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(i,"checked").set;if(I!==n&&v){const _=new Event("click",{bubbles:d});v.call(P,n),P.dispatchEvent(_)}},[I,n,d]),e.jsx(Se.input,{type:"radio","aria-hidden":!0,defaultChecked:n,...x,tabIndex:-1,ref:l,style:{...x.style,...k,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});$t.displayName=Hs;function At(r){return r?"checked":"unchecked"}var Ws=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],$e="RadioGroup",[Js,pn]=bt($e,[_t,Et]),It=_t(),kt=Et(),[Ys,er]=Js($e),Dt=a.forwardRef((r,t)=>{const{__scopeRadioGroup:n,name:d,defaultValue:x,value:f,required:u=!1,disabled:l=!1,orientation:I,dir:k,loop:P=!0,onValueChange:i,...b}=r,v=It(n),_=vs(k),[M,V]=fs({prop:f,defaultProp:x??null,onChange:i,caller:$e});return e.jsx(Ys,{scope:n,name:d,required:u,disabled:l,value:M,onValueChange:V,children:e.jsx(js,{asChild:!0,...v,orientation:I,dir:_,loop:P,children:e.jsx(Se.div,{role:"radiogroup","aria-required":u,"aria-orientation":I,"data-disabled":l?"":void 0,dir:_,...b,ref:t})})})});Dt.displayName=$e;var Mt="RadioGroupItem",Ft=a.forwardRef((r,t)=>{const{__scopeRadioGroup:n,disabled:d,...x}=r,f=er(Mt,n),u=f.disabled||d,l=It(n),I=kt(n),k=a.useRef(null),P=Be(t,k),i=f.value===x.value,b=a.useRef(!1);return a.useEffect(()=>{const v=M=>{Ws.includes(M.key)&&(b.current=!0)},_=()=>b.current=!1;return document.addEventListener("keydown",v),document.addEventListener("keyup",_),()=>{document.removeEventListener("keydown",v),document.removeEventListener("keyup",_)}},[]),e.jsx(bs,{asChild:!0,...l,focusable:!u,active:i,children:e.jsx(Rt,{disabled:u,required:f.required,checked:i,...I,...x,name:f.name,ref:P,onCheck:()=>f.onValueChange(x.value),onKeyDown:Le(v=>{v.key==="Enter"&&v.preventDefault()}),onFocus:Le(x.onFocus,()=>{var v;b.current&&((v=k.current)==null||v.click())})})})});Ft.displayName=Mt;var tr="RadioGroupIndicator",Vt=a.forwardRef((r,t)=>{const{__scopeRadioGroup:n,...d}=r,x=kt(n);return e.jsx(St,{...x,...d,ref:t})});Vt.displayName=tr;var Ot=Dt,Tt=Ft,sr=Vt;const qe=a.forwardRef(({className:r,...t},n)=>e.jsx(Ot,{className:xe("grid gap-2",r),...t,ref:n}));qe.displayName=Ot.displayName;const Pe=a.forwardRef(({className:r,...t},n)=>e.jsx(Tt,{ref:n,className:xe("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...t,children:e.jsx(sr,{className:"flex items-center justify-center",children:e.jsx(Ks,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Pe.displayName=Tt.displayName;var Ke={};Object.defineProperty(Ke,"__esModule",{value:!0});var Lt=Ke.loadMercadoPago=void 0;const zt="https://sdk.mercadopago.com/js/v2",rr=/^https:\/\/sdk\.mercadopago\.com\/js\/v2\/?(\?.*)?$/,yt="MercadoPago has already been initialized in your window, please remove the duplicate import",nr="MercadoPago.js not available",or="Failed to load MercadoPago.js",ar=()=>{for(var r=document.querySelectorAll(`script[src^="${zt}"`),t=0;t<r.length;t++){var n=r[t];if(rr.test(n.src))return n}return null},ir=()=>{const r=document.createElement("script");r.src=zt;const t=document.head||document.body;if(!t)throw new Error("Expected document.body or document.head not to be null. MercadoPago requires a <body> or a <head> element, please add on your project.");return t.appendChild(r),r};let Ee=null;const cr=()=>(Ee!==null||(Ee=new Promise((r,t)=>{if(typeof window>"u"){r(null);return}if(window.MercadoPago){console.warn(yt),r(window.MercadoPago);return}try{let n=ar();n?console.warn(yt):n||(n=ir()),n.addEventListener("load",()=>{window.MercadoPago?r(window.MercadoPago):t(new Error(nr))}),n.addEventListener("error",()=>{t(new Error(or))})}catch(n){t(n);return}})),Ee);Lt=Ke.loadMercadoPago=cr;var lr=function(r,t,n,d){function x(f){return f instanceof n?f:new n(function(u){u(f)})}return new(n||(n=Promise))(function(f,u){function l(P){try{k(d.next(P))}catch(i){u(i)}}function I(P){try{k(d.throw(P))}catch(i){u(i)}}function k(P){P.done?f(P.value):x(P.value).then(l,I)}k((d=d.apply(r,t||[])).next())})};class G{static getInstance(){return lr(this,void 0,void 0,function*(){if(this.publicKey)return this.loadedInstanceMercadoPago||(yield Lt(),this.loadedInstanceMercadoPago=!0),this.instanceMercadoPago||(this.instanceMercadoPago=new window.MercadoPago(this.publicKey,this.options)),this.instanceMercadoPago;console.error("Expected the PUBLIC_KEY to render the MercadoPago SDK React")})}}G.publicKey=null;G.options={};G.instanceMercadoPago=void 0;G.loadedInstanceMercadoPago=!1;function dr(r,t){return Object.keys(r).length===Object.keys(t).length&&Object.keys(r).every(d=>Object.prototype.hasOwnProperty.call(t,d)&&r[d]===t[d])}const mr=(r,t)=>{const n=Object.assign(Object.assign({},t),{frontEndStack:"react"}),d=!dr(G.options,n);(r!==G.publicKey||d)&&(G.publicKey=r,G.options=n,G.instanceMercadoPago=void 0)},ur=({preferenceId:r,initPoint:t,onClose:n})=>{const{data:d,isLoading:x}=Ct();return a.useEffect(()=>{if(d)try{mr(d,{locale:"pt-BR"})}catch(f){console.error("Erro ao inicializar Mercado Pago:",f),$.error("Erro ao carregar o SDK do Mercado Pago."),n();return}t&&(console.log("Redirecionando para o Mercado Pago:",t),window.location.href=t)},[d,n,t]),x||!d?e.jsx(pt,{open:!0,onOpenChange:n,children:e.jsx(ft,{className:"sm:max-w-[425px]",children:e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsx(he,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{children:"Carregando configurações de pagamento..."})]})})}):e.jsx(pt,{open:!0,onOpenChange:n,children:e.jsxs(ft,{className:"sm:max-w-[425px]",children:[e.jsxs(Ss,{children:[e.jsxs($s,{className:"flex items-center gap-2",children:[e.jsx(Nt,{className:"h-5 w-5 text-primary"}),"Redirecionando para Pagamento"]}),e.jsx(As,{children:"Você está sendo redirecionado para o checkout seguro do Mercado Pago."})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(he,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aguarde..."})]}),e.jsx(U,{variant:"outline",onClick:n,children:"Cancelar e Voltar"})]})})},pr=({latitude:r,longitude:t,address:n,className:d})=>{const x=a.useMemo(()=>[r,t],[r,t]),f=a.useMemo(()=>[r,t],[r,t]);return e.jsxs(Z,{className:xe("w-full",d),children:[e.jsxs(Q,{children:[e.jsxs(X,{className:"text-lg flex items-center gap-2",children:[e.jsx(ze,{className:"h-5 w-5 text-primary"}),"Sua Localização"]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:n})]}),e.jsx(H,{className:"p-0",children:e.jsx("div",{className:"h-64 w-full rounded-b-lg overflow-hidden",children:e.jsx(xs,{center:f,markerPosition:x,onMarkerDragEnd:()=>{},zoom:16})})})]})},fr=({isOpen:r,onConfirm:t})=>e.jsx(ks,{open:r,children:e.jsxs(Ds,{children:[e.jsxs(Ms,{children:[e.jsxs(Fs,{className:"flex items-center gap-2 text-primary",children:[e.jsx(Re,{className:"h-6 w-6"}),"Atenção ao Pagamento Online!"]}),e.jsxs(Vs,{children:["Você escolheu o pagamento online (Pix ou Cartão).",e.jsx("br",{}),e.jsx("br",{}),"Ao prosseguir, você será redirecionado para o checkout seguro do Mercado Pago.",e.jsx("br",{}),e.jsx("br",{}),'**IMPORTANTE:** Se você escolher **PIX**, após o pagamento, você pode precisar clicar no botão **"Voltar ao site"** na tela do Mercado Pago para que seu pedido seja finalizado e rastreado corretamente.']})]}),e.jsx(Os,{children:e.jsx(Ts,{onClick:t,className:"w-full",children:"Entendi e Continuar"})})]})}),hr=({onAddressSelect:r,defaultValue:t,disabled:n})=>{const d=a.useRef(null),x=a.useRef(null);return a.useEffect(()=>{!d.current||!window.google||!window.google.maps||!window.google.maps.places||(x.current=new window.google.maps.places.Autocomplete(d.current,{componentRestrictions:{country:"br"},fields:["address_components","geometry","formatted_address"],types:["address"]}),x.current.addListener("place_changed",()=>{var I,k,P;const f=(I=x.current)==null?void 0:I.getPlace();if(!f||!f.address_components||!f.geometry)return;const u={street:"",number:"",neighborhood:"",city:"",state:"",zip_code:"",latitude:((k=f.geometry.location)==null?void 0:k.lat())||0,longitude:((P=f.geometry.location)==null?void 0:P.lng())||0},l=["sublocality_level_1","neighborhood","sublocality","sublocality_level_2","sublocality_level_3"];if(f.address_components.forEach(i=>{const b=i.types;b.includes("route")&&(u.street=i.long_name),b.includes("street_number")&&(u.number=i.long_name);for(const v of l)if(b.includes(v)&&!u.neighborhood){u.neighborhood=i.long_name;break}(b.includes("administrative_area_level_2")||b.includes("locality"))&&(u.city=i.long_name),b.includes("administrative_area_level_1")&&(u.state=i.short_name),b.includes("postal_code")&&(u.zip_code=i.long_name.replace(/\D/g,""))}),!u.neighborhood||u.neighborhood===u.street){const i=f.formatted_address||"";console.log("[AddressAutocomplete] Iniciando extração forçada de bairro do texto:",i);const b=i.split(","),v=b.findIndex(_=>_.includes(u.street));if(v!==-1&&b.length>v+1){let _=b[v+1].trim();_.includes(u.number)&&b.length>v+2&&(_=b[v+2].trim());const M=/^\d{5}-\d{3}$/.test(_)||/^\d{8}$/.test(_),V=/^[A-Z]{2}$/.test(_),Y=/^\d+$/.test(_);!M&&!V&&!Y&&_.length>2&&(u.neighborhood=_)}u.neighborhood===u.street&&(u.neighborhood=""),console.log("[AddressAutocomplete] Resultado final da extração de bairro:",u.neighborhood)}r(u)}))},[r]),e.jsxs("div",{className:"relative",children:[e.jsx(Es,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(fe,{ref:d,placeholder:"Busque seu endereço (Rua, Número...)",defaultValue:t,className:"pl-10 h-12",disabled:n})]})},wt=r=>{if(!r)return"";let t=r.replace(/\D/g,"");return t.length>11&&(t=t.slice(0,11)),t.length>0&&(t=`(${t}`),t.length>3&&(t=`${t.slice(0,3)}) ${t.slice(3)}`),t.length>10&&(t=`${t.slice(0,10)}-${t.slice(10)}`),t},jt=r=>{if(!r)return"";let t=r.replace(/\D/g,"");return t.length>14&&(t=t.slice(0,14)),t.length<=11?(t.length>9&&(t=`${t.slice(0,9)}-${t.slice(9)}`),t.length>6&&(t=`${t.slice(0,6)}.${t.slice(6)}`),t.length>3&&(t=`${t.slice(0,3)}.${t.slice(3)}`)):(t.length>12&&(t=`${t.slice(0,12)}-${t.slice(12)}`),t.length>8&&(t=`${t.slice(0,8)}/${t.slice(8)}`),t.length>5&&(t=`${t.slice(0,5)}.${t.slice(5)}`),t.length>2&&(t=`${t.slice(0,2)}.${t.slice(2)}`)),t},xr=vt({zip_code:F().min(1,"CEP é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length===8,{message:"O CEP deve ter 8 dígitos."}),street:F().min(1,"Rua é obrigatória."),number:F().min(1,"Número é obrigatório."),complement:F().optional(),neighborhood:F().min(1,"Bairro é obrigatório."),city:F().min(1,"Cidade é obrigatória."),state:F().min(1,"Estado é obrigatória.")}),gr=vt({name:F().min(1,"Nome é obrigatório."),phone:F().min(1,"Telefone é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length>=10,{message:"O telefone deve ter pelo menos 10 dígitos."}),cpf_cnpj:F().min(1,"CPF/CNPJ é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length===11||r.length===14,{message:"CPF deve ter 11 dígitos ou CNPJ 14 dígitos."}),delivery_option:ys(["delivery","pickup"],{required_error:"Selecione uma opção de entrega."}),notes:F().optional(),payment_method_id:F().min(1,"Selecione um método de pagamento."),change_for:F().optional()}),yr=async r=>{const{data:t,error:n}=await A.from("restaurants").select("id, name, address, phone, email, street, number, neighborhood, city, zip_code, latitude, longitude, delivery_enabled").eq("id",r).eq("is_active",!0).limit(1).single();if(n)throw new Error(`Erro ao buscar restaurante: ${n.message}`);if(!t)throw new Error("Restaurante não encontrado ou inativo.");return t},wr=async r=>{const{data:t,error:n}=await A.from("delivery_zones").select("*").eq("restaurant_id",r).eq("is_active",!0).order("max_distance_km",{ascending:!0});if(n)throw new Error(`Erro ao buscar zonas de entrega: ${n.message}`);return t},jr=async r=>{const{data:t,error:n}=await A.from("payment_methods").select("*").eq("restaurant_id",r).eq("is_active",!0).order("name",{ascending:!0});if(n)throw new Error(`Erro ao buscar métodos de pagamento: ${n.message}`);return t},br=async r=>{const{data:t,error:n}=await A.from("customers").select("*, complement, state").eq("user_id",r).limit(1).single();if(n&&n.code!=="PGRST116")throw new Error(n.message);return t||null},fn=()=>{var tt,st,rt,nt,ot;const r=cs(),t=ls(),[n]=ds(),d=is(),{items:x,totalAmount:f,clearCart:u}=hs(),{data:l,isLoading:I}=gs(),[k]=a.useState((tt=t.state)==null?void 0:tt.restaurantId),P=n.get("restaurantId"),i=k||P,{data:b}=Ct(i),[v,_]=a.useState(!1),[M,V]=a.useState(!1),[Y,ge]=a.useState(0),[ne,ye]=a.useState(null),[Ae,oe]=a.useState(!0),[W,ae]=a.useState(null),[qt,Ie]=a.useState(!1),[Bt,Gt]=a.useState(null),[Ue,Kt]=a.useState(null),[K,ee]=a.useState(!1),[Ut,Ze]=a.useState(!1),[Qe,ke]=a.useState(null),[De,ie]=a.useState(null),te=a.useRef(null),we=a.useRef(null),{data:j,isLoading:Zt,isError:Qt,error:Xe,refetch:Xt}=pe({queryKey:["checkoutRestaurantData",i],queryFn:()=>yr(i),enabled:!!i,staleTime:1e3*60*5}),{data:J,isLoading:Ht}=pe({queryKey:["checkoutDeliveryZones",i],queryFn:()=>wr(j.id),enabled:!!j,staleTime:1e3*60*5}),{data:B,isLoading:Wt}=pe({queryKey:["checkoutPaymentMethods",i],queryFn:()=>jr(j.id),enabled:!!j,staleTime:1/0}),{data:g,isLoading:He,refetch:vr}=pe({queryKey:["checkoutCustomerData",l==null?void 0:l.id],queryFn:()=>br(l.id),enabled:!!l,staleTime:0}),ce=a.useMemo(()=>j!=null&&j.latitude&&(j!=null&&j.longitude)?[j.latitude,j.longitude]:null,[j]);a.useEffect(()=>{const s=async()=>{document.hidden?(console.log("Página oculta. Iniciando timer de expiração de 20 minutos..."),te.current=setTimeout(async()=>{console.log("Timer expirado. Deslogando usuário..."),await A.auth.signOut(),$.error("Sessão expirada.",{description:"Você ficou fora da página de checkout por mais de 20 minutos. Por favor, identifique-se novamente.",duration:6e3}),r("/auth",{state:{from:"/checkout",restaurantId:i},replace:!0})},12e5)):(console.log("Página visível. Cancelando timer de expiração."),te.current&&(clearTimeout(te.current),te.current=null))};return document.addEventListener("visibilitychange",s),()=>{document.removeEventListener("visibilitychange",s),te.current&&clearTimeout(te.current)}},[r,i]);const Jt=a.useCallback(async(s,o,y,c,p,h,E,S)=>{const D=[30,45];if(j&&j.delivery_enabled===!1){const C=`${o}, ${y}, ${p}, ${c}, ${h}, ${s}`;let N=null;if(E&&S?N={lat:E,lng:S}:N=await ct(C),!N)return{coords:null,fee:0,time:null,isValid:!1};if(J&&J.length>0&&ce){const L=lt([N.lat,N.lng],ce,J);if(L)return{coords:N,fee:0,time:[L.minTime,L.maxTime],isValid:!0}}return{coords:N,fee:0,time:D,isValid:!0}}if(!j||!ce)return{coords:null,fee:0,time:D,isValid:!0};const O=`${o}, ${y}, ${p}, ${c}, ${h}, ${s}`;let R=null;if(E&&S?R={lat:E,lng:S}:R=await ct(O),!R)return{coords:null,fee:0,time:null,isValid:!1};if(J&&J.length>0){const C=lt([R.lat,R.lng],ce,J);return C?{coords:R,fee:C.fee,time:[C.minTime,C.maxTime],isValid:!0}:{coords:R,fee:0,time:null,isValid:!1}}else return{coords:R,fee:0,time:D,isValid:!0}},[j,ce,J]),m=dt({resolver:mt(gr),defaultValues:{name:"",phone:"",cpf_cnpj:"",delivery_option:"delivery",notes:"",payment_method_id:"",change_for:""},mode:"onBlur"}),w=dt({resolver:mt(xr),defaultValues:{zip_code:"",street:"",number:"",complement:"",neighborhood:"",city:"",state:""},mode:"onBlur"});a.useEffect(()=>{w.reset({zip_code:"",street:"",number:"",complement:"",neighborhood:"",city:"",state:""}),ee(!1),ae(null),ie(null),ge(0),ye(null),oe(!0)},[]);const T=m.watch("delivery_option"),Yt=m.watch("payment_method_id"),se=B==null?void 0:B.find(s=>s.id===Yt),Me=(st=se==null?void 0:se.name)==null?void 0:st.includes("online"),le=(rt=se==null?void 0:se.name)==null?void 0:rt.includes("Dinheiro"),q=f+Y,je=w.watch(["zip_code","street","number","city","neighborhood","complement","state"]),We=a.useMemo(()=>{const[s,o,y,c,p,h,E]=je;return`${o}|${y}|${h||""}|${p}|${c}|${s}|${E}`},[je]);a.useEffect(()=>{if(!i)return;const s=A.channel("delivery-zones-changes").on("postgres_changes",{event:"*",schema:"public",table:"delivery_zones",filter:`restaurant_id=eq.${i}`},()=>{console.log("[Realtime] Zonas de entrega atualizadas. Invalidando query..."),d.invalidateQueries({queryKey:["checkoutDeliveryZones",i]}),$.info("As taxas de entrega foram atualizadas.",{duration:3e3})}).subscribe(),o=A.channel("restaurant-settings-changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"restaurants",filter:`id=eq.${i}`},()=>{console.log("[Realtime] Configurações do restaurante atualizadas. Invalidando query..."),d.invalidateQueries({queryKey:["checkoutRestaurantData",i]}),$.info("As configurações da loja foram atualizadas.",{duration:3e3})}).subscribe();return()=>{A.removeChannel(s),A.removeChannel(o)}},[i,d]),a.useEffect(()=>{if(g){if(m.reset({...m.getValues(),name:g.name||"",phone:wt(g.phone||""),cpf_cnpj:jt(g.cpf_cnpj||""),change_for:""}),g.street&&g.zip_code&&(w.reset({zip_code:g.zip_code,street:g.street,number:g.number||"",complement:g.complement||"",neighborhood:g.neighborhood||"",city:g.city||"",state:g.state||""}),g.latitude&&g.longitude)){ae([Number(g.latitude),Number(g.longitude)]),ee(!0);const s=`${g.street}|${g.number||""}|${g.complement||""}|${g.neighborhood}|${g.city}|${g.zip_code}|${g.state}`;ie(s)}}else if(l&&!He){const s=l.user_metadata;m.reset({...m.getValues(),name:s.full_name||"",phone:wt(s.phone||""),cpf_cnpj:jt(s.cpf_cnpj||""),change_for:""})}},[g,l,He,m,w]),a.useEffect(()=>{T==="delivery"&&De!==null&&We!==De&&(ee(!1),ge(0),ye(null),oe(!0),ae(null),ie(null))},[We,De,T]);const be=m.watch("change_for");a.useEffect(()=>{if(le&&be&&be.trim()!==""){const s=be.replace(",","."),o=parseFloat(s);isNaN(o)?m.setError("change_for",{message:"O troco deve ser um número válido."}):o<q?m.setError("change_for",{message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(q)}).`}):m.clearErrors("change_for")}else m.clearErrors("change_for")},[le,be,q,m]);const ve=Ve({mutationFn:async s=>{var at;V(!0);const o=s.number||"";if(!o)throw V(!1),new Error("O campo 'Número' é obrigatório para calcular a taxa de entrega.");const y=`${s.street}, ${o}${s.complement?` - ${s.complement}`:""}, ${s.neighborhood}, ${s.city}, ${s.state}, ${s.zip_code}`,c=await Jt(s.zip_code,s.street,o,s.city,s.neighborhood,s.state);if(V(!1),!c.isValid)throw new Error((j==null?void 0:j.delivery_enabled)===!1?"O endereço está errado ou incompleto, revise todos os campos.":"Endereço fora da área de entrega.");if(!c.coords)throw new Error("Não foi possível obter as coordenadas para salvar o endereço.");const p=m.getValues("name"),h=m.getValues("phone"),E=m.getValues("cpf_cnpj"),S=h.replace(/\D/g,""),D=E.replace(/\D/g,"")||null;if(!p||S.length<10||!D||D.length!==11&&D.length!==14)throw new Error("Preencha Nome, Telefone (10+ dígitos) e CPF/CNPJ (11 ou 14 dígitos) nos Seus Dados antes de salvar o endereço.");const R=(at=(await A.auth.getUser()).data.user)==null?void 0:at.id;if(!(g!=null&&g.id)&&!R)return{customer:{id:"anonymous",user_id:null,name:p,phone:S,email:null,address:y,created_at:"",updated_at:"",latitude:c.coords.lat,longitude:c.coords.lng,cpf_cnpj:D,street:s.street,number:o,neighborhood:s.neighborhood,city:s.city,zip_code:s.zip_code,complement:s.complement||null,state:s.state},feeResult:c};const C={name:p,phone:S,cpf_cnpj:D},N={user_id:(l==null?void 0:l.id)||null,...C,email:(l==null?void 0:l.email)||null,address:y,latitude:c.coords.lat,longitude:c.coords.lng,street:s.street,number:o,neighborhood:s.neighborhood,city:s.city,zip_code:s.zip_code,complement:s.complement||null,state:s.state},L="*, street, number, neighborhood, city, zip_code, complement, state";let Fe;if(g!=null&&g.id){const{data:Ne,error:de}=await A.from("customers").update(N).eq("id",g.id).select(L).single();if(de)throw de;Fe=Ne}else if(R){const{data:Ne,error:de}=await A.from("customers").insert(N).select(L).single();if(de)throw de;Fe=Ne}else throw new Error("Não foi possível identificar o cliente para salvar.");return{customer:Fe,feeResult:c}},onSuccess:(s,o)=>{const{customer:y,feeResult:c}=s;(y==null?void 0:y.id)!=="anonymous"&&d.invalidateQueries({queryKey:["checkoutCustomerData"]}),ge(c.fee),ye(c.time),oe(c.isValid),ee(!0),ae([c.coords.lat,c.coords.lng]);const p=o.number||"",h=`${o.street}|${p}|${o.complement||""}|${o.neighborhood}|${o.city}|${o.zip_code}|${o.state}`;ie(h),$.success("Endereço salvo e taxa de entrega calculada!")},onError:s=>{$.error(`Erro ao salvar endereço: ${s.message}`),oe(!1),ee(!1),s.message.includes("'Número' é obrigatório")&&we.current&&we.current.focus()}}),es=s=>{ve.mutate(s)},Je=Ve({mutationFn:async s=>{var D,O;if(!j)throw new Error("Dados do restaurante não disponíveis.");(D=(await A.auth.getUser()).data.user)==null||D.id;const y=s.phone.replace(/\D/g,""),c=((O=s.cpf_cnpj)==null?void 0:O.replace(/\D/g,""))||null;if(!s.name||y.length<10||c&&c.length!==11&&c.length!==14)throw new Error("Dados de contato incompletos ou inválidos.");const p=w.getValues(),h=T==="delivery"?`${p.street}, ${p.number}${p.complement?` - ${p.complement}`:""}, ${p.neighborhood}, ${p.city}, ${p.state}, ${p.zip_code}`:null,E={user_id:(l==null?void 0:l.id)||null,name:s.name,phone:y,email:(l==null?void 0:l.email)||null,cpf_cnpj:c,address:h,latitude:W?W[0]:null,longitude:W?W[1]:null,street:w.getValues("street")||null,number:w.getValues("number")||null,neighborhood:w.getValues("neighborhood")||null,city:w.getValues("city")||null,zip_code:w.getValues("zip_code")||null,complement:w.getValues("complement")||null,state:w.getValues("state")||null};l||(E.email=null);const S="*, street, number, neighborhood, city, zip_code, complement, state";if(l)if(g){const{data:R,error:C}=await A.from("customers").update(E).eq("id",g.id).select(S).single();if(C)throw C;return R}else{const{data:R,error:C}=await A.from("customers").insert(E).select(S).single();if(C)throw C;return R}else{const{data:R,error:C}=await A.from("customers").insert(E).select(S).single();if(C)throw C;return R}},onSuccess:()=>{d.invalidateQueries({queryKey:["checkoutCustomerData"]})},onError:s=>{$.error(`Erro ao salvar dados do cliente: ${s.message}`)}}),Ye=Ve({mutationFn:async({customerId:s,data:o})=>{if(!j)throw new Error("Dados do restaurante não disponíveis.");let y=null;if(le&&o.change_for&&o.change_for.trim()!==""){const N=o.change_for.replace(",","."),L=parseFloat(N);!isNaN(L)&&L>q&&(y=L)}let[c,p]=ne||[null,null];if((T==="delivery"||T==="pickup")&&(!c||!p)){const N=T==="pickup"?[15,30]:[30,45];c=N[0],p=N[1]}const h=w.getValues(),E=T==="delivery"?`${h.street}, ${h.number}${h.complement?` - ${h.complement}`:""}, ${h.neighborhood}, ${h.city}, ${h.state}, ${h.zip_code}`:null,S={restaurant_id:j.id,customer_id:s,status:Me?"pending_payment":"pending",total_amount:q,delivery_fee:Y,delivery_address:E,notes:o.notes,payment_method_id:o.payment_method_id,change_for:y,min_delivery_time_minutes:c,max_delivery_time_minutes:p},{data:D,error:O}=await A.from("orders").insert(S).select("id").single();if(O)throw O;const R=x.map(N=>({order_id:D.id,product_id:N.product.id,quantity:parseFloat(N.quantity.toFixed(3)),unit_price:parseFloat(N.product.price.toFixed(2)),subtotal:parseFloat(N.subtotal.toFixed(2)),notes:N.notes})),{error:C}=await A.from("order_items").insert(R);if(C)throw C;return D.id},onSuccess:s=>{d.invalidateQueries({queryKey:["orders"]})},onError:s=>{$.error(`Erro ao criar pedido: ${s.message}`)}}),ts=async s=>{if(le&&s.change_for&&s.change_for.trim()!==""){const c=s.change_for.replace(",","."),p=parseFloat(c);if(isNaN(p)){$.error("O troco deve ser um número válido.");return}if(p<q){m.setError("change_for",{type:"manual",message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(q)}).`});return}}if(x.length===0){$.error("Seu carrinho está vazio."),r(`/menu/${i}`);return}if(T==="delivery"){if(!K){$.error("Você deve salvar e validar o endereço de entrega antes de finalizar o pedido.");return}if(!Ae){$.error("O endereço de entrega está fora da área de cobertura.");return}}let o;try{o=(await Je.mutateAsync(s)).id}catch(c){$.error(`Falha ao salvar cliente: ${c.message}`);return}let y;try{y=await Ye.mutateAsync({customerId:o,data:s})}catch(c){$.error(`Falha ao criar pedido: ${c.message}`);return}Me?await ss(y,s):(u(),r(`/order-success/${y}`,{replace:!0}))},ss=async(s,o)=>{if(!j)return;const y=window.location.origin+window.location.pathname,c=x.map(h=>({name:h.product.name,price:h.product.price,quantity:h.quantity})),p=$.loading("Preparando pagamento online...");try{const{data:h,error:E}=await A.functions.invoke("create-payment-preference",{body:{orderId:s,items:c,totalAmount:q,restaurantName:j.name,clientUrl:y,customerEmail:(l==null?void 0:l.email)||"cliente@anonimo.com",customerCpfCnpj:o.cpf_cnpj}});if(E)throw E;const{init_point:S}=h;Gt(s),Kt(S),Ie(!0),$.dismiss(p)}catch(h){$.dismiss(p),$.error(`Erro no pagamento online: ${h.message}`),Ie(!1)}},rs=async()=>{await A.auth.signOut(),$.success("Você saiu da sua conta."),r("/auth",{replace:!0})},ns=(s,o,y)=>{o&&y?(ke(s),Ze(!0)):(m.setValue("payment_method_id",s,{shouldValidate:!0}),ke(null))},os=()=>{Qe&&m.setValue("payment_method_id",Qe,{shouldValidate:!0}),Ze(!1),ke(null)},as=a.useCallback(s=>{w.setValue("zip_code",s.zip_code,{shouldValidate:!0}),w.setValue("street",s.street,{shouldValidate:!0}),w.setValue("neighborhood",s.neighborhood,{shouldValidate:!0}),w.setValue("city",s.city,{shouldValidate:!0}),w.setValue("state",s.state,{shouldValidate:!0}),w.setValue("number",s.number,{shouldValidate:!0}),w.setValue("complement","",{shouldValidate:!0}),s.number?$.info("Endereço encontrado! Verifique o número e clique em Salvar."):($.warning("Endereço encontrado! Por favor, preencha o campo 'Número' e clique em Salvar."),setTimeout(()=>{var o;return(o=we.current)==null?void 0:o.focus()},100)),ee(!1),ge(0),ye(null),oe(!0),ae(null),ie(null)},[w]),_e=a.useMemo(()=>{const[s,o,y,c,p,h,E]=je;if(!o)return"";const S=[];o&&S.push(o),y&&S.push(y),h&&S.push(`(Comp: ${h})`),p&&S.push(p);let D=S.join(", ");const O=[];c&&O.push(c),E&&O.push(E);let R=O.join(" - ");const C=s.replace(/\D/g,"");let N="";return C.length===8&&(N=`${C.slice(0,5)}-${C.slice(5)}`),N&&(R+=(R?", CEP: ":"CEP: ")+N),[D,R].filter(Boolean).join(", ")},[je]);if(!i)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(re,{variant:"destructive",className:"max-w-lg",children:[e.jsx(xt,{className:"h-4 w-4"}),e.jsx(me,{children:"Erro de Rastreamento"}),e.jsx(ue,{children:"Não foi possível identificar o restaurante para o qual o pedido está sendo feito. Por favor, volte ao menu."}),e.jsx(Oe,{to:"/",children:e.jsx(U,{className:"mt-3",variant:"secondary",size:"sm",children:"Voltar"})})]})});if(x.length===0)return a.useEffect(()=>{r(`/menu/${i}`)},[r,i]),e.jsx(it,{});if(Zt||Ht||Wt||I)return e.jsx(it,{});if(Qt||!j)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(re,{variant:"destructive",className:"max-w-lg",children:[e.jsx(xt,{className:"h-4 w-4"}),e.jsx(me,{children:"Erro Crítico"}),e.jsx(ue,{children:Xe instanceof Error?Xe.message:"Não foi possível carregar os dados do restaurante."}),e.jsxs(U,{onClick:()=>Xt(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]})});const et=Je.isPending||Ye.isPending||ve.isPending||M||T==="delivery"&&!K;return e.jsx("div",{className:"min-h-screen bg-background w-full overflow-x-hidden",children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-6 py-4 sm:py-8 max-w-5xl space-y-6 sm:space-y-8",children:[e.jsx(Rs,{isOpen:v,onClose:()=>_(!1),customer:g}),e.jsx(fr,{isOpen:Ut,onConfirm:os}),qt&&Ue&&e.jsx(ur,{preferenceId:Bt,initPoint:Ue,onClose:()=>Ie(!1)}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto",children:[e.jsx(Oe,{to:`/menu/${i}`,children:e.jsx(U,{variant:"ghost",size:"icon","aria-label":"Voltar ao Menu",children:e.jsx(zs,{className:"h-6 w-6"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg sm:text-3xl font-bold text-foreground",children:"Finalizar Pedido"}),e.jsx("p",{className:"text-xs sm:text-lg text-muted-foreground font-medium truncate max-w-full",children:j.name})]})]}),l&&e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto justify-end",children:[e.jsxs(U,{variant:"outline",size:"sm",onClick:()=>_(!0),"aria-label":"Meu Perfil e Pedidos",className:"flex-1 sm:flex-none text-xs sm:text-sm h-8 sm:h-9",children:[e.jsx(gt,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"truncate",children:"Perfil / Pedidos"})]}),e.jsxs(U,{variant:"outline",size:"sm",onClick:rs,className:"flex-shrink-0 text-xs sm:text-sm h-8 sm:h-9",children:[e.jsx(Ps,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"})," Sair"]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 sm:gap-8 w-full",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6 min-w-0",children:[e.jsxs(Z,{className:"w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(X,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(gt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Seus Dados"]})}),e.jsxs(H,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx("div",{className:"flex justify-between items-center mb-3 sm:mb-4",children:e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:l?`Logado como ${l.email}`:"Pedido anônimo"})}),e.jsx(ht,{...m,children:e.jsx("form",{onSubmit:m.handleSubmit(ts),id:"checkout-form",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(z,{htmlFor:"name",className:"text-xs sm:text-sm",children:"Nome Completo *"}),e.jsx(fe,{id:"name",...m.register("name"),className:"h-9 sm:h-12 text-sm w-full"}),m.formState.errors.name&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:m.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(z,{htmlFor:"phone",className:"text-xs sm:text-sm",children:"Telefone *"}),e.jsx(Ce,{name:"phone",control:m.control,render:({field:s})=>e.jsx(Ns,{id:"phone",...s,className:"h-9 sm:h-12 text-sm w-full"})}),m.formState.errors.phone&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:m.formState.errors.phone.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(z,{htmlFor:"cpf_cnpj",className:"text-xs sm:text-sm",children:"CPF/CNPJ *"}),e.jsx(Ce,{name:"cpf_cnpj",control:m.control,render:({field:s})=>e.jsx(Is,{id:"cpf_cnpj",...s,className:"h-9 sm:h-12 text-sm w-full"})}),m.formState.errors.cpf_cnpj&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:m.formState.errors.cpf_cnpj.message})]})]})})})]})]}),e.jsxs(Z,{className:"w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(X,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Opção de Entrega"]})}),e.jsx(H,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsx(Ce,{name:"delivery_option",control:m.control,render:({field:s})=>e.jsxs(qe,{onValueChange:s.onChange,value:s.value,className:"grid grid-cols-2 gap-2 sm:gap-4 min-w-0 w-full",children:[e.jsxs(z,{htmlFor:"delivery",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-2 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer text-center w-full max-w-full",children:[e.jsx(Pe,{value:"delivery",id:"delivery",className:"sr-only"}),e.jsx(Te,{className:"mb-1.5 sm:mb-3 h-4 w-4 sm:h-6 sm:w-6 flex-shrink-0"}),e.jsx("span",{translate:"no",className:"text-xs sm:text-base break-words w-full",children:"Entrega"})]}),e.jsxs(z,{htmlFor:"pickup",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-2 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer text-center w-full max-w-full",children:[e.jsx(Pe,{value:"pickup",id:"pickup",className:"sr-only"}),e.jsx(ze,{className:"mb-1.5 sm:mb-3 h-4 w-4 sm:h-6 sm:w-6 flex-shrink-0"}),e.jsx("span",{translate:"no",className:"text-xs sm:text-base break-words w-full",children:"Retirada no Local"})]})]})})})]}),T==="delivery"&&e.jsxs(Z,{className:xe("w-full overflow-hidden",!K&&"border-destructive ring-2 ring-destructive/50"),children:[e.jsxs(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:[e.jsxs(X,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(ze,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Endereço de Entrega",K&&e.jsx(qs,{className:"h-4 w-4 sm:h-5 sm:w-5 text-green-500 ml-2 flex-shrink-0"}),!K&&e.jsx(Re,{className:"h-4 w-4 sm:h-5 sm:w-5 text-destructive ml-2 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Preencha e salve para calcular a taxa."})]}),e.jsxs(H,{className:"space-y-3 sm:space-y-4 px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx(ht,{...w,children:e.jsxs("form",{onSubmit:w.handleSubmit(es),id:"address-form-inner",className:"space-y-3 sm:space-y-4",autoComplete:"off",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(z,{htmlFor:"address-search",className:"text-xs sm:text-sm",children:"Buscar Endereço *"}),e.jsx(hr,{onAddressSelect:as,disabled:M})]}),e.jsx("input",{type:"hidden",...w.register("zip_code")}),e.jsx("input",{type:"hidden",...w.register("street")}),e.jsx("input",{type:"hidden",...w.register("neighborhood")}),e.jsx("input",{type:"hidden",...w.register("city")}),e.jsx("input",{type:"hidden",...w.register("state")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(z,{htmlFor:"number",className:"text-xs sm:text-sm",children:"Número *"}),e.jsx(fe,{id:"number",...w.register("number"),placeholder:"Nº",className:"h-9 sm:h-12 text-sm",autoComplete:"off",ref:we}),w.formState.errors.number&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:w.formState.errors.number.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(z,{htmlFor:"complement",className:"text-xs sm:text-sm",children:"Complemento"}),e.jsx(fe,{id:"complement",...w.register("complement"),placeholder:"Apto, Bloco...",className:"h-9 sm:h-12 text-sm",autoComplete:"off"})]})]}),_e&&e.jsxs("div",{className:"bg-muted p-2 sm:p-3 rounded text-xs sm:text-sm break-words overflow-hidden",children:[e.jsx("p",{children:e.jsx("strong",{children:"Endereço:"})}),e.jsx("p",{className:"text-sm text-foreground",children:_e})]}),e.jsxs(U,{type:"submit",className:"w-full h-auto py-2 text-xs sm:text-base mt-2 whitespace-normal",disabled:ve.isPending||M,children:[ve.isPending||M?e.jsx(he,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin mr-2"}):e.jsx(Bs,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2"}),"Salvar e Calcular"]})]})}),M&&e.jsxs(re,{className:"flex items-center gap-2 p-2 sm:p-4",children:[e.jsx(he,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin"}),e.jsx(me,{className:"text-xs sm:text-sm",children:"Calculando..."})]}),K&&!M&&e.jsxs(e.Fragment,{children:[j.delivery_enabled!==!1&&!Ae&&e.jsxs(re,{variant:"destructive",className:"p-2 sm:p-4",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx(me,{className:"text-sm",children:"Fora da Área"}),e.jsx(ue,{className:"text-xs",children:"Endereço fora da área de cobertura."})]}),(j.delivery_enabled===!1||Ae&&ne)&&e.jsxs(re,{variant:"default",className:"bg-green-50 dark:bg-green-900/20 border-green-200 text-green-700 p-2 sm:p-4",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx(me,{className:"text-sm",children:"Entrega Disponível"}),e.jsxs(ue,{className:"text-xs",children:["Taxa: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Y),". Tempo: ",ne?`${ne[0]}-${ne[1]}`:"30-45"," min."]})]})]}),K&&W&&_e&&e.jsx("div",{className:"mt-4 w-full overflow-hidden rounded-md border",children:e.jsx(pr,{latitude:W[0],longitude:W[1],address:_e,className:"w-full"})})]})]}),e.jsxs(Z,{className:"w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(X,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(Nt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Pagamento *"]})}),e.jsxs(H,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx(Ce,{name:"payment_method_id",control:m.control,render:({field:s})=>e.jsx(qe,{onValueChange:o=>{var h;const y=B==null?void 0:B.find(E=>E.id===o),c=(h=y==null?void 0:y.name)==null?void 0:h.includes("online"),p=!!b&&b.trim()!=="";ns(o,!!c,p)},value:s.value,className:"space-y-2 sm:space-y-3 w-full",children:B==null?void 0:B.map(o=>{var h;const y=(h=o.name)==null?void 0:h.includes("online"),c=!!b&&b.trim()!=="",p=y&&!c;return e.jsx(z,{htmlFor:o.id,className:xe("flex items-center justify-between rounded-md border-2 border-muted bg-popover p-2.5 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer w-full max-w-full",p&&"opacity-50 cursor-not-allowed"),children:e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 overflow-hidden min-w-0 w-full",children:[e.jsx(Pe,{value:o.id,id:o.id,disabled:p,className:"flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-xs sm:text-base break-words w-full leading-tight whitespace-normal",translate:"no",children:o.name}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground truncate",children:o.description}),p&&e.jsx("p",{className:"text-[10px] text-destructive mt-0.5",children:"Indisponível no momento."})]})]})},o.id)})})}),m.formState.errors.payment_method_id&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm mt-2",children:m.formState.errors.payment_method_id.message})]})]}),le&&e.jsxs(Z,{className:"w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(X,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(Gs,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Troco"]})}),e.jsx(H,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(z,{htmlFor:"change_for",className:"text-xs sm:text-sm",children:"Precisa de troco para quanto?"}),e.jsx(fe,{id:"change_for",type:"number",step:"0.01",placeholder:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(q),...m.register("change_for"),className:"h-9 sm:h-12 text-sm w-full"}),((nt=m.formState.errors.change_for)==null?void 0:nt.message)&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:m.formState.errors.change_for.message}),((ot=m.formState.errors.change_for)==null?void 0:ot.type)==="manual"&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:m.formState.errors.change_for.message})]})})]}),e.jsxs(Z,{className:"w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(X,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(Cs,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Observações"]})}),e.jsx(H,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(z,{htmlFor:"notes",className:"text-xs sm:text-sm",children:"Notas para o restaurante"}),e.jsx(ws,{id:"notes",...m.register("notes"),rows:3,placeholder:"Ex: Entregar na portaria, sem pimenta...",className:"text-sm w-full"})]})})]})]}),e.jsx("div",{className:"lg:col-span-1 space-y-6 sticky top-4 self-start min-w-0",children:e.jsxs(Z,{className:"shadow-lg w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsx(X,{className:"text-lg sm:text-2xl",children:"Resumo"})}),e.jsxs(H,{className:"space-y-3 sm:space-y-4 px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:x.map(s=>e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsxs("span",{className:"truncate max-w-[70%]",children:[s.quantity,"x ",s.product.name]}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.subtotal)})]},s.product.id))}),e.jsx(ut,{}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm text-muted-foreground",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(f)})]}),e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm text-muted-foreground",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Y)})]})]}),e.jsx(ut,{}),e.jsxs("div",{className:"flex justify-between font-bold text-base sm:text-xl",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(q)})]}),e.jsx(U,{type:"submit",form:"checkout-form",className:"w-full h-10 sm:h-12 text-sm sm:text-lg",disabled:et,children:et?e.jsx(he,{className:"h-4 w-4 sm:h-5 sm:w-5 animate-spin mr-2"}):Me?"Pagar e Finalizar":"Confirmar Pedido"}),T==="delivery"&&!K&&e.jsxs(re,{variant:"destructive",className:"mt-3 p-2 sm:p-4",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx(ue,{className:"text-xs",children:"Salve o endereço acima para continuar."})]}),e.jsx(Oe,{to:`/menu/${j.id}`,className:"block text-center text-xs sm:text-sm text-muted-foreground hover:underline mt-2",children:"Voltar ao Cardápio"})]})]})})]})]})})};export{fn as default};
