import{j as e,u as ge,b as ne,a as Ie}from"./tanstack-b27kfv6r.js";import{s as F}from"./client-CNbeM-CQ.js";import{c as Vs,B as A}from"./button-BeHtcrrn.js";import{C as Ce,a as ft,d as Ne,b as $s}from"./card-9EUTfGBi.js";import{r as l,f as vt,b as Bs}from"./vendor-CrUvlFU9.js";import{b as ve,e as jt,g as tt,l as Re,P as q,h as k,q as Us,c as W,r as yt,f as J,A as Hs,s as ie,D as Ks,C as zs,t as Ws,V as Gs,k as Qs,j as Ys,R as Xs,u as L,a as _e}from"./index-C9e7Jciz.js";import{c as wt,R as Zs,I as Js,a as er}from"./index-Bjj1LNtX.js";import{u as bt}from"./index-e6NhVHje.js";import{S as le}from"./switch-BwrnlKkm.js";import{S as K}from"./skeleton-CjO9bdBF.js";import{A as St,a as Ct,b as Nt}from"./alert-CZktw6p2.js";import{o as Me,s as G,c as ke,e as fe,u as Ae,t as De,p as _t,l as Et,i as Tt}from"./types-Z9mbP6pS.js";import{D as Oe,a as Le,b as Fe,c as qe,d as Ve,e as $e,f as Be,S as tr}from"./dialog-CLApRZN7.js";import{F as Ue,a as _,b as E,e as M,c as T,d as O}from"./form-BpuYfx2y.js";import{I as Z}from"./label-BqSFWCjN.js";import{T as He}from"./textarea-B9dNpNfF.js";import{c as gt}from"./index-BdQq_4o_.js";import{h as sr,u as rr,d as or,F as ar,e as nr}from"./index-CAVd4Zch.js";import{u as ir}from"./index-DQCYbIBI.js";import{C as lr}from"./check-G6m0E3YH.js";import{P as ct}from"./plus-B6bQy41M.js";import{A as Pt,b as It,c as Rt,d as Mt,e as kt,f as At,g as Dt,h as Ot}from"./alert-dialog-C5Fnm4DY.js";import{T as Ee}from"./trash-2-C2ZhAYG8.js";import{T as Lt}from"./terminal-DPv0b58a.js";import"./supabase-hDq9CU0q.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=ve("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cr=ve("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=ve("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ur=ve("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=ve("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=ve("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var Ke="Tabs",[mr,Mo]=jt(Ke,[wt]),Vt=wt(),[pr,ut]=mr(Ke),$t=l.forwardRef((s,r)=>{const{__scopeTabs:t,value:c,onValueChange:n,defaultValue:u,orientation:d="horizontal",dir:i,activationMode:o="automatic",...m}=s,h=bt(i),[a,v]=tt({prop:c,onChange:n,defaultProp:u??"",caller:Ke});return e.jsx(pr,{scope:t,baseId:Re(),value:a,onValueChange:v,orientation:d,dir:h,activationMode:o,children:e.jsx(q.div,{dir:h,"data-orientation":d,...m,ref:r})})});$t.displayName=Ke;var Bt="TabsList",Ut=l.forwardRef((s,r)=>{const{__scopeTabs:t,loop:c=!0,...n}=s,u=ut(Bt,t),d=Vt(t);return e.jsx(Zs,{asChild:!0,...d,orientation:u.orientation,dir:u.dir,loop:c,children:e.jsx(q.div,{role:"tablist","aria-orientation":u.orientation,...n,ref:r})})});Ut.displayName=Bt;var Ht="TabsTrigger",Kt=l.forwardRef((s,r)=>{const{__scopeTabs:t,value:c,disabled:n=!1,...u}=s,d=ut(Ht,t),i=Vt(t),o=Gt(d.baseId,c),m=Qt(d.baseId,c),h=c===d.value;return e.jsx(Js,{asChild:!0,...i,focusable:!n,active:h,children:e.jsx(q.button,{type:"button",role:"tab","aria-selected":h,"aria-controls":m,"data-state":h?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:o,...u,ref:r,onMouseDown:k(s.onMouseDown,a=>{!n&&a.button===0&&a.ctrlKey===!1?d.onValueChange(c):a.preventDefault()}),onKeyDown:k(s.onKeyDown,a=>{[" ","Enter"].includes(a.key)&&d.onValueChange(c)}),onFocus:k(s.onFocus,()=>{const a=d.activationMode!=="manual";!h&&!n&&a&&d.onValueChange(c)})})})});Kt.displayName=Ht;var zt="TabsContent",Wt=l.forwardRef((s,r)=>{const{__scopeTabs:t,value:c,forceMount:n,children:u,...d}=s,i=ut(zt,t),o=Gt(i.baseId,c),m=Qt(i.baseId,c),h=c===i.value,a=l.useRef(h);return l.useEffect(()=>{const v=requestAnimationFrame(()=>a.current=!1);return()=>cancelAnimationFrame(v)},[]),e.jsx(Us,{present:n||h,children:({present:v})=>e.jsx(q.div,{"data-state":h?"active":"inactive","data-orientation":i.orientation,role:"tabpanel","aria-labelledby":o,hidden:!v,id:m,tabIndex:0,...d,ref:r,style:{...s.style,animationDuration:a.current?"0s":void 0},children:v&&u})})});Wt.displayName=zt;function Gt(s,r){return`${s}-trigger-${r}`}function Qt(s,r){return`${s}-content-${r}`}var hr=$t,Yt=Ut,Xt=Kt,Zt=Wt;const xr=hr,Jt=l.forwardRef(({className:s,...r},t)=>e.jsx(Yt,{ref:t,className:W("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...r}));Jt.displayName=Yt.displayName;const st=l.forwardRef(({className:s,...r},t)=>e.jsx(Xt,{ref:t,className:W("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...r}));st.displayName=Xt.displayName;const rt=l.forwardRef(({className:s,...r},t)=>e.jsx(Zt,{ref:t,className:W("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r}));rt.displayName=Zt.displayName;const fr=Vs("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Te({className:s,variant:r,...t}){return e.jsx("div",{className:W(fr({variant:r}),s),...t})}var gr=[" ","Enter","ArrowUp","ArrowDown"],vr=[" ","Enter"],pe="Select",[ze,We,jr]=er(pe),[je,ko]=jt(pe,[jr,yt]),Ge=yt(),[yr,ce]=je(pe),[wr,br]=je(pe),es=s=>{const{__scopeSelect:r,children:t,open:c,defaultOpen:n,onOpenChange:u,value:d,defaultValue:i,onValueChange:o,dir:m,name:h,autoComplete:a,disabled:v,required:j,form:S}=s,p=Ge(r),[y,g]=l.useState(null),[x,w]=l.useState(null),[B,U]=l.useState(!1),re=bt(m),[D,V]=tt({prop:c,defaultProp:n??!1,onChange:u,caller:pe}),[f,I]=tt({prop:d,defaultProp:i,onChange:o,caller:pe}),$=l.useRef(null),Q=y?S||!!y.closest("form"):!0,[oe,ee]=l.useState(new Set),te=Array.from(oe).map(H=>H.props.value).join(";");return e.jsx(Xs,{...p,children:e.jsxs(yr,{required:j,scope:r,trigger:y,onTriggerChange:g,valueNode:x,onValueNodeChange:w,valueNodeHasChildren:B,onValueNodeHasChildrenChange:U,contentId:Re(),value:f,onValueChange:I,open:D,onOpenChange:V,dir:re,triggerPointerDownPosRef:$,disabled:v,children:[e.jsx(ze.Provider,{scope:r,children:e.jsx(wr,{scope:s.__scopeSelect,onNativeOptionAdd:l.useCallback(H=>{ee(X=>new Set(X).add(H))},[]),onNativeOptionRemove:l.useCallback(H=>{ee(X=>{const se=new Set(X);return se.delete(H),se})},[]),children:t})}),Q?e.jsxs(Cs,{"aria-hidden":!0,required:j,tabIndex:-1,name:h,autoComplete:a,value:f,onChange:H=>I(H.target.value),disabled:v,form:S,children:[f===void 0?e.jsx("option",{value:""}):null,Array.from(oe)]},te):null]})})};es.displayName=pe;var ts="SelectTrigger",ss=l.forwardRef((s,r)=>{const{__scopeSelect:t,disabled:c=!1,...n}=s,u=Ge(t),d=ce(ts,t),i=d.disabled||c,o=J(r,d.onTriggerChange),m=We(t),h=l.useRef("touch"),[a,v,j]=_s(p=>{const y=m().filter(w=>!w.disabled),g=y.find(w=>w.value===d.value),x=Es(y,p,g);x!==void 0&&d.onValueChange(x.value)}),S=p=>{i||(d.onOpenChange(!0),j()),p&&(d.triggerPointerDownPosRef.current={x:Math.round(p.pageX),y:Math.round(p.pageY)})};return e.jsx(Hs,{asChild:!0,...u,children:e.jsx(q.button,{type:"button",role:"combobox","aria-controls":d.contentId,"aria-expanded":d.open,"aria-required":d.required,"aria-autocomplete":"none",dir:d.dir,"data-state":d.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":Ns(d.value)?"":void 0,...n,ref:o,onClick:k(n.onClick,p=>{p.currentTarget.focus(),h.current!=="mouse"&&S(p)}),onPointerDown:k(n.onPointerDown,p=>{h.current=p.pointerType;const y=p.target;y.hasPointerCapture(p.pointerId)&&y.releasePointerCapture(p.pointerId),p.button===0&&p.ctrlKey===!1&&p.pointerType==="mouse"&&(S(p),p.preventDefault())}),onKeyDown:k(n.onKeyDown,p=>{const y=a.current!=="";!(p.ctrlKey||p.altKey||p.metaKey)&&p.key.length===1&&v(p.key),!(y&&p.key===" ")&&gr.includes(p.key)&&(S(),p.preventDefault())})})})});ss.displayName=ts;var rs="SelectValue",os=l.forwardRef((s,r)=>{const{__scopeSelect:t,className:c,style:n,children:u,placeholder:d="",...i}=s,o=ce(rs,t),{onValueNodeHasChildrenChange:m}=o,h=u!==void 0,a=J(r,o.onValueNodeChange);return ie(()=>{m(h)},[m,h]),e.jsx(q.span,{...i,ref:a,style:{pointerEvents:"none"},children:Ns(o.value)?e.jsx(e.Fragment,{children:d}):u})});os.displayName=rs;var Sr="SelectIcon",as=l.forwardRef((s,r)=>{const{__scopeSelect:t,children:c,...n}=s;return e.jsx(q.span,{"aria-hidden":!0,...n,ref:r,children:c||"▼"})});as.displayName=Sr;var Cr="SelectPortal",ns=s=>e.jsx(nr,{asChild:!0,...s});ns.displayName=Cr;var he="SelectContent",is=l.forwardRef((s,r)=>{const t=ce(he,s.__scopeSelect),[c,n]=l.useState();if(ie(()=>{n(new DocumentFragment)},[]),!t.open){const u=c;return u?vt.createPortal(e.jsx(ls,{scope:s.__scopeSelect,children:e.jsx(ze.Slot,{scope:s.__scopeSelect,children:e.jsx("div",{children:s.children})})}),u):null}return e.jsx(cs,{...s,ref:r})});is.displayName=he;var Y=10,[ls,de]=je(he),Nr="SelectContentImpl",_r=Ys("SelectContent.RemoveScroll"),cs=l.forwardRef((s,r)=>{const{__scopeSelect:t,position:c="item-aligned",onCloseAutoFocus:n,onEscapeKeyDown:u,onPointerDownOutside:d,side:i,sideOffset:o,align:m,alignOffset:h,arrowPadding:a,collisionBoundary:v,collisionPadding:j,sticky:S,hideWhenDetached:p,avoidCollisions:y,...g}=s,x=ce(he,t),[w,B]=l.useState(null),[U,re]=l.useState(null),D=J(r,b=>B(b)),[V,f]=l.useState(null),[I,$]=l.useState(null),Q=We(t),[oe,ee]=l.useState(!1),te=l.useRef(!1);l.useEffect(()=>{if(w)return sr(w)},[w]),rr();const H=l.useCallback(b=>{const[R,...z]=Q().map(N=>N.ref.current),[P]=z.slice(-1),C=document.activeElement;for(const N of b)if(N===C||(N==null||N.scrollIntoView({block:"nearest"}),N===R&&U&&(U.scrollTop=0),N===P&&U&&(U.scrollTop=U.scrollHeight),N==null||N.focus(),document.activeElement!==C))return},[Q,U]),X=l.useCallback(()=>H([V,w]),[H,V,w]);l.useEffect(()=>{oe&&X()},[oe,X]);const{onOpenChange:se,triggerPointerDownPosRef:ae}=x;l.useEffect(()=>{if(w){let b={x:0,y:0};const R=P=>{var C,N;b={x:Math.abs(Math.round(P.pageX)-(((C=ae.current)==null?void 0:C.x)??0)),y:Math.abs(Math.round(P.pageY)-(((N=ae.current)==null?void 0:N.y)??0))}},z=P=>{b.x<=10&&b.y<=10?P.preventDefault():w.contains(P.target)||se(!1),document.removeEventListener("pointermove",R),ae.current=null};return ae.current!==null&&(document.addEventListener("pointermove",R),document.addEventListener("pointerup",z,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",R),document.removeEventListener("pointerup",z,{capture:!0})}}},[w,se,ae]),l.useEffect(()=>{const b=()=>se(!1);return window.addEventListener("blur",b),window.addEventListener("resize",b),()=>{window.removeEventListener("blur",b),window.removeEventListener("resize",b)}},[se]);const[Qe,be]=_s(b=>{const R=Q().filter(C=>!C.disabled),z=R.find(C=>C.ref.current===document.activeElement),P=Es(R,b,z);P&&setTimeout(()=>P.ref.current.focus())}),Ye=l.useCallback((b,R,z)=>{const P=!te.current&&!z;(x.value!==void 0&&x.value===R||P)&&(f(b),P&&(te.current=!0))},[x.value]),Xe=l.useCallback(()=>w==null?void 0:w.focus(),[w]),xe=l.useCallback((b,R,z)=>{const P=!te.current&&!z;(x.value!==void 0&&x.value===R||P)&&$(b)},[x.value]),Se=c==="popper"?ot:ds,ye=Se===ot?{side:i,sideOffset:o,align:m,alignOffset:h,arrowPadding:a,collisionBoundary:v,collisionPadding:j,sticky:S,hideWhenDetached:p,avoidCollisions:y}:{};return e.jsx(ls,{scope:t,content:w,viewport:U,onViewportChange:re,itemRefCallback:Ye,selectedItem:V,onItemLeave:Xe,itemTextRefCallback:xe,focusSelectedItem:X,selectedItemText:I,position:c,isPositioned:oe,searchRef:Qe,children:e.jsx(or,{as:_r,allowPinchZoom:!0,children:e.jsx(ar,{asChild:!0,trapped:x.open,onMountAutoFocus:b=>{b.preventDefault()},onUnmountAutoFocus:k(n,b=>{var R;(R=x.trigger)==null||R.focus({preventScroll:!0}),b.preventDefault()}),children:e.jsx(Ks,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:b=>b.preventDefault(),onDismiss:()=>x.onOpenChange(!1),children:e.jsx(Se,{role:"listbox",id:x.contentId,"data-state":x.open?"open":"closed",dir:x.dir,onContextMenu:b=>b.preventDefault(),...g,...ye,onPlaced:()=>ee(!0),ref:D,style:{display:"flex",flexDirection:"column",outline:"none",...g.style},onKeyDown:k(g.onKeyDown,b=>{const R=b.ctrlKey||b.altKey||b.metaKey;if(b.key==="Tab"&&b.preventDefault(),!R&&b.key.length===1&&be(b.key),["ArrowUp","ArrowDown","Home","End"].includes(b.key)){let P=Q().filter(C=>!C.disabled).map(C=>C.ref.current);if(["ArrowUp","End"].includes(b.key)&&(P=P.slice().reverse()),["ArrowUp","ArrowDown"].includes(b.key)){const C=b.target,N=P.indexOf(C);P=P.slice(N+1)}setTimeout(()=>H(P)),b.preventDefault()}})})})})})})});cs.displayName=Nr;var Er="SelectItemAlignedPosition",ds=l.forwardRef((s,r)=>{const{__scopeSelect:t,onPlaced:c,...n}=s,u=ce(he,t),d=de(he,t),[i,o]=l.useState(null),[m,h]=l.useState(null),a=J(r,D=>h(D)),v=We(t),j=l.useRef(!1),S=l.useRef(!0),{viewport:p,selectedItem:y,selectedItemText:g,focusSelectedItem:x}=d,w=l.useCallback(()=>{if(u.trigger&&u.valueNode&&i&&m&&p&&y&&g){const D=u.trigger.getBoundingClientRect(),V=m.getBoundingClientRect(),f=u.valueNode.getBoundingClientRect(),I=g.getBoundingClientRect();if(u.dir!=="rtl"){const C=I.left-V.left,N=f.left-C,ue=D.left-N,me=D.width+ue,Ze=Math.max(me,V.width),Je=window.innerWidth-Y,et=gt(N,[Y,Math.max(Y,Je-Ze)]);i.style.minWidth=me+"px",i.style.left=et+"px"}else{const C=V.right-I.right,N=window.innerWidth-f.right-C,ue=window.innerWidth-D.right-N,me=D.width+ue,Ze=Math.max(me,V.width),Je=window.innerWidth-Y,et=gt(N,[Y,Math.max(Y,Je-Ze)]);i.style.minWidth=me+"px",i.style.right=et+"px"}const $=v(),Q=window.innerHeight-Y*2,oe=p.scrollHeight,ee=window.getComputedStyle(m),te=parseInt(ee.borderTopWidth,10),H=parseInt(ee.paddingTop,10),X=parseInt(ee.borderBottomWidth,10),se=parseInt(ee.paddingBottom,10),ae=te+H+oe+se+X,Qe=Math.min(y.offsetHeight*5,ae),be=window.getComputedStyle(p),Ye=parseInt(be.paddingTop,10),Xe=parseInt(be.paddingBottom,10),xe=D.top+D.height/2-Y,Se=Q-xe,ye=y.offsetHeight/2,b=y.offsetTop+ye,R=te+H+b,z=ae-R;if(R<=xe){const C=$.length>0&&y===$[$.length-1].ref.current;i.style.bottom="0px";const N=m.clientHeight-p.offsetTop-p.offsetHeight,ue=Math.max(Se,ye+(C?Xe:0)+N+X),me=R+ue;i.style.height=me+"px"}else{const C=$.length>0&&y===$[0].ref.current;i.style.top="0px";const ue=Math.max(xe,te+p.offsetTop+(C?Ye:0)+ye)+z;i.style.height=ue+"px",p.scrollTop=R-xe+p.offsetTop}i.style.margin=`${Y}px 0`,i.style.minHeight=Qe+"px",i.style.maxHeight=Q+"px",c==null||c(),requestAnimationFrame(()=>j.current=!0)}},[v,u.trigger,u.valueNode,i,m,p,y,g,u.dir,c]);ie(()=>w(),[w]);const[B,U]=l.useState();ie(()=>{m&&U(window.getComputedStyle(m).zIndex)},[m]);const re=l.useCallback(D=>{D&&S.current===!0&&(w(),x==null||x(),S.current=!1)},[w,x]);return e.jsx(Pr,{scope:t,contentWrapper:i,shouldExpandOnScrollRef:j,onScrollButtonChange:re,children:e.jsx("div",{ref:o,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:B},children:e.jsx(q.div,{...n,ref:a,style:{boxSizing:"border-box",maxHeight:"100%",...n.style}})})})});ds.displayName=Er;var Tr="SelectPopperPosition",ot=l.forwardRef((s,r)=>{const{__scopeSelect:t,align:c="start",collisionPadding:n=Y,...u}=s,d=Ge(t);return e.jsx(zs,{...d,...u,ref:r,align:c,collisionPadding:n,style:{boxSizing:"border-box",...u.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});ot.displayName=Tr;var[Pr,mt]=je(he,{}),at="SelectViewport",us=l.forwardRef((s,r)=>{const{__scopeSelect:t,nonce:c,...n}=s,u=de(at,t),d=mt(at,t),i=J(r,u.onViewportChange),o=l.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:c}),e.jsx(ze.Slot,{scope:t,children:e.jsx(q.div,{"data-radix-select-viewport":"",role:"presentation",...n,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...n.style},onScroll:k(n.onScroll,m=>{const h=m.currentTarget,{contentWrapper:a,shouldExpandOnScrollRef:v}=d;if(v!=null&&v.current&&a){const j=Math.abs(o.current-h.scrollTop);if(j>0){const S=window.innerHeight-Y*2,p=parseFloat(a.style.minHeight),y=parseFloat(a.style.height),g=Math.max(p,y);if(g<S){const x=g+j,w=Math.min(S,x),B=x-w;a.style.height=w+"px",a.style.bottom==="0px"&&(h.scrollTop=B>0?B:0,a.style.justifyContent="flex-end")}}}o.current=h.scrollTop})})})]})});us.displayName=at;var ms="SelectGroup",[Ir,Rr]=je(ms),Mr=l.forwardRef((s,r)=>{const{__scopeSelect:t,...c}=s,n=Re();return e.jsx(Ir,{scope:t,id:n,children:e.jsx(q.div,{role:"group","aria-labelledby":n,...c,ref:r})})});Mr.displayName=ms;var ps="SelectLabel",hs=l.forwardRef((s,r)=>{const{__scopeSelect:t,...c}=s,n=Rr(ps,t);return e.jsx(q.div,{id:n.id,...c,ref:r})});hs.displayName=ps;var Pe="SelectItem",[kr,xs]=je(Pe),fs=l.forwardRef((s,r)=>{const{__scopeSelect:t,value:c,disabled:n=!1,textValue:u,...d}=s,i=ce(Pe,t),o=de(Pe,t),m=i.value===c,[h,a]=l.useState(u??""),[v,j]=l.useState(!1),S=J(r,x=>{var w;return(w=o.itemRefCallback)==null?void 0:w.call(o,x,c,n)}),p=Re(),y=l.useRef("touch"),g=()=>{n||(i.onValueChange(c),i.onOpenChange(!1))};if(c==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(kr,{scope:t,value:c,disabled:n,textId:p,isSelected:m,onItemTextChange:l.useCallback(x=>{a(w=>w||((x==null?void 0:x.textContent)??"").trim())},[]),children:e.jsx(ze.ItemSlot,{scope:t,value:c,disabled:n,textValue:h,children:e.jsx(q.div,{role:"option","aria-labelledby":p,"data-highlighted":v?"":void 0,"aria-selected":m&&v,"data-state":m?"checked":"unchecked","aria-disabled":n||void 0,"data-disabled":n?"":void 0,tabIndex:n?void 0:-1,...d,ref:S,onFocus:k(d.onFocus,()=>j(!0)),onBlur:k(d.onBlur,()=>j(!1)),onClick:k(d.onClick,()=>{y.current!=="mouse"&&g()}),onPointerUp:k(d.onPointerUp,()=>{y.current==="mouse"&&g()}),onPointerDown:k(d.onPointerDown,x=>{y.current=x.pointerType}),onPointerMove:k(d.onPointerMove,x=>{var w;y.current=x.pointerType,n?(w=o.onItemLeave)==null||w.call(o):y.current==="mouse"&&x.currentTarget.focus({preventScroll:!0})}),onPointerLeave:k(d.onPointerLeave,x=>{var w;x.currentTarget===document.activeElement&&((w=o.onItemLeave)==null||w.call(o))}),onKeyDown:k(d.onKeyDown,x=>{var B;((B=o.searchRef)==null?void 0:B.current)!==""&&x.key===" "||(vr.includes(x.key)&&g(),x.key===" "&&x.preventDefault())})})})})});fs.displayName=Pe;var we="SelectItemText",gs=l.forwardRef((s,r)=>{const{__scopeSelect:t,className:c,style:n,...u}=s,d=ce(we,t),i=de(we,t),o=xs(we,t),m=br(we,t),[h,a]=l.useState(null),v=J(r,g=>a(g),o.onItemTextChange,g=>{var x;return(x=i.itemTextRefCallback)==null?void 0:x.call(i,g,o.value,o.disabled)}),j=h==null?void 0:h.textContent,S=l.useMemo(()=>e.jsx("option",{value:o.value,disabled:o.disabled,children:j},o.value),[o.disabled,o.value,j]),{onNativeOptionAdd:p,onNativeOptionRemove:y}=m;return ie(()=>(p(S),()=>y(S)),[p,y,S]),e.jsxs(e.Fragment,{children:[e.jsx(q.span,{id:o.textId,...u,ref:v}),o.isSelected&&d.valueNode&&!d.valueNodeHasChildren?vt.createPortal(u.children,d.valueNode):null]})});gs.displayName=we;var vs="SelectItemIndicator",js=l.forwardRef((s,r)=>{const{__scopeSelect:t,...c}=s;return xs(vs,t).isSelected?e.jsx(q.span,{"aria-hidden":!0,...c,ref:r}):null});js.displayName=vs;var nt="SelectScrollUpButton",ys=l.forwardRef((s,r)=>{const t=de(nt,s.__scopeSelect),c=mt(nt,s.__scopeSelect),[n,u]=l.useState(!1),d=J(r,c.onScrollButtonChange);return ie(()=>{if(t.viewport&&t.isPositioned){let i=function(){const m=o.scrollTop>0;u(m)};const o=t.viewport;return i(),o.addEventListener("scroll",i),()=>o.removeEventListener("scroll",i)}},[t.viewport,t.isPositioned]),n?e.jsx(bs,{...s,ref:d,onAutoScroll:()=>{const{viewport:i,selectedItem:o}=t;i&&o&&(i.scrollTop=i.scrollTop-o.offsetHeight)}}):null});ys.displayName=nt;var it="SelectScrollDownButton",ws=l.forwardRef((s,r)=>{const t=de(it,s.__scopeSelect),c=mt(it,s.__scopeSelect),[n,u]=l.useState(!1),d=J(r,c.onScrollButtonChange);return ie(()=>{if(t.viewport&&t.isPositioned){let i=function(){const m=o.scrollHeight-o.clientHeight,h=Math.ceil(o.scrollTop)<m;u(h)};const o=t.viewport;return i(),o.addEventListener("scroll",i),()=>o.removeEventListener("scroll",i)}},[t.viewport,t.isPositioned]),n?e.jsx(bs,{...s,ref:d,onAutoScroll:()=>{const{viewport:i,selectedItem:o}=t;i&&o&&(i.scrollTop=i.scrollTop+o.offsetHeight)}}):null});ws.displayName=it;var bs=l.forwardRef((s,r)=>{const{__scopeSelect:t,onAutoScroll:c,...n}=s,u=de("SelectScrollButton",t),d=l.useRef(null),i=We(t),o=l.useCallback(()=>{d.current!==null&&(window.clearInterval(d.current),d.current=null)},[]);return l.useEffect(()=>()=>o(),[o]),ie(()=>{var h;const m=i().find(a=>a.ref.current===document.activeElement);(h=m==null?void 0:m.ref.current)==null||h.scrollIntoView({block:"nearest"})},[i]),e.jsx(q.div,{"aria-hidden":!0,...n,ref:r,style:{flexShrink:0,...n.style},onPointerDown:k(n.onPointerDown,()=>{d.current===null&&(d.current=window.setInterval(c,50))}),onPointerMove:k(n.onPointerMove,()=>{var m;(m=u.onItemLeave)==null||m.call(u),d.current===null&&(d.current=window.setInterval(c,50))}),onPointerLeave:k(n.onPointerLeave,()=>{o()})})}),Ar="SelectSeparator",Ss=l.forwardRef((s,r)=>{const{__scopeSelect:t,...c}=s;return e.jsx(q.div,{"aria-hidden":!0,...c,ref:r})});Ss.displayName=Ar;var lt="SelectArrow",Dr=l.forwardRef((s,r)=>{const{__scopeSelect:t,...c}=s,n=Ge(t),u=ce(lt,t),d=de(lt,t);return u.open&&d.position==="popper"?e.jsx(Ws,{...n,...c,ref:r}):null});Dr.displayName=lt;var Or="SelectBubbleInput",Cs=l.forwardRef(({__scopeSelect:s,value:r,...t},c)=>{const n=l.useRef(null),u=J(c,n),d=ir(r);return l.useEffect(()=>{const i=n.current;if(!i)return;const o=window.HTMLSelectElement.prototype,h=Object.getOwnPropertyDescriptor(o,"value").set;if(d!==r&&h){const a=new Event("change",{bubbles:!0});h.call(i,r),i.dispatchEvent(a)}},[d,r]),e.jsx(q.select,{...t,style:{...Gs,...t.style},ref:u,defaultValue:r})});Cs.displayName=Or;function Ns(s){return s===""||s===void 0}function _s(s){const r=Qs(s),t=l.useRef(""),c=l.useRef(0),n=l.useCallback(d=>{const i=t.current+d;r(i),function o(m){t.current=m,window.clearTimeout(c.current),m!==""&&(c.current=window.setTimeout(()=>o(""),1e3))}(i)},[r]),u=l.useCallback(()=>{t.current="",window.clearTimeout(c.current)},[]);return l.useEffect(()=>()=>window.clearTimeout(c.current),[]),[t,n,u]}function Es(s,r,t){const n=r.length>1&&Array.from(r).every(m=>m===r[0])?r[0]:r,u=t?s.indexOf(t):-1;let d=Lr(s,Math.max(u,0));n.length===1&&(d=d.filter(m=>m!==t));const o=d.find(m=>m.textValue.toLowerCase().startsWith(n.toLowerCase()));return o!==t?o:void 0}function Lr(s,r){return s.map((t,c)=>s[(r+c)%s.length])}var Fr=es,Ts=ss,qr=os,Vr=as,$r=ns,Ps=is,Br=us,Is=hs,Rs=fs,Ur=gs,Hr=js,Ms=ys,ks=ws,As=Ss;const Ds=Fr,Os=qr,pt=l.forwardRef(({className:s,children:r,...t},c)=>e.jsxs(Ts,{ref:c,className:W("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...t,children:[r,e.jsx(Vr,{asChild:!0,children:e.jsx(Ft,{className:"h-4 w-4 opacity-50"})})]}));pt.displayName=Ts.displayName;const Ls=l.forwardRef(({className:s,...r},t)=>e.jsx(Ms,{ref:t,className:W("flex cursor-default items-center justify-center py-1",s),...r,children:e.jsx(cr,{className:"h-4 w-4"})}));Ls.displayName=Ms.displayName;const Fs=l.forwardRef(({className:s,...r},t)=>e.jsx(ks,{ref:t,className:W("flex cursor-default items-center justify-center py-1",s),...r,children:e.jsx(Ft,{className:"h-4 w-4"})}));Fs.displayName=ks.displayName;const ht=l.forwardRef(({className:s,children:r,position:t="popper",...c},n)=>e.jsx($r,{children:e.jsxs(Ps,{ref:n,className:W("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:t,...c,children:[e.jsx(Ls,{}),e.jsx(Br,{className:W("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),e.jsx(Fs,{})]})}));ht.displayName=Ps.displayName;const Kr=l.forwardRef(({className:s,...r},t)=>e.jsx(Is,{ref:t,className:W("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r}));Kr.displayName=Is.displayName;const xt=l.forwardRef(({className:s,children:r,...t},c)=>e.jsxs(Rs,{ref:c,className:W("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Hr,{children:e.jsx(lr,{className:"h-4 w-4"})})}),e.jsx(Ur,{children:r})]}));xt.displayName=Rs.displayName;const zr=l.forwardRef(({className:s,...r},t)=>e.jsx(As,{ref:t,className:W("-mx-1 my-1 h-px bg-muted",s),...r}));zr.displayName=As.displayName;const Wr=Me({name:G().min(1,"O nome é obrigatório."),description:G().optional(),display_order:ke.number().default(0),is_active:fe().default(!0)}),qs=({isOpen:s,onClose:r,restaurantId:t})=>{const c=ge(),n=Ae({resolver:De(Wr),defaultValues:{name:"",description:"",display_order:0,is_active:!0}}),u=ne({mutationFn:async i=>{if(!t)throw new Error("ID do restaurante não encontrado.");const{error:o}=await F.from("categories").insert({restaurant_id:t,name:i.name,description:i.description,display_order:i.display_order,is_active:i.is_active});if(o)throw new Error(o.message)},onSuccess:()=>{L.success("Categoria criada com sucesso!"),c.invalidateQueries({queryKey:["categoriesWithProducts",t]}),c.invalidateQueries({queryKey:["categories",t]}),r(),n.reset()},onError:i=>{L.error(`Erro ao criar categoria: ${i.message}`)}}),d=i=>{u.mutate(i)};return e.jsx(Oe,{open:s,onOpenChange:r,children:e.jsxs(Le,{className:"sm:max-w-[425px]",children:[e.jsxs(Fe,{children:[e.jsx(qe,{children:"Nova Categoria"}),e.jsx(Ve,{children:"Gerencie as categorias dos seus produtos"})]}),e.jsx(Ue,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(d),className:"space-y-4 pt-4",children:[e.jsx(_,{control:n.control,name:"name",render:({field:i})=>e.jsxs(E,{children:[e.jsx(M,{children:"Nome *"}),e.jsx(T,{children:e.jsx(Z,{placeholder:"",...i})}),e.jsx(O,{})]})}),e.jsx(_,{control:n.control,name:"description",render:({field:i})=>e.jsxs(E,{children:[e.jsx(M,{children:"Descrição"}),e.jsx(T,{children:e.jsx(He,{placeholder:"",...i})}),e.jsx(O,{})]})}),e.jsx(_,{control:n.control,name:"display_order",render:({field:i})=>e.jsxs(E,{children:[e.jsx(M,{children:"Ordem de Exibição"}),e.jsx(T,{children:e.jsx(Z,{type:"number",...i})}),e.jsx(O,{})]})}),e.jsx(_,{control:n.control,name:"is_active",render:({field:i})=>e.jsxs(E,{className:"flex flex-row items-center space-x-3 space-y-0 pt-2",children:[e.jsx(T,{children:e.jsx(le,{checked:i.value,onCheckedChange:i.onChange,id:"is_active"})}),e.jsx(M,{htmlFor:"is_active",className:"font-normal cursor-pointer",children:"Ativa"})]})}),e.jsxs($e,{className:"pt-4",children:[e.jsx(Be,{asChild:!0,children:e.jsx(A,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(A,{type:"submit",disabled:u.isPending||!t,children:u.isPending?"Criando...":"Criar"})]})]})})]})})},Gr=Me({name:G().min(1,"O nome é obrigatório."),description:G().optional(),price:_t(s=>String(s).replace(",","."),ke.number({invalid_type_error:"O preço deve ser um número."}).positive("O preço deve ser maior que zero.")),category_id:G().min(1,"A categoria é obrigatória."),image_url:G().url("URL inválida.").optional().or(Et("")),image_file:Tt(File).optional(),is_price_by_weight:fe().default(!1),is_available:fe().default(!0)}).refine(s=>s.image_url||s.image_file,{message:"É necessário enviar uma imagem ou uma URL.",path:["image_file"]}),Qr=async s=>{const{data:r,error:t}=await F.from("categories").select("id, name").eq("restaurant_id",s).eq("is_active",!0);if(t)throw new Error(t.message);return r},Yr=({isOpen:s,onClose:r,restaurantId:t})=>{const c=ge(),[n,u]=l.useState(!1),{data:d,isLoading:i}=Ie({queryKey:["categories",t],queryFn:()=>Qr(t),enabled:!!t&&s}),o=Ae({resolver:De(Gr),defaultValues:{name:"",description:"",price:0,is_price_by_weight:!1,is_available:!0,image_url:"",category_id:""}}),m=ne({mutationFn:async a=>{if(!t)throw new Error("ID do restaurante não encontrado.");let v=a.image_url;if(a.image_file){const S=a.image_file,p=`${t}/${Date.now()}-${S.name}`,{error:y}=await F.storage.from("products").upload(p,S);if(y)throw new Error(`Erro no upload da imagem: ${y.message}`);const{data:g}=F.storage.from("products").getPublicUrl(p);v=g.publicUrl}const{error:j}=await F.from("products").insert({restaurant_id:t,name:a.name,description:a.description,price:a.price,category_id:a.category_id,image_url:v,is_price_by_weight:a.is_price_by_weight,is_available:a.is_available});if(j)throw new Error(j.message)},onSuccess:()=>{L.success("Produto criado com sucesso!"),c.invalidateQueries({queryKey:["products"]}),r(),o.reset()},onError:a=>{L.error(`Erro ao criar produto: ${a.message}`)}}),h=a=>{m.mutate(a)};return e.jsxs(e.Fragment,{children:[e.jsx(qs,{isOpen:n,onClose:()=>u(!1),restaurantId:t}),e.jsx(Oe,{open:s,onOpenChange:r,children:e.jsxs(Le,{className:"sm:max-w-lg",children:[e.jsxs(Fe,{children:[e.jsx(qe,{children:"Novo Produto"}),e.jsx(Ve,{children:"Adicione um novo item ao seu cardápio."})]}),e.jsx(Ue,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(h),children:[e.jsxs("div",{className:"space-y-4 py-2 pb-4 max-h-[70vh] overflow-y-auto pr-4",children:[e.jsx(_,{control:o.control,name:"name",render:({field:a})=>e.jsxs(E,{children:[e.jsx(M,{children:"Nome *"}),e.jsx(T,{children:e.jsx(Z,{placeholder:"Nome do produto",...a})}),e.jsx(O,{})]})}),e.jsx(_,{control:o.control,name:"description",render:({field:a})=>e.jsxs(E,{children:[e.jsx(M,{children:"Descrição"}),e.jsx(T,{children:e.jsx(He,{placeholder:"Ingredientes, detalhes, etc.",...a})}),e.jsx(O,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(_,{control:o.control,name:"price",render:({field:a})=>e.jsxs(E,{children:[e.jsx(M,{children:"Preço (R$) unitário *"}),e.jsx(T,{children:e.jsx(Z,{type:"text",placeholder:"0,00",...a})}),e.jsx(O,{})]})}),e.jsx(_,{control:o.control,name:"category_id",render:({field:a})=>e.jsxs(E,{children:[e.jsx(M,{children:"Categoria *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ds,{onValueChange:a.onChange,value:a.value,disabled:i||!t,children:[e.jsx(T,{children:e.jsx(pt,{children:e.jsx(Os,{placeholder:"Selecione uma categoria"})})}),e.jsx(ht,{children:d==null?void 0:d.map(v=>e.jsx(xt,{value:v.id,children:v.name},v.id))})]}),e.jsx(A,{type:"button",variant:"outline",size:"icon",onClick:()=>u(!0),disabled:!t,children:e.jsx(ct,{className:"h-4 w-4"})})]}),e.jsx(O,{})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Imagem do Produto"}),e.jsx(_,{control:o.control,name:"image_file",render:({field:a})=>{var v;return e.jsxs(E,{children:[e.jsx(T,{children:e.jsxs("label",{className:"flex items-center justify-center w-full h-12 px-4 border-2 border-dashed rounded-md cursor-pointer hover:bg-muted",children:[e.jsx(qt,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:((v=a.value)==null?void 0:v.name)||"Escolher Imagem"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:j=>{var S;return a.onChange((S=j.target.files)==null?void 0:S[0])}})]})}),e.jsx(O,{})]})}}),e.jsx(_,{control:o.control,name:"image_url",render:({field:a})=>e.jsxs(E,{children:[e.jsx(T,{children:e.jsx(Z,{placeholder:"Ou cole a URL da imagem",...a})}),e.jsx(O,{})]})})]}),e.jsx(_,{control:o.control,name:"is_price_by_weight",render:({field:a})=>e.jsxs(E,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(M,{children:"Produto pesável (preço por kg)"}),e.jsx(T,{children:e.jsx(le,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsx(_,{control:o.control,name:"is_available",render:({field:a})=>e.jsxs(E,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(M,{children:"Produto disponível"}),e.jsx(T,{children:e.jsx(le,{checked:a.value,onCheckedChange:a.onChange})})]})})]}),e.jsxs($e,{className:"pt-4 border-t",children:[e.jsx(Be,{asChild:!0,children:e.jsx(A,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(A,{type:"submit",disabled:m.isPending||!t,children:m.isPending?"Criando...":"Criar Produto"})]})]})})]})})]})},Xr=Me({name:G().min(1,"O nome é obrigatório."),description:G().optional(),price:_t(s=>String(s).replace(",","."),ke.number({invalid_type_error:"O preço deve ser um número."}).positive("O preço deve ser maior que zero.")),category_id:G().optional(),image_url:G().url("URL inválida.").optional().or(Et("")),image_file:Tt(File).optional(),is_price_by_weight:fe().default(!1),is_available:fe().default(!0)}),Zr=async s=>{const{data:r,error:t}=await F.from("categories").select("id, name").eq("restaurant_id",s).eq("is_active",!0);if(t)throw new Error(t.message);return r},Jr=({isOpen:s,onClose:r,product:t})=>{const c=ge(),[n,u]=l.useState(null);l.useEffect(()=>{t!=null&&t.restaurant_id&&u(t.restaurant_id)},[t,s]);const{data:d,isLoading:i}=Ie({queryKey:["categories",n],queryFn:()=>Zr(n),enabled:!!n&&s}),o=Ae({resolver:De(Xr)});l.useEffect(()=>{t&&o.reset({name:t.name,description:t.description||"",price:t.price,category_id:t.category_id||void 0,image_url:t.image_url||"",is_price_by_weight:t.is_price_by_weight||!1,is_available:t.is_available??!0,image_file:void 0})},[t,o,s]);const m=ne({mutationFn:async a=>{if(!(t!=null&&t.id)||!n)throw new Error("ID do produto ou restaurante não encontrado.");let v=t.image_url;if(a.image_file){const S=a.image_file,p=`${n}/${Date.now()}-${S.name}`,{error:y}=await F.storage.from("products").upload(p,S);if(y)throw new Error(`Erro no upload da imagem: ${y.message}`);const{data:g}=F.storage.from("products").getPublicUrl(p);v=g.publicUrl}else v=a.image_url||null;const{error:j}=await F.from("products").update({name:a.name,description:a.description,price:a.price,category_id:a.category_id||null,image_url:v,is_price_by_weight:a.is_price_by_weight,is_available:a.is_available}).eq("id",t.id);if(j)throw j},onSuccess:()=>{L.success("Produto atualizado com sucesso!"),c.invalidateQueries({queryKey:["products",n]}),c.invalidateQueries({queryKey:["menuData"]}),r()},onError:a=>{L.error(`Erro ao atualizar produto: ${a.message}`)}}),h=a=>{m.mutate(a)};return e.jsx(Oe,{open:s,onOpenChange:r,children:e.jsxs(Le,{className:"sm:max-w-lg",children:[e.jsxs(Fe,{children:[e.jsx(qe,{children:"Editar Produto"}),e.jsx(Ve,{children:"Atualize as informações do item do seu cardápio."})]}),e.jsx(Ue,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(h),children:[e.jsxs("div",{className:"space-y-4 py-2 pb-4 max-h-[70vh] overflow-y-auto pr-4",children:[e.jsx(_,{control:o.control,name:"name",render:({field:a})=>e.jsxs(E,{children:[e.jsx(M,{children:"Nome *"}),e.jsx(T,{children:e.jsx(Z,{...a})}),e.jsx(O,{})]})}),e.jsx(_,{control:o.control,name:"description",render:({field:a})=>e.jsxs(E,{children:[e.jsx(M,{children:"Descrição"}),e.jsx(T,{children:e.jsx(He,{...a})}),e.jsx(O,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(_,{control:o.control,name:"price",render:({field:a})=>e.jsxs(E,{children:[e.jsx(M,{children:"Preço (R$) *"}),e.jsx(T,{children:e.jsx(Z,{type:"text",...a})}),e.jsx(O,{})]})}),e.jsx(_,{control:o.control,name:"category_id",render:({field:a})=>e.jsxs(E,{children:[e.jsx(M,{children:"Categoria"}),e.jsxs(Ds,{onValueChange:a.onChange,value:a.value,disabled:i||!n,children:[e.jsx(T,{children:e.jsx(pt,{children:e.jsx(Os,{placeholder:"Selecione uma categoria"})})}),e.jsx(ht,{children:d==null?void 0:d.map(v=>e.jsx(xt,{value:v.id,children:v.name},v.id))})]}),e.jsx(O,{})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Imagem do Produto"}),e.jsx(_,{control:o.control,name:"image_file",render:({field:a})=>{var v;return e.jsxs(E,{children:[e.jsx(T,{children:e.jsxs("label",{className:"flex items-center justify-center w-full h-12 px-4 border-2 border-dashed rounded-md cursor-pointer hover:bg-muted",children:[e.jsx(qt,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:((v=a.value)==null?void 0:v.name)||"Escolher Nova Imagem"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:j=>{var S;return a.onChange((S=j.target.files)==null?void 0:S[0])}})]})}),e.jsx(O,{})]})}}),e.jsx(_,{control:o.control,name:"image_url",render:({field:a})=>e.jsxs(E,{children:[e.jsx(T,{children:e.jsx(Z,{placeholder:"Ou cole a URL da imagem",...a})}),e.jsx(O,{})]})})]}),e.jsx(_,{control:o.control,name:"is_price_by_weight",render:({field:a})=>e.jsxs(E,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(M,{children:"Produto pesável (preço por kg)"}),e.jsx(T,{children:e.jsx(le,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsx(_,{control:o.control,name:"is_available",render:({field:a})=>e.jsxs(E,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(M,{children:"Produto disponível"}),e.jsx(T,{children:e.jsx(le,{checked:a.value,onCheckedChange:a.onChange})})]})})]}),e.jsxs($e,{className:"pt-4 border-t",children:[e.jsx(Be,{asChild:!0,children:e.jsx(A,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(A,{type:"submit",disabled:m.isPending||!n,children:m.isPending?"Salvando...":"Salvar Alterações"})]})]})})]})})},eo=Me({name:G().min(1,"O nome é obrigatório."),description:G().optional(),display_order:ke.number().default(0),is_active:fe().default(!0)}),to=({isOpen:s,onClose:r,category:t,restaurantId:c})=>{const n=ge(),u=Ae({resolver:De(eo),defaultValues:{name:"",description:"",display_order:0,is_active:!0}});l.useEffect(()=>{t&&u.reset({name:t.name||"",description:t.description||"",display_order:t.display_order??0,is_active:t.is_active??!0})},[t,u,s]);const d=ne({mutationFn:async o=>{if(!(t!=null&&t.id))throw new Error("ID da categoria não encontrado.");const m={name:o.name,description:o.description,display_order:o.display_order,is_active:o.is_active},{error:h}=await F.from("categories").update(m).eq("id",t.id);if(h)throw new Error(h.message)},onSuccess:()=>{L.success("Categoria atualizada com sucesso!"),n.invalidateQueries({queryKey:["categoriesWithProducts",c]}),n.invalidateQueries({queryKey:["categories",c]}),n.invalidateQueries({queryKey:["menuData"]}),r()},onError:o=>{L.error(`Erro ao atualizar categoria: ${o.message}`)}}),i=o=>{d.mutate(o)};return e.jsx(Oe,{open:s,onOpenChange:r,children:e.jsxs(Le,{className:"sm:max-w-[425px]",children:[e.jsxs(Fe,{children:[e.jsxs(qe,{children:["Editar Categoria: ",t==null?void 0:t.name]}),e.jsx(Ve,{children:"Atualize as informações da categoria."})]}),e.jsx(Ue,{...u,children:e.jsxs("form",{onSubmit:u.handleSubmit(i),className:"space-y-4 pt-4",children:[e.jsx(_,{control:u.control,name:"name",render:({field:o})=>e.jsxs(E,{children:[e.jsx(M,{children:"Nome *"}),e.jsx(T,{children:e.jsx(Z,{placeholder:"",...o})}),e.jsx(O,{})]})}),e.jsx(_,{control:u.control,name:"description",render:({field:o})=>e.jsxs(E,{children:[e.jsx(M,{children:"Descrição"}),e.jsx(T,{children:e.jsx(He,{placeholder:"",...o})}),e.jsx(O,{})]})}),e.jsx(_,{control:u.control,name:"display_order",render:({field:o})=>e.jsxs(E,{children:[e.jsx(M,{children:"Ordem de Exibição"}),e.jsx(T,{children:e.jsx(Z,{type:"number",...o})}),e.jsx(O,{})]})}),e.jsx(_,{control:u.control,name:"is_active",render:({field:o})=>e.jsxs(E,{className:"flex flex-row items-center space-x-3 space-y-0 pt-2",children:[e.jsx(T,{children:e.jsx(le,{checked:o.value,onCheckedChange:o.onChange,id:"is_active_edit"})}),e.jsx(M,{htmlFor:"is_active_edit",className:"font-normal cursor-pointer",children:"Ativa"})]})}),e.jsxs($e,{className:"pt-4",children:[e.jsx(Be,{asChild:!0,children:e.jsx(A,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsxs(A,{type:"submit",disabled:d.isPending||!(t!=null&&t.id),children:[d.isPending?e.jsx(_e,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(tr,{className:"h-4 w-4 mr-2"}),"Salvar Alterações"]})]})]})})]})})},so=async s=>{const{data:r,error:t}=await F.from("categories").select("*").eq("restaurant_id",s).order("display_order",{ascending:!0});if(t)throw new Error(`Erro ao buscar categorias: ${t.message}`);const{data:c,error:n}=await F.from("products").select("id, name, category_id, is_available").eq("restaurant_id",s);if(n)throw new Error(`Erro ao buscar produtos: ${n.message}`);return r.map(d=>({...d,products:c.filter(i=>i.category_id===d.id)}))},ro=({restaurantId:s})=>{const r=ge(),[t,c]=l.useState(!1),[n,u]=l.useState(!1),[d,i]=l.useState(null),[o,m]=l.useState(null),{data:h,isLoading:a,isError:v,error:j}=Ie({queryKey:["categoriesWithProducts",s],queryFn:()=>so(s),enabled:!!s}),S=g=>{m(g)},p=ne({mutationFn:async g=>{const{error:x}=await F.from("categories").delete().eq("id",g);if(x)throw new Error(x.message)},onSuccess:()=>{L.success("Categoria excluída com sucesso!"),r.invalidateQueries({queryKey:["categoriesWithProducts",s]}),r.invalidateQueries({queryKey:["categories",s]}),r.invalidateQueries({queryKey:["menuData"]}),m(null)},onError:g=>{L.error(`Erro ao excluir categoria: ${g.message}`),m(null)}}),y=h==null?void 0:h.find(g=>g.id===o);return e.jsxs(e.Fragment,{children:[e.jsx(qs,{isOpen:t,onClose:()=>c(!1),restaurantId:s}),e.jsx(to,{isOpen:n,onClose:()=>{u(!1),i(null)},category:d,restaurantId:s}),e.jsx(Pt,{open:!!o,onOpenChange:g=>!g&&m(null),children:e.jsxs(It,{children:[e.jsxs(Rt,{children:[e.jsx(Mt,{children:"Tem certeza que deseja excluir esta categoria?"}),e.jsxs(kt,{children:['Esta ação é permanente. A categoria "',(y==null?void 0:y.name)||"selecionada",'" será removida.',e.jsx("br",{}),"**Atenção:** Os produtos associados a esta categoria não serão excluídos, mas ficarão sem categoria."]})]}),e.jsxs(At,{children:[e.jsx(Dt,{disabled:p.isPending,children:"Cancelar"}),e.jsxs(Ot,{onClick:()=>p.mutate(o),className:"bg-destructive hover:bg-destructive/90",disabled:p.isPending,children:[p.isPending?e.jsx(_e,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Excluir"]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Categorias"}),e.jsxs(A,{onClick:()=>c(!0),disabled:!s,children:[e.jsx(ct,{className:"mr-2 h-4 w-4"})," Nova Categoria"]})]}),a&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[...Array(3)].map((g,x)=>e.jsxs(Ce,{children:[e.jsx(ft,{children:e.jsx(K,{className:"h-6 w-3/4"})}),e.jsxs(Ne,{className:"space-y-4",children:[e.jsx(K,{className:"h-4 w-1/4"}),e.jsx(K,{className:"h-4 w-1/2"}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(K,{className:"h-8 w-full"}),e.jsx(K,{className:"h-8 w-full"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(K,{className:"h-10 w-full"}),e.jsx(K,{className:"h-10 w-10"})]})]})]},x))}),v&&e.jsxs(St,{variant:"destructive",children:[e.jsx(Lt,{className:"h-4 w-4"}),e.jsx(Ct,{children:"Erro ao carregar categorias"}),e.jsx(Nt,{children:j instanceof Error?j.message:"Ocorreu um erro desconhecido."})]}),h&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:h.map(g=>e.jsxs(Ce,{children:[e.jsxs(ft,{className:"flex flex-row items-start justify-between",children:[e.jsx($s,{children:g.name}),g.is_active&&e.jsx(Te,{children:"Ativa"})]}),e.jsxs(Ne,{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ordem: ",g.display_order??0]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium mb-2",children:["Produtos (",g.products.length,"):"]}),e.jsx("div",{className:"space-y-2",children:g.products.length>0?g.products.map(x=>e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-2 rounded-md",children:[e.jsx("span",{className:"text-sm",children:x.name}),x.is_available&&e.jsx(Te,{variant:"secondary",children:"Disponível"})]},x.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum produto nesta categoria."})})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[e.jsxs(A,{variant:"outline",className:"w-full",onClick:()=>{i(g),u(!0)},children:[e.jsx(dt,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsx(A,{variant:"destructive",size:"icon",onClick:()=>S(g.id),children:e.jsx(Ee,{className:"h-4 w-4"})})]})]})]},g.id))})]})]})},oo=({product:s,onEditClick:r,onUpdateStatus:t,onDeleteClick:c})=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-card hover:bg-accent transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:s.image_url||"/placeholder.svg",alt:s.name,className:"w-16 h-16 object-cover rounded-md border"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.price)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{variant:s.is_available?"default":"secondary",children:s.is_available?"Disponível":"Indisponível"}),e.jsx(le,{checked:s.is_available??!1,onCheckedChange:t}),e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>r(s),children:e.jsx(dt,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>c(s.id),children:e.jsx(Ee,{className:"h-4 w-4"})})]})]}),ao=async s=>{const{data:r,error:t}=await F.from("products").select("*").eq("restaurant_id",s).order("created_at",{ascending:!1});if(t)throw new Error(`Erro ao buscar produtos: ${t.message}`);return r},Ao=()=>{const s=ge(),{userRestaurantId:r}=Bs(),[t,c]=l.useState(!1),[n,u]=l.useState(!1),[d,i]=l.useState(null),[o,m]=l.useState(null),[h,a]=l.useState(()=>{if(typeof window<"u"){const f=localStorage.getItem("productsLayout");return f==="grid"||f==="list"?f:"grid"}return"grid"}),v=l.useCallback(f=>{a(f),localStorage.setItem("productsLayout",f)},[]),{data:j,isLoading:S,isError:p,error:y}=Ie({queryKey:["products",r],queryFn:()=>ao(r),enabled:!!r}),g=f=>{i(f),u(!0)},x=ne({mutationFn:async({id:f,is_available:I})=>{const{error:$}=await F.from("products").update({is_available:I}).eq("id",f);if($)throw new Error($.message)},onSuccess:()=>{s.invalidateQueries({queryKey:["products"]}),L.success("Status do produto atualizado!")},onError:f=>{L.error(`Erro ao atualizar produto: ${f.message}`)}}),w=ne({mutationFn:async f=>{const{error:I}=await F.from("products").delete().eq("id",f);if(I)throw new Error(I.message)},onSuccess:()=>{s.invalidateQueries({queryKey:["products"]}),s.invalidateQueries({queryKey:["menuData"]}),L.success("Produto excluído com sucesso!"),m(null)},onError:f=>{L.error(`Erro ao excluir produto: ${f.message}`),m(null)}}),B=ne({mutationFn:async f=>{if(!j||j.length===0||!r)return;const I=j.map(Q=>Q.id),{error:$}=await F.from("products").update({is_available:f}).in("id",I);if($)throw new Error($.message)},onSuccess:(f,I)=>{s.invalidateQueries({queryKey:["products"]}),s.invalidateQueries({queryKey:["menuData"]}),L.success(`Todos os produtos foram ${I?"ativados":"desativados"} com sucesso!`)},onError:f=>{L.error(`Erro ao atualizar status em massa: ${f.message}`)}}),U=f=>{if(!j||j.length===0){L.info("Nenhum produto para atualizar.");return}B.mutate(f)},re=f=>{w.mutate(f)},D=j==null?void 0:j.find(f=>f.id===o),V=B.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(Yr,{isOpen:t,onClose:()=>c(!1),restaurantId:r}),e.jsx(Jr,{isOpen:n,onClose:()=>u(!1),product:d}),e.jsx(Pt,{open:!!o,onOpenChange:f=>!f&&m(null),children:e.jsxs(It,{children:[e.jsxs(Rt,{children:[e.jsx(Mt,{children:"Tem certeza que deseja excluir este produto?"}),e.jsxs(kt,{children:['Esta ação é permanente. O produto "',(D==null?void 0:D.name)||"selecionado",'" será removido do cardápio.']})]}),e.jsxs(At,{children:[e.jsx(Dt,{disabled:w.isPending,children:"Cancelar"}),e.jsx(Ot,{onClick:()=>re(o),className:"bg-destructive hover:bg-destructive/90",disabled:w.isPending,children:w.isPending?"Excluindo...":"Excluir"})]})]})}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:e.jsxs(xr,{defaultValue:"products",children:[e.jsxs(Jt,{children:[e.jsx(st,{value:"products",children:"Produtos"}),e.jsx(st,{value:"categories",children:"Categorias"})]}),e.jsxs(rt,{value:"products",className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Produtos"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(A,{variant:"outline",size:"icon",onClick:()=>v(h==="grid"?"list":"grid"),children:h==="grid"?e.jsx(ur,{className:"h-4 w-4"}):e.jsx(dr,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",onClick:()=>U(!0),disabled:V||S||!j||j.length===0,children:V?e.jsx(_e,{className:"h-4 w-4 animate-spin mr-2"}):"Ativar Todos"}),e.jsx(A,{variant:"outline",onClick:()=>U(!1),disabled:V||S||!j||j.length===0,children:V?e.jsx(_e,{className:"h-4 w-4 animate-spin mr-2"}):"Desativar Todos"}),e.jsxs(A,{onClick:()=>c(!0),children:[e.jsx(ct,{className:"mr-2 h-4 w-4"})," Novo Produto"]})]})]}),S&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((f,I)=>e.jsxs(Ce,{className:"overflow-hidden",children:[e.jsx(K,{className:"h-48 w-full"}),e.jsxs(Ne,{className:"p-4 space-y-3",children:[e.jsx(K,{className:"h-5 w-3/4"}),e.jsx(K,{className:"h-6 w-1/3"}),e.jsxs("div",{className:"flex justify-between items-center border-t pt-3 mt-3",children:[e.jsx(K,{className:"h-5 w-1/2"}),e.jsx(K,{className:"h-6 w-12"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(K,{className:"h-10 w-full"}),e.jsx(K,{className:"h-10 w-10"})]})]})]},I))}),p&&e.jsxs(St,{variant:"destructive",children:[e.jsx(Lt,{className:"h-4 w-4"}),e.jsx(Ct,{children:"Erro ao carregar produtos"}),e.jsx(Nt,{children:y.message})]}),j&&e.jsx("div",{className:W(h==="grid"?"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"space-y-4"),children:j.map(f=>h==="grid"?e.jsxs(Ce,{className:"overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:f.image_url||"/placeholder.svg",alt:f.name,className:"w-full h-48 object-cover"}),f.is_available&&e.jsx(Te,{className:"absolute top-2 right-2",children:"Disponível"})]}),e.jsxs(Ne,{className:"p-4 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"text-lg font-semibold truncate",children:f.name}),e.jsx("p",{className:"text-xl font-bold text-primary mt-1 mb-3",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(f.price)})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-t pt-3",children:[e.jsx("label",{htmlFor:`active-${f.id}`,className:"text-sm font-medium",children:"Produto Ativo"}),e.jsx(le,{id:`active-${f.id}`,checked:f.is_available??!1,onCheckedChange:I=>{x.mutate({id:f.id,is_available:I})}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(A,{variant:"outline",className:"w-full",onClick:()=>g(f),children:[e.jsx(dt,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsx(A,{variant:"destructive",size:"icon",onClick:()=>m(f.id),children:e.jsx(Ee,{className:"h-4 w-4"})})]})]})]})]},f.id):e.jsx(oo,{product:f,onEditClick:g,onUpdateStatus:I=>x.mutate({id:f.id,is_available:I}),onDeleteClick:re},f.id))})]}),e.jsx(rt,{value:"categories",children:e.jsx(ro,{restaurantId:r})})]})})]})};export{Ao as default};
