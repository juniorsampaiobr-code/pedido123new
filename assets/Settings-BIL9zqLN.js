import{j as e,u as k,b as V,c as K}from"./tanstack-d4AvmB45.js";import{o as Q,s as u,l as U,b as $,p as S,c as _,u as Z,t as H}from"./types-DKlirIXB.js";import{s as f}from"./client-D5i5GwB9.js";import{B as G}from"./button-B32jff8i.js";import{C as z,b as L,c as F,a as P}from"./card-Bwblxcsp.js";import{I as x,L as J}from"./label-Ci-Iy_hA.js";import{T as W}from"./textarea-VCtpad5C.js";import{S as X}from"./switch-BTCz2w2d.js";import{u as M}from"./index-CqkdHDdl.js";import{F as Y,a as i,b as l,c,d,e as m}from"./form-BnQj-iBa.js";import{S as ee}from"./skeleton-BabO2S0c.js";import{r as h,i as re}from"./vendor-CnEXr6gt.js";import{L as se,Z as oe}from"./LazyMap-fpoHo-JT.js";import{M as ae,P as te}from"./PhoneInput-8RkbkpGs.js";import{M as ne}from"./map-pin-7rWfKumS.js";import{P as ie}from"./phone-BCRTxmZl.js";import"./supabase-BZV_3FV3.js";import"./index-KNP7Yozt.js";const le=({markerPosition:s,onLocationChange:t,restaurant:n})=>{const b=h.useMemo(()=>[n.street,n.number,n.neighborhood,n.city,n.zip_code].filter(Boolean).join(", "),[n]);return e.jsxs(z,{className:"mt-6",children:[e.jsx(L,{children:e.jsxs(F,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ne,{className:"h-5 w-5 text-primary"}),"Localização no Mapa"]})}),e.jsxs(P,{className:"space-y-4",children:[e.jsx("div",{className:"h-80 w-full rounded-lg overflow-hidden border",children:e.jsx(se,{center:s,markerPosition:s,onMarkerDragEnd:t,zoom:15})}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground max-w-[100%] truncate",children:["Endereço atual: ",b||"N/A"]})})]})]})},ce=h.memo(le),de=s=>s.replace(/\D/g,""),me=Q({name:u().min(1,"O nome do restaurante é obrigatório."),description:u().optional(),street:u().min(1,"A rua é obrigatória."),number:u().min(1,"O número é obrigatório."),neighborhood:u().min(1,"O bairro é obrigatório."),city:u().min(1,"A cidade é obrigatória."),zip_code:u().min(1,"O CEP é obrigatório.").transform(s=>s.replace(/\D/g,"")).refine(s=>s.length===8,{message:"O CEP deve ter 8 dígitos."}),phone:u().min(1,"Telefone é obrigatório.").transform(de).refine(s=>s.length>=10,{message:"O telefone deve ter pelo menos 10 dígitos (incluindo DDD)."}),email:u().email("Email inválido.").optional().or(U("")),is_active:$().default(!0),latitude:S(s=>String(s).replace(",","."),_.number({invalid_type_error:"Latitude deve ser um número."}).refine(s=>s!==null,{message:"A localização no mapa é obrigatória. Mova o pino no mapa para definir a localização."})),longitude:S(s=>String(s).replace(",","."),_.number({invalid_type_error:"Longitude deve ser um número."}).refine(s=>s!==null,{message:"A localização no mapa é obrigatória. Mova o pino no mapa para definir a localização."}))}),ue=async s=>{const{data:t,error:n}=await f.from("restaurants").select("*").eq("id",s).single();if(n)throw new Error(`Erro ao buscar dados do restaurante: ${n.message}`);if(!t)throw new Error("Nenhum restaurante encontrado.");return t},Fe=()=>{const s=k(),{userRestaurantId:t}=re(),[n,b]=h.useState(!1),[T,D]=h.useState(null),{data:a,isLoading:N,isError:y,error:A}=V({queryKey:["restaurantSettings",t],queryFn:()=>ue(t),enabled:!!t,staleTime:1e3*60*5});h.useEffect(()=>{f.auth.getSession().then(({data:{session:r}})=>{var g;D(((g=r==null?void 0:r.user)==null?void 0:g.email)||null)})},[]);const o=Z({resolver:H(me),defaultValues:{name:"",description:"",street:"",number:"",neighborhood:"",city:"",zip_code:"",phone:"",email:"",is_active:!0,latitude:null,longitude:null},mode:"onBlur"});h.useEffect(()=>{a&&(o.reset({name:a.name||"",description:a.description||"",street:a.street||"",number:a.number||"",neighborhood:a.neighborhood||"",city:a.city||"",zip_code:a.zip_code||"",phone:a.phone||"",email:a.email||"",is_active:a.is_active??!0,latitude:a.latitude??null,longitude:a.longitude??null}),a.latitude&&a.longitude&&b(!0))},[a,o.reset]);const p=o.watch("latitude"),j=o.watch("longitude"),R=[-23.55052,-46.633308],q=h.useMemo(()=>typeof p=="number"&&typeof j=="number"&&!isNaN(p)&&!isNaN(j)?[p,j]:R,[p,j]),I=h.useCallback((r,g)=>{o.setValue("latitude",r,{shouldValidate:!0}),o.setValue("longitude",g,{shouldValidate:!0})},[o]),v=K({mutationFn:async r=>{if(!t)throw new Error("ID do restaurante não disponível.");const g={name:r.name,description:r.description,logo_url:null,street:r.street,number:r.number,neighborhood:r.neighborhood,city:r.city,zip_code:r.zip_code.replace(/\D/g,""),phone:r.phone,email:r.email,is_active:r.is_active,latitude:r.latitude,longitude:r.longitude},{error:w}=await f.from("restaurants").update(g).eq("id",t);if(w)throw w;const{data:{user:E}}=await f.auth.getUser();if(E){const B={phone:r.phone},{error:C}=await f.from("profiles").update(B).eq("id",E.id);C&&console.warn("Falha ao sincronizar telefone com o perfil:",C.message)}},onSuccess:()=>{M.success("Configurações salvas com sucesso!"),s.invalidateQueries({queryKey:["restaurantSettings",t]}),s.invalidateQueries({queryKey:["adminProfile"]})},onError:r=>M.error(`Erro ao salvar configurações: ${r.message}`)}),O=h.useMemo(()=>p===null||j===null?"map-settings-null":`map-settings-${p.toFixed(6)}-${j.toFixed(6)}`,[p,j]);return e.jsx("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:e.jsx("div",{className:"max-w-3xl mx-auto space-y-6",children:e.jsxs(z,{children:[e.jsx(L,{children:e.jsx(F,{className:"text-2xl font-bold",children:"Configurações do Restaurante"})}),e.jsxs(P,{children:[N&&e.jsx(ee,{className:"h-96 w-full"}),y&&e.jsxs("p",{className:"text-destructive",children:["Erro ao carregar dados: ",A.message]}),!t&&!N&&e.jsx("p",{className:"text-destructive",children:"Erro: ID do restaurante não encontrado."}),a&&!y&&!N&&e.jsx(Y,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(r=>v.mutate(r)),className:"space-y-6",children:[e.jsx(i,{control:o.control,name:"name",render:({field:r})=>e.jsxs(l,{children:[e.jsx(c,{children:"Nome do Restaurante *"}),e.jsx(d,{children:e.jsx(x,{...r})}),e.jsx(m,{})]})}),e.jsx(i,{control:o.control,name:"description",render:({field:r})=>e.jsxs(l,{children:[e.jsx(c,{children:"Descrição"}),e.jsx(d,{children:e.jsx(W,{...r,rows:3})}),e.jsx(m,{})]})}),e.jsx("div",{className:"pt-4 border-t mt-6",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Contato e Status"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ae,{className:"h-4 w-4"}),"Email do Administrador"]}),e.jsx(x,{value:T||"N/A",disabled:!0,className:"bg-muted/50"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Este é o email de login do administrador."})]}),e.jsx(i,{control:o.control,name:"phone",render:({field:r})=>e.jsxs(l,{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Telefone do Restaurante *"]}),e.jsx(d,{children:e.jsx(te,{...r})}),e.jsx(m,{})]})})]}),e.jsx("div",{className:"pt-4 border-t mt-6",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Endereço e Localização"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(i,{control:o.control,name:"street",render:({field:r})=>e.jsxs(l,{children:[e.jsx(c,{children:"Rua *"}),e.jsx(d,{children:e.jsx(x,{placeholder:"Nome da rua",...r})}),e.jsx(m,{})]})}),e.jsx(i,{control:o.control,name:"number",render:({field:r})=>e.jsxs(l,{children:[e.jsx(c,{children:"Número *"}),e.jsx(d,{children:e.jsx(x,{placeholder:"Número",...r})}),e.jsx(m,{})]})}),e.jsx(i,{control:o.control,name:"neighborhood",render:({field:r})=>e.jsxs(l,{children:[e.jsx(c,{children:"Bairro *"}),e.jsx(d,{children:e.jsx(x,{placeholder:"Bairro",...r})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:o.control,name:"city",render:({field:r})=>e.jsxs(l,{children:[e.jsx(c,{children:"Cidade *"}),e.jsx(d,{children:e.jsx(x,{placeholder:"Cidade",...r})}),e.jsx(m,{})]})}),e.jsx(i,{control:o.control,name:"zip_code",render:({field:r})=>e.jsxs(l,{children:[e.jsx(c,{children:"CEP *"}),e.jsx(d,{children:e.jsx(oe,{placeholder:"00000-000",...r})}),e.jsx(m,{})]})})]}),e.jsx("div",{className:"pt-4 border-t",children:n&&e.jsx(ce,{mapKey:O,markerPosition:q,onLocationChange:I,restaurant:a})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:o.control,name:"latitude",render:({field:r})=>e.jsxs(l,{children:[e.jsx(c,{children:"Latitude *"}),e.jsx(d,{children:e.jsx(x,{...r,placeholder:"-22.7627908",value:r.value??""})}),e.jsx(m,{})]})}),e.jsx(i,{control:o.control,name:"longitude",render:({field:r})=>e.jsxs(l,{children:[e.jsx(c,{children:"Longitude *"}),e.jsx(d,{children:e.jsx(x,{...r,placeholder:"-47.408315",value:r.value??""})}),e.jsx(m,{})]})})]}),e.jsx(i,{control:o.control,name:"is_active",render:({field:r})=>e.jsxs(l,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(c,{className:"font-normal",children:"Restaurante Ativo"}),e.jsx(d,{children:e.jsx(X,{checked:r.value,onCheckedChange:r.onChange})})]})}),e.jsx(G,{type:"submit",className:"w-full h-12 text-lg",disabled:v.isPending||!t,children:v.isPending?"Salvando...":"Salvar Configurações"})]})})]})]})})})};export{Fe as default};
