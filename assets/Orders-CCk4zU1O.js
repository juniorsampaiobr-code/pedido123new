import{j as e,u as Y,b as K,a as De}from"./tanstack-E1juXnZE.js";import{r as m,b as Be}from"./vendor-nYMJN4lg.js";import{s as q}from"./client-DHSUo4L7.js";import{B as R,b as Fe}from"./button-DeWcX41H.js";import{C as ee,d as se,a as Le,b as qe}from"./card-CDdiaJK6.js";import{S as Oe,a as ze,b as $e,c as Ve,d as He,T as Ke,e as Ue,f as Ge,g as Qe,B as Xe}from"./select-DXrmWd0z.js";import{S as A}from"./skeleton-DadAbzg5.js";import{A as ae,a as te,b as ne}from"./alert-XH9PkOo9.js";import{c as O,a as k,e as Je,f as re,P as Q,h as W,o as Ze,i as We,g as Ye,L as es,u as T}from"./index-2W2_6B9d.js";import{d as ss,e as as,f as ts,g as ns,X as rs}from"./dialog-C97hO83p.js";import{p as ls}from"./pt-BR-CbDebePx.js";import{T as le}from"./terminal-BJCNtcCC.js";import{U as cs}from"./user-BfNb5Dt2.js";import{M as os}from"./map-pin-BYzD9Xve.js";import{C as is}from"./credit-card-BPpc0hEt.js";import{C as ds}from"./calendar-C7hJZopp.js";import{C as ce}from"./clock-BNXrnSSK.js";import{P as oe}from"./package-dhw5Jgzi.js";import{C as ie}from"./circle-check-big-D8cH-o_R.js";import{T as de}from"./truck-J0XmGoZa.js";import{C as V}from"./check-CzrnA9RT.js";import{C as me}from"./circle-x-Dt2tIjfj.js";import{f as ms}from"./format-BeKxgCCE.js";import{u as us}from"./use-sound-BCUTcw37.js";import{A as ue,h as he,a as xe,b as pe,c as fe,d as ge,e as je,f as be,g as ve}from"./alert-dialog-BSBIwM5H.js";import{u as hs}from"./index-DpcYSu1F.js";import{R as Ne}from"./refresh-cw-Xj66Pqkm.js";import{S as ye}from"./shopping-cart-CGvcQ1Dy.js";import{D as xs}from"./dollar-sign-DDhv2Ycd.js";import{T as ps}from"./trash-2-P0L1z1g1.js";import"./supabase-CBMN163Q.js";import"./index-DNYFYjXG.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=O("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=O("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=O("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=O("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=O("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),Ns={pending:{label:"Pendente",icon:ce,color:"bg-yellow-500"},preparing:{label:"Em Preparação",icon:oe,color:"bg-orange-500"},ready:{label:"Pronto",icon:ie,color:"bg-green-500"},delivering:{label:"Em Entrega",icon:de,color:"bg-blue-500"},delivered:{label:"Entregue",icon:V,color:"bg-purple-500"},cancelled:{label:"Cancelado",icon:me,color:"bg-destructive"},pending_payment:{label:"Aguardando Pagamento",icon:bs,color:"bg-gray-500"}},ys=async s=>{const{data:a,error:r}=await q.from("order_items").select("*, products(name)").eq("order_id",s);if(r)throw new Error(r.message);return a},Cs=({order:s,isOpen:a,onClose:r})=>{var M,D,B,z,$;const[u,l]=m.useState([]),[t,i]=m.useState(!1),[d,c]=m.useState(null);m.useEffect(()=>{a&&(async()=>{if(s!=null&&s.id){i(!0),c(null);try{const S=await ys(s.id);l(S)}catch(S){console.error("Failed to fetch order items:",S),c("Falha ao carregar itens do pedido.")}finally{i(!1)}}})()},[s==null?void 0:s.id,a]);const f=((M=s==null?void 0:s.customer)==null?void 0:M.name)||"Cliente Desconhecido",h=(D=s==null?void 0:s.customer)==null?void 0:D.phone,g=(B=s==null?void 0:s.customer)==null?void 0:B.email,j=(z=s==null?void 0:s.customer)==null?void 0:z.cpf_cnpj,v=s==null?void 0:s.delivery_address,y=(($=s==null?void 0:s.payment_methods)==null?void 0:$.name)||"Não especificado",p=s!=null&&s.status?Ns[s.status]:null,N=s!=null&&s.id?s.id.slice(-4):"N/A",n=s!=null&&s.created_at?new Date(s.created_at):null,x=n?ms(n,"dd 'de' MMMM 'de' yyyy 'às' HH:mm",{locale:ls}):"Data desconhecida",b=s!=null&&s.change_for?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.change_for):null,E=s!=null&&s.delivery_fee?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.delivery_fee):"Grátis";return e.jsx(ss,{open:a,onOpenChange:r,children:e.jsxs(as,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ts,{children:e.jsxs(ns,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Detalhes do Pedido #",N]}),p&&e.jsxs("span",{className:k("text-xs font-semibold px-2.5 py-0.5 rounded-full text-white flex items-center",p.color),children:[e.jsx(p.icon,{className:"w-3 h-3 mr-1"}),p.label]})]})}),d&&e.jsxs(ae,{variant:"destructive",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx(te,{children:"Erro"}),e.jsx(ne,{children:d})]}),t?e.jsxs("div",{className:"space-y-4",children:[e.jsx(A,{className:"h-4 w-1/3"}),e.jsx(A,{className:"h-10 w-full"}),e.jsx(A,{className:"h-4 w-1/3"}),e.jsx(A,{className:"h-20 w-full"}),e.jsx(A,{className:"h-4 w-1/3"}),e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((P,S)=>e.jsx(A,{className:"h-12 w-full"},S))}),e.jsx(A,{className:"h-4 w-1/3"}),e.jsx(A,{className:"h-6 w-full"})]}):s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(cs,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Cliente"}),e.jsx("p",{children:f}),j&&e.jsxs("p",{className:"text-muted-foreground text-xs",children:["CPF/CNPJ: ",j]})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(vs,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Telefone"}),e.jsx("p",{children:h||"Não informado"}),g&&e.jsx("p",{className:"text-muted-foreground text-xs",children:g})]})]}),e.jsxs("div",{className:"flex items-start md:col-span-2",children:[e.jsx(os,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Endereço de Entrega"}),e.jsx("p",{children:v||"Não informado"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(is,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Método de Pagamento"}),e.jsx("p",{children:y}),b&&e.jsxs("p",{className:"text-muted-foreground text-xs",children:["Troco para: ",b]})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(ds,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Data do Pedido"}),e.jsx("p",{children:x})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Itens do Pedido"}),e.jsx("div",{className:"space-y-2",children:u.map(P=>{var S;return e.jsxs("div",{className:"flex justify-between items-start p-2 bg-muted/50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((S=P.products)==null?void 0:S.name)||"Produto não encontrado"}),P.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Obs: ",P.notes]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{children:[P.quantity," x ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(P.unit_price)]}),e.jsx("p",{className:"font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(P.subtotal)})]})]},P.id)})})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount-(s.delivery_fee||0))})]}),e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:E})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]})]}),e.jsx("div",{className:"pt-4",children:s.notes&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Observações do Cliente:"}),e.jsx("p",{className:"bg-muted p-2 rounded",children:s.notes})]})})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(R,{onClick:r,children:"Fechar"})})]})})},Ce=({className:s,...a})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:k("mx-auto flex w-full justify-center",s),...a});Ce.displayName="Pagination";const we=m.forwardRef(({className:s,...a},r)=>e.jsx("ul",{ref:r,className:k("flex flex-row items-center gap-1",s),...a}));we.displayName="PaginationContent";const _=m.forwardRef(({className:s,...a},r)=>e.jsx("li",{ref:r,className:k("",s),...a}));_.displayName="PaginationItem";const L=({className:s,isActive:a,size:r="icon",...u})=>e.jsx("a",{"aria-current":a?"page":void 0,className:k(Fe({variant:a?"outline":"ghost",size:r}),s),...u});L.displayName="PaginationLink";const ke=({className:s,...a})=>e.jsxs(L,{"aria-label":"Go to previous page",size:"default",className:k("gap-1 pl-2.5",s),...a,children:[e.jsx(fs,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});ke.displayName="PaginationPrevious";const Pe=({className:s,...a})=>e.jsxs(L,{"aria-label":"Go to next page",size:"default",className:k("gap-1 pr-2.5",s),...a,children:[e.jsx("span",{children:"Next"}),e.jsx(gs,{className:"h-4 w-4"})]});Pe.displayName="PaginationNext";const U=({className:s,...a})=>e.jsxs("span",{"aria-hidden":!0,className:k("flex h-9 w-9 items-center justify-center",s),...a,children:[e.jsx(js,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]});U.displayName="PaginationEllipsis";const ws=({currentPage:s,totalPages:a,onPageChange:r})=>{if(a<=1)return null;const l=(()=>{const t=[],d=Math.max(1,s-Math.floor(2.5)),c=Math.min(a,d+5-1);if(c-d+1<5){const f=Math.max(1,c-5+1);for(let h=f;h<=c;h++)t.push(h)}else for(let f=d;f<=c;f++)t.push(f);return t})();return e.jsx(Ce,{children:e.jsxs(we,{children:[e.jsx(_,{children:e.jsx(ke,{onClick:()=>r(s-1),className:k(s===1&&"pointer-events-none opacity-50")})}),l[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx(_,{children:e.jsx(L,{onClick:()=>r(1),children:"1"})}),l[0]>2&&e.jsx(_,{children:e.jsx(U,{})})]}),l.map(t=>e.jsx(_,{children:e.jsx(L,{isActive:t===s,onClick:()=>r(t),children:t})},t)),l[l.length-1]<a&&e.jsxs(e.Fragment,{children:[l[l.length-1]<a-1&&e.jsx(_,{children:e.jsx(U,{})}),e.jsx(_,{children:e.jsx(L,{onClick:()=>r(a),children:a})})]}),e.jsx(_,{children:e.jsx(Pe,{onClick:()=>r(s+1),className:k(s===a&&"pointer-events-none opacity-50")})})]})})};var H="Checkbox",[ks,ma]=Je(H),[Ps,X]=ks(H);function Es(s){const{__scopeCheckbox:a,checked:r,children:u,defaultChecked:l,disabled:t,form:i,name:d,onCheckedChange:c,required:f,value:h="on",internal_do_not_use_render:g}=s,[j,v]=Ye({prop:r,defaultProp:l??!1,onChange:c,caller:H}),[y,p]=m.useState(null),[N,n]=m.useState(null),x=m.useRef(!1),b=y?!!i||!!y.closest("form"):!0,E={checked:j,disabled:t,setChecked:v,control:y,setControl:p,name:d,form:i,value:h,hasConsumerStoppedPropagationRef:x,required:f,defaultChecked:I(l)?!1:l,isFormControl:b,bubbleInput:N,setBubbleInput:n};return e.jsx(Ps,{scope:a,...E,children:Ss(g)?g(E):u})}var Ee="CheckboxTrigger",Se=m.forwardRef(({__scopeCheckbox:s,onKeyDown:a,onClick:r,...u},l)=>{const{control:t,value:i,disabled:d,checked:c,required:f,setControl:h,setChecked:g,hasConsumerStoppedPropagationRef:j,isFormControl:v,bubbleInput:y}=X(Ee,s),p=re(l,h),N=m.useRef(c);return m.useEffect(()=>{const n=t==null?void 0:t.form;if(n){const x=()=>g(N.current);return n.addEventListener("reset",x),()=>n.removeEventListener("reset",x)}},[t,g]),e.jsx(Q.button,{type:"button",role:"checkbox","aria-checked":I(c)?"mixed":c,"aria-required":f,"data-state":Ie(c),"data-disabled":d?"":void 0,disabled:d,value:i,...u,ref:p,onKeyDown:W(a,n=>{n.key==="Enter"&&n.preventDefault()}),onClick:W(r,n=>{g(x=>I(x)?!0:!x),y&&v&&(j.current=n.isPropagationStopped(),j.current||n.stopPropagation())})})});Se.displayName=Ee;var J=m.forwardRef((s,a)=>{const{__scopeCheckbox:r,name:u,checked:l,defaultChecked:t,required:i,disabled:d,value:c,onCheckedChange:f,form:h,...g}=s;return e.jsx(Es,{__scopeCheckbox:r,checked:l,defaultChecked:t,disabled:d,required:i,onCheckedChange:f,name:u,form:h,value:c,internal_do_not_use_render:({isFormControl:j})=>e.jsxs(e.Fragment,{children:[e.jsx(Se,{...g,ref:a,__scopeCheckbox:r}),j&&e.jsx(Te,{__scopeCheckbox:r})]})})});J.displayName=H;var Ae="CheckboxIndicator",_e=m.forwardRef((s,a)=>{const{__scopeCheckbox:r,forceMount:u,...l}=s,t=X(Ae,r);return e.jsx(Ze,{present:u||I(t.checked)||t.checked===!0,children:e.jsx(Q.span,{"data-state":Ie(t.checked),"data-disabled":t.disabled?"":void 0,...l,ref:a,style:{pointerEvents:"none",...s.style}})})});_e.displayName=Ae;var Re="CheckboxBubbleInput",Te=m.forwardRef(({__scopeCheckbox:s,...a},r)=>{const{control:u,hasConsumerStoppedPropagationRef:l,checked:t,defaultChecked:i,required:d,disabled:c,name:f,value:h,form:g,bubbleInput:j,setBubbleInput:v}=X(Re,s),y=re(r,v),p=hs(t),N=We(u);m.useEffect(()=>{const x=j;if(!x)return;const b=window.HTMLInputElement.prototype,M=Object.getOwnPropertyDescriptor(b,"checked").set,D=!l.current;if(p!==t&&M){const B=new Event("click",{bubbles:D});x.indeterminate=I(t),M.call(x,I(t)?!1:t),x.dispatchEvent(B)}},[j,p,t,l]);const n=m.useRef(I(t)?!1:t);return e.jsx(Q.input,{type:"checkbox","aria-hidden":!0,defaultChecked:i??n.current,required:d,disabled:c,name:f,value:h,form:g,...a,tabIndex:-1,ref:y,style:{...a.style,...N,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Te.displayName=Re;function Ss(s){return typeof s=="function"}function I(s){return s==="indeterminate"}function Ie(s){return I(s)?"indeterminate":s?"checked":"unchecked"}const Z=m.forwardRef(({className:s,...a},r)=>e.jsx(J,{ref:r,className:k("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(_e,{className:k("flex items-center justify-center text-current"),children:e.jsx(V,{className:"h-4 w-4"})})}));Z.displayName=J.displayName;const Me={pending:{label:"Pendente",icon:ce,color:"bg-yellow-500 hover:bg-yellow-600"},preparing:{label:"Em Preparação",icon:oe,color:"bg-orange-500 hover:bg-orange-600"},ready:{label:"Pronto",icon:ie,color:"bg-green-500 hover:bg-green-600"},delivering:{label:"Em Entrega",icon:de,color:"bg-indigo-500 hover:bg-indigo-600"},delivered:{label:"Entregue",icon:V,color:"bg-primary hover:bg-primary/90"},cancelled:{label:"Cancelado",icon:me,color:"bg-destructive hover:bg-destructive/90"},pending_payment:{label:"Aguardando Pag.",icon:xs,color:"bg-gray-500 hover:bg-gray-600"}},As=[{value:"pending",label:"Mudar para Pendente"},{value:"preparing",label:"Mudar para Em Preparação"},{value:"ready",label:"Mudar para Pronto"},{value:"delivering",label:"Mudar para Em Entrega"},{value:"delivered",label:"Mudar para Entregue"},{value:"cancelled",label:"Mudar para Cancelado"},{value:"pending_payment",label:"Mudar para Aguardando Pag."},{value:"delete",label:"Excluir Permanentemente"}],G=12,_s=async(s,a,r)=>{const u=r*G,l=u+G-1;let t=q.from("orders").select("*, customer:customers(name, phone)",{count:"exact"}).eq("restaurant_id",s);a!=="all"&&(t=t.eq("status",a));const{data:i,error:d,count:c}=await t.order("created_at",{ascending:!1}).range(u,l);if(d)throw new Error(`Erro ao buscar pedidos: ${d.message}`);return{orders:i,count:c||0}},Rs=({order:s,onViewDetails:a,onAccept:r,onDecline:u,onDelete:l,isSelected:t,onSelect:i})=>{var h;const d=Me[s.status||"pending"],c=((h=s.customer)==null?void 0:h.name)||"Cliente Desconhecido",f=s.created_at?new Date(s.created_at).getTime().toString().slice(-4):"N/A";return e.jsxs(ee,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col relative",children:[e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx(Z,{checked:t,onCheckedChange:g=>i(s.id,!!g),className:"h-5 w-5"})}),e.jsxs(Le,{className:"flex flex-row items-center justify-between space-y-0 pb-2 pl-12",children:[e.jsxs(qe,{className:"text-lg font-bold flex items-center gap-2",children:["Pedido #",f]}),e.jsxs(Xe,{className:k("text-white",d.color),children:[e.jsx(d.icon,{className:"h-3 w-3 mr-1"}),d.label]})]}),e.jsxs(se,{className:"space-y-2 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",c]}),e.jsx("p",{className:"text-2xl font-extrabold text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]}),e.jsxs("div",{className:"flex justify-end pt-2 border-t gap-2",children:[(s.status==="pending"||s.status==="pending_payment")&&e.jsxs(e.Fragment,{children:[e.jsxs(R,{variant:"destructive",size:"sm",onClick:()=>u(s.id),children:[e.jsx(rs,{className:"h-4 w-4 mr-1"})," Recusar"]}),e.jsxs(R,{variant:"default",size:"sm",onClick:()=>r(s.id),children:[e.jsx(V,{className:"h-4 w-4 mr-1"})," Aceitar"]})]}),e.jsx(R,{variant:"outline",size:"sm",onClick:()=>a(s),children:"Detalhes"}),e.jsxs(ue,{children:[e.jsx(he,{asChild:!0,children:e.jsx(R,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",children:e.jsx(ps,{className:"h-4 w-4"})})}),e.jsxs(xe,{children:[e.jsxs(pe,{children:[e.jsx(fe,{children:"Tem certeza que deseja excluir?"}),e.jsxs(ge,{children:["Esta ação é permanente. O pedido #",f," será excluído permanentemente do sistema, incluindo todos os itens associados."]})]}),e.jsxs(je,{children:[e.jsx(be,{children:"Cancelar"}),e.jsx(ve,{onClick:()=>l(s.id),className:"bg-destructive hover:bg-destructive/90",children:"Excluir Permanentemente"})]})]})]})]})]})]})},Ts=({status:s,onViewDetails:a,restaurantId:r,selectedOrders:u,setSelectedOrders:l,totalOrdersInView:t})=>{const i=Y(),{stopSoundLoop:d}=us(),[c,f]=m.useState(0),{data:h,isLoading:g,isError:j,error:v,refetch:y}=De({queryKey:["orders",s,r,c],queryFn:()=>_s(r,s,c),enabled:!!r}),p=(h==null?void 0:h.orders)||[],N=(h==null?void 0:h.count)||0,n=Math.ceil(N/G),x=K({mutationFn:async({orderId:o,newStatus:C})=>{const w=C==="pending"?"preparing":C,{error:F}=await q.from("orders").update({status:w}).eq("id",o);if(F)throw new Error(F.message);return w},onSuccess:o=>{T.success(`Pedido ${o==="preparing"?"aceito":"recusado"} com sucesso!`),i.invalidateQueries({queryKey:["orders"]})},onError:o=>T.error(`Erro ao atualizar pedido: ${o.message}`)}),b=K({mutationFn:async o=>{const{error:C}=await q.from("orders").delete().eq("id",o);if(C)throw new Error(C.message)},onSuccess:()=>{T.success("Pedido excluído permanentemente."),i.invalidateQueries({queryKey:["orders"]})},onError:o=>T.error(`Erro ao excluir pedido: ${o.message}`)}),E=o=>{d(),x.mutate({orderId:o,newStatus:"preparing"})},M=o=>{d(),x.mutate({orderId:o,newStatus:"cancelled"})},D=o=>{d(),a(o)},B=o=>{b.mutate(o)},z=m.useCallback(o=>{f(o-1)},[]),$=m.useCallback((o,C)=>{l(w=>C?[...w,o]:w.filter(F=>F!==o))},[l]),P=m.useCallback(o=>{if(o){const C=p.map(w=>w.id);l(w=>[...new Set([...w,...C])])}else{const C=new Set(p.map(w=>w.id));l(w=>w.filter(F=>!C.has(F)))}},[p,l]),S=p.length>0&&p.every(o=>u.includes(o.id));return g?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((o,C)=>e.jsx(ee,{children:e.jsx(se,{className:"p-4 space-y-3",children:e.jsx(A,{className:"h-32 w-full"})})},C))}):j?e.jsxs(ae,{variant:"destructive",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx(te,{children:"Erro ao carregar pedidos"}),e.jsx(ne,{children:v instanceof Error?v.message:"Ocorreu um erro desconhecido."}),e.jsxs(R,{onClick:()=>y(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]}):!p||p.length===0?e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg border",children:[e.jsx(ye,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifique o status selecionado ou aguarde novos pedidos."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg bg-muted/50",children:[e.jsx(Z,{checked:S,onCheckedChange:P,className:"h-5 w-5"}),e.jsxs("span",{className:"text-sm font-medium",children:["Selecionar todos (",p.length,") nesta página."]}),t>0&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-auto",children:[t," pedidos selecionados no total."]})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:p.map(o=>e.jsx(Rs,{order:o,onViewDetails:D,onAccept:E,onDecline:M,onDelete:B,isSelected:u.includes(o.id),onSelect:$},o.id))}),n>1&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(ws,{currentPage:c+1,totalPages:n,onPageChange:z})})]})},ua=()=>{const{userRestaurantId:s}=Be(),a=Y(),[r,u]=m.useState(null),[l,t]=m.useState(!1),[i,d]=m.useState([]),[c,f]=m.useState(""),h=n=>{u(n),t(!0)},g=()=>{t(!1),u(null)},j=()=>{a.invalidateQueries({queryKey:["orders",s]}),T.info("Atualizando pedidos...",{description:"Buscando novos dados no servidor."})},v=K({mutationFn:async({orderIds:n,action:x})=>{if(x==="delete"){const{error:b}=await q.from("orders").delete().in("id",n);if(b)throw new Error(b.message);return"deleted"}else{const b=x==="pending"?"preparing":x,{error:E}=await q.from("orders").update({status:b}).in("id",n);if(E)throw new Error(E.message);return"updated"}},onSuccess:(n,x)=>{if(n==="deleted")T.success(`${x.orderIds.length} pedidos excluídos permanentemente.`);else{const b=Me[x.action].label;T.success(`${x.orderIds.length} pedidos atualizados para "${b}".`)}d([]),f(""),a.invalidateQueries({queryKey:["orders",s]})},onError:n=>{T.error(`Erro na ação em massa: ${n.message}`)}}),y=()=>{var n;!c||i.length===0||(c==="delete"?(n=document.getElementById("mass-delete-trigger"))==null||n.click():v.mutate({orderIds:i,action:c}))},p=[{value:"pending_payment",label:"Aguardando Pag."},{value:"pending",label:"Pendentes"},{value:"preparing",label:"Em Preparação"},{value:"ready",label:"Prontos"},{value:"delivering",label:"Em Entrega"},{value:"delivered",label:"Entregues"},{value:"cancelled",label:"Cancelados"},{value:"all",label:"Todos"}],N=v.isPending;return s?e.jsxs(e.Fragment,{children:[e.jsx(Cs,{order:r,isOpen:l,onClose:g}),e.jsxs(ue,{children:[e.jsx(he,{asChild:!0,children:e.jsx("button",{id:"mass-delete-trigger",className:"hidden"})}),e.jsxs(xe,{children:[e.jsxs(pe,{children:[e.jsxs(fe,{children:["Tem certeza que deseja excluir ",i.length," pedidos?"]}),e.jsxs(ge,{children:["Esta ação é permanente. ",i.length," pedidos serão excluídos permanentemente do sistema."]})]}),e.jsxs(je,{children:[e.jsx(be,{children:"Cancelar"}),e.jsx(ve,{onClick:()=>v.mutate({orderIds:i,action:"delete"}),className:"bg-destructive hover:bg-destructive/90",disabled:N,children:N?"Excluindo...":"Excluir Permanentemente"})]})]})]}),e.jsxs("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(R,{variant:"outline",onClick:j,children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"})," Atualizar Dados"]})}),i.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-lg bg-card shadow-lg animate-fade-in",children:[e.jsx(ye,{className:"h-5 w-5 text-primary mr-2"}),e.jsxs("span",{className:"text-sm font-medium mr-4",children:[i.length," selecionado(s)"]}),e.jsxs(Oe,{value:c,onValueChange:n=>f(n),children:[e.jsx(ze,{className:"w-[200px]",children:e.jsx($e,{placeholder:"Ação em Massa"})}),e.jsx(Ve,{children:As.map(n=>e.jsx(He,{value:n.value,children:n.label},n.value))})]}),e.jsx(R,{onClick:y,disabled:!c||N,children:N?e.jsx(es,{className:"h-4 w-4 animate-spin"}):"Aplicar"})]})]}),s?e.jsxs(Ke,{defaultValue:"pending",children:[e.jsx(Ue,{className:"w-full overflow-x-auto justify-start",children:p.map(n=>e.jsx(Ge,{value:n.value,className:"whitespace-nowrap",children:n.label},n.value))}),p.map(n=>e.jsx(Qe,{value:n.value,className:"mt-6",children:e.jsx(Ts,{status:n.value,onViewDetails:h,restaurantId:s,selectedOrders:i,setSelectedOrders:d,totalOrdersInView:i.length})},n.value))]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Carregando dados do restaurante..."})]})]})]}):e.jsx("div",{className:"flex h-screen items-center justify-center",children:"Carregando..."})};export{ua as default};
