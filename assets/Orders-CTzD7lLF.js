import{b as Q,u as K,c as B,j as e}from"./tanstack-DS1wz2fm.js";import{r as f,f as Le}from"./vendor-DPb28zz8.js";import{s as D}from"./client-BP8r4skJ.js";import{B as P,b as Be}from"./button-Ba04wcpp.js";import{C as se,a as ae,b as Fe,c as Oe}from"./card-C-80OWda.js";import{S as te,a as re,b as ne,c as oe,d as le,C as T,T as ze,e as $e,f as Ke,g as Ve}from"./select-DoNJn-iU.js";import{D as Z,a as W,b as He,c as Qe,d as Ge,e as Ue,B as Xe}from"./index-Dv1ZN2i2.js";import{S as E}from"./skeleton-KQLX-0_b.js";import{A as Je,a as Ze,b as We}from"./alert-CrF8gxqy.js";import{c as q,u as S,b as k,g as Ye,h as ie,P as G,j as Y,i as es,m as ss,n as as,L as ts,X as ce}from"./index-CqykEuFJ.js";import{S as M}from"./separator-DyJqr_DL.js";import{P as rs}from"./printer-BQCSrdQY.js";import{useSound as ns}from"./DashboardLayout-DYr28MaT.js";import{A as de,a as me,b as ue,c as he,d as xe,e as pe,f as fe,g as ge,h as je}from"./alert-dialog-DXAtQ78O.js";import{u as os}from"./index-CJmVBZLB.js";import{T as ls}from"./terminal-DcGG-fwZ.js";import{S as be}from"./shopping-cart-De-0qfei.js";import{D as is}from"./dollar-sign-CDHyJuuM.js";import{T as cs}from"./trash-2-CumkruPX.js";import"./supabase-BT-vd-uw.js";import"./index-ByFAvHhO.js";import"./index-Dm27xrF8.js";import"./index-gRoGNF98.js";import"./Logo-nq5EsxoJ.js";import"./package-ClHzF0di.js";import"./clock-Bd9ZNFjG.js";import"./credit-card-DItUpBo7.js";import"./truck-6iYrmo0p.js";import"./settings-BCDd0UJA.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=q("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=q("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=q("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=q("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=q("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),ee={pending:{label:"Pendente"},confirmed:{label:"Confirmado"},preparing:{label:"Em Preparação"},ready:{label:"Pronto"},delivering:{label:"Em Entrega"},delivered:{label:"Entregue"},cancelled:{label:"Cancelado"},pending_payment:{label:"Aguardando Pagamento"}},xs=async s=>{const{data:a,error:t}=await D.from("order_items").select("*, products(name)").eq("order_id",s);if(t)throw new Error(t.message);return a},ps=async s=>{const{data:a,error:t}=await D.from("orders").select("*, customer:customers(name, phone, cpf_cnpj, email), payment_methods(name)").eq("id",s).limit(1).single();if(t)throw new Error(`Erro ao buscar detalhes do pedido: ${t.message}`);return a},fs=({order:s,isOpen:a,onClose:t})=>{var n;const h=Q(),[i,r]=f.useState("pending"),{data:o,isLoading:m,isError:c}=K({queryKey:["orderDetails",s==null?void 0:s.id],queryFn:()=>ps(s.id),enabled:!!s&&a});f.useEffect(()=>{o!=null&&o.status&&r(o.status)},[o]);const{data:x,isLoading:p}=K({queryKey:["orderItems",s==null?void 0:s.id],queryFn:()=>xs(s.id),enabled:!!s&&a}),b=B({mutationFn:async l=>{if(!s)throw new Error("Pedido não encontrado.");const{error:j}=await D.from("orders").update({status:l}).eq("id",s.id);if(j)throw new Error(j.message)},onSuccess:(l,j)=>{S.success(`Status do pedido atualizado para "${ee[j].label}"`),h.invalidateQueries({queryKey:["orders"]}),t()},onError:l=>{S.error(`Erro ao atualizar status: ${l.message}`)}}),y=()=>{window.print()};if(!s||m)return e.jsx(Z,{open:a,onOpenChange:t,children:e.jsxs(W,{className:"sm:max-w-lg",children:[e.jsx(E,{className:"h-6 w-1/2 mb-4"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(E,{className:"h-4 w-full"}),e.jsx(E,{className:"h-4 w-full"}),e.jsx(E,{className:"h-4 w-full"}),e.jsx(M,{}),e.jsx(E,{className:"h-48 w-full"}),e.jsx(M,{}),e.jsx(E,{className:"h-10 w-full"})]})]})});if(c||!o)return null;const N=o.created_at?new Date(o.created_at).getTime().toString().slice(-4):"N/A",u=o.customer,g=((n=o.payment_methods)==null?void 0:n.name)||"Não Informado",v=o.change_for;return e.jsx(Z,{open:a,onOpenChange:t,children:e.jsxs(W,{className:"sm:max-w-lg",children:[e.jsxs(He,{children:[e.jsxs(Qe,{children:["Detalhes do Pedido #",N]}),e.jsx(Ge,{children:"Gerencie os detalhes e o status deste pedido."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold",children:"Cliente"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nome: ",(u==null?void 0:u.name)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Telefone: ",(u==null?void 0:u.phone)||"N/A"]}),(u==null?void 0:u.email)&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Email: ",u.email]}),(u==null?void 0:u.cpf_cnpj)&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["CPF/CNPJ: ",u.cpf_cnpj]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Endereço: ",o.delivery_address||"Retirada no Local"]})]}),e.jsx(M,{}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold",children:"Pagamento"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Método: ",g]}),g==="Dinheiro"&&v!==null&&v!==void 0&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Troco para: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(v)]}),g==="Dinheiro"&&v==null&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Troco: Não precisa de troco"})]}),e.jsx(M,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Itens do Pedido"}),p?e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{className:"h-8 w-full"}),e.jsx(E,{className:"h-8 w-full"})]}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto pr-2",children:x==null?void 0:x.map(l=>{var j;return e.jsxs("div",{className:"flex justify-between items-start text-sm border-b pb-2 last:border-b-0",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[l.quantity,"x ",((j=l.products)==null?void 0:j.name)||"Produto desconhecido"]}),l.notes&&e.jsxs("p",{className:"text-xs text-destructive italic mt-1",children:["Obs: ",l.notes]})]}),e.jsx("span",{className:"text-muted-foreground",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(l.subtotal)})]},l.id)})})]}),e.jsx(M,{}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex flex-col pb-2",children:[e.jsx("span",{className:"font-semibold",children:"Observações do Pedido:"}),e.jsx("span",{className:"text-sm text-muted-foreground mt-1",children:o.notes||"Nenhuma observação."})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsx("span",{className:"font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o.delivery_fee||0)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-base",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o.total_amount)})]})]}),e.jsx(M,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Atualizar Status"}),e.jsxs(te,{value:i,onValueChange:l=>r(l),children:[e.jsx(re,{children:e.jsx(ne,{placeholder:"Selecione um status"})}),e.jsx(oe,{children:Object.entries(ee).map(([l,{label:j}])=>e.jsx(le,{value:l,children:j},l))})]})]})]}),e.jsxs(Ue,{className:"flex-col sm:flex-row sm:justify-between sm:space-x-2",children:[e.jsxs(P,{variant:"outline",onClick:y,className:"w-full sm:w-auto mb-2 sm:mb-0",children:[e.jsx(rs,{className:"h-4 w-4 mr-2"})," Imprimir Pedido"]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(P,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(P,{onClick:()=>b.mutate(i),disabled:b.isPending||i===o.status,children:b.isPending?"Salvando...":"Salvar Alterações"})]})]})]})})},ye=({className:s,...a})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:k("mx-auto flex w-full justify-center",s),...a});ye.displayName="Pagination";const Ne=f.forwardRef(({className:s,...a},t)=>e.jsx("ul",{ref:t,className:k("flex flex-row items-center gap-1",s),...a}));Ne.displayName="PaginationContent";const A=f.forwardRef(({className:s,...a},t)=>e.jsx("li",{ref:t,className:k("",s),...a}));A.displayName="PaginationItem";const R=({className:s,isActive:a,size:t="icon",...h})=>e.jsx("a",{"aria-current":a?"page":void 0,className:k(Be({variant:a?"outline":"ghost",size:t}),s),...h});R.displayName="PaginationLink";const we=({className:s,...a})=>e.jsxs(R,{"aria-label":"Go to previous page",size:"default",className:k("gap-1 pl-2.5",s),...a,children:[e.jsx(ds,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});we.displayName="PaginationPrevious";const Ce=({className:s,...a})=>e.jsxs(R,{"aria-label":"Go to next page",size:"default",className:k("gap-1 pr-2.5",s),...a,children:[e.jsx("span",{children:"Next"}),e.jsx(ms,{className:"h-4 w-4"})]});Ce.displayName="PaginationNext";const V=({className:s,...a})=>e.jsxs("span",{"aria-hidden":!0,className:k("flex h-9 w-9 items-center justify-center",s),...a,children:[e.jsx(us,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]});V.displayName="PaginationEllipsis";const gs=({currentPage:s,totalPages:a,onPageChange:t})=>{if(a<=1)return null;const i=(()=>{const r=[],m=Math.max(1,s-Math.floor(2.5)),c=Math.min(a,m+5-1);if(c-m+1<5){const x=Math.max(1,c-5+1);for(let p=x;p<=c;p++)r.push(p)}else for(let x=m;x<=c;x++)r.push(x);return r})();return e.jsx(ye,{children:e.jsxs(Ne,{children:[e.jsx(A,{children:e.jsx(we,{onClick:()=>t(s-1),className:k(s===1&&"pointer-events-none opacity-50")})}),i[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx(A,{children:e.jsx(R,{onClick:()=>t(1),children:"1"})}),i[0]>2&&e.jsx(A,{children:e.jsx(V,{})})]}),i.map(r=>e.jsx(A,{children:e.jsx(R,{isActive:r===s,onClick:()=>t(r),children:r})},r)),i[i.length-1]<a&&e.jsxs(e.Fragment,{children:[i[i.length-1]<a-1&&e.jsx(A,{children:e.jsx(V,{})}),e.jsx(A,{children:e.jsx(R,{onClick:()=>t(a),children:a})})]}),e.jsx(A,{children:e.jsx(Ce,{onClick:()=>t(s+1),className:k(s===a&&"pointer-events-none opacity-50")})})]})})};var F="Checkbox",[js,sa]=Ye(F),[bs,U]=js(F);function vs(s){const{__scopeCheckbox:a,checked:t,children:h,defaultChecked:i,disabled:r,form:o,name:m,onCheckedChange:c,required:x,value:p="on",internal_do_not_use_render:b}=s,[y,N]=as({prop:t,defaultProp:i??!1,onChange:c,caller:F}),[u,g]=f.useState(null),[v,n]=f.useState(null),l=f.useRef(!1),j=u?!!o||!!u.closest("form"):!0,I={checked:y,disabled:r,setChecked:N,control:u,setControl:g,name:m,form:o,value:p,hasConsumerStoppedPropagationRef:l,required:x,defaultChecked:_(i)?!1:i,isFormControl:j,bubbleInput:v,setBubbleInput:n};return e.jsx(bs,{scope:a,...I,children:ys(b)?b(I):h})}var ke="CheckboxTrigger",Ee=f.forwardRef(({__scopeCheckbox:s,onKeyDown:a,onClick:t,...h},i)=>{const{control:r,value:o,disabled:m,checked:c,required:x,setControl:p,setChecked:b,hasConsumerStoppedPropagationRef:y,isFormControl:N,bubbleInput:u}=U(ke,s),g=ie(i,p),v=f.useRef(c);return f.useEffect(()=>{const n=r==null?void 0:r.form;if(n){const l=()=>b(v.current);return n.addEventListener("reset",l),()=>n.removeEventListener("reset",l)}},[r,b]),e.jsx(G.button,{type:"button",role:"checkbox","aria-checked":_(c)?"mixed":c,"aria-required":x,"data-state":De(c),"data-disabled":m?"":void 0,disabled:m,value:o,...h,ref:g,onKeyDown:Y(a,n=>{n.key==="Enter"&&n.preventDefault()}),onClick:Y(t,n=>{b(l=>_(l)?!0:!l),u&&N&&(y.current=n.isPropagationStopped(),y.current||n.stopPropagation())})})});Ee.displayName=ke;var X=f.forwardRef((s,a)=>{const{__scopeCheckbox:t,name:h,checked:i,defaultChecked:r,required:o,disabled:m,value:c,onCheckedChange:x,form:p,...b}=s;return e.jsx(vs,{__scopeCheckbox:t,checked:i,defaultChecked:r,disabled:m,required:o,onCheckedChange:x,name:h,form:p,value:c,internal_do_not_use_render:({isFormControl:y})=>e.jsxs(e.Fragment,{children:[e.jsx(Ee,{...b,ref:a,__scopeCheckbox:t}),y&&e.jsx(_e,{__scopeCheckbox:t})]})})});X.displayName=F;var Pe="CheckboxIndicator",Se=f.forwardRef((s,a)=>{const{__scopeCheckbox:t,forceMount:h,...i}=s,r=U(Pe,t);return e.jsx(es,{present:h||_(r.checked)||r.checked===!0,children:e.jsx(G.span,{"data-state":De(r.checked),"data-disabled":r.disabled?"":void 0,...i,ref:a,style:{pointerEvents:"none",...s.style}})})});Se.displayName=Pe;var Ae="CheckboxBubbleInput",_e=f.forwardRef(({__scopeCheckbox:s,...a},t)=>{const{control:h,hasConsumerStoppedPropagationRef:i,checked:r,defaultChecked:o,required:m,disabled:c,name:x,value:p,form:b,bubbleInput:y,setBubbleInput:N}=U(Ae,s),u=ie(t,N),g=os(r),v=ss(h);f.useEffect(()=>{const l=y;if(!l)return;const j=window.HTMLInputElement.prototype,L=Object.getOwnPropertyDescriptor(j,"checked").set,O=!i.current;if(g!==r&&L){const z=new Event("click",{bubbles:O});l.indeterminate=_(r),L.call(l,_(r)?!1:r),l.dispatchEvent(z)}},[y,g,r,i]);const n=f.useRef(_(r)?!1:r);return e.jsx(G.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??n.current,required:m,disabled:c,name:x,value:p,form:b,...a,tabIndex:-1,ref:u,style:{...a.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});_e.displayName=Ae;function ys(s){return typeof s=="function"}function _(s){return s==="indeterminate"}function De(s){return _(s)?"indeterminate":s?"checked":"unchecked"}const J=f.forwardRef(({className:s,...a},t)=>e.jsx(X,{ref:t,className:k("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(Se,{className:k("flex items-center justify-center text-current"),children:e.jsx(T,{className:"h-4 w-4"})})}));J.displayName=X.displayName;const Te={pending:{label:"Pendente",icon:be,color:"bg-yellow-500 hover:bg-yellow-600"},confirmed:{label:"Confirmado",icon:T,color:"bg-blue-500 hover:bg-blue-600"},preparing:{label:"Em Preparação",icon:T,color:"bg-orange-500 hover:bg-orange-600"},ready:{label:"Pronto",icon:T,color:"bg-green-500 hover:bg-green-600"},delivering:{label:"Em Entrega",icon:T,color:"bg-indigo-500 hover:bg-indigo-600"},delivered:{label:"Entregue",icon:T,color:"bg-primary hover:bg-primary/90"},cancelled:{label:"Cancelado",icon:ce,color:"bg-destructive hover:bg-destructive/90"},pending_payment:{label:"Aguardando Pag.",icon:is,color:"bg-gray-500 hover:bg-gray-600"}},Ns=[{value:"pending",label:"Mudar para Pendente"},{value:"confirmed",label:"Mudar para Confirmado"},{value:"preparing",label:"Mudar para Em Preparação"},{value:"ready",label:"Mudar para Pronto"},{value:"delivering",label:"Mudar para Em Entrega"},{value:"delivered",label:"Mudar para Entregue"},{value:"cancelled",label:"Mudar para Cancelado"},{value:"pending_payment",label:"Mudar para Aguardando Pag."},{value:"delete",label:"Excluir Permanentemente"}],H=12,ws=async(s,a,t)=>{const h=t*H,i=h+H-1;let r=D.from("orders").select("*, customer:customers(name, phone)",{count:"exact"}).eq("restaurant_id",s);a!=="all"&&(r=r.eq("status",a));const{data:o,error:m,count:c}=await r.order("created_at",{ascending:!1}).range(h,i);if(m)throw new Error(`Erro ao buscar pedidos: ${m.message}`);return{orders:o,count:c||0}},Cs=({order:s,onViewDetails:a,onAccept:t,onDecline:h,onDelete:i,isSelected:r,onSelect:o})=>{var p;const m=Te[s.status||"pending"],c=((p=s.customer)==null?void 0:p.name)||"Cliente Desconhecido",x=s.created_at?new Date(s.created_at).getTime().toString().slice(-4):"N/A";return e.jsxs(se,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col relative",children:[e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx(J,{checked:r,onCheckedChange:b=>o(s.id,!!b),className:"h-5 w-5"})}),e.jsxs(Fe,{className:"flex flex-row items-center justify-between space-y-0 pb-2 pl-12",children:[e.jsxs(Oe,{className:"text-lg font-bold flex items-center gap-2",children:["Pedido #",x]}),e.jsxs(Xe,{className:k("text-white",m.color),children:[e.jsx(m.icon,{className:"h-3 w-3 mr-1"}),m.label]})]}),e.jsxs(ae,{className:"space-y-2 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",c]}),e.jsx("p",{className:"text-2xl font-extrabold text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]}),e.jsxs("div",{className:"flex justify-end pt-2 border-t gap-2",children:[(s.status==="pending"||s.status==="pending_payment")&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{variant:"destructive",size:"sm",onClick:()=>h(s.id),children:[e.jsx(ce,{className:"h-4 w-4 mr-1"})," Recusar"]}),e.jsxs(P,{variant:"default",size:"sm",onClick:()=>t(s.id),children:[e.jsx(T,{className:"h-4 w-4 mr-1"})," Aceitar"]})]}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>a(s),children:"Detalhes"}),e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",children:e.jsx(cs,{className:"h-4 w-4"})})}),e.jsxs(ue,{children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Tem certeza que deseja excluir?"}),e.jsxs(pe,{children:["Esta ação é permanente. O pedido #",x," será excluído permanentemente do sistema, incluindo todos os itens associados."]})]}),e.jsxs(fe,{children:[e.jsx(ge,{children:"Cancelar"}),e.jsx(je,{onClick:()=>i(s.id),className:"bg-destructive hover:bg-destructive/90",children:"Excluir Permanentemente"})]})]})]})]})]})]})},ks=({status:s,onViewDetails:a,restaurantId:t,selectedOrders:h,setSelectedOrders:i,totalOrdersInView:r})=>{const o=Q(),{stopSoundLoop:m}=ns(),[c,x]=f.useState(0),{data:p,isLoading:b,isError:y,error:N,refetch:u}=K({queryKey:["orders",s,t,c],queryFn:()=>ws(t,s,c),enabled:!!t}),g=(p==null?void 0:p.orders)||[],v=(p==null?void 0:p.count)||0,n=Math.ceil(v/H),l=B({mutationFn:async({orderId:d,newStatus:w})=>{const{error:C}=await D.from("orders").update({status:w}).eq("id",d);if(C)throw new Error(C.message);return w},onSuccess:d=>{S.success(`Pedido ${d==="confirmed"?"aceito":"recusado"} com sucesso!`),o.invalidateQueries({queryKey:["orders"]})},onError:d=>S.error(`Erro ao atualizar pedido: ${d.message}`)}),j=B({mutationFn:async d=>{const{error:w}=await D.from("orders").delete().eq("id",d);if(w)throw new Error(w.message)},onSuccess:()=>{S.success("Pedido excluído permanentemente."),o.invalidateQueries({queryKey:["orders"]})},onError:d=>S.error(`Erro ao excluir pedido: ${d.message}`)}),I=d=>{m(),l.mutate({orderId:d,newStatus:"confirmed"})},L=d=>{m(),l.mutate({orderId:d,newStatus:"cancelled"})},O=d=>{m(),a(d)},z=d=>{j.mutate(d)},Me=f.useCallback(d=>{x(d-1)},[]),Re=f.useCallback((d,w)=>{i(C=>w?[...C,d]:C.filter($=>$!==d))},[i]),Ie=f.useCallback(d=>{if(d){const w=g.map(C=>C.id);i(C=>[...new Set([...C,...w])])}else{const w=new Set(g.map(C=>C.id));i(C=>C.filter($=>!w.has($)))}},[g,i]),qe=g.length>0&&g.every(d=>h.includes(d.id));return b?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((d,w)=>e.jsx(se,{children:e.jsx(ae,{className:"p-4 space-y-3",children:e.jsx(E,{className:"h-32 w-full"})})},w))}):y?e.jsxs(Je,{variant:"destructive",children:[e.jsx(ls,{className:"h-4 w-4"}),e.jsx(Ze,{children:"Erro ao carregar pedidos"}),e.jsx(We,{children:N instanceof Error?N.message:"Ocorreu um erro desconhecido."}),e.jsxs(P,{onClick:()=>u(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]}):!g||g.length===0?e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg border",children:[e.jsx(be,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifique o status selecionado ou aguarde novos pedidos."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg bg-muted/50",children:[e.jsx(J,{checked:qe,onCheckedChange:Ie,className:"h-5 w-5"}),e.jsxs("span",{className:"text-sm font-medium",children:["Selecionar todos (",g.length,") nesta página."]}),r>0&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-auto",children:[r," pedidos selecionados no total."]})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:g.map(d=>e.jsx(Cs,{order:d,onViewDetails:O,onAccept:I,onDecline:L,onDelete:z,isSelected:h.includes(d.id),onSelect:Re},d.id))}),n>1&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(gs,{currentPage:c+1,totalPages:n,onPageChange:Me})})]})},aa=()=>{const{restaurant:s}=Le(),a=Q(),[t,h]=f.useState(null),[i,r]=f.useState(!1),[o,m]=f.useState([]),[c,x]=f.useState(""),p=n=>{h(n),r(!0)},b=()=>{r(!1),h(null)},y=()=>{a.invalidateQueries({queryKey:["orders"]}),S.info("Atualizando pedidos...",{description:"Buscando novos dados no servidor."})},N=B({mutationFn:async({orderIds:n,action:l})=>{if(l==="delete"){const{error:j}=await D.from("orders").delete().in("id",n);if(j)throw new Error(j.message);return"deleted"}else{const{error:j}=await D.from("orders").update({status:l}).in("id",n);if(j)throw new Error(j.message);return"updated"}},onSuccess:(n,l)=>{if(n==="deleted")S.success(`${l.orderIds.length} pedidos excluídos permanentemente.`);else{const j=Te[l.action].label;S.success(`${l.orderIds.length} pedidos atualizados para "${j}".`)}m([]),x(""),a.invalidateQueries({queryKey:["orders"]})},onError:n=>{S.error(`Erro na ação em massa: ${n.message}`)}}),u=()=>{var n;!c||o.length===0||(c==="delete"?(n=document.getElementById("mass-delete-trigger"))==null||n.click():N.mutate({orderIds:o,action:c}))},g=[{value:"pending_payment",label:"Aguardando Pag."},{value:"pending",label:"Pendentes"},{value:"confirmed",label:"Confirmados"},{value:"preparing",label:"Em Preparação"},{value:"ready",label:"Prontos"},{value:"delivering",label:"Em Entrega"},{value:"delivered",label:"Entregues"},{value:"cancelled",label:"Cancelados"},{value:"all",label:"Todos"}],v=N.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(fs,{order:t,isOpen:i,onClose:b}),e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx("button",{id:"mass-delete-trigger",className:"hidden"})}),e.jsxs(ue,{children:[e.jsxs(he,{children:[e.jsxs(xe,{children:["Tem certeza que deseja excluir ",o.length," pedidos?"]}),e.jsxs(pe,{children:["Esta ação é permanente. ",o.length," pedidos serão excluídos permanentemente do sistema."]})]}),e.jsxs(fe,{children:[e.jsx(ge,{children:"Cancelar"}),e.jsx(je,{onClick:()=>N.mutate({orderIds:o,action:"delete"}),className:"bg-destructive hover:bg-destructive/90",disabled:v,children:v?"Excluindo...":"Excluir Permanentemente"})]})]})]}),e.jsxs("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(P,{variant:"outline",onClick:y,children:[e.jsx(ve,{className:"h-4 w-4 mr-2"})," Atualizar Dados"]})}),o.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-lg bg-card shadow-lg animate-fade-in",children:[e.jsx(hs,{className:"h-5 w-5 text-primary mr-2"}),e.jsxs("span",{className:"text-sm font-medium mr-4",children:[o.length," selecionado(s)"]}),e.jsxs(te,{value:c,onValueChange:n=>x(n),children:[e.jsx(re,{className:"w-[200px]",children:e.jsx(ne,{placeholder:"Ação em Massa"})}),e.jsx(oe,{children:Ns.map(n=>e.jsx(le,{value:n.value,children:n.label},n.value))})]}),e.jsx(P,{onClick:u,disabled:!c||v,children:v?e.jsx(ts,{className:"h-4 w-4 animate-spin"}):"Aplicar"})]})]}),s!=null&&s.id?e.jsxs(ze,{defaultValue:"pending_payment",children:[e.jsx($e,{className:"w-full overflow-x-auto justify-start",children:g.map(n=>e.jsx(Ke,{value:n.value,className:"whitespace-nowrap",children:n.label},n.value))}),g.map(n=>e.jsx(Ve,{value:n.value,className:"mt-6",children:e.jsx(ks,{status:n.value,onViewDetails:p,restaurantId:s.id,selectedOrders:o,setSelectedOrders:m,totalOrdersInView:o.length})},n.value))]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Carregando dados do restaurante..."})]})]})]})};export{aa as default};
