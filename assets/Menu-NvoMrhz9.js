import{j as e,u as Ke}from"./tanstack-DXzASLyu.js";import{s as H}from"./client-lAKPhnc8.js";import{S as B}from"./skeleton-CdJp0rkt.js";import{A as re,a as se,b as oe}from"./alert-VSu2ND2w.js";import{r as l,L as Je}from"./vendor-YgypLURK.js";import{o as ne,n as Ze,s as et,u as ae,t as le,c as tt}from"./types-CUwlEUMq.js";import{B as C}from"./button-BxQvs-kK.js";import{D as ie,a as ce,b as de,c as me,d as ue,e as he,B as fe,f as rt}from"./index-HzaS1k76.js";import{F as xe,a as U,b as pe,c as be,d as ge,e as ve}from"./form-Bk-97d-3.js";import{T as st}from"./textarea-C740TDrO.js";import{c as ot,a as M,b as w,T as nt,d as at,e as lt,X as it,f as ct,g as dt,h as I,P as z,i as V,j as T,k as _,l as mt,u as ee}from"./index-CMiS2o-F.js";import{P as we,T as ut}from"./trash-2-CFp19j6E.js";import{S as X}from"./shopping-cart-DpzJdGp4.js";import{I as ht}from"./label-Dw_GSlgs.js";import{C as je,a as ft}from"./card-ADX1xhjW.js";import{M as xt}from"./map-pin-CWpVmh6a.js";import{C as pt,a as bt}from"./circle-x-F-CPzeJO.js";import{C as Se}from"./clock-C1on4qoY.js";import{O as ye,C as Ne,a as Ce,T as Pe,D as Re,P as gt,R as vt}from"./index-BDB3UOS_.js";import{S as wt}from"./separator-Clsguzeh.js";import{u as jt}from"./index-DvUVZ62n.js";import{T as St}from"./terminal-CdKP6dSk.js";import"./supabase-Bm28tI2t.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=ot("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),yt=ne({quantity:Ze().min(1,"Mínimo 1 item."),notes:et().max(255,"Máximo de 255 caracteres.").optional()}),Nt=({product:t,isOpen:s,onClose:r})=>{const{addItem:n}=M(),o=ae({resolver:le(yt),defaultValues:{quantity:1,notes:""},values:{quantity:1,notes:""}}),a=o.watch("quantity"),i=u=>{const m=a+u;m>=1&&o.setValue("quantity",m)},d=u=>{t&&(n({product_id:t.id,name:t.name,price:t.price,quantity:u.quantity,notes:u.notes||void 0,image_url:t.image_url}),r(),o.reset({quantity:1,notes:""}))};if(!t)return null;const c=t.price*a;return e.jsx(ie,{open:s,onOpenChange:r,children:e.jsxs(ce,{className:"sm:max-w-[425px] p-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.image_url||"/placeholder.svg",alt:t.name,className:"w-full h-48 object-cover"}),e.jsxs(de,{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent p-4 flex flex-col justify-end items-start text-left space-y-0",children:[e.jsx(me,{className:"text-2xl font-bold text-white drop-shadow-md",children:t.name}),e.jsxs(ue,{className:"sr-only",children:["Detalhes e opções de personalização para ",t.name,"."]})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description}),e.jsx(xe,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(d),className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-y py-3",children:[e.jsx(U,{className:"text-base font-semibold",children:"Quantidade"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{type:"button",variant:"outline",size:"icon",onClick:()=>i(-1),disabled:a<=1,children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-8 text-center font-bold text-lg",children:a}),e.jsx(C,{type:"button",variant:"outline",size:"icon",onClick:()=>i(1),children:e.jsx(we,{className:"h-4 w-4"})})]})]}),e.jsx(pe,{control:o.control,name:"notes",render:({field:u})=>e.jsxs(be,{children:[e.jsx(U,{children:"Observações (Ex: Sem cebola)"}),e.jsx(ge,{children:e.jsx(st,{placeholder:"Adicione notas sobre o pedido...",...u,rows:2})}),e.jsx(ve,{})]})}),e.jsxs(he,{className:w("pt-4","sm:justify-between sm:space-x-0"),children:[e.jsxs("div",{className:"text-xl font-bold text-foreground hidden sm:block",children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c)]}),e.jsxs(C,{type:"submit",className:"w-full sm:w-auto h-12 text-lg",disabled:o.formState.isSubmitting,children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),"Adicionar ao Pedido"]})]})]})})]})]})})},Ct=ne({weight_in_grams:tt.number({invalid_type_error:"Deve ser um número."}).positive("A quantidade deve ser maior que zero.")}),Pt=({product:t,isOpen:s,onClose:r})=>{const{addItem:n}=M(),o=ae({resolver:le(Ct),defaultValues:{weight_in_grams:500}}),a=o.watch("weight_in_grams"),i=l.useMemo(()=>!t||!a||a<=0?0:t.price/1e3*a,[t,a]),d=c=>{t&&(n({product_id:t.id,name:`${t.name} (${c.weight_in_grams}g)`,price:i,quantity:1,image_url:t.image_url,is_price_by_weight:!0}),r(),o.reset({weight_in_grams:500}))};return t?e.jsx(ie,{open:s,onOpenChange:r,children:e.jsxs(ce,{className:"sm:max-w-[425px]",children:[e.jsxs(de,{className:"text-center",children:[e.jsx(me,{className:"text-2xl",children:"Quanto você deseja?"}),e.jsxs(ue,{children:[e.jsx("span",{className:"block text-lg font-semibold mt-2",children:t.name}),e.jsxs("span",{className:"block text-muted-foreground",children:[new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.price)," por kg"]})]})]}),e.jsx(xe,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(d),className:"space-y-6 pt-4",children:[e.jsx(pe,{control:o.control,name:"weight_in_grams",render:({field:c})=>e.jsxs(be,{children:[e.jsx(U,{className:"text-base",children:"Quantidade em gramas"}),e.jsx(ge,{children:e.jsx(ht,{type:"number",placeholder:"Ex: 500",className:"h-12 text-lg text-center",...c,value:c.value===void 0||c.value===null?"":String(c.value),onChange:u=>{const m=u.target.value;c.onChange(m===""?void 0:parseFloat(m))}})}),e.jsx(ve,{})]})}),e.jsxs(he,{className:"flex-col-reverse sm:flex-row sm:justify-between sm:space-x-2 w-full",children:[e.jsxs("div",{className:"text-xl font-bold text-foreground text-center sm:text-left mb-4 sm:mb-0",children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i)]}),e.jsxs(C,{type:"submit",className:"w-full sm:w-auto h-12 text-lg",disabled:o.formState.isSubmitting||!o.formState.isValid,children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),"Adicionar"]})]})]})})]})}):null},Q=({src:t,alt:s,placeholder:r="/placeholder.svg",className:n="",...o})=>{const[a,i]=l.useState(!0),[d,c]=l.useState(!1),u=l.useRef(null);return l.useEffect(()=>{if(!t){i(!1);return}const m=new Image;m.src=t,m.onload=()=>{i(!1),c(!1)},m.onerror=()=>{i(!1),c(!0)}},[t]),e.jsxs("div",{className:`relative overflow-hidden ${n}`,children:[a&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 animate-pulse"}),e.jsx("img",{ref:u,src:d?r:t,alt:s,className:`${a?"opacity-0":"opacity-100"} transition-opacity duration-300 w-full h-full object-cover`,...o})]})},Te=l.memo(({id:t,name:s,description:r,price:n,image_url:o,is_price_by_weight:a,is_available:i,onClick:d})=>{const c=i===!1;return e.jsxs(je,{className:w("overflow-hidden group transition-shadow duration-300 flex flex-col",c?"cursor-not-allowed":"hover:shadow-xl cursor-pointer"),onClick:d,children:[e.jsxs("div",{className:"relative h-48",children:[e.jsx(Q,{src:o||"/placeholder.svg",alt:s,className:w("w-full h-full object-cover",!c&&"group-hover:scale-105 transition-transform duration-300",c&&"filter grayscale")}),c&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx(fe,{variant:"destructive",className:"text-lg",children:"Indisponível"})})]}),e.jsxs(ft,{className:w("p-4 flex flex-col flex-grow",c&&"opacity-60"),children:[e.jsx("h3",{className:"text-xl font-semibold mb-1 truncate",children:s}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3 flex-grow line-clamp-2",children:r}),e.jsx("p",{className:"text-lg font-bold text-primary text-right mt-2",children:a?`${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)} / kg`:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)})]})]},t)});Te.displayName="ProductCard";function Rt(t,s){const[r,n]=l.useState(t);return l.useEffect(()=>{const o=setTimeout(()=>{n(t)},s);return()=>{clearTimeout(o)}},[t,s]),r}const _t=()=>{const t=new Date,s=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0");return`${s}:${r}`},Tt=()=>new Date().getDay(),Ee=t=>{const s=Tt(),r=_t(),n=t.find(c=>c.day_of_week===s);if(!n||!n.is_open)return{isOpen:!1,todayHours:"Fechado hoje"};const o=n.open_time,a=n.close_time;if(!o||!a)return{isOpen:!1,todayHours:"Horário não configurado"};const i=r>=o&&r<=a,d=`${o.substring(0,5)} - ${a.substring(0,5)}`;return{isOpen:i,todayHours:d}},Et=({restaurant:t,hours:s})=>{const{isOpen:r,todayHours:n}=Ee(s),o=[t.street,t.number,t.neighborhood,t.city,t.zip_code].filter(Boolean).join(", ");return e.jsxs("div",{className:"space-y-3 text-center",children:[o&&e.jsxs("div",{className:"flex items-center justify-center text-sm text-muted-foreground",children:[e.jsx(xt,{className:"h-4 w-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate max-w-full",children:o})]}),e.jsxs("div",{className:"flex items-center justify-center text-sm font-medium",children:[e.jsxs("div",{className:w("flex items-center gap-1 px-3 py-1 rounded-full",r?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"),children:[r?e.jsx(pt,{className:"h-4 w-4"}):e.jsx(bt,{className:"h-4 w-4"}),e.jsx("span",{children:r?"Aberto Agora":"Fechado"})]}),e.jsxs("div",{className:"ml-4 flex items-center text-muted-foreground",children:[e.jsx(Se,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:n})]})]})]})},At=()=>e.jsxs(re,{variant:"destructive",className:"mb-8",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(se,{className:"font-bold",children:"Loja Fechada no Momento"}),e.jsx(oe,{children:"Não é possível adicionar itens ao carrinho ou fazer pedidos fora do nosso horário de funcionamento."})]}),Lt=({onClick:t})=>{const{totalItems:s,subtotal:r}=M();return s===0?null:e.jsxs(nt,{children:[e.jsx(at,{asChild:!0,children:e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsxs(C,{size:"lg",className:"relative h-14 w-14 rounded-full shadow-lg",onClick:t,children:[e.jsx(X,{className:"h-6 w-6"}),e.jsx(fe,{variant:"destructive",className:"absolute -top-1 -right-1 px-2 py-1 text-xs rounded-full",children:s})]})})}),e.jsxs(lt,{children:[e.jsxs("p",{children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Clique para ver seu carrinho"})]})]})},Dt=vt,kt=Ce,It=gt,Ae=l.forwardRef(({className:t,...s},r)=>e.jsx(ye,{className:w("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:r}));Ae.displayName=ye.displayName;const Ot=ct("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Le=l.forwardRef(({side:t="right",className:s,children:r,...n},o)=>e.jsxs(It,{children:[e.jsx(Ae,{}),e.jsxs(Ne,{ref:o,className:w(Ot({side:t}),s),...n,children:[r,e.jsxs(Ce,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(it,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Le.displayName=Ne.displayName;const De=({className:t,...s})=>e.jsx("div",{className:w("flex flex-col space-y-2 text-center sm:text-left",t),...s});De.displayName="SheetHeader";const ke=l.forwardRef(({className:t,...s},r)=>e.jsx(Pe,{ref:r,className:w("text-lg font-semibold text-foreground",t),...s}));ke.displayName=Pe.displayName;const Ie=l.forwardRef(({className:t,...s},r)=>e.jsx(Re,{ref:r,className:w("text-sm text-muted-foreground",t),...s}));Ie.displayName=Re.displayName;function Bt(t,s){return l.useReducer((r,n)=>s[r][n]??r,t)}var G="ScrollArea",[Oe,yr]=dt(G),[Mt,j]=Oe(G),Be=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,type:n="hover",dir:o,scrollHideDelay:a=600,...i}=t,[d,c]=l.useState(null),[u,m]=l.useState(null),[f,h]=l.useState(null),[x,g]=l.useState(null),[S,E]=l.useState(null),[R,y]=l.useState(0),[O,p]=l.useState(0),[b,A]=l.useState(!1),[L,F]=l.useState(!1),v=I(s,D=>c(D)),N=jt(o);return e.jsx(Mt,{scope:r,type:n,dir:N,scrollHideDelay:a,scrollArea:d,viewport:u,onViewportChange:m,content:f,onContentChange:h,scrollbarX:x,onScrollbarXChange:g,scrollbarXEnabled:b,onScrollbarXEnabledChange:A,scrollbarY:S,onScrollbarYChange:E,scrollbarYEnabled:L,onScrollbarYEnabledChange:F,onCornerWidthChange:y,onCornerHeightChange:p,children:e.jsx(z.div,{dir:N,...i,ref:v,style:{position:"relative","--radix-scroll-area-corner-width":R+"px","--radix-scroll-area-corner-height":O+"px",...t.style}})})});Be.displayName=G;var Me="ScrollAreaViewport",ze=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,children:n,nonce:o,...a}=t,i=j(Me,r),d=l.useRef(null),c=I(s,d,i.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),e.jsx(z.div,{"data-radix-scroll-area-viewport":"",...a,ref:c,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:i.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});ze.displayName=Me;var P="ScrollAreaScrollbar",K=l.forwardRef((t,s)=>{const{forceMount:r,...n}=t,o=j(P,t.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:i}=o,d=t.orientation==="horizontal";return l.useEffect(()=>(d?a(!0):i(!0),()=>{d?a(!1):i(!1)}),[d,a,i]),o.type==="hover"?e.jsx(zt,{...n,ref:s,forceMount:r}):o.type==="scroll"?e.jsx(Ft,{...n,ref:s,forceMount:r}):o.type==="auto"?e.jsx(Fe,{...n,ref:s,forceMount:r}):o.type==="always"?e.jsx(J,{...n,ref:s}):null});K.displayName=P;var zt=l.forwardRef((t,s)=>{const{forceMount:r,...n}=t,o=j(P,t.__scopeScrollArea),[a,i]=l.useState(!1);return l.useEffect(()=>{const d=o.scrollArea;let c=0;if(d){const u=()=>{window.clearTimeout(c),i(!0)},m=()=>{c=window.setTimeout(()=>i(!1),o.scrollHideDelay)};return d.addEventListener("pointerenter",u),d.addEventListener("pointerleave",m),()=>{window.clearTimeout(c),d.removeEventListener("pointerenter",u),d.removeEventListener("pointerleave",m)}}},[o.scrollArea,o.scrollHideDelay]),e.jsx(V,{present:r||a,children:e.jsx(Fe,{"data-state":a?"visible":"hidden",...n,ref:s})})}),Ft=l.forwardRef((t,s)=>{const{forceMount:r,...n}=t,o=j(P,t.__scopeScrollArea),a=t.orientation==="horizontal",i=$(()=>c("SCROLL_END"),100),[d,c]=Bt("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return l.useEffect(()=>{if(d==="idle"){const u=window.setTimeout(()=>c("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(u)}},[d,o.scrollHideDelay,c]),l.useEffect(()=>{const u=o.viewport,m=a?"scrollLeft":"scrollTop";if(u){let f=u[m];const h=()=>{const x=u[m];f!==x&&(c("SCROLL"),i()),f=x};return u.addEventListener("scroll",h),()=>u.removeEventListener("scroll",h)}},[o.viewport,a,c,i]),e.jsx(V,{present:r||d!=="hidden",children:e.jsx(J,{"data-state":d==="hidden"?"hidden":"visible",...n,ref:s,onPointerEnter:T(t.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:T(t.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),Fe=l.forwardRef((t,s)=>{const r=j(P,t.__scopeScrollArea),{forceMount:n,...o}=t,[a,i]=l.useState(!1),d=t.orientation==="horizontal",c=$(()=>{if(r.viewport){const u=r.viewport.offsetWidth<r.viewport.scrollWidth,m=r.viewport.offsetHeight<r.viewport.scrollHeight;i(d?u:m)}},10);return k(r.viewport,c),k(r.content,c),e.jsx(V,{present:n||a,children:e.jsx(J,{"data-state":a?"visible":"hidden",...o,ref:s})})}),J=l.forwardRef((t,s)=>{const{orientation:r="vertical",...n}=t,o=j(P,t.__scopeScrollArea),a=l.useRef(null),i=l.useRef(0),[d,c]=l.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=Xe(d.viewport,d.content),m={...n,sizes:d,onSizesChange:c,hasThumb:u>0&&u<1,onThumbChange:h=>a.current=h,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:h=>i.current=h};function f(h,x){return Yt(h,i.current,d,x)}return r==="horizontal"?e.jsx(Ht,{...m,ref:s,onThumbPositionChange:()=>{if(o.viewport&&a.current){const h=o.viewport.scrollLeft,x=te(h,d,o.dir);a.current.style.transform=`translate3d(${x}px, 0, 0)`}},onWheelScroll:h=>{o.viewport&&(o.viewport.scrollLeft=h)},onDragScroll:h=>{o.viewport&&(o.viewport.scrollLeft=f(h,o.dir))}}):r==="vertical"?e.jsx(Wt,{...m,ref:s,onThumbPositionChange:()=>{if(o.viewport&&a.current){const h=o.viewport.scrollTop,x=te(h,d);a.current.style.transform=`translate3d(0, ${x}px, 0)`}},onWheelScroll:h=>{o.viewport&&(o.viewport.scrollTop=h)},onDragScroll:h=>{o.viewport&&(o.viewport.scrollTop=f(h))}}):null}),Ht=l.forwardRef((t,s)=>{const{sizes:r,onSizesChange:n,...o}=t,a=j(P,t.__scopeScrollArea),[i,d]=l.useState(),c=l.useRef(null),u=I(s,c,a.onScrollbarXChange);return l.useEffect(()=>{c.current&&d(getComputedStyle(c.current))},[c]),e.jsx(We,{"data-orientation":"horizontal",...o,ref:u,sizes:r,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Y(r)+"px",...t.style},onThumbPointerDown:m=>t.onThumbPointerDown(m.x),onDragScroll:m=>t.onDragScroll(m.x),onWheelScroll:(m,f)=>{if(a.viewport){const h=a.viewport.scrollLeft+m.deltaX;t.onWheelScroll(h),$e(h,f)&&m.preventDefault()}},onResize:()=>{c.current&&a.viewport&&i&&n({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:q(i.paddingLeft),paddingEnd:q(i.paddingRight)}})}})}),Wt=l.forwardRef((t,s)=>{const{sizes:r,onSizesChange:n,...o}=t,a=j(P,t.__scopeScrollArea),[i,d]=l.useState(),c=l.useRef(null),u=I(s,c,a.onScrollbarYChange);return l.useEffect(()=>{c.current&&d(getComputedStyle(c.current))},[c]),e.jsx(We,{"data-orientation":"vertical",...o,ref:u,sizes:r,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Y(r)+"px",...t.style},onThumbPointerDown:m=>t.onThumbPointerDown(m.y),onDragScroll:m=>t.onDragScroll(m.y),onWheelScroll:(m,f)=>{if(a.viewport){const h=a.viewport.scrollTop+m.deltaY;t.onWheelScroll(h),$e(h,f)&&m.preventDefault()}},onResize:()=>{c.current&&a.viewport&&i&&n({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:q(i.paddingTop),paddingEnd:q(i.paddingBottom)}})}})}),[qt,He]=Oe(P),We=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,sizes:n,hasThumb:o,onThumbChange:a,onThumbPointerUp:i,onThumbPointerDown:d,onThumbPositionChange:c,onDragScroll:u,onWheelScroll:m,onResize:f,...h}=t,x=j(P,r),[g,S]=l.useState(null),E=I(s,v=>S(v)),R=l.useRef(null),y=l.useRef(""),O=x.viewport,p=n.content-n.viewport,b=_(m),A=_(c),L=$(f,10);function F(v){if(R.current){const N=v.clientX-R.current.left,D=v.clientY-R.current.top;u({x:N,y:D})}}return l.useEffect(()=>{const v=N=>{const D=N.target;(g==null?void 0:g.contains(D))&&b(N,p)};return document.addEventListener("wheel",v,{passive:!1}),()=>document.removeEventListener("wheel",v,{passive:!1})},[O,g,p,b]),l.useEffect(A,[n,A]),k(g,L),k(x.content,L),e.jsx(qt,{scope:r,scrollbar:g,hasThumb:o,onThumbChange:_(a),onThumbPointerUp:_(i),onThumbPositionChange:A,onThumbPointerDown:_(d),children:e.jsx(z.div,{...h,ref:E,style:{position:"absolute",...h.style},onPointerDown:T(t.onPointerDown,v=>{v.button===0&&(v.target.setPointerCapture(v.pointerId),R.current=g.getBoundingClientRect(),y.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",x.viewport&&(x.viewport.style.scrollBehavior="auto"),F(v))}),onPointerMove:T(t.onPointerMove,F),onPointerUp:T(t.onPointerUp,v=>{const N=v.target;N.hasPointerCapture(v.pointerId)&&N.releasePointerCapture(v.pointerId),document.body.style.webkitUserSelect=y.current,x.viewport&&(x.viewport.style.scrollBehavior=""),R.current=null})})})}),W="ScrollAreaThumb",qe=l.forwardRef((t,s)=>{const{forceMount:r,...n}=t,o=He(W,t.__scopeScrollArea);return e.jsx(V,{present:r||o.hasThumb,children:e.jsx(Vt,{ref:s,...n})})}),Vt=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,style:n,...o}=t,a=j(W,r),i=He(W,r),{onThumbPositionChange:d}=i,c=I(s,f=>i.onThumbChange(f)),u=l.useRef(void 0),m=$(()=>{u.current&&(u.current(),u.current=void 0)},100);return l.useEffect(()=>{const f=a.viewport;if(f){const h=()=>{if(m(),!u.current){const x=$t(f,d);u.current=x,d()}};return d(),f.addEventListener("scroll",h),()=>f.removeEventListener("scroll",h)}},[a.viewport,m,d]),e.jsx(z.div,{"data-state":i.hasThumb?"visible":"hidden",...o,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:T(t.onPointerDownCapture,f=>{const x=f.target.getBoundingClientRect(),g=f.clientX-x.left,S=f.clientY-x.top;i.onThumbPointerDown({x:g,y:S})}),onPointerUp:T(t.onPointerUp,i.onThumbPointerUp)})});qe.displayName=W;var Z="ScrollAreaCorner",Ve=l.forwardRef((t,s)=>{const r=j(Z,t.__scopeScrollArea),n=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&n?e.jsx(Xt,{...t,ref:s}):null});Ve.displayName=Z;var Xt=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,...n}=t,o=j(Z,r),[a,i]=l.useState(0),[d,c]=l.useState(0),u=!!(a&&d);return k(o.scrollbarX,()=>{var f;const m=((f=o.scrollbarX)==null?void 0:f.offsetHeight)||0;o.onCornerHeightChange(m),c(m)}),k(o.scrollbarY,()=>{var f;const m=((f=o.scrollbarY)==null?void 0:f.offsetWidth)||0;o.onCornerWidthChange(m),i(m)}),u?e.jsx(z.div,{...n,ref:s,style:{width:a,height:d,position:"absolute",right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function q(t){return t?parseInt(t,10):0}function Xe(t,s){const r=t/s;return isNaN(r)?0:r}function Y(t){const s=Xe(t.viewport,t.content),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,n=(t.scrollbar.size-r)*s;return Math.max(n,18)}function Yt(t,s,r,n="ltr"){const o=Y(r),a=o/2,i=s||a,d=o-i,c=r.scrollbar.paddingStart+i,u=r.scrollbar.size-r.scrollbar.paddingEnd-d,m=r.content-r.viewport,f=n==="ltr"?[0,m]:[m*-1,0];return Ye([c,u],f)(t)}function te(t,s,r="ltr"){const n=Y(s),o=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,a=s.scrollbar.size-o,i=s.content-s.viewport,d=a-n,c=r==="ltr"?[0,i]:[i*-1,0],u=rt(t,c);return Ye([0,i],[0,d])(u)}function Ye(t,s){return r=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const n=(s[1]-s[0])/(t[1]-t[0]);return s[0]+n*(r-t[0])}}function $e(t,s){return t>0&&t<s}var $t=(t,s=()=>{})=>{let r={left:t.scrollLeft,top:t.scrollTop},n=0;return function o(){const a={left:t.scrollLeft,top:t.scrollTop},i=r.left!==a.left,d=r.top!==a.top;(i||d)&&s(),r=a,n=window.requestAnimationFrame(o)}(),()=>window.cancelAnimationFrame(n)};function $(t,s){const r=_(t),n=l.useRef(0);return l.useEffect(()=>()=>window.clearTimeout(n.current),[]),l.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(r,s)},[r,s])}function k(t,s){const r=_(s);mt(()=>{let n=0;if(t){const o=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(r)});return o.observe(t),()=>{window.cancelAnimationFrame(n),o.unobserve(t)}}},[t,r])}var Ue=Be,Ut=ze,Qt=Ve;const Qe=l.forwardRef(({className:t,children:s,...r},n)=>e.jsxs(Ue,{ref:n,className:w("relative overflow-hidden",t),...r,children:[e.jsx(Ut,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(Ge,{}),e.jsx(Qt,{})]}));Qe.displayName=Ue.displayName;const Ge=l.forwardRef(({className:t,orientation:s="vertical",...r},n)=>e.jsx(K,{ref:n,orientation:s,className:w("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...r,children:e.jsx(qe,{className:"relative flex-1 rounded-full bg-border"})}));Ge.displayName=K.displayName;const Gt=({item:t})=>{const{updateQuantity:s,removeItem:r}=M();return e.jsxs("div",{className:"flex items-center gap-4 py-3",children:[e.jsx(Q,{src:t.image_url||"/placeholder.svg",alt:t.name,className:"w-16 h-16 rounded-md object-cover"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-semibold leading-tight",children:t.name}),e.jsx("p",{className:"text-sm text-primary font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.price)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!t.is_price_by_weight&&e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>s(t.id,t.quantity-1),children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-6 text-center font-bold",children:t.quantity}),e.jsx(C,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>s(t.id,t.quantity+1),children:e.jsx(we,{className:"h-4 w-4"})})]}),e.jsx(C,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive hover:text-destructive",onClick:()=>r(t.id),children:e.jsx(ut,{className:"h-4 w-4"})})]})]})},Kt=({isOpen:t,onOpenChange:s})=>{const{items:r,subtotal:n,total:o,clearCart:a}=M();return e.jsx(Dt,{open:t,onOpenChange:s,children:e.jsxs(Le,{className:"flex flex-col",children:[e.jsxs(De,{children:[e.jsx(ke,{className:"text-2xl",children:"Seu Carrinho"}),e.jsx(Ie,{className:"sr-only",children:"Lista de itens no seu carrinho e resumo do pedido."})]}),e.jsx(wt,{}),r.length===0?e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-center",children:[e.jsx(X,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Seu carrinho está vazio"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Adicione produtos do cardápio para começar."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Qe,{className:"flex-grow -mx-6 px-6",children:e.jsx("div",{className:"divide-y",children:r.map(i=>e.jsx(Gt,{item:i},i.id))})}),e.jsxs("div",{className:"border-t pt-4 mt-4 space-y-4",children:[e.jsxs("div",{className:"w-full space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-base",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal:"}),e.jsx("span",{className:"font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o)})]})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(C,{variant:"outline",onClick:a,className:"flex-1",children:"Limpar Carrinho"}),e.jsx(kt,{asChild:!0,children:e.jsx(Je,{to:"/checkout",className:"flex-1",children:e.jsx(C,{className:"w-full",children:"Finalizar Pedido"})})})]})]})]})]})})},Jt=async()=>{const{data:t,error:s}=await H.from("restaurants").select("*").eq("is_active",!0).limit(1).single();if(s)throw new Error(`Erro ao buscar restaurante: ${s.message}`);if(!t)throw new Error("Nenhum restaurante ativo encontrado.");const r=t.id,[n,o,a]=await Promise.all([H.from("categories").select("*").eq("restaurant_id",r).eq("is_active",!0).order("display_order",{ascending:!0}),H.from("products").select("*").eq("restaurant_id",r),H.from("business_hours").select("*").eq("restaurant_id",r)]);if(n.error)throw new Error(`Erro ao buscar categorias: ${n.error.message}`);if(o.error)throw new Error(`Erro ao buscar produtos: ${o.error.message}`);if(a.error)throw new Error(`Erro ao buscar horários: ${a.error.message}`);const i=(n.data||[]).map(d=>({...d,products:(o.data||[]).filter(c=>c.category_id===d.id)})).filter(d=>d.products.length>0);return{restaurant:t,menu:i,hours:a.data}},Nr=()=>{const{data:t,isLoading:s,isError:r,error:n}=Ke({queryKey:["menuData"],queryFn:Jt,staleTime:3e5,gcTime:6e5}),[o,a]=l.useState(null),[i,d]=l.useState(!1),[c,u]=l.useState(!1),[m,f]=l.useState(!1),[h,x]=l.useState(""),g=Rt(h,300),{isOpen:S}=l.useMemo(()=>t!=null&&t.hours?Ee(t.hours):{isOpen:!1,todayHours:"Carregando..."},[t==null?void 0:t.hours]),E=l.useMemo(()=>t!=null&&t.menu?g?t.menu.map(p=>({...p,products:p.products.filter(b=>b.name.toLowerCase().includes(g.toLowerCase())||b.description&&b.description.toLowerCase().includes(g.toLowerCase()))})).filter(p=>p.products.length>0):t.menu:[],[t==null?void 0:t.menu,g]),R=l.useCallback(p=>{if(!S){ee.error("A loja está fechada.",{description:"Não é possível adicionar itens ao carrinho no momento."});return}if(!p.is_available){ee.info("Produto indisponível",{description:"Este item não está disponível no momento."});return}a(p),p.is_price_by_weight?u(!0):d(!0)},[S]);if(s)return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-5xl",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx(B,{className:"h-24 w-24 rounded-full mx-auto mb-4"}),e.jsx(B,{className:"h-10 w-1/2 mx-auto mb-2"}),e.jsx(B,{className:"h-6 w-3/4 mx-auto"})]}),e.jsx("div",{className:"space-y-10",children:[...Array(3)].map((p,b)=>e.jsxs("div",{children:[e.jsx(B,{className:"h-9 w-1/3 mb-6"}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(3)].map((A,L)=>e.jsx(je,{className:"p-4",children:e.jsx(B,{className:"h-48 w-full"})},L))})]},b))})]});if(r)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs(re,{variant:"destructive",children:[e.jsx(St,{className:"h-4 w-4"}),e.jsx(se,{children:"Erro ao carregar o cardápio"}),e.jsx(oe,{children:n instanceof Error?n.message:"Ocorreu um erro desconhecido."})]})});const{restaurant:y,hours:O}=t;return e.jsxs(e.Fragment,{children:[e.jsx(Nt,{product:o,isOpen:i,onClose:()=>d(!1)}),e.jsx(Pt,{product:o,isOpen:c,onClose:()=>u(!1)}),e.jsx(Kt,{isOpen:m,onOpenChange:f}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-5xl",children:[e.jsxs("header",{className:"text-center mb-8",children:[y.logo_url&&e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full mb-4 overflow-hidden border-4 border-card shadow-lg",children:e.jsx(Q,{src:y.logo_url,alt:y.name,className:"w-full h-full object-cover"})}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight mb-2",children:y.name}),e.jsx("p",{className:"text-muted-foreground mb-4",children:y.description}),e.jsx(Et,{restaurant:y,hours:O})]}),!S&&e.jsx(At,{}),e.jsx("div",{className:"mb-8",children:e.jsx("input",{type:"text",placeholder:"Buscar produtos...",className:"w-full p-3 border rounded-lg",value:h,onChange:p=>x(p.target.value)})}),e.jsx("main",{className:w(!S&&"opacity-50 pointer-events-none"),children:E.length===0?e.jsx("div",{className:"text-center py-16",children:e.jsx("p",{className:"text-muted-foreground text-lg",children:g?"Nenhum produto encontrado.":"Nenhum item no cardápio no momento."})}):e.jsx("div",{className:"space-y-10",children:E.map(p=>e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold border-b-2 border-primary pb-2 mb-6",children:p.name}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.products.map(b=>e.jsx(Te,{id:b.id,name:b.name,description:b.description,price:b.price,image_url:b.image_url,is_price_by_weight:b.is_price_by_weight,is_available:b.is_available,onClick:()=>R(b)},b.id))})]},p.id))})})]}),S&&e.jsx(Lt,{onClick:()=>f(!0)})]})};export{Nr as default};
