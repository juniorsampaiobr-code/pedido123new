import{b as me,j as e,u as or,c as Me}from"./tanstack-d4AvmB45.js";import{r as i,u as sr,h as ar,j as ir,L as Fe}from"./vendor-CnEXr6gt.js";import{s as A}from"./client-D5i5GwB9.js";import{c as cr,d as yt,e as Le,P as Ce,f as ke,g as lr,h as dr,i as ur,a as he,u as P,L as pe,p as mr,b as st}from"./index-BcD7V_bc.js";import{L as fr,g as at,c as Oe}from"./location-DbtI4I31.js";import{u as pr}from"./use-auth-status-b07NBuTX.js";import{o as jt,s as O,e as hr,u as it,C as ve,t as ct}from"./types-DKlirIXB.js";import{B as X}from"./button-CyBJbptL.js";import{C as H,b as J,c as W,a as Z}from"./card-DTdQjeSz.js";import{I as fe,L as V}from"./label-DR2AgQc4.js";import{T as xr}from"./textarea-Bg8whWL_.js";import{c as vt,R as gr,I as yr}from"./index-DPx68UAK.js";import{u as jr}from"./index-DrlxvCXN.js";import{u as vr}from"./index-KNP7Yozt.js";import{S as lt}from"./separator-Bktxm_j2.js";import{A as te,a as se,b as ae}from"./alert-QphIXohn.js";import{P as wr,M as br}from"./PhoneInput-BtLSyFDP.js";import{S as _r,C as Nr,L as Cr}from"./CustomerProfileModal-ChGtBEUA.js";import{D as dt,a as ut,b as Er,c as Rr,d as Sr}from"./dialog-DOmf3D9I.js";import{C as wt}from"./credit-card-Dl9J-2VH.js";import{C as Pr}from"./CpfCnpjInput-CQ7T85Dx.js";import{M as Te}from"./map-pin-DbpDbkEJ.js";import{A as $r,a as Ar,b as Ir,c as Dr,d as Mr,e as Fr,g as Or}from"./alert-dialog-DyCzA4FL.js";import{C as _e}from"./circle-alert-DfYtYA-X.js";import{F as mt}from"./form-D_Uk2CKM.js";import{T as ft}from"./terminal-CCHJrMU9.js";import{R as kr}from"./pt-BR-DHr5PDnq.js";import{A as Tr}from"./arrow-left-TM3wgMl8.js";import{U as pt}from"./user-Dbzl2noB.js";import{T as we}from"./truck-l3M9-VYS.js";import{C as Vr}from"./circle-check-big-Dk6kk0ti.js";import{S as Lr}from"./save-C6hqMgfp.js";import{D as zr}from"./dollar-sign-CaMLXLW6.js";import"./supabase-BZV_3FV3.js";import"./skeleton-CbzX8amF.js";import"./store-Uw8mTX2p.js";import"./package-DufC43YG.js";import"./check-eHhTVPiz.js";import"./circle-x-Dib03Re6.js";import"./euro-BYFlQaVG.js";import"./format-BeKxgCCE.js";import"./index-BpGMbxyE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=cr("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Br=async n=>{const{data:t,error:o}=await A.from("payment_settings").select("mercado_pago_public_key").eq("restaurant_id",n).limit(1).single();if(o&&o.code!=="PGRST116")throw new Error(`Error fetching payment settings: ${o.message}`);return(t==null?void 0:t.mercado_pago_public_key)||null},bt=n=>me({queryKey:["mercadoPagoPublicKey",n],queryFn:()=>Br(n),enabled:!!n,staleTime:1/0});var ze="Radio",[Gr,_t]=yt(ze),[Kr,Ur]=Gr(ze),Nt=i.forwardRef((n,t)=>{const{__scopeRadio:o,name:u,checked:f=!1,required:p,disabled:v,value:c="on",onCheck:E,form:R,...w}=n,[h,D]=i.useState(null),$=Le(t,B=>D(B)),I=i.useRef(!1),M=h?R||!!h.closest("form"):!0;return e.jsxs(Kr,{scope:o,checked:f,disabled:v,children:[e.jsx(Ce.button,{type:"button",role:"radio","aria-checked":f,"data-state":St(f),"data-disabled":v?"":void 0,disabled:v,value:c,...w,ref:$,onClick:ke(n.onClick,B=>{f||E==null||E(),M&&(I.current=B.isPropagationStopped(),I.current||B.stopPropagation())})}),M&&e.jsx(Rt,{control:h,bubbles:!I.current,name:u,value:c,checked:f,required:p,disabled:v,form:R,style:{transform:"translateX(-100%)"}})]})});Nt.displayName=ze;var Ct="RadioIndicator",Et=i.forwardRef((n,t)=>{const{__scopeRadio:o,forceMount:u,...f}=n,p=Ur(Ct,o);return e.jsx(lr,{present:u||p.checked,children:e.jsx(Ce.span,{"data-state":St(p.checked),"data-disabled":p.disabled?"":void 0,...f,ref:t})})});Et.displayName=Ct;var Qr="RadioBubbleInput",Rt=i.forwardRef(({__scopeRadio:n,control:t,checked:o,bubbles:u=!0,...f},p)=>{const v=i.useRef(null),c=Le(v,p),E=vr(o),R=dr(t);return i.useEffect(()=>{const w=v.current;if(!w)return;const h=window.HTMLInputElement.prototype,$=Object.getOwnPropertyDescriptor(h,"checked").set;if(E!==o&&$){const I=new Event("click",{bubbles:u});$.call(w,o),w.dispatchEvent(I)}},[E,o,u]),e.jsx(Ce.input,{type:"radio","aria-hidden":!0,defaultChecked:o,...f,tabIndex:-1,ref:c,style:{...f.style,...R,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Rt.displayName=Qr;function St(n){return n?"checked":"unchecked"}var Xr=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Ee="RadioGroup",[Hr,uo]=yt(Ee,[vt,_t]),Pt=vt(),$t=_t(),[Jr,Wr]=Hr(Ee),At=i.forwardRef((n,t)=>{const{__scopeRadioGroup:o,name:u,defaultValue:f,value:p,required:v=!1,disabled:c=!1,orientation:E,dir:R,loop:w=!0,onValueChange:h,...D}=n,$=Pt(o),I=jr(R),[M,B]=ur({prop:p,defaultProp:f??null,onChange:h,caller:Ee});return e.jsx(Jr,{scope:o,name:u,required:v,disabled:c,value:M,onValueChange:B,children:e.jsx(gr,{asChild:!0,...$,orientation:E,dir:I,loop:w,children:e.jsx(Ce.div,{role:"radiogroup","aria-required":v,"aria-orientation":E,"data-disabled":c?"":void 0,dir:I,...D,ref:t})})})});At.displayName=Ee;var It="RadioGroupItem",Dt=i.forwardRef((n,t)=>{const{__scopeRadioGroup:o,disabled:u,...f}=n,p=Wr(It,o),v=p.disabled||u,c=Pt(o),E=$t(o),R=i.useRef(null),w=Le(t,R),h=p.value===f.value,D=i.useRef(!1);return i.useEffect(()=>{const $=M=>{Xr.includes(M.key)&&(D.current=!0)},I=()=>D.current=!1;return document.addEventListener("keydown",$),document.addEventListener("keyup",I),()=>{document.removeEventListener("keydown",$),document.removeEventListener("keyup",I)}},[]),e.jsx(yr,{asChild:!0,...c,focusable:!v,active:h,children:e.jsx(Nt,{disabled:v,required:p.required,checked:h,...E,...f,name:p.name,ref:w,onCheck:()=>p.onValueChange(f.value),onKeyDown:ke($=>{$.key==="Enter"&&$.preventDefault()}),onFocus:ke(f.onFocus,()=>{var $;D.current&&(($=R.current)==null||$.click())})})})});Dt.displayName=It;var Zr="RadioGroupIndicator",Mt=i.forwardRef((n,t)=>{const{__scopeRadioGroup:o,...u}=n,f=$t(o);return e.jsx(Et,{...f,...u,ref:t})});Mt.displayName=Zr;var Ft=At,Ot=Dt,Yr=Mt;const Ve=i.forwardRef(({className:n,...t},o)=>e.jsx(Ft,{className:he("grid gap-2",n),...t,ref:o}));Ve.displayName=Ft.displayName;const Ne=i.forwardRef(({className:n,...t},o)=>e.jsx(Ot,{ref:o,className:he("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),...t,children:e.jsx(Yr,{className:"flex items-center justify-center",children:e.jsx(qr,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Ne.displayName=Ot.displayName;var qe={};Object.defineProperty(qe,"__esModule",{value:!0});var kt=qe.loadMercadoPago=void 0;const Tt="https://sdk.mercadopago.com/js/v2",en=/^https:\/\/sdk\.mercadopago\.com\/js\/v2\/?(\?.*)?$/,ht="MercadoPago has already been initialized in your window, please remove the duplicate import",tn="MercadoPago.js not available",rn="Failed to load MercadoPago.js",nn=()=>{for(var n=document.querySelectorAll(`script[src^="${Tt}"`),t=0;t<n.length;t++){var o=n[t];if(en.test(o.src))return o}return null},on=()=>{const n=document.createElement("script");n.src=Tt;const t=document.head||document.body;if(!t)throw new Error("Expected document.body or document.head not to be null. MercadoPago requires a <body> or a <head> element, please add on your project.");return t.appendChild(n),n};let be=null;const sn=()=>(be!==null||(be=new Promise((n,t)=>{if(typeof window>"u"){n(null);return}if(window.MercadoPago){console.warn(ht),n(window.MercadoPago);return}try{let o=nn();o?console.warn(ht):o||(o=on()),o.addEventListener("load",()=>{window.MercadoPago?n(window.MercadoPago):t(new Error(tn))}),o.addEventListener("error",()=>{t(new Error(rn))})}catch(o){t(o);return}})),be);kt=qe.loadMercadoPago=sn;var an=function(n,t,o,u){function f(p){return p instanceof o?p:new o(function(v){v(p)})}return new(o||(o=Promise))(function(p,v){function c(w){try{R(u.next(w))}catch(h){v(h)}}function E(w){try{R(u.throw(w))}catch(h){v(h)}}function R(w){w.done?p(w.value):f(w.value).then(c,E)}R((u=u.apply(n,t||[])).next())})};class K{static getInstance(){return an(this,void 0,void 0,function*(){if(this.publicKey)return this.loadedInstanceMercadoPago||(yield kt(),this.loadedInstanceMercadoPago=!0),this.instanceMercadoPago||(this.instanceMercadoPago=new window.MercadoPago(this.publicKey,this.options)),this.instanceMercadoPago;console.error("Expected the PUBLIC_KEY to render the MercadoPago SDK React")})}}K.publicKey=null;K.options={};K.instanceMercadoPago=void 0;K.loadedInstanceMercadoPago=!1;function cn(n,t){return Object.keys(n).length===Object.keys(t).length&&Object.keys(n).every(u=>Object.prototype.hasOwnProperty.call(t,u)&&n[u]===t[u])}const ln=(n,t)=>{const o=Object.assign(Object.assign({},t),{frontEndStack:"react"}),u=!cn(K.options,o);(n!==K.publicKey||u)&&(K.publicKey=n,K.options=o,K.instanceMercadoPago=void 0)},dn=({preferenceId:n,initPoint:t,onClose:o})=>{const{data:u,isLoading:f}=bt();return i.useEffect(()=>{if(u)try{ln(u,{locale:"pt-BR"})}catch(p){console.error("Erro ao inicializar Mercado Pago:",p),P.error("Erro ao carregar o SDK do Mercado Pago."),o();return}t&&(console.log("Redirecionando para o Mercado Pago:",t),window.location.href=t)},[u,o,t]),f||!u?e.jsx(dt,{open:!0,onOpenChange:o,children:e.jsx(ut,{className:"sm:max-w-[425px]",children:e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsx(pe,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{children:"Carregando configurações de pagamento..."})]})})}):e.jsx(dt,{open:!0,onOpenChange:o,children:e.jsxs(ut,{className:"sm:max-w-[425px]",children:[e.jsxs(Er,{children:[e.jsxs(Rr,{className:"flex items-center gap-2",children:[e.jsx(wt,{className:"h-5 w-5 text-primary"}),"Redirecionando para Pagamento"]}),e.jsx(Sr,{children:"Você está sendo redirecionado para o checkout seguro do Mercado Pago."})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(pe,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aguarde..."})]}),e.jsx(X,{variant:"outline",onClick:o,children:"Cancelar e Voltar"})]})})},un=({latitude:n,longitude:t,address:o,className:u})=>{const f=i.useMemo(()=>[n,t],[n,t]),p=i.useMemo(()=>[n,t],[n,t]);return e.jsxs(H,{className:he("w-full",u),children:[e.jsxs(J,{children:[e.jsxs(W,{className:"text-lg flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-primary"}),"Sua Localização"]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:o})]}),e.jsx(Z,{className:"p-0",children:e.jsx("div",{className:"h-64 w-full rounded-b-lg overflow-hidden",children:e.jsx(fr,{center:p,markerPosition:f,onMarkerDragEnd:()=>{},zoom:16})})})]})},mn=({isOpen:n,onConfirm:t})=>e.jsx($r,{open:n,children:e.jsxs(Ar,{children:[e.jsxs(Ir,{children:[e.jsxs(Dr,{className:"flex items-center gap-2 text-primary",children:[e.jsx(_e,{className:"h-6 w-6"}),"Atenção ao Pagamento Online!"]}),e.jsxs(Mr,{children:["Você escolheu o pagamento online (Pix ou Cartão).",e.jsx("br",{}),e.jsx("br",{}),"Ao prosseguir, você será redirecionado para o checkout do Mercado Pago.",e.jsx("br",{}),e.jsx("br",{}),'**IMPORTANTE:** Se você escolher **PIX**, após o pagamento, você pode precisar clicar no botão **"Voltar ao site"** na tela do Mercado Pago para que seu pedido seja finalizado e rastreado corretamente.']})]}),e.jsx(Fr,{children:e.jsx(Or,{onClick:t,className:"w-full",children:"Entendi e Continuar"})})]})}),fn=({onAddressSelect:n,defaultValue:t,disabled:o})=>{const u=i.useRef(null),f=i.useRef(null);return i.useEffect(()=>{!u.current||!window.google||!window.google.maps||!window.google.maps.places||(f.current=new window.google.maps.places.Autocomplete(u.current,{componentRestrictions:{country:"br"},fields:["address_components","geometry","formatted_address"],types:["address"]}),f.current.addListener("place_changed",()=>{var c,E,R;const p=(c=f.current)==null?void 0:c.getPlace();if(!p||!p.address_components||!p.geometry)return;const v={street:"",number:"",neighborhood:"",city:"",state:"",zip_code:"",latitude:((E=p.geometry.location)==null?void 0:E.lat())||0,longitude:((R=p.geometry.location)==null?void 0:R.lng())||0};p.address_components.forEach(w=>{const h=w.types;h.includes("route")&&(v.street=w.long_name),h.includes("street_number")&&(v.number=w.long_name),(h.includes("sublocality_level_1")||h.includes("sublocality"))&&(v.neighborhood=w.long_name),(h.includes("administrative_area_level_2")||h.includes("locality"))&&(v.city=w.long_name),h.includes("administrative_area_level_1")&&(v.state=w.short_name),h.includes("postal_code")&&(v.zip_code=w.long_name.replace(/\D/g,""))}),n(v)}))},[n]),e.jsxs("div",{className:"relative",children:[e.jsx(_r,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(fe,{ref:u,placeholder:"Busque seu endereço (Rua, Número...)",defaultValue:t,className:"pl-10 h-12",disabled:o})]})},xt=n=>{if(!n)return"";let t=n.replace(/\D/g,"");return t.length>11&&(t=t.slice(0,11)),t.length>0&&(t=`(${t}`),t.length>3&&(t=`${t.slice(0,3)}) ${t.slice(3)}`),t.length>10&&(t=`${t.slice(0,10)}-${t.slice(10)}`),t},gt=n=>{if(!n)return"";let t=n.replace(/\D/g,"");return t.length>14&&(t=t.slice(0,14)),t.length<=11?(t.length>9&&(t=`${t.slice(0,9)}-${t.slice(9)}`),t.length>6&&(t=`${t.slice(0,6)}.${t.slice(6)}`),t.length>3&&(t=`${t.slice(0,3)}.${t.slice(3)}`)):(t.length>12&&(t=`${t.slice(0,12)}-${t.slice(12)}`),t.length>8&&(t=`${t.slice(0,8)}/${t.slice(8)}`),t.length>5&&(t=`${t.slice(0,5)}.${t.slice(5)}`),t.length>2&&(t=`${t.slice(0,2)}.${t.slice(2)}`)),t},pn=jt({zip_code:O().min(1,"CEP é obrigatório."),street:O().min(1,"Rua é obrigatória."),number:O().min(1,"Número é obrigatório."),complement:O().optional(),neighborhood:O().min(1,"Bairro é obrigatório."),city:O().min(1,"Cidade é obrigatória.")}),hn=jt({name:O().min(1,"Nome é obrigatório."),phone:O().min(1,"Telefone é obrigatório.").transform(n=>n.replace(/\D/g,"")).refine(n=>n.length>=10,{message:"O telefone deve ter pelo menos 10 dígitos."}),cpf_cnpj:O().min(1,"CPF/CNPJ é obrigatório.").transform(n=>n.replace(/\D/g,"")).refine(n=>n.length===11||n.length===14,{message:"CPF deve ter 11 dígitos ou CNPJ 14 dígitos."}),delivery_option:hr(["delivery","pickup"],{required_error:"Selecione uma opção de entrega."}),notes:O().optional(),payment_method_id:O().min(1,"Selecione um método de pagamento."),change_for:O().optional()}),xn=async n=>{const{data:t,error:o}=await A.from("restaurants").select("id, name, address, phone, email, street, number, neighborhood, city, zip_code, latitude, longitude, delivery_enabled").eq("id",n).eq("is_active",!0).limit(1).single();if(o)throw new Error(`Erro ao buscar restaurante: ${o.message}`);if(!t)throw new Error("Restaurante não encontrado ou inativo.");return t},gn=async n=>{const{data:t,error:o}=await A.from("delivery_zones").select("*").eq("restaurant_id",n).eq("is_active",!0).order("max_distance_km",{ascending:!0});if(o)throw new Error(`Erro ao buscar zonas de entrega: ${o.message}`);return t},yn=async n=>{const{data:t,error:o}=await A.from("payment_methods").select("*").eq("restaurant_id",n).eq("is_active",!0).order("name",{ascending:!0});if(o)throw new Error(`Erro ao buscar métodos de pagamento: ${o.message}`);return t},jn=async n=>{const{data:t,error:o}=await A.from("customers").select("*").eq("user_id",n).limit(1).single();if(o&&o.code!=="PGRST116")throw new Error(o.message);return t||null},mo=()=>{var Ye,et,tt,rt,nt;const n=sr(),t=ar(),[o]=ir(),u=or(),{items:f,totalAmount:p,clearCart:v}=mr(),{data:c,isLoading:E}=pr(),[R]=i.useState((Ye=t.state)==null?void 0:Ye.restaurantId),w=o.get("restaurantId"),h=R||w,{data:D}=bt(h),[$,I]=i.useState(!1),[M,B]=i.useState(!1),[xe,ie]=i.useState(0),[ce,ge]=i.useState(null),[Re,re]=i.useState(!0),[Y,le]=i.useState(null),[Vt,Se]=i.useState(!1),[Lt,zt]=i.useState(null),[Be,qt]=i.useState(null),[U,ne]=i.useState(!1),[Bt,Ge]=i.useState(!1),[Ke,Pe]=i.useState(null),[$e,Ae]=i.useState(null),{data:y,isLoading:Gt,isError:Kt,error:Ue,refetch:Ut}=me({queryKey:["checkoutRestaurantData",h],queryFn:()=>xn(h),enabled:!!h,staleTime:1/0}),{data:L,isLoading:Qt}=me({queryKey:["checkoutDeliveryZones",h],queryFn:()=>gn(y.id),enabled:!!y,staleTime:1/0}),{data:G,isLoading:Xt}=me({queryKey:["checkoutPaymentMethods",h],queryFn:()=>yn(y.id),enabled:!!y,staleTime:1/0}),{data:g,isLoading:Qe,refetch:vn}=me({queryKey:["checkoutCustomerData",c==null?void 0:c.id],queryFn:()=>jn(c.id),enabled:!!c,staleTime:0}),Q=i.useMemo(()=>y!=null&&y.latitude&&(y!=null&&y.longitude)?[y.latitude,y.longitude]:null,[y]),Ht=i.useCallback(async(r,s,a,d,x,m,b)=>{const F=[30,45];if(y&&y.delivery_enabled===!1){const C=`${s}, ${a}, ${x}, ${d}, ${r}`;let N=null;if(m&&b?N={lat:m,lng:b}:N=await at(C),!N)return{coords:null,fee:0,time:null,isValid:!1};if(L&&L.length>0&&Q){const q=Oe([N.lat,N.lng],Q,L);if(q)return{coords:N,fee:0,time:[q.minTime,q.maxTime],isValid:!0}}return{coords:N,fee:0,time:F,isValid:!0}}if(!y||!Q)return{coords:null,fee:0,time:F,isValid:!0};const T=`${s}, ${a}, ${x}, ${d}, ${r}`;let _=null;if(m&&b?_={lat:m,lng:b}:_=await at(T),!_)return{coords:null,fee:0,time:null,isValid:!1};if(L&&L.length>0){const C=Oe([_.lat,_.lng],Q,L);return C?{coords:_,fee:C.fee,time:[C.minTime,C.maxTime],isValid:!0}:{coords:_,fee:0,time:null,isValid:!1}}else return{coords:null,fee:0,time:F,isValid:!0}},[y,Q,L]),l=it({resolver:ct(hn),defaultValues:{name:"",phone:"",cpf_cnpj:"",delivery_option:"delivery",notes:"",payment_method_id:"",change_for:""},mode:"onBlur"}),j=it({resolver:ct(pn),defaultValues:{zip_code:"",street:"",number:"",complement:"",neighborhood:"",city:""},mode:"onBlur"}),k=l.watch("delivery_option"),Jt=l.watch("payment_method_id"),oe=G==null?void 0:G.find(r=>r.id===Jt),Ie=(et=oe==null?void 0:oe.name)==null?void 0:et.includes("online"),de=(tt=oe==null?void 0:oe.name)==null?void 0:tt.includes("Dinheiro"),z=p+xe,S=j.watch(["zip_code","street","number","city","neighborhood","complement"]),Xe=i.useMemo(()=>{const[r,s,a,d,x,m]=S;return`${s}|${a}|${m||""}|${x}|${d}|${r}`},[S]);i.useEffect(()=>{if(ne(!1),le(null),ie(0),ge(null),re(!0),Ae(null),j.reset({zip_code:"",street:"",number:"",complement:"",neighborhood:"",city:""}),g){if(l.reset({...l.getValues(),name:g.name||"",phone:xt(g.phone||""),cpf_cnpj:gt(g.cpf_cnpj||""),change_for:""}),g.latitude&&g.longitude&&g.street&&g.number&&g.zip_code){const r=g.zip_code||"",s=g.street||"",a=g.number||"",d=g.neighborhood||"",x=g.city||"";j.reset({zip_code:r,street:s,number:a,complement:"",neighborhood:d,city:x});const m=`${s}|${a}||${d}|${x}|${r}`;if(Ae(m),Q&&L){const b=Oe([g.latitude,g.longitude],Q,L);b?(ie(b.fee),ge([b.minTime,b.maxTime]),re(!0),ne(!0),le([g.latitude,g.longitude])):(ie(0),re(!1),ne(!0),le([g.latitude,g.longitude]))}}}else if(c&&!Qe){const r=c.user_metadata;l.reset({...l.getValues(),name:r.full_name||"",phone:xt(r.phone||""),cpf_cnpj:gt(r.cpf_cnpj||""),change_for:""})}},[g,l,c,Qe,j,Q,L]),i.useEffect(()=>{k==="delivery"&&$e!==null&&Xe!==$e&&(ne(!1),ie(0),ge(null),re(!0),le(null))},[Xe,$e,k]);const ye=l.watch("change_for");i.useEffect(()=>{if(de&&ye&&ye.trim()!==""){const r=ye.replace(",","."),s=parseFloat(r);isNaN(s)?l.setError("change_for",{message:"O troco deve ser um número válido."}):s<z?l.setError("change_for",{message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z)}).`}):l.clearErrors("change_for")}else l.clearErrors("change_for")},[de,ye,z,l]);const je=Me({mutationFn:async r=>{var ot;console.log("=== INICIANDO SALVAMENTO DE ENDEREÇO ==="),console.log("Dados do endereço:",r),B(!0);const s=`${r.street}, ${r.number}${r.complement?` - ${r.complement}`:""}, ${r.neighborhood}, ${r.city}, ${r.zip_code}`;console.log("Endereço completo:",s),console.log("Iniciando geocodificação...");const a=await Ht(r.zip_code,r.street,r.number,r.city,r.neighborhood);if(B(!1),console.log("Resultado da geocodificação:",a),!a.isValid)throw console.error("Endereço inválido ou fora da área de entrega"),new Error((y==null?void 0:y.delivery_enabled)===!1?"O endereço está errado ou incompleto, revise todos os campos.":"Endereço fora da área de entrega.");if(!a.coords)throw new Error("Não foi possível obter as coordenadas para salvar o endereço.");const x=(ot=(await A.auth.getUser()).data.user)==null?void 0:ot.id,m=l.getValues("name"),b=l.getValues("phone"),F=l.getValues("cpf_cnpj"),T=b.replace(/\D/g,""),_=F.replace(/\D/g,"");if(console.log("=== VALIDAÇÃO DE CONTATO ==="),!m||T.length<10||!_||_.length!==11&&_.length!==14){const ee="Preencha Nome, Telefone (10+ dígitos) e CPF/CNPJ (11 ou 14 dígitos) nos Seus Dados antes de salvar o endereço.";throw console.error("ERRO DE VALIDAÇÃO:",ee),new Error(ee)}if(console.log("Validação de contato passou!"),!(g!=null&&g.id)&&!x)return{customer:{id:"anonymous",user_id:null,name:m,phone:T,email:null,address:s,created_at:"",updated_at:"",latitude:a.coords.lat,longitude:a.coords.lng,cpf_cnpj:_,street:r.street,number:r.number,neighborhood:r.neighborhood,city:r.city,zip_code:r.zip_code},feeResult:a};const C={name:m,phone:T,cpf_cnpj:_||null},N={user_id:(c==null?void 0:c.id)||null,...C,email:(c==null?void 0:c.email)||null,address:s,latitude:a.coords.lat,longitude:a.coords.lng,street:r.street,number:r.number,neighborhood:r.neighborhood,city:r.city,zip_code:r.zip_code},q="*, street, number, neighborhood, city, zip_code";let De;if(g!=null&&g.id){const{data:ee,error:ue}=await A.from("customers").update(N).eq("id",g.id).select(q).single();if(ue)throw ue;De=ee}else if(x){const{data:ee,error:ue}=await A.from("customers").insert(N).select(q).single();if(ue)throw ue;De=ee}else throw new Error("Não foi possível identificar o cliente para salvar.");return{customer:De,feeResult:a}},onSuccess:(r,s)=>{const{customer:a,feeResult:d}=r;(a==null?void 0:a.id)!=="anonymous"&&u.invalidateQueries({queryKey:["checkoutCustomerData"]}),ie(d.fee),ge(d.time),re(d.isValid),ne(!0),le([d.coords.lat,d.coords.lng]);const x=`${s.street}|${s.number}|${s.complement||""}|${s.neighborhood}|${s.city}|${s.zip_code}`;Ae(x),P.success("Endereço salvo e taxa de entrega calculada!")},onError:r=>{P.error(`Erro ao salvar endereço: ${r.message}`),re(!1),ne(!1)}}),Wt=r=>{l.trigger(["name","phone","cpf_cnpj"]).then(s=>{s?je.mutate(r):P.error("Preencha Nome, Telefone e CPF/CNPJ nos Seus Dados antes de salvar o endereço.")})},He=Me({mutationFn:async r=>{var F,T;(F=(await A.auth.getUser()).data.user)==null||F.id;const a=r.phone.replace(/\D/g,""),d=((T=r.cpf_cnpj)==null?void 0:T.replace(/\D/g,""))||null;if(!r.name||a.length<10||d&&d.length!==11&&d.length!==14)throw new Error("Dados de contato incompletos ou inválidos.");const x=k==="delivery"?`${S[1]}, ${S[2]}${S[5]?` - ${S[5]}`:""}, ${S[4]}, ${S[3]}, ${S[0]}`:null,m={user_id:(c==null?void 0:c.id)||null,name:r.name,phone:a,email:(c==null?void 0:c.email)||null,cpf_cnpj:d,address:x,latitude:Y?Y[0]:null,longitude:Y?Y[1]:null,street:j.getValues("street")||null,number:j.getValues("number")||null,neighborhood:j.getValues("neighborhood")||null,city:j.getValues("city")||null,zip_code:j.getValues("zip_code")||null};c||(m.email=null);const b="*, street, number, neighborhood, city, zip_code";if(c)if(g){const{data:_,error:C}=await A.from("customers").update(m).eq("id",g.id).select(b).single();if(C)throw C;return _}else{const{data:_,error:C}=await A.from("customers").insert(m).select(b).single();if(C)throw C;return _}else{const{data:_,error:C}=await A.from("customers").insert(m).select(b).single();if(C)throw C;return _}},onSuccess:()=>{u.invalidateQueries({queryKey:["checkoutCustomerData"]})},onError:r=>{P.error(`Erro ao salvar dados do cliente: ${r.message}`)}}),Je=Me({mutationFn:async({customerId:r,data:s})=>{if(!y)throw new Error("Dados do restaurante não disponíveis.");let a=null;if(de&&s.change_for&&s.change_for.trim()!==""){const N=s.change_for.replace(",","."),q=parseFloat(N);!isNaN(q)&&q>z&&(a=q)}let[d,x]=ce||[null,null];if((k==="delivery"||k==="pickup")&&(!d||!x)){const N=k==="pickup"?[15,30]:[30,45];d=N[0],x=N[1]}const m=k==="delivery"?`${S[1]}, ${S[2]}${S[5]?` - ${S[5]}`:""}, ${S[4]}, ${S[3]}, ${S[0]}`:null,b={restaurant_id:y.id,customer_id:r,status:Ie?"pending_payment":"pending",total_amount:z,delivery_fee:xe,delivery_address:m,notes:s.notes,payment_method_id:s.payment_method_id,change_for:a,min_delivery_time_minutes:d,max_delivery_time_minutes:x},{data:F,error:T}=await A.from("orders").insert(b).select("id").single();if(T)throw T;const _=f.map(N=>({order_id:F.id,product_id:N.product.id,quantity:parseFloat(N.quantity.toFixed(3)),unit_price:parseFloat(N.product.price.toFixed(2)),subtotal:parseFloat(N.subtotal.toFixed(2)),notes:N.notes})),{error:C}=await A.from("order_items").insert(_);if(C)throw C;return F.id},onSuccess:r=>{u.invalidateQueries({queryKey:["orders"]})},onError:r=>{P.error(`Erro ao criar pedido: ${r.message}`)}}),Zt=async r=>{if(de&&r.change_for&&r.change_for.trim()!==""){const d=r.change_for.replace(",","."),x=parseFloat(d);if(isNaN(x)){P.error("O troco deve ser um número válido.");return}if(x<z){l.setError("change_for",{type:"manual",message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z)}).`});return}}if(f.length===0){P.error("Seu carrinho está vazio."),n(`/menu/${h}`);return}if(k==="delivery"){if(!U){P.error("Você deve salvar e validar o endereço de entrega antes de finalizar o pedido.");return}if(!Re){P.error("O endereço de entrega está fora da área de cobertura.");return}}let s;try{s=(await He.mutateAsync(r)).id}catch(d){P.error(`Falha ao salvar cliente: ${d.message}`);return}let a;try{a=await Je.mutateAsync({customerId:s,data:r})}catch(d){P.error(`Falha ao criar pedido: ${d.message}`);return}Ie?await Yt(a,r):(v(),n(`/order-success/${a}`,{replace:!0}))},Yt=async(r,s)=>{if(!y)return;const a=window.location.origin+window.location.pathname,d=f.map(m=>({name:m.product.name,price:m.product.price,quantity:m.quantity})),x=P.loading("Preparando pagamento online...");try{const{data:m,error:b}=await A.functions.invoke("create-payment-preference",{body:{orderId:r,items:d,totalAmount:z,restaurantName:y.name,clientUrl:a,customerEmail:(c==null?void 0:c.email)||"cliente@anonimo.com",customerCpfCnpj:s.cpf_cnpj}});if(b)throw b;const{init_point:F}=m;zt(r),qt(F),Se(!0),P.dismiss(x)}catch(m){P.dismiss(x),P.error(`Erro no pagamento online: ${m.message}`),Se(!1)}},er=async()=>{await A.auth.signOut(),P.success("Você saiu da sua conta."),n("/auth",{replace:!0})},tr=(r,s,a)=>{s&&a?(Pe(r),Ge(!0)):(l.setValue("payment_method_id",r,{shouldValidate:!0}),Pe(null))},rr=()=>{Ke&&l.setValue("payment_method_id",Ke,{shouldValidate:!0}),Ge(!1),Pe(null)},nr=i.useCallback(r=>{j.setValue("street",r.street),j.setValue("neighborhood",r.neighborhood),j.setValue("city",r.city),j.setValue("zip_code",r.zip_code),j.setValue("number",r.number),P.info("Endereço encontrado! Verifique o número e clique em Salvar.")},[j]),We=i.useMemo(()=>{const[r,s,a,d,x,m]=S;return s&&a&&x&&d&&r?`${s}, ${a}${m?` - ${m}`:""} - ${x}, ${d}, ${r}`:""},[S]);if(!h)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(te,{variant:"destructive",className:"max-w-lg",children:[e.jsx(ft,{className:"h-4 w-4"}),e.jsx(se,{children:"Erro de Rastreamento"}),e.jsx(ae,{children:"Não foi possível identificar o restaurante para o qual o pedido está sendo feito. Por favor, volte ao menu."}),e.jsx(Fe,{to:"/",children:e.jsx(X,{className:"mt-3",variant:"secondary",size:"sm",children:"Voltar"})})]})});if(f.length===0)return i.useEffect(()=>{n(`/menu/${h}`)},[n,h]),e.jsx(st,{});if(Gt||Qt||Xt||E)return e.jsx(st,{});if(Kt||!y)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(te,{variant:"destructive",className:"max-w-lg",children:[e.jsx(ft,{className:"h-4 w-4"}),e.jsx(se,{children:"Erro Crítico"}),e.jsx(ae,{children:Ue instanceof Error?Ue.message:"Não foi possível carregar os dados do restaurante."}),e.jsxs(X,{onClick:()=>Ut(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(kr,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]})});const Ze=He.isPending||Je.isPending||je.isPending||M||k==="delivery"&&!U;return e.jsxs("div",{className:"min-h-screen bg-background py-4 sm:py-8 px-4 sm:px-8",children:[e.jsx(Nr,{isOpen:$,onClose:()=>I(!1),customer:g}),e.jsx(mn,{isOpen:Bt,onConfirm:rr}),Vt&&Be&&e.jsx(dn,{preferenceId:Lt,initPoint:Be,onClose:()=>Se(!1)}),e.jsxs("div",{className:"w-full lg:max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fe,{to:`/menu/${h}`,children:e.jsx(X,{variant:"ghost",size:"icon","aria-label":"Voltar ao Menu",children:e.jsx(Tr,{className:"h-6 w-6"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Finalizar Pedido"}),e.jsx("p",{className:"text-lg text-muted-foreground font-medium",children:y.name})]})]}),c&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(X,{variant:"outline",size:"sm",onClick:()=>I(!0),"aria-label":"Meu Perfil e Pedidos",children:[e.jsx(pt,{className:"h-4 w-4 mr-2"})," Perfil / Pedidos"]}),e.jsxs(X,{variant:"outline",size:"sm",onClick:er,children:[e.jsx(Cr,{className:"h-4 w-4 mr-1"})," Sair"]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(H,{children:[e.jsx(J,{children:e.jsxs(W,{className:"text-xl flex items-center gap-2",children:[e.jsx(pt,{className:"h-5 w-5 text-primary"})," Seus Dados"]})}),e.jsxs(Z,{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:c?`Logado como ${c.email}. ${g?"Perfil de cliente encontrado.":"Preencha os dados para criar seu perfil de cliente."}`:"Você está fazendo um pedido anônimo."})}),e.jsx(mt,{...l,children:e.jsx("form",{onSubmit:l.handleSubmit(Zt),id:"checkout-form",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"name",children:"Nome Completo *"}),e.jsx(fe,{id:"name",...l.register("name")}),l.formState.errors.name&&e.jsx("p",{className:"text-destructive text-sm",children:l.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"phone",children:"Telefone *"}),e.jsx(ve,{name:"phone",control:l.control,render:({field:r})=>e.jsx(wr,{id:"phone",...r})}),l.formState.errors.phone&&e.jsx("p",{className:"text-destructive text-sm",children:l.formState.errors.phone.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"cpf_cnpj",children:"CPF/CNPJ *"}),e.jsx(ve,{name:"cpf_cnpj",control:l.control,render:({field:r})=>e.jsx(Pr,{id:"cpf_cnpj",...r})}),l.formState.errors.cpf_cnpj&&e.jsx("p",{className:"text-destructive text-sm",children:l.formState.errors.cpf_cnpj.message})]})]})})})]})]}),e.jsxs(H,{children:[e.jsx(J,{children:e.jsxs(W,{className:"text-xl flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5 text-primary"})," Opção de Entrega"]})}),e.jsx(Z,{children:e.jsx(ve,{name:"delivery_option",control:l.control,render:({field:r})=>e.jsxs(Ve,{onValueChange:r.onChange,value:r.value,className:"grid grid-cols-2 gap-4",children:[e.jsxs(V,{htmlFor:"delivery",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer",children:[e.jsx(Ne,{value:"delivery",id:"delivery",className:"sr-only"}),e.jsx(we,{className:"mb-3 h-6 w-6"}),e.jsx("span",{translate:"no",children:"Entrega"})]}),e.jsxs(V,{htmlFor:"pickup",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer",children:[e.jsx(Ne,{value:"pickup",id:"pickup",className:"sr-only"}),e.jsx(Te,{className:"mb-3 h-6 w-6"}),e.jsx("span",{translate:"no",children:"Retirada no Local"})]})]})})})]}),k==="delivery"&&e.jsxs(H,{className:he(!U&&"border-destructive ring-2 ring-destructive/50"),children:[e.jsxs(J,{children:[e.jsxs(W,{className:"text-xl flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-primary"})," Endereço de Entrega",U&&e.jsx(Vr,{className:"h-5 w-5 text-green-500 ml-2"}),!U&&e.jsx(_e,{className:"h-5 w-5 text-destructive ml-2"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Preencha e salve o endereço para calcular a taxa de entrega."})]}),e.jsxs(Z,{className:"space-y-4",children:[y.delivery_enabled===!1&&e.jsxs(te,{variant:"default",className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 text-blue-700",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(se,{children:"Frete Grátis Ativo"}),e.jsx(ae,{children:"As taxas de entrega dinâmica estão desativadas. O frete será R$ 0,00."})]}),e.jsx(mt,{...j,children:e.jsxs("form",{onSubmit:j.handleSubmit(Wt),id:"address-form-inner",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(V,{htmlFor:"address-search",children:"Buscar Endereço"}),e.jsx(fn,{onAddressSelect:nr,disabled:M})]}),e.jsx("input",{type:"hidden",...j.register("zip_code")}),e.jsx("input",{type:"hidden",...j.register("street")}),e.jsx("input",{type:"hidden",...j.register("neighborhood")}),e.jsx("input",{type:"hidden",...j.register("city")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"number",children:"Número *"}),e.jsx(fe,{id:"number",...j.register("number"),placeholder:"Número da casa/apto"}),j.formState.errors.number&&e.jsx("p",{className:"text-destructive text-sm",children:j.formState.errors.number.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"complement",children:"Complemento (Opcional)"}),e.jsx(fe,{id:"complement",...j.register("complement"),placeholder:"Apto, Bloco, etc."})]})]}),j.watch("street")&&e.jsxs("div",{className:"bg-muted p-3 rounded text-sm",children:[e.jsx("p",{children:e.jsx("strong",{children:"Endereço selecionado:"})}),e.jsxs("p",{children:[j.watch("street"),", ",j.watch("neighborhood")]}),e.jsxs("p",{children:[j.watch("city")," - CEP: ",j.watch("zip_code")]})]}),e.jsxs(X,{type:"submit",className:"w-full h-10 text-base mt-4",disabled:je.isPending||M,children:[je.isPending||M?e.jsx(pe,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Lr,{className:"h-4 w-4 mr-2"}),"Salvar Endereço e Calcular Taxa"]})]})}),M&&e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 animate-spin"}),e.jsx(se,{children:"Calculando Taxa de Entrega..."})]}),U&&!M&&e.jsxs(e.Fragment,{children:[y.delivery_enabled!==!1&&!Re&&e.jsxs(te,{variant:"destructive",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx(se,{children:"Fora da Área de Entrega"}),e.jsx(ae,{children:"Seu endereço está fora da área de cobertura do restaurante."})]}),(y.delivery_enabled===!1||Re&&ce)&&e.jsxs(te,{variant:"default",className:"bg-green-50 dark:bg-green-900/20 border-green-200 text-green-700",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(se,{children:"Entrega Disponível"}),e.jsxs(ae,{children:["Taxa de entrega: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(xe),". Tempo estimado: ",ce?`${ce[0]} - ${ce[1]}`:"30 - 45"," minutos."]})]})]}),U&&Y&&We&&e.jsx("div",{className:"mt-6",children:e.jsx(un,{latitude:Y[0],longitude:Y[1],address:We})})]})]}),e.jsxs(H,{children:[e.jsx(J,{children:e.jsxs(W,{className:"text-xl flex items-center gap-2",children:[e.jsx(wt,{className:"h-5 w-5 text-primary"})," Método de Pagamento *"]})}),e.jsxs(Z,{children:[e.jsx(ve,{name:"payment_method_id",control:l.control,render:({field:r})=>e.jsx(Ve,{onValueChange:s=>{var m;const a=G==null?void 0:G.find(b=>b.id===s),d=(m=a==null?void 0:a.name)==null?void 0:m.includes("online"),x=!!D&&D.trim()!=="";tr(s,!!d,x)},value:r.value,className:"space-y-3",children:G==null?void 0:G.map(s=>{var m;const a=(m=s.name)==null?void 0:m.includes("online"),d=!!D&&D.trim()!=="",x=a&&!d;return e.jsx(V,{htmlFor:s.id,className:he("flex items-center justify-between rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer",x&&"opacity-50 cursor-not-allowed"),children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ne,{value:s.id,id:s.id,disabled:x}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",translate:"no",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description}),x&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:"Pagamento online indisponível no momento."})]})]})},s.id)})})}),l.formState.errors.payment_method_id&&e.jsx("p",{className:"text-destructive text-sm mt-2",children:l.formState.errors.payment_method_id.message})]})]}),de&&e.jsxs(H,{children:[e.jsx(J,{children:e.jsxs(W,{className:"text-xl flex items-center gap-2",children:[e.jsx(zr,{className:"h-5 w-5 text-primary"})," Troco"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"change_for",children:"Precisa de troco para quanto? (Opcional)"}),e.jsx(fe,{id:"change_for",type:"number",step:"0.01",placeholder:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z),...l.register("change_for")}),((rt=l.formState.errors.change_for)==null?void 0:rt.message)&&e.jsx("p",{className:"text-destructive text-sm",children:l.formState.errors.change_for.message}),((nt=l.formState.errors.change_for)==null?void 0:nt.type)==="manual"&&e.jsx("p",{className:"text-destructive text-sm",children:l.formState.errors.change_for.message})]})})]}),e.jsxs(H,{children:[e.jsx(J,{children:e.jsxs(W,{className:"text-xl flex items-center gap-2",children:[e.jsx(br,{className:"h-5 w-5 text-primary"})," Observações"]})}),e.jsx(Z,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"notes",children:"Notas para o restaurante (Opcional)"}),e.jsx(xr,{id:"notes",...l.register("notes"),rows:3,placeholder:"Ex: Entregar na portaria, sem pimenta, etc."})]})})]})]}),e.jsx("div",{className:"lg:col-span-1 space-y-6 sticky top-4 self-start",children:e.jsxs(H,{className:"shadow-lg",children:[e.jsx(J,{children:e.jsx(W,{className:"text-2xl",children:"Resumo"})}),e.jsxs(Z,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:f.map(r=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"truncate max-w-[70%]",children:[r.quantity,"x ",r.product.name]}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.subtotal)})]},r.product.id))}),e.jsx(lt,{}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(p)})]}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(xe)})]})]}),e.jsx(lt,{}),e.jsxs("div",{className:"flex justify-between font-bold text-xl",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z)})]}),e.jsx(X,{type:"submit",form:"checkout-form",className:"w-full h-12 text-lg",disabled:Ze,children:Ze?e.jsx(pe,{className:"h-5 w-5 animate-spin mr-2"}):Ie?"Pagar e Finalizar":"Confirmar Pedido"}),k==="delivery"&&!U&&e.jsxs(te,{variant:"destructive",className:"mt-3",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx(ae,{className:"text-xs",children:"Salve o endereço acima para continuar."})]}),e.jsx(Fe,{to:`/menu/${y.id}`,className:"block text-center text-sm text-muted-foreground hover:underline mt-2",children:"Voltar ao Cardápio"})]})]})})]})]})]})};export{mo as default};
