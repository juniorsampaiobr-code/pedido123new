import{b as fe,j as e,u as os,c as De}from"./tanstack-d4AvmB45.js";import{r as a,u as as,h as is,j as cs,L as Me}from"./vendor-CnEXr6gt.js";import{s as $}from"./client-D5i5GwB9.js";import{c as ls,d as wt,e as ze,P as Re,f as Oe,g as ds,h as ms,i as us,a as ge,u as R,L as xe,p as ps,b as at}from"./index-C9CJWst-.js";import{L as fs,g as it,c as ct}from"./location-LTC1bLOd.js";import{u as hs}from"./use-auth-status-b07NBuTX.js";import{o as jt,s as F,e as xs,u as lt,C as _e,t as dt}from"./types-DKlirIXB.js";import{B as U}from"./button-aepKgusd.js";import{C as Z,b as Q,c as X,a as H}from"./card-DZjv_oBi.js";import{I as he,L}from"./label-BmeQM6A0.js";import{T as gs}from"./textarea-D9c7teou.js";import{c as bt,R as ys,I as ws}from"./index-D97KLKqs.js";import{u as js}from"./index-DrlxvCXN.js";import{u as bs}from"./index-KNP7Yozt.js";import{S as mt}from"./separator-BqGeGf81.js";import{A as ne,a as ue,b as pe}from"./alert-DOtyZxX0.js";import{P as vs,M as _s}from"./PhoneInput-BaC5lFPB.js";import{S as Ns,C as Cs,L as Es}from"./CustomerProfileModal-CX_n03l8.js";import{D as ut,a as pt,b as Rs,c as $s,d as Ss}from"./dialog-DrRCrdHh.js";import{C as vt}from"./credit-card-B5zrAzbP.js";import{C as Ps}from"./CpfCnpjInput-ZdEtVcc3.js";import{M as Te}from"./map-pin-XvYUMiLj.js";import{A as As,a as Is,b as ks,c as Ds,d as Ms,e as Fs,g as Vs}from"./alert-dialog-BDwwzKLD.js";import{C as Ce}from"./circle-alert-BQsJSYk8.js";import{F as ft}from"./form-CHviAexz.js";import{T as ht}from"./terminal-S3z7FXBI.js";import{R as Os}from"./pt-BR-C1oC0vMD.js";import{A as Ts}from"./arrow-left-BSm8l3O1.js";import{U as xt}from"./user-B2vPTNEw.js";import{T as Fe}from"./truck-CJPy_k8p.js";import{C as Ls}from"./circle-check-big-BbBl1u_v.js";import{S as zs}from"./save-DZLvzVG-.js";import{D as qs}from"./dollar-sign-BJPqmhPV.js";import"./supabase-BZV_3FV3.js";import"./skeleton-B9FNwO0v.js";import"./store-Bo594wL2.js";import"./package-COiAKipq.js";import"./check-CB4oFk3B.js";import"./circle-x-C7r-YYCe.js";import"./euro-BleNkwdQ.js";import"./format-BeKxgCCE.js";import"./index-z8c_GyBc.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=ls("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Gs=async r=>{const{data:t,error:n}=await $.from("payment_settings").select("mercado_pago_public_key").eq("restaurant_id",r).limit(1).single();if(n&&n.code!=="PGRST116")throw new Error(`Error fetching payment settings: ${n.message}`);return(t==null?void 0:t.mercado_pago_public_key)||null},_t=r=>fe({queryKey:["mercadoPagoPublicKey",r],queryFn:()=>Gs(r),enabled:!!r,staleTime:1e3*60*60*24});var qe="Radio",[Ks,Nt]=wt(qe),[Us,Zs]=Ks(qe),Ct=a.forwardRef((r,t)=>{const{__scopeRadio:n,name:m,checked:g=!1,required:h,disabled:c,value:d="on",onCheck:A,form:I,...N}=r,[i,v]=a.useState(null),b=ze(t,M=>v(M)),P=a.useRef(!1),k=i?I||!!i.closest("form"):!0;return e.jsxs(Us,{scope:n,checked:g,disabled:c,children:[e.jsx(Re.button,{type:"button",role:"radio","aria-checked":g,"data-state":St(g),"data-disabled":c?"":void 0,disabled:c,value:d,...N,ref:b,onClick:Oe(r.onClick,M=>{g||A==null||A(),k&&(P.current=M.isPropagationStopped(),P.current||M.stopPropagation())})}),k&&e.jsx($t,{control:i,bubbles:!P.current,name:m,value:d,checked:g,required:h,disabled:c,form:I,style:{transform:"translateX(-100%)"}})]})});Ct.displayName=qe;var Et="RadioIndicator",Rt=a.forwardRef((r,t)=>{const{__scopeRadio:n,forceMount:m,...g}=r,h=Zs(Et,n);return e.jsx(ds,{present:m||h.checked,children:e.jsx(Re.span,{"data-state":St(h.checked),"data-disabled":h.disabled?"":void 0,...g,ref:t})})});Rt.displayName=Et;var Qs="RadioBubbleInput",$t=a.forwardRef(({__scopeRadio:r,control:t,checked:n,bubbles:m=!0,...g},h)=>{const c=a.useRef(null),d=ze(c,h),A=bs(n),I=ms(t);return a.useEffect(()=>{const N=c.current;if(!N)return;const i=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(i,"checked").set;if(A!==n&&b){const P=new Event("click",{bubbles:m});b.call(N,n),N.dispatchEvent(P)}},[A,n,m]),e.jsx(Re.input,{type:"radio","aria-hidden":!0,defaultChecked:n,...g,tabIndex:-1,ref:d,style:{...g.style,...I,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});$t.displayName=Qs;function St(r){return r?"checked":"unchecked"}var Xs=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],$e="RadioGroup",[Hs,mn]=wt($e,[bt,Nt]),Pt=bt(),At=Nt(),[Ws,Js]=Hs($e),It=a.forwardRef((r,t)=>{const{__scopeRadioGroup:n,name:m,defaultValue:g,value:h,required:c=!1,disabled:d=!1,orientation:A,dir:I,loop:N=!0,onValueChange:i,...v}=r,b=Pt(n),P=js(I),[k,M]=us({prop:h,defaultProp:g??null,onChange:i,caller:$e});return e.jsx(Ws,{scope:n,name:m,required:c,disabled:d,value:k,onValueChange:M,children:e.jsx(ys,{asChild:!0,...b,orientation:A,dir:P,loop:N,children:e.jsx(Re.div,{role:"radiogroup","aria-required":c,"aria-orientation":A,"data-disabled":d?"":void 0,dir:P,...v,ref:t})})})});It.displayName=$e;var kt="RadioGroupItem",Dt=a.forwardRef((r,t)=>{const{__scopeRadioGroup:n,disabled:m,...g}=r,h=Js(kt,n),c=h.disabled||m,d=Pt(n),A=At(n),I=a.useRef(null),N=ze(t,I),i=h.value===g.value,v=a.useRef(!1);return a.useEffect(()=>{const b=k=>{Xs.includes(k.key)&&(v.current=!0)},P=()=>v.current=!1;return document.addEventListener("keydown",b),document.addEventListener("keyup",P),()=>{document.removeEventListener("keydown",b),document.removeEventListener("keyup",P)}},[]),e.jsx(ws,{asChild:!0,...d,focusable:!c,active:i,children:e.jsx(Ct,{disabled:c,required:h.required,checked:i,...A,...g,name:h.name,ref:N,onCheck:()=>h.onValueChange(g.value),onKeyDown:Oe(b=>{b.key==="Enter"&&b.preventDefault()}),onFocus:Oe(g.onFocus,()=>{var b;v.current&&((b=I.current)==null||b.click())})})})});Dt.displayName=kt;var Ys="RadioGroupIndicator",Mt=a.forwardRef((r,t)=>{const{__scopeRadioGroup:n,...m}=r,g=At(n);return e.jsx(Rt,{...g,...m,ref:t})});Mt.displayName=Ys;var Ft=It,Vt=Dt,er=Mt;const Le=a.forwardRef(({className:r,...t},n)=>e.jsx(Ft,{className:ge("grid gap-2",r),...t,ref:n}));Le.displayName=Ft.displayName;const Ee=a.forwardRef(({className:r,...t},n)=>e.jsx(Vt,{ref:n,className:ge("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...t,children:e.jsx(er,{className:"flex items-center justify-center",children:e.jsx(Bs,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Ee.displayName=Vt.displayName;var Be={};Object.defineProperty(Be,"__esModule",{value:!0});var Ot=Be.loadMercadoPago=void 0;const Tt="https://sdk.mercadopago.com/js/v2",tr=/^https:\/\/sdk\.mercadopago\.com\/js\/v2\/?(\?.*)?$/,gt="MercadoPago has already been initialized in your window, please remove the duplicate import",sr="MercadoPago.js not available",rr="Failed to load MercadoPago.js",nr=()=>{for(var r=document.querySelectorAll(`script[src^="${Tt}"`),t=0;t<r.length;t++){var n=r[t];if(tr.test(n.src))return n}return null},or=()=>{const r=document.createElement("script");r.src=Tt;const t=document.head||document.body;if(!t)throw new Error("Expected document.body or document.head not to be null. MercadoPago requires a <body> or a <head> element, please add on your project.");return t.appendChild(r),r};let Ne=null;const ar=()=>(Ne!==null||(Ne=new Promise((r,t)=>{if(typeof window>"u"){r(null);return}if(window.MercadoPago){console.warn(gt),r(window.MercadoPago);return}try{let n=nr();n?console.warn(gt):n||(n=or()),n.addEventListener("load",()=>{window.MercadoPago?r(window.MercadoPago):t(new Error(sr))}),n.addEventListener("error",()=>{t(new Error(rr))})}catch(n){t(n);return}})),Ne);Ot=Be.loadMercadoPago=ar;var ir=function(r,t,n,m){function g(h){return h instanceof n?h:new n(function(c){c(h)})}return new(n||(n=Promise))(function(h,c){function d(N){try{I(m.next(N))}catch(i){c(i)}}function A(N){try{I(m.throw(N))}catch(i){c(i)}}function I(N){N.done?h(N.value):g(N.value).then(d,A)}I((m=m.apply(r,t||[])).next())})};class G{static getInstance(){return ir(this,void 0,void 0,function*(){if(this.publicKey)return this.loadedInstanceMercadoPago||(yield Ot(),this.loadedInstanceMercadoPago=!0),this.instanceMercadoPago||(this.instanceMercadoPago=new window.MercadoPago(this.publicKey,this.options)),this.instanceMercadoPago;console.error("Expected the PUBLIC_KEY to render the MercadoPago SDK React")})}}G.publicKey=null;G.options={};G.instanceMercadoPago=void 0;G.loadedInstanceMercadoPago=!1;function cr(r,t){return Object.keys(r).length===Object.keys(t).length&&Object.keys(r).every(m=>Object.prototype.hasOwnProperty.call(t,m)&&r[m]===t[m])}const lr=(r,t)=>{const n=Object.assign(Object.assign({},t),{frontEndStack:"react"}),m=!cr(G.options,n);(r!==G.publicKey||m)&&(G.publicKey=r,G.options=n,G.instanceMercadoPago=void 0)},dr=({preferenceId:r,initPoint:t,onClose:n})=>{const{data:m,isLoading:g}=_t();return a.useEffect(()=>{if(m)try{lr(m,{locale:"pt-BR"})}catch(h){console.error("Erro ao inicializar Mercado Pago:",h),R.error("Erro ao carregar o SDK do Mercado Pago."),n();return}t&&(console.log("Redirecionando para o Mercado Pago:",t),window.location.href=t)},[m,n,t]),g||!m?e.jsx(ut,{open:!0,onOpenChange:n,children:e.jsx(pt,{className:"sm:max-w-[425px]",children:e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsx(xe,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{children:"Carregando configurações de pagamento..."})]})})}):e.jsx(ut,{open:!0,onOpenChange:n,children:e.jsxs(pt,{className:"sm:max-w-[425px]",children:[e.jsxs(Rs,{children:[e.jsxs($s,{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"h-5 w-5 text-primary"}),"Redirecionando para Pagamento"]}),e.jsx(Ss,{children:"Você está sendo redirecionado para o checkout seguro do Mercado Pago."})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(xe,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aguarde..."})]}),e.jsx(U,{variant:"outline",onClick:n,children:"Cancelar e Voltar"})]})})},mr=({latitude:r,longitude:t,address:n,className:m})=>{const g=a.useMemo(()=>[r,t],[r,t]),h=a.useMemo(()=>[r,t],[r,t]);return e.jsxs(Z,{className:ge("w-full",m),children:[e.jsxs(Q,{children:[e.jsxs(X,{className:"text-lg flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-primary"}),"Sua Localização"]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:n})]}),e.jsx(H,{className:"p-0",children:e.jsx("div",{className:"h-64 w-full rounded-b-lg overflow-hidden",children:e.jsx(fs,{center:h,markerPosition:g,onMarkerDragEnd:()=>{},zoom:16})})})]})},ur=({isOpen:r,onConfirm:t})=>e.jsx(As,{open:r,children:e.jsxs(Is,{children:[e.jsxs(ks,{children:[e.jsxs(Ds,{className:"flex items-center gap-2 text-primary",children:[e.jsx(Ce,{className:"h-6 w-6"}),"Atenção ao Pagamento Online!"]}),e.jsxs(Ms,{children:["Você escolheu o pagamento online (Pix ou Cartão).",e.jsx("br",{}),e.jsx("br",{}),"Ao prosseguir, você será redirecionado para o checkout seguro do Mercado Pago.",e.jsx("br",{}),e.jsx("br",{}),'**IMPORTANTE:** Se você escolher **PIX**, após o pagamento, você pode precisar clicar no botão **"Voltar ao site"** na tela do Mercado Pago para que seu pedido seja finalizado e rastreado corretamente.']})]}),e.jsx(Fs,{children:e.jsx(Vs,{onClick:t,className:"w-full",children:"Entendi e Continuar"})})]})}),pr=({onAddressSelect:r,defaultValue:t,disabled:n})=>{const m=a.useRef(null),g=a.useRef(null);return a.useEffect(()=>{!m.current||!window.google||!window.google.maps||!window.google.maps.places||(g.current=new window.google.maps.places.Autocomplete(m.current,{componentRestrictions:{country:"br"},fields:["address_components","geometry","formatted_address"],types:["address"]}),g.current.addListener("place_changed",()=>{var A,I,N;const h=(A=g.current)==null?void 0:A.getPlace();if(!h||!h.address_components||!h.geometry)return;const c={street:"",number:"",neighborhood:"",city:"",state:"",zip_code:"",latitude:((I=h.geometry.location)==null?void 0:I.lat())||0,longitude:((N=h.geometry.location)==null?void 0:N.lng())||0},d=["sublocality_level_1","neighborhood","sublocality","sublocality_level_2","sublocality_level_3"];if(h.address_components.forEach(i=>{const v=i.types;v.includes("route")&&(c.street=i.long_name),v.includes("street_number")&&(c.number=i.long_name);for(const b of d)if(v.includes(b)&&!c.neighborhood){c.neighborhood=i.long_name;break}(v.includes("administrative_area_level_2")||v.includes("locality"))&&(c.city=i.long_name),v.includes("administrative_area_level_1")&&(c.state=i.short_name),v.includes("postal_code")&&(c.zip_code=i.long_name.replace(/\D/g,""))}),!c.neighborhood||c.neighborhood===c.street){const i=h.formatted_address||"";console.log("[AddressAutocomplete] Iniciando extração forçada de bairro do texto:",i);const v=i.match(/ - ([^,]+)/);if(v&&v[1]){const b=v[1].trim(),P=/^\d{5}-\d{3}$/.test(b)||/^\d{8}$/.test(b),k=/^[A-Z]{2}$/.test(b),M=/^\d+$/.test(b);!P&&!k&&!M&&(c.neighborhood=b)}if(!c.neighborhood||c.neighborhood===c.street){const P=i.split(",")[0];if(P.includes(" - ")){const k=P.split(" - "),M=k[k.length-1].trim(),Y=/^\d{5}-\d{3}$/.test(M)||/^\d{8}$/.test(M),ee=/^[A-Z]{2}$/.test(M);!Y&&!ee&&!/^\d+$/.test(M)&&(c.neighborhood=M)}}if(!c.neighborhood||c.neighborhood===c.street){const b=i.split(",");b.length>=3&&(c.neighborhood=b[2].trim())}c.neighborhood===c.street&&(c.neighborhood=""),console.log("[AddressAutocomplete] Resultado final da extração de bairro:",c.neighborhood)}r(c)}))},[r]),e.jsxs("div",{className:"relative",children:[e.jsx(Ns,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(he,{ref:m,placeholder:"Busque seu endereço (Rua, Número...)",defaultValue:t,className:"pl-10 h-12",disabled:n})]})},yt=r=>{if(!r)return"";let t=r.replace(/\D/g,"");return t.length>11&&(t=t.slice(0,11)),t.length>0&&(t=`(${t}`),t.length>3&&(t=`${t.slice(0,3)}) ${t.slice(3)}`),t.length>10&&(t=`${t.slice(0,10)}-${t.slice(10)}`),t},Ve=r=>{if(!r)return"";let t=r.replace(/\D/g,"");return t.length>14&&(t=t.slice(0,14)),t.length<=11?(t.length>9&&(t=`${t.slice(0,9)}-${t.slice(9)}`),t.length>6&&(t=`${t.slice(0,6)}.${t.slice(6)}`),t.length>3&&(t=`${t.slice(0,3)}.${t.slice(3)}`)):(t.length>12&&(t=`${t.slice(0,12)}-${t.slice(12)}`),t.length>8&&(t=`${t.slice(0,8)}/${t.slice(8)}`),t.length>5&&(t=`${t.slice(0,5)}.${t.slice(5)}`),t.length>2&&(t=`${t.slice(0,2)}.${t.slice(2)}`)),t},fr=jt({zip_code:F().min(1,"CEP é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length===8,{message:"O CEP deve ter 8 dígitos."}),street:F().min(1,"Rua é obrigatória."),number:F().min(1,"Número é obrigatório."),complement:F().optional(),neighborhood:F().min(1,"Bairro é obrigatório."),city:F().min(1,"Cidade é obrigatória."),state:F().min(1,"Estado é obrigatório.")}),hr=jt({name:F().min(1,"Nome é obrigatório."),phone:F().min(1,"Telefone é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length>=10,{message:"O telefone deve ter pelo menos 10 dígitos."}),cpf_cnpj:F().min(1,"CPF/CNPJ é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length===11||r.length===14,{message:"CPF deve ter 11 dígitos ou CNPJ 14 dígitos."}),delivery_option:xs(["delivery","pickup"],{required_error:"Selecione uma opção de entrega."}),notes:F().optional(),payment_method_id:F().min(1,"Selecione um método de pagamento."),change_for:F().optional()}),xr=async r=>{const{data:t,error:n}=await $.from("restaurants").select("id, name, address, phone, email, street, number, neighborhood, city, zip_code, latitude, longitude, delivery_enabled").eq("id",r).eq("is_active",!0).limit(1).single();if(n)throw new Error(`Erro ao buscar restaurante: ${n.message}`);if(!t)throw new Error("Restaurante não encontrado ou inativo.");return t},gr=async r=>{const{data:t,error:n}=await $.from("delivery_zones").select("*").eq("restaurant_id",r).eq("is_active",!0).order("max_distance_km",{ascending:!0});if(n)throw new Error(`Erro ao buscar zonas de entrega: ${n.message}`);return t},yr=async r=>{const{data:t,error:n}=await $.from("payment_methods").select("*").eq("restaurant_id",r).eq("is_active",!0).order("name",{ascending:!0});if(n)throw new Error(`Erro ao buscar métodos de pagamento: ${n.message}`);return t},wr=async r=>{const{data:t,error:n}=await $.from("customers").select("*, complement, state").eq("user_id",r).limit(1).single();if(n&&n.code!=="PGRST116")throw new Error(n.message);return t||null},un=()=>{var et,tt,st,rt,nt;const r=as(),t=is(),[n]=cs(),m=os(),{items:g,totalAmount:h,clearCart:c}=ps(),{data:d,isLoading:A}=hs(),[I]=a.useState((et=t.state)==null?void 0:et.restaurantId),N=n.get("restaurantId"),i=I||N,{data:v}=_t(i),[b,P]=a.useState(!1),[k,M]=a.useState(!1),[Y,ee]=a.useState(0),[oe,ye]=a.useState(null),[Se,ae]=a.useState(!0),[W,ie]=a.useState(null),[Lt,Pe]=a.useState(!1),[zt,qt]=a.useState(null),[Ge,Bt]=a.useState(null),[K,te]=a.useState(!1),[Gt,Ke]=a.useState(!1),[Ue,Ae]=a.useState(null),[Ie,ce]=a.useState(null),se=a.useRef(null),{data:j,isLoading:Kt,isError:Ut,error:Ze,refetch:Zt}=fe({queryKey:["checkoutRestaurantData",i],queryFn:()=>xr(i),enabled:!!i,staleTime:1e3*60*5}),{data:J,isLoading:Qt}=fe({queryKey:["checkoutDeliveryZones",i],queryFn:()=>gr(j.id),enabled:!!j,staleTime:1e3*60*5}),{data:B,isLoading:Xt}=fe({queryKey:["checkoutPaymentMethods",i],queryFn:()=>yr(j.id),enabled:!!j,staleTime:1/0}),{data:y,isLoading:Qe,refetch:jr}=fe({queryKey:["checkoutCustomerData",d==null?void 0:d.id],queryFn:()=>wr(d.id),enabled:!!d,staleTime:0}),le=a.useMemo(()=>j!=null&&j.latitude&&(j!=null&&j.longitude)?[j.latitude,j.longitude]:null,[j]);a.useEffect(()=>{const s=async()=>{document.hidden?(console.log("Página oculta. Iniciando timer de expiração de 20 minutos..."),se.current=setTimeout(async()=>{console.log("Timer expirado. Deslogando usuário..."),await $.auth.signOut(),R.error("Sessão expirada.",{description:"Você ficou fora da página de checkout por mais de 20 minutos. Por favor, identifique-se novamente.",duration:6e3}),r("/auth",{state:{from:"/checkout",restaurantId:i},replace:!0})},12e5)):(console.log("Página visível. Cancelando timer de expiração."),se.current&&(clearTimeout(se.current),se.current=null))};return document.addEventListener("visibilitychange",s),()=>{document.removeEventListener("visibilitychange",s),se.current&&clearTimeout(se.current)}},[r,i]);const Ht=a.useCallback(async(s,o,p,f,x,w,_,S)=>{const O=[30,45];if(j&&j.delivery_enabled===!1){const C=`${o}, ${p}, ${x}, ${f}, ${w}, ${s}`;let E=null;if(_&&S?E={lat:_,lng:S}:E=await it(C),!E)return{coords:null,fee:0,time:null,isValid:!1};if(J&&J.length>0&&le){const T=ct([E.lat,E.lng],le,J);if(T)return{coords:E,fee:0,time:[T.minTime,T.maxTime],isValid:!0}}return{coords:E,fee:0,time:O,isValid:!0}}if(!j||!le)return{coords:null,fee:0,time:O,isValid:!0};const q=`${o}, ${p}, ${x}, ${f}, ${w}, ${s}`;let D=null;if(_&&S?D={lat:_,lng:S}:D=await it(q),!D)return{coords:null,fee:0,time:null,isValid:!1};if(J&&J.length>0){const C=ct([D.lat,D.lng],le,J);return C?{coords:D,fee:C.fee,time:[C.minTime,C.maxTime],isValid:!0}:{coords:D,fee:0,time:null,isValid:!1}}else return{coords:D,fee:0,time:O,isValid:!0}},[j,le,J]),u=lt({resolver:dt(hr),defaultValues:{name:"",phone:"",cpf_cnpj:"",delivery_option:"delivery",notes:"",payment_method_id:"",change_for:""},mode:"onBlur"}),l=lt({resolver:dt(fr),defaultValues:{zip_code:"",street:"",number:"",complement:"",neighborhood:"",city:"",state:""},mode:"onBlur"});a.useEffect(()=>{l.reset({zip_code:"",street:"",number:"",complement:"",neighborhood:"",city:"",state:""}),te(!1),ie(null),ce(null),ee(0),ye(null),ae(!0)},[]);const V=u.watch("delivery_option"),Wt=u.watch("payment_method_id"),re=B==null?void 0:B.find(s=>s.id===Wt),ke=(tt=re==null?void 0:re.name)==null?void 0:tt.includes("online"),de=(st=re==null?void 0:re.name)==null?void 0:st.includes("Dinheiro"),z=h+Y,we=l.watch(["zip_code","street","number","city","neighborhood","complement","state"]),Xe=a.useMemo(()=>{const[s,o,p,f,x,w,_]=we;return`${o}|${p}|${w||""}|${x}|${f}|${s}|${_}`},[we]);a.useEffect(()=>{if(!i)return;const s=$.channel("delivery-zones-changes").on("postgres_changes",{event:"*",schema:"public",table:"delivery_zones",filter:`restaurant_id=eq.${i}`},()=>{console.log("[Realtime] Zonas de entrega atualizadas. Invalidando query..."),m.invalidateQueries({queryKey:["checkoutDeliveryZones",i]}),R.info("As taxas de entrega foram atualizadas.",{duration:3e3})}).subscribe(),o=$.channel("restaurant-settings-changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"restaurants",filter:`id=eq.${i}`},()=>{console.log("[Realtime] Configurações do restaurante atualizadas. Invalidando query..."),m.invalidateQueries({queryKey:["checkoutRestaurantData",i]}),R.info("As configurações da loja foram atualizadas.",{duration:3e3})}).subscribe();return()=>{$.removeChannel(s),$.removeChannel(o)}},[i,m]),a.useEffect(()=>{if(y){if(u.reset({...u.getValues(),name:y.name||"",phone:yt(y.phone||""),cpf_cnpj:Ve(y.cpf_cnpj||""),change_for:""}),y.street&&y.zip_code&&(l.reset({zip_code:y.zip_code,street:y.street,number:y.number||"",complement:y.complement||"",neighborhood:y.neighborhood||"",city:y.city||"",state:y.state||""}),y.latitude&&y.longitude)){ie([Number(y.latitude),Number(y.longitude)]),te(!0);const s=`${y.street}|${y.number}|${y.complement||""}|${y.neighborhood}|${y.city}|${y.zip_code}|${y.state}`;ce(s)}}else if(d&&!Qe){const s=d.user_metadata;u.reset({...u.getValues(),name:s.full_name||"",phone:yt(s.phone||""),cpf_cnpj:Ve(s.cpf_cnpj||""),change_for:""})}},[y,d,Qe,u,l]),a.useEffect(()=>{V==="delivery"&&Ie!==null&&Xe!==Ie&&(te(!1),ee(0),ye(null),ae(!0),ie(null),ce(null))},[Xe,Ie,V]);const je=u.watch("change_for");a.useEffect(()=>{if(de&&je&&je.trim()!==""){const s=je.replace(",","."),o=parseFloat(s);isNaN(o)?u.setError("change_for",{message:"O troco deve ser um número válido."}):o<z?u.setError("change_for",{message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z)}).`}):u.clearErrors("change_for")}else u.clearErrors("change_for")},[de,je,z,u]);const be=De({mutationFn:async s=>{var ot;M(!0);const o=`${s.street}, ${s.number}${s.complement?` - ${s.complement}`:""}, ${s.neighborhood}, ${s.city}, ${s.state}, ${s.zip_code}`,p=await Ht(s.zip_code,s.street,s.number,s.city,s.neighborhood,s.state);if(M(!1),!p.isValid)throw new Error((j==null?void 0:j.delivery_enabled)===!1?"O endereço está errado ou incompleto, revise todos os campos.":"Endereço fora da área de entrega.");if(!p.coords)throw new Error("Não foi possível obter as coordenadas para salvar o endereço.");const f=u.getValues("name"),x=u.getValues("phone"),w=u.getValues("cpf_cnpj"),_=x.replace(/\D/g,""),S=w.replace(/\D/g,"")||null;if(!f||_.length<10||!S||S.length!==11&&S.length!==14)throw new Error("Preencha Nome, Telefone (10+ dígitos) e CPF/CNPJ (11 ou 14 dígitos) nos Seus Dados antes de salvar o endereço.");const q=(ot=(await $.auth.getUser()).data.user)==null?void 0:ot.id;if(!(y!=null&&y.id)&&!q)return{customer:{id:"anonymous",user_id:null,name:f,phone:_,email:null,address:o,created_at:"",updated_at:"",latitude:p.coords.lat,longitude:p.coords.lng,cpf_cnpj:S,street:s.street,number:s.number,neighborhood:s.neighborhood,city:s.city,zip_code:s.zip_code,complement:s.complement||null,state:s.state},feeResult:p};const D={name:f,phone:_,cpf_cnpj:S},C={user_id:(d==null?void 0:d.id)||null,...D,email:(d==null?void 0:d.email)||null,address:o,latitude:p.coords.lat,longitude:p.coords.lng,street:s.street,number:s.number,neighborhood:s.neighborhood,city:s.city,zip_code:s.zip_code,complement:s.complement||null,state:s.state},E="*, street, number, neighborhood, city, zip_code, complement, state";let T;if(y!=null&&y.id){const{data:ve,error:me}=await $.from("customers").update(C).eq("id",y.id).select(E).single();if(me)throw me;T=ve}else if(q){const{data:ve,error:me}=await $.from("customers").insert(C).select(E).single();if(me)throw me;T=ve}else throw new Error("Não foi possível identificar o cliente para salvar.");return{customer:T,feeResult:p}},onSuccess:(s,o)=>{const{customer:p,feeResult:f}=s;(p==null?void 0:p.id)!=="anonymous"&&m.invalidateQueries({queryKey:["checkoutCustomerData"]}),ee(f.fee),ye(f.time),ae(f.isValid),te(!0),ie([f.coords.lat,f.coords.lng]);const x=`${o.street}|${o.number}|${o.complement||""}|${o.neighborhood}|${o.city}|${o.zip_code}|${o.state}`;ce(x),R.success("Endereço salvo e taxa de entrega calculada!")},onError:s=>{R.error(`Erro ao salvar endereço: ${s.message}`),ae(!1),te(!1)}}),Jt=s=>{be.mutate(s)},He=De({mutationFn:async s=>{var O,q;if(!j)throw new Error("Dados do restaurante não disponíveis.");(O=(await $.auth.getUser()).data.user)==null||O.id;const p=s.phone.replace(/\D/g,""),f=((q=s.cpf_cnpj)==null?void 0:q.replace(/\D/g,""))||null;if(!s.name||p.length<10||f&&f.length!==11&&f.length!==14)throw new Error("Dados de contato incompletos ou inválidos.");const x=l.getValues(),w=V==="delivery"?`${x.street}, ${x.number}${x.complement?` - ${x.complement}`:""}, ${x.neighborhood}, ${x.city}, ${x.state}, ${x.zip_code}`:null,_={user_id:(d==null?void 0:d.id)||null,name:s.name,phone:p,email:(d==null?void 0:d.email)||null,cpf_cnpj:f,address:w,latitude:W?W[0]:null,longitude:W?W[1]:null,street:l.getValues("street")||null,number:l.getValues("number")||null,neighborhood:l.getValues("neighborhood")||null,city:l.getValues("city")||null,zip_code:l.getValues("zip_code")||null,complement:l.getValues("complement")||null,state:l.getValues("state")||null};d||(_.email=null);const S="*, street, number, neighborhood, city, zip_code, complement, state";if(d)if(y){const{data:D,error:C}=await $.from("customers").update(_).eq("id",y.id).select(S).single();if(C)throw C;return D}else{const{data:D,error:C}=await $.from("customers").insert(_).select(S).single();if(C)throw C;return D}else{const{data:D,error:C}=await $.from("customers").insert(_).select(S).single();if(C)throw C;return D}},onSuccess:()=>{m.invalidateQueries({queryKey:["checkoutCustomerData"]})},onError:s=>{R.error(`Erro ao salvar dados do cliente: ${s.message}`)}}),We=De({mutationFn:async({customerId:s,data:o})=>{if(!j)throw new Error("Dados do restaurante não disponíveis.");let p=null;if(de&&o.change_for&&o.change_for.trim()!==""){const E=o.change_for.replace(",","."),T=parseFloat(E);!isNaN(T)&&T>z&&(p=T)}let[f,x]=oe||[null,null];if((V==="delivery"||V==="pickup")&&(!f||!x)){const E=V==="pickup"?[15,30]:[30,45];f=E[0],x=E[1]}const w=l.getValues(),_=V==="delivery"?`${w.street}, ${w.number}${w.complement?` - ${w.complement}`:""}, ${w.neighborhood}, ${w.city}, ${w.state}, ${w.zip_code}`:null,S={restaurant_id:j.id,customer_id:s,status:ke?"pending_payment":"pending",total_amount:z,delivery_fee:Y,delivery_address:_,notes:o.notes,payment_method_id:o.payment_method_id,change_for:p,min_delivery_time_minutes:f,max_delivery_time_minutes:x},{data:O,error:q}=await $.from("orders").insert(S).select("id").single();if(q)throw q;const D=g.map(E=>({order_id:O.id,product_id:E.product.id,quantity:parseFloat(E.quantity.toFixed(3)),unit_price:parseFloat(E.product.price.toFixed(2)),subtotal:parseFloat(E.subtotal.toFixed(2)),notes:E.notes})),{error:C}=await $.from("order_items").insert(D);if(C)throw C;return O.id},onSuccess:s=>{m.invalidateQueries({queryKey:["orders"]})},onError:s=>{R.error(`Erro ao criar pedido: ${s.message}`)}}),Yt=async s=>{if(de&&s.change_for&&s.change_for.trim()!==""){const f=s.change_for.replace(",","."),x=parseFloat(f);if(isNaN(x)){R.error("O troco deve ser um número válido.");return}if(x<z){u.setError("change_for",{type:"manual",message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z)}).`});return}}if(g.length===0){R.error("Seu carrinho está vazio."),r(`/menu/${i}`);return}if(V==="delivery"){if(!K){R.error("Você deve salvar e validar o endereço de entrega antes de finalizar o pedido.");return}if(!Se){R.error("O endereço de entrega está fora da área de cobertura.");return}}let o;try{o=(await He.mutateAsync(s)).id}catch(f){R.error(`Falha ao salvar cliente: ${f.message}`);return}let p;try{p=await We.mutateAsync({customerId:o,data:s})}catch(f){R.error(`Falha ao criar pedido: ${f.message}`);return}ke?await es(p,s):(c(),r(`/order-success/${p}`,{replace:!0}))},es=async(s,o)=>{if(!j)return;const p=window.location.origin+window.location.pathname,f=g.map(w=>({name:w.product.name,price:w.product.price,quantity:w.quantity})),x=R.loading("Preparando pagamento online...");try{const{data:w,error:_}=await $.functions.invoke("create-payment-preference",{body:{orderId:s,items:f,totalAmount:z,restaurantName:j.name,clientUrl:p,customerEmail:(d==null?void 0:d.email)||"cliente@anonimo.com",customerCpfCnpj:o.cpf_cnpj}});if(_)throw _;const{init_point:S}=w;qt(s),Bt(S),Pe(!0),R.dismiss(x)}catch(w){R.dismiss(x),R.error(`Erro no pagamento online: ${w.message}`),Pe(!1)}},ts=async()=>{await $.auth.signOut(),R.success("Você saiu da sua conta."),r("/auth",{replace:!0})},ss=(s,o,p)=>{o&&p?(Ae(s),Ke(!0)):(u.setValue("payment_method_id",s,{shouldValidate:!0}),Ae(null))},rs=()=>{Ue&&u.setValue("payment_method_id",Ue,{shouldValidate:!0}),Ke(!1),Ae(null)},ns=a.useCallback(s=>{l.setValue("zip_code",s.zip_code,{shouldValidate:!0}),l.setValue("street",s.street,{shouldValidate:!0}),l.setValue("neighborhood",s.neighborhood,{shouldValidate:!0}),l.setValue("city",s.city,{shouldValidate:!0}),l.setValue("state",s.state,{shouldValidate:!0}),l.setValue("number",s.number,{shouldValidate:!0}),l.setValue("complement","",{shouldValidate:!0}),s.number?R.info("Endereço encontrado! Verifique o número e clique em Salvar."):R.warning("Endereço encontrado! Por favor, preencha o campo 'Número' e clique em Salvar."),te(!1),ee(0),ye(null),ae(!0),ie(null),ce(null)},[l]),Je=a.useMemo(()=>{const[s,o,p,f,x,w,_]=we;if(!o||!p||!x||!f||!s||!_)return"";const S=w?` - ${w}`:"";return`${o}, ${p}${S}, ${x}, ${f} - ${_}, ${Ve(s)}`},[we]);if(!i)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(ne,{variant:"destructive",className:"max-w-lg",children:[e.jsx(ht,{className:"h-4 w-4"}),e.jsx(ue,{children:"Erro de Rastreamento"}),e.jsx(pe,{children:"Não foi possível identificar o restaurante para o qual o pedido está sendo feito. Por favor, volte ao menu."}),e.jsx(Me,{to:"/",children:e.jsx(U,{className:"mt-3",variant:"secondary",size:"sm",children:"Voltar"})})]})});if(g.length===0)return a.useEffect(()=>{r(`/menu/${i}`)},[r,i]),e.jsx(at,{});if(Kt||Qt||Xt||A)return e.jsx(at,{});if(Ut||!j)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(ne,{variant:"destructive",className:"max-w-lg",children:[e.jsx(ht,{className:"h-4 w-4"}),e.jsx(ue,{children:"Erro Crítico"}),e.jsx(pe,{children:Ze instanceof Error?Ze.message:"Não foi possível carregar os dados do restaurante."}),e.jsxs(U,{onClick:()=>Zt(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(Os,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]})});const Ye=He.isPending||We.isPending||be.isPending||k||V==="delivery"&&!K;return e.jsx("div",{className:"min-h-screen bg-background w-full overflow-x-hidden",children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-6 py-4 sm:py-8 max-w-5xl space-y-6 sm:space-y-8",children:[e.jsx(Cs,{isOpen:b,onClose:()=>P(!1),customer:y}),e.jsx(ur,{isOpen:Gt,onConfirm:rs}),Lt&&Ge&&e.jsx(dr,{preferenceId:zt,initPoint:Ge,onClose:()=>Pe(!1)}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto",children:[e.jsx(Me,{to:`/menu/${i}`,children:e.jsx(U,{variant:"ghost",size:"icon","aria-label":"Voltar ao Menu",children:e.jsx(Ts,{className:"h-6 w-6"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg sm:text-3xl font-bold text-foreground",children:"Finalizar Pedido"}),e.jsx("p",{className:"text-xs sm:text-lg text-muted-foreground font-medium truncate max-w-full",children:j.name})]})]}),d&&e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto justify-end",children:[e.jsxs(U,{variant:"outline",size:"sm",onClick:()=>P(!0),"aria-label":"Meu Perfil e Pedidos",className:"flex-1 sm:flex-none text-xs sm:text-sm h-8 sm:h-9",children:[e.jsx(xt,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"truncate",children:"Perfil / Pedidos"})]}),e.jsxs(U,{variant:"outline",size:"sm",onClick:ts,className:"flex-shrink-0 text-xs sm:text-sm h-8 sm:h-9",children:[e.jsx(Es,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"})," Sair"]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 sm:gap-8 w-full",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6 min-w-0",children:[e.jsxs(Z,{className:"w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(X,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(xt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Seus Dados"]})}),e.jsxs(H,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx("div",{className:"flex justify-between items-center mb-3 sm:mb-4",children:e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:d?`Logado como ${d.email}`:"Pedido anônimo"})}),e.jsx(ft,{...u,children:e.jsx("form",{onSubmit:u.handleSubmit(Yt),id:"checkout-form",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"name",className:"text-xs sm:text-sm",children:"Nome Completo *"}),e.jsx(he,{id:"name",...u.register("name"),className:"h-9 sm:h-12 text-sm w-full"}),u.formState.errors.name&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:u.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"phone",className:"text-xs sm:text-sm",children:"Telefone *"}),e.jsx(_e,{name:"phone",control:u.control,render:({field:s})=>e.jsx(vs,{id:"phone",...s,className:"h-9 sm:h-12 text-sm w-full"})}),u.formState.errors.phone&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:u.formState.errors.phone.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"cpf_cnpj",className:"text-xs sm:text-sm",children:"CPF/CNPJ *"}),e.jsx(_e,{name:"cpf_cnpj",control:u.control,render:({field:s})=>e.jsx(Ps,{id:"cpf_cnpj",...s,className:"h-9 sm:h-12 text-sm w-full"})}),u.formState.errors.cpf_cnpj&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:u.formState.errors.cpf_cnpj.message})]})]})})})]})]}),e.jsxs(Z,{className:"w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(X,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Opção de Entrega"]})}),e.jsx(H,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsx(_e,{name:"delivery_option",control:u.control,render:({field:s})=>e.jsxs(Le,{onValueChange:s.onChange,value:s.value,className:"grid grid-cols-2 gap-2 sm:gap-4 min-w-0 w-full",children:[e.jsxs(L,{htmlFor:"delivery",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-2 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer text-center w-full max-w-full",children:[e.jsx(Ee,{value:"delivery",id:"delivery",className:"sr-only"}),e.jsx(Fe,{className:"mb-1.5 sm:mb-3 h-4 w-4 sm:h-6 sm:w-6 flex-shrink-0"}),e.jsx("span",{translate:"no",className:"text-xs sm:text-base break-words w-full",children:"Entrega"})]}),e.jsxs(L,{htmlFor:"pickup",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-2 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer text-center w-full max-w-full",children:[e.jsx(Ee,{value:"pickup",id:"pickup",className:"sr-only"}),e.jsx(Te,{className:"mb-1.5 sm:mb-3 h-4 w-4 sm:h-6 sm:w-6 flex-shrink-0"}),e.jsx("span",{translate:"no",className:"text-xs sm:text-base break-words w-full",children:"Retirada no Local"})]})]})})})]}),V==="delivery"&&e.jsxs(Z,{className:ge("w-full overflow-hidden",!K&&"border-destructive ring-2 ring-destructive/50"),children:[e.jsxs(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:[e.jsxs(X,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Endereço de Entrega",K&&e.jsx(Ls,{className:"h-4 w-4 sm:h-5 sm:w-5 text-green-500 ml-2 flex-shrink-0"}),!K&&e.jsx(Ce,{className:"h-4 w-4 sm:h-5 sm:w-5 text-destructive ml-2 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Preencha e salve para calcular a taxa."})]}),e.jsxs(H,{className:"space-y-3 sm:space-y-4 px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx(ft,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(Jt),id:"address-form-inner",className:"space-y-3 sm:space-y-4",autoComplete:"off",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"address-search",className:"text-xs sm:text-sm",children:"Buscar Endereço"}),e.jsx(pr,{onAddressSelect:ns,disabled:k})]}),e.jsx("input",{type:"hidden",...l.register("zip_code")}),e.jsx("input",{type:"hidden",...l.register("street")}),e.jsx("input",{type:"hidden",...l.register("neighborhood")}),e.jsx("input",{type:"hidden",...l.register("city")}),e.jsx("input",{type:"hidden",...l.register("state")})," ",e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"number",className:"text-xs sm:text-sm",children:"Número *"}),e.jsx(he,{id:"number",...l.register("number"),placeholder:"Nº",className:"h-9 sm:h-12 text-sm",autoComplete:"off"}),l.formState.errors.number&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:l.formState.errors.number.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"complement",className:"text-xs sm:text-sm",children:"Complemento"}),e.jsx(he,{id:"complement",...l.register("complement"),placeholder:"Apto, Bloco...",className:"h-9 sm:h-12 text-sm",autoComplete:"off"})]})]}),l.watch("street")&&e.jsxs("div",{className:"bg-muted p-2 sm:p-3 rounded text-xs sm:text-sm break-words overflow-hidden",children:[e.jsx("p",{children:e.jsx("strong",{children:"Endereço:"})}),e.jsxs("p",{children:[l.watch("street")," ",l.watch("number")?`, ${l.watch("number")}`:"",l.watch("complement")?` - ${l.watch("complement")}`:""]}),e.jsxs("p",{className:"mt-1",children:[l.watch("neighborhood")&&e.jsx("span",{className:"font-semibold text-primary",children:l.watch("neighborhood")}),l.watch("neighborhood")&&l.watch("city")?" - ":"",l.watch("city")," - ",l.watch("state")]})]}),e.jsxs(U,{type:"submit",className:"w-full h-auto py-2 text-xs sm:text-base mt-2 whitespace-normal",disabled:be.isPending||k,children:[be.isPending||k?e.jsx(xe,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin mr-2"}):e.jsx(zs,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2"}),"Salvar e Calcular"]})]})}),k&&e.jsxs(ne,{className:"flex items-center gap-2 p-2 sm:p-4",children:[e.jsx(xe,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin"}),e.jsx(ue,{className:"text-xs sm:text-sm",children:"Calculando..."})]}),K&&!k&&e.jsxs(e.Fragment,{children:[j.delivery_enabled!==!1&&!Se&&e.jsxs(ne,{variant:"destructive",className:"p-2 sm:p-4",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx(ue,{className:"text-sm",children:"Fora da Área"}),e.jsx(pe,{className:"text-xs",children:"Endereço fora da área de cobertura."})]}),(j.delivery_enabled===!1||Se&&oe)&&e.jsxs(ne,{variant:"default",className:"bg-green-50 dark:bg-green-900/20 border-green-200 text-green-700 p-2 sm:p-4",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx(ue,{className:"text-sm",children:"Entrega Disponível"}),e.jsxs(pe,{className:"text-xs",children:["Taxa: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Y),". Tempo: ",oe?`${oe[0]}-${oe[1]}`:"30-45"," min."]})]})]}),K&&W&&Je&&e.jsx("div",{className:"mt-4 w-full overflow-hidden rounded-md border",children:e.jsx(mr,{latitude:W[0],longitude:W[1],address:Je,className:"w-full"})})]})]}),e.jsxs(Z,{className:"w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(X,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(vt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Pagamento *"]})}),e.jsxs(H,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx(_e,{name:"payment_method_id",control:u.control,render:({field:s})=>e.jsx(Le,{onValueChange:o=>{var w;const p=B==null?void 0:B.find(_=>_.id===o),f=(w=p==null?void 0:p.name)==null?void 0:w.includes("online"),x=!!v&&v.trim()!=="";ss(o,!!f,x)},value:s.value,className:"space-y-2 sm:space-y-3 w-full",children:B==null?void 0:B.map(o=>{var w;const p=(w=o.name)==null?void 0:w.includes("online"),f=!!v&&v.trim()!=="",x=p&&!f;return e.jsx(L,{htmlFor:o.id,className:ge("flex items-center justify-between rounded-md border-2 border-muted bg-popover p-2.5 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer w-full max-w-full",x&&"opacity-50 cursor-not-allowed"),children:e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 overflow-hidden min-w-0 w-full",children:[e.jsx(Ee,{value:o.id,id:o.id,disabled:x,className:"flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-xs sm:text-base break-words w-full leading-tight whitespace-normal",translate:"no",children:o.name}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground truncate",children:o.description}),x&&e.jsx("p",{className:"text-[10px] text-destructive mt-0.5",children:"Indisponível no momento."})]})]})},o.id)})})}),u.formState.errors.payment_method_id&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm mt-2",children:u.formState.errors.payment_method_id.message})]})]}),de&&e.jsxs(Z,{className:"w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(X,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(qs,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Troco"]})}),e.jsx(H,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"change_for",className:"text-xs sm:text-sm",children:"Precisa de troco para quanto?"}),e.jsx(he,{id:"change_for",type:"number",step:"0.01",placeholder:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z),...u.register("change_for"),className:"h-9 sm:h-12 text-sm w-full"}),((rt=u.formState.errors.change_for)==null?void 0:rt.message)&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:u.formState.errors.change_for.message}),((nt=u.formState.errors.change_for)==null?void 0:nt.type)==="manual"&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:u.formState.errors.change_for.message})]})})]}),e.jsxs(Z,{className:"w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(X,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(_s,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Observações"]})}),e.jsx(H,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"notes",className:"text-xs sm:text-sm",children:"Notas para o restaurante"}),e.jsx(gs,{id:"notes",...u.register("notes"),rows:3,placeholder:"Ex: Entregar na portaria, sem pimenta...",className:"text-sm w-full"})]})})]})]}),e.jsx("div",{className:"lg:col-span-1 space-y-6 sticky top-4 self-start min-w-0",children:e.jsxs(Z,{className:"shadow-lg w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsx(X,{className:"text-lg sm:text-2xl",children:"Resumo"})}),e.jsxs(H,{className:"space-y-3 sm:space-y-4 px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:g.map(s=>e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsxs("span",{className:"truncate max-w-[70%]",children:[s.quantity,"x ",s.product.name]}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.subtotal)})]},s.product.id))}),e.jsx(mt,{}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm text-muted-foreground",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(h)})]}),e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm text-muted-foreground",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Y)})]})]}),e.jsx(mt,{}),e.jsxs("div",{className:"flex justify-between font-bold text-base sm:text-xl",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z)})]}),e.jsx(U,{type:"submit",form:"checkout-form",className:"w-full h-10 sm:h-12 text-sm sm:text-lg",disabled:Ye,children:Ye?e.jsx(xe,{className:"h-4 w-4 sm:h-5 sm:w-5 animate-spin mr-2"}):ke?"Pagar e Finalizar":"Confirmar Pedido"}),V==="delivery"&&!K&&e.jsxs(ne,{variant:"destructive",className:"mt-3 p-2 sm:p-4",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx(pe,{className:"text-xs",children:"Salve o endereço acima para continuar."})]}),e.jsx(Me,{to:`/menu/${j.id}`,className:"block text-center text-xs sm:text-sm text-muted-foreground hover:underline mt-2",children:"Voltar ao Cardápio"})]})]})})]})]})})};export{un as default};
