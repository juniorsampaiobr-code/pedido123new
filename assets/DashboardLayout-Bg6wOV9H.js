import{j as e,b as ve,u as be}from"./tanstack-DS1wz2fm.js";import{k as M,L as Ae,r as t,u as je,O as Ne}from"./vendor-DPb28zz8.js";import{s as v}from"./client-BP8r4skJ.js";import{L as Se}from"./Logo-DecuKb2x.js";import{c as j,b as f,g as De,h as I,j as Ce,w as we,u as p,v as Ee,T as R,d as O,e as L,L as Te}from"./index-B6i9nglq.js";import{P as Pe}from"./package-L8dpTpm1.js";import{S as q}from"./shopping-cart-BImT3Gwr.js";import{C as ke}from"./clock-B8BcUOj7.js";import{C as _e}from"./credit-card-BkoPDiJ7.js";import{T as Re}from"./truck-D_GQ-45y.js";import{S as Oe}from"./settings-Eh6mAANp.js";import{b as $,B as k}from"./button-BeVziqmx.js";import{c as z,d as Le,O as Me,W as Ie,C as qe,T as $e,D as ze,a as F,R as Fe,P as Ve}from"./index-D2OCKsID.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=j("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=j("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=j("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=j("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=j("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),Be=[{href:"/dashboard",label:"Dashboard",icon:Ge},{href:"/products",label:"Produtos",icon:Pe},{href:"/orders",label:"Pedidos",icon:q},{href:"/cashier",label:"Caixa",icon:Qe},{href:"/hours",label:"Hor√°rios",icon:ke},{href:"/payments",label:"Pagamentos",icon:_e},{href:"/delivery",label:"Taxa de Entrega",icon:Re},{href:"/settings",label:"Configura√ß√µes",icon:Oe}],Ke=()=>{const a=M();return e.jsxs("aside",{className:"w-64 flex-shrink-0 border-r bg-card h-screen sticky top-0 flex-col hidden lg:flex",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx(Se,{})}),e.jsx("nav",{className:"flex-grow p-4",children:e.jsx("ul",{children:Be.map(o=>e.jsx("li",{children:e.jsxs(Ae,{to:o.href,className:f("flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors",a.pathname===o.href?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted hover:text-foreground"),children:[e.jsx(o.icon,{className:"h-4 w-4"}),o.label]})},o.href))})})]})};var H="AlertDialog",[Ue,Ta]=De(H,[z]),g=z(),G=a=>{const{__scopeAlertDialog:o,...r}=a,s=g(o);return e.jsx(Fe,{...s,...r,modal:!0})};G.displayName=H;var Xe="AlertDialogTrigger",W=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,l=g(r);return e.jsx(Le,{...l,...s,ref:o})});W.displayName=Xe;var Ye="AlertDialogPortal",Q=a=>{const{__scopeAlertDialog:o,...r}=a,s=g(o);return e.jsx(Ve,{...s,...r})};Q.displayName=Ye;var Je="AlertDialogOverlay",B=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,l=g(r);return e.jsx(Me,{...l,...s,ref:o})});B.displayName=Je;var b="AlertDialogContent",[Ze,ea]=Ue(b),aa=we("AlertDialogContent"),K=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,children:s,...l}=a,n=g(r),i=t.useRef(null),N=I(o,i),S=t.useRef(null);return e.jsx(Ie,{contentName:b,titleName:U,docsSlug:"alert-dialog",children:e.jsx(Ze,{scope:r,cancelRef:S,children:e.jsxs(qe,{role:"alertdialog",...n,...l,ref:N,onOpenAutoFocus:Ce(l.onOpenAutoFocus,h=>{var y;h.preventDefault(),(y=S.current)==null||y.focus({preventScroll:!0})}),onPointerDownOutside:h=>h.preventDefault(),onInteractOutside:h=>h.preventDefault(),children:[e.jsx(aa,{children:s}),e.jsx(ra,{contentRef:i})]})})})});K.displayName=b;var U="AlertDialogTitle",X=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,l=g(r);return e.jsx($e,{...l,...s,ref:o})});X.displayName=U;var Y="AlertDialogDescription",J=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,l=g(r);return e.jsx(ze,{...l,...s,ref:o})});J.displayName=Y;var oa="AlertDialogAction",Z=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,l=g(r);return e.jsx(F,{...l,...s,ref:o})});Z.displayName=oa;var ee="AlertDialogCancel",ae=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,{cancelRef:l}=ea(ee,r),n=g(r),i=I(o,l);return e.jsx(F,{...n,...s,ref:i})});ae.displayName=ee;var ra=({contentRef:a})=>{const o=`\`${b}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${b}\` by passing a \`${Y}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${b}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return t.useEffect(()=>{var s;document.getElementById((s=a.current)==null?void 0:s.getAttribute("aria-describedby"))||console.warn(o)},[o,a]),null},ta=G,sa=W,na=Q,oe=B,re=K,te=Z,se=ae,ne=X,ie=J;const ia=ta,Pa=sa,la=na,le=t.forwardRef(({className:a,...o},r)=>e.jsx(oe,{className:f("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...o,ref:r}));le.displayName=oe.displayName;const ce=t.forwardRef(({className:a,...o},r)=>e.jsxs(la,{children:[e.jsx(le,{}),e.jsx(re,{ref:r,className:f("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...o})]}));ce.displayName=re.displayName;const de=({className:a,...o})=>e.jsx("div",{className:f("flex flex-col space-y-2 text-center sm:text-left",a),...o});de.displayName="AlertDialogHeader";const ue=({className:a,...o})=>e.jsx("div",{className:f("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...o});ue.displayName="AlertDialogFooter";const pe=t.forwardRef(({className:a,...o},r)=>e.jsx(ne,{ref:r,className:f("text-lg font-semibold",a),...o}));pe.displayName=ne.displayName;const me=t.forwardRef(({className:a,...o},r)=>e.jsx(ie,{ref:r,className:f("text-sm text-muted-foreground",a),...o}));me.displayName=ie.displayName;const fe=t.forwardRef(({className:a,...o},r)=>e.jsx(te,{ref:r,className:f($(),a),...o}));fe.displayName=te.displayName;const ca=t.forwardRef(({className:a,...o},r)=>e.jsx(se,{ref:r,className:f($({variant:"outline"}),"mt-2 sm:mt-0",a),...o}));ca.displayName=se.displayName;const da=({isOpen:a,onEnable:o})=>e.jsx(ia,{open:a,children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-6 w-6 text-primary"}),"Ativar Notifica√ß√µes Sonoras?"]}),e.jsxs(me,{children:["Para garantir que voc√™ n√£o perca nenhum novo pedido, precisamos da sua permiss√£o para tocar um som de notifica√ß√£o.",e.jsx("br",{}),e.jsx("br",{}),'Ao clicar em "Ativar", um som de teste ser√° reproduzido.']})]}),e.jsx(ue,{children:e.jsx(fe,{onClick:o,className:"w-full",children:"Sim, ativar som"})})]})}),_=t.createContext(null),ua=()=>{const a=t.useContext(_);if(!a)throw new Error("useSound must be used within a DashboardLayout");return a},pa=a=>{const o=ma.find(r=>r.href===a);return o?o.label:"Dashboard"},ma=[{href:"/dashboard",label:"Dashboard"},{href:"/products",label:"Produtos"},{href:"/orders",label:"Pedidos"},{href:"/cashier",label:"Caixa"},{href:"/hours",label:"Hor√°rios"},{href:"/payments",label:"Pagamentos"},{href:"/delivery",label:"Taxa de Entrega"},{href:"/settings",label:"Configura√ß√µes"}],fa=()=>{const a=je(),o=M(),r=ve(),[s,l]=t.useState(null),n=t.useRef(null),[i,N]=t.useState("loading"),[S,h]=t.useState(!1),[y,E]=t.useState(null),[u,x]=t.useState(()=>localStorage.getItem("soundNotificationStatus")||"disabled");t.useEffect(()=>{localStorage.setItem("soundNotificationStatus",u)},[u]);const{data:A,isLoading:ge}=be({queryKey:["dashboardRestaurant"],queryFn:async()=>{const{data:d,error:m}=await v.from("restaurants").select("*").limit(1).single();if(m)throw new Error(m.message);return d},enabled:!!s,staleTime:1/0});t.useEffect(()=>{!localStorage.getItem("hasSeenSoundPermissionModal")&&u!=="enabled"&&i==="ready"&&h(!0)},[u,i]),t.useEffect(()=>{(async()=>{const{data:{session:c}}=await v.auth.getSession();c!=null&&c.user?l(c.user):a("/auth")})();const{data:{subscription:m}}=v.auth.onAuthStateChange((c,w)=>{c==="SIGNED_OUT"?a("/"):w!=null&&w.user?l(w.user):a("/auth")});return()=>m.unsubscribe()},[a]);const D=t.useCallback(()=>{n.current&&(n.current.pause(),n.current.loop=!1,E(null))},[]),T=t.useCallback(d=>{if(u==="enabled"&&n.current&&i==="ready"){if(y)return;E(d),n.current.loop=!0,n.current.play().catch(m=>{console.error("Erro na reprodu√ß√£o autom√°tica de √°udio:",m),E(null),p.warning("N√£o foi poss√≠vel tocar o som automaticamente.",{description:"Interaja com a p√°gina para permitir a reprodu√ß√£o de som."})})}},[u,i,y]);t.useEffect(()=>{const d=v.channel("new-orders-toast").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders"},m=>{r.invalidateQueries({queryKey:["orders"]});const c=m.new;c.status==="pending"&&c.id&&(p.info("üîî Novo pedido recebido!",{description:`Pedido #${c.id.slice(-4)} est√° aguardando confirma√ß√£o.`,duration:15e3}),T(c.id))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders"},m=>{r.invalidateQueries({queryKey:["orders"]});const c=m.new;c.status==="confirmed"&&c.id&&(p.success("‚úÖ Pagamento Confirmado!",{description:`Pedido #${c.id.slice(-4)} foi pago e est√° pronto para preparo.`,duration:15e3}),T(c.id))}).subscribe();return()=>{v.removeChannel(d)}},[r,T]);const P=t.useCallback(()=>{u==="enabled"&&n.current&&i==="ready"&&(D(),n.current.loop=!1,n.current.currentTime=0,n.current.play().catch(d=>{console.error("Erro na reprodu√ß√£o de √°udio de teste:",d)}))},[u,i,D]),he=async()=>{if(i!=="ready"||!n.current){p.error("O arquivo de som ainda n√£o est√° pronto. Tente novamente em um momento.");return}try{n.current.currentTime=0,await n.current.play(),x("enabled"),p.success("Notifica√ß√µes sonoras ativadas!"),localStorage.setItem("hasSeenSoundPermissionModal","true")}catch(d){console.error("Audio activation failed from modal:",d),p.error("Falha ao ativar o som.",{description:"Seu navegador pode ter bloqueado a reprodu√ß√£o. Por favor, tente ativar manualmente no √≠cone do cabe√ßalho."}),x("error")}finally{h(!1)}},xe=async()=>{if(u==="enabled"){D(),x("disabled"),p.info("Notifica√ß√µes sonoras desativadas.");return}if(i!=="ready"||!n.current){p.error("Som de notifica√ß√£o n√£o est√° pronto ou configurado."),x("error");return}try{await P(),x("enabled"),p.success("Notifica√ß√µes sonoras ativadas!",{description:"Voc√™ ouviu o som de teste."})}catch(d){console.error("Audio activation failed:",d),p.error("Falha ao ativar o som.",{description:"Seu navegador pode ter bloqueado. Clique na p√°gina e tente novamente."}),x("error")}},ye=async()=>{await v.auth.signOut()};if(!s||ge)return e.jsx(Ee,{});const C=i!=="ready";return e.jsxs(_.Provider,{value:{playSound:P,stopSoundLoop:D,soundStatus:u,loopingOrderId:y},children:[e.jsx(da,{isOpen:S,onEnable:he}),e.jsxs("div",{className:"flex min-h-screen bg-muted/40",children:[e.jsx(Ke,{}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"border-b bg-background sticky top-0 z-40",children:e.jsxs("div",{className:"container max-w-none mx-auto px-8 h-16 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(q,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-xl font-semibold",children:pa(o.pathname)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(R,{children:[e.jsx(O,{asChild:!0,children:e.jsx(k,{variant:"outline",size:"sm",onClick:P,disabled:C,children:"Testar Som"})}),C&&e.jsx(L,{children:e.jsx("p",{children:"Carregando som..."})})]}),e.jsxs(R,{children:[e.jsx(O,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"icon",onClick:xe,disabled:C,children:[i==="loading"&&e.jsx(Te,{className:"h-4 w-4 animate-spin"}),i==="ready"&&u==="enabled"&&e.jsx(V,{className:"h-4 w-4 text-green-500"}),i==="ready"&&u==="disabled"&&e.jsx(We,{className:"h-4 w-4"}),i==="error"&&e.jsx(He,{className:"h-4 w-4 text-destructive"})]})}),C&&e.jsx(L,{children:e.jsx("p",{children:"Carregando som..."})})]}),e.jsx(k,{variant:"outline",onClick:ye,children:"Sair"})]})]})}),e.jsx(Ne,{context:{restaurant:A}})]}),(A==null?void 0:A.notification_sound_url)&&e.jsx("audio",{ref:n,src:A.notification_sound_url,onCanPlayThrough:()=>N("ready"),onError:()=>{p.error("Erro ao carregar o som de notifica√ß√£o.",{description:"Verifique o arquivo em Configura√ß√µes."}),N("error"),x("error")},className:"hidden"})]})]})},ga=t.memo(fa),ka=Object.freeze(Object.defineProperty({__proto__:null,SoundContext:_,default:ga,useSound:ua},Symbol.toStringTag,{value:"Module"}));export{ia as A,ka as D,Pa as a,ce as b,de as c,pe as d,me as e,ue as f,ca as g,fe as h,ua as u};
