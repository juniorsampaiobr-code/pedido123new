import{c as _,e as T,r as g,a as y,j as e,d as q,X as O}from"./index-zkuE9Bm6.js";import{u as w}from"./useQuery-Bop5DQT3.js";import{u as D}from"./useMutation-DTwKCpeC.js";import{s as f}from"./client-g0uDe16g.js";import{B as h}from"./button-3xZnEy7f.js";import{C as P,a as A,b as R,c as k}from"./card-B1F0wEox.js";import{S as B,a as F,b as I,c as L,d as M,T as z,e as V,f as $,g as K,B as Q,C as U}from"./select-CxRWN2Rh.js";import{S as v}from"./skeleton-CBZEqJVS.js";import{A as H,T as X,a as G,b as J}from"./alert-B4s-E96m.js";import{D as W,a as Y,e as Z,b as ee,c as se,d as ae}from"./dialog-CNrbAfnQ.js";import{S as N}from"./separator-DaMM4xLR.js";import{useSound as re}from"./DashboardLayout-lnZ5BDU2.js";import{S as te}from"./shopping-cart-eMCEywpz.js";import{C as ne}from"./clock-8B-vU318.js";import{C as S,U as le,a as oe}from"./utensils-C3TXi82r.js";import{P as ie}from"./package-BjiMSLe_.js";import{T as ce}from"./truck-Dx6yc9rA.js";import{D as de}from"./dollar-sign-MxpQT_7w.js";import"./index-CIr-YXcb.js";import"./index-BRDkXO0b.js";import"./index-CSKTzlwz.js";import"./Logo-Dpd43AUV.js";import"./credit-card-CwfrA48D.js";import"./settings-CtP3JrMo.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=_("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),E={pending:{label:"Pendente"},confirmed:{label:"Confirmado"},preparing:{label:"Em Preparação"},ready:{label:"Pronto"},delivering:{label:"Em Entrega"},delivered:{label:"Entregue"},cancelled:{label:"Cancelado"},pending_payment:{label:"Aguardando Pagamento"}},ue=async s=>{const{data:o,error:a}=await f.from("order_items").select("*, products(name)").eq("order_id",s);if(a)throw new Error(a.message);return o},xe=({order:s,isOpen:o,onClose:a})=>{var p,j;const c=T(),[t,d]=g.useState("pending");g.useEffect(()=>{s!=null&&s.status&&d(s.status)},[s]);const{data:m,isLoading:x}=w({queryKey:["orderItems",s==null?void 0:s.id],queryFn:()=>ue(s.id),enabled:!!s&&o}),u=D({mutationFn:async r=>{if(!s)throw new Error("Pedido não encontrado.");const{error:i}=await f.from("orders").update({status:r}).eq("id",s.id);if(i)throw new Error(i.message)},onSuccess:(r,i)=>{y.success(`Status do pedido atualizado para "${E[i].label}"`),c.invalidateQueries({queryKey:["orders"]}),a()},onError:r=>{y.error(`Erro ao atualizar status: ${r.message}`)}});if(!s)return null;const n=s.created_at?new Date(s.created_at).getTime().toString().slice(-4):"N/A";return e.jsx(W,{open:o,onOpenChange:a,children:e.jsxs(Y,{className:"sm:max-w-lg",children:[e.jsxs(Z,{children:[e.jsxs(ee,{children:["Detalhes do Pedido #",n]}),e.jsx(se,{children:"Gerencie os detalhes e o status deste pedido."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold",children:"Cliente"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nome: ",((p=s.customer)==null?void 0:p.name)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Telefone: ",((j=s.customer)==null?void 0:j.phone)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Endereço: ",s.delivery_address||"N/A"]})]}),e.jsx(N,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Itens do Pedido"}),x?e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{className:"h-8 w-full"}),e.jsx(v,{className:"h-8 w-full"})]}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto pr-2",children:m==null?void 0:m.map(r=>{var i;return e.jsxs("div",{className:"flex justify-between items-start text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[r.quantity,"x ",((i=r.products)==null?void 0:i.name)||"Produto desconhecido"]}),r.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground italic",children:["Obs: ",r.notes]})]}),e.jsx("span",{className:"text-muted-foreground",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.subtotal)})]},r.id)})})]}),e.jsx(N,{}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsx("span",{className:"font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.delivery_fee||0)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-base",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]})]}),e.jsx(N,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Atualizar Status"}),e.jsxs(B,{value:t,onValueChange:r=>d(r),children:[e.jsx(F,{children:e.jsx(I,{placeholder:"Selecione um status"})}),e.jsx(L,{children:Object.entries(E).map(([r,{label:i}])=>e.jsx(M,{value:r,children:i},r))})]})]})]}),e.jsxs(ae,{children:[e.jsx(h,{variant:"outline",onClick:a,children:"Cancelar"}),e.jsx(h,{onClick:()=>u.mutate(t),disabled:u.isPending||t===s.status,children:u.isPending?"Salvando...":"Salvar Alterações"})]})]})})},pe={pending:{label:"Pendente",icon:ne,color:"bg-yellow-500 hover:bg-yellow-600"},confirmed:{label:"Confirmado",icon:S,color:"bg-blue-500 hover:bg-blue-600"},preparing:{label:"Em Preparação",icon:le,color:"bg-orange-500 hover:bg-orange-600"},ready:{label:"Pronto",icon:ie,color:"bg-green-500 hover:bg-green-600"},delivering:{label:"Em Entrega",icon:ce,color:"bg-indigo-500 hover:bg-indigo-600"},delivered:{label:"Entregue",icon:S,color:"bg-primary hover:bg-primary/90"},cancelled:{label:"Cancelado",icon:oe,color:"bg-destructive hover:bg-destructive/90"},pending_payment:{label:"Aguardando Pag.",icon:de,color:"bg-gray-500 hover:bg-gray-600"}},he=async(s,o)=>{let a=f.from("orders").select("*, customer:customers(name, phone)").eq("restaurant_id",s).order("created_at",{ascending:!1});o!=="all"&&(a=a.eq("status",o));const{data:c,error:t}=await a;if(t)throw new Error(`Erro ao buscar pedidos: ${t.message}`);return c},ge=({order:s,onViewDetails:o,onAccept:a,onDecline:c})=>{var x;const t=pe[s.status||"pending"],d=((x=s.customer)==null?void 0:x.name)||"Cliente Desconhecido",m=s.created_at?new Date(s.created_at).getTime().toString().slice(-4):"N/A";return e.jsxs(P,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col",children:[e.jsxs(R,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs(k,{className:"text-lg font-bold flex items-center gap-2",children:["Pedido #",m]}),e.jsxs(Q,{className:q("text-white",t.color),children:[e.jsx(t.icon,{className:"h-3 w-3 mr-1"}),t.label]})]}),e.jsxs(A,{className:"space-y-2 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",d]}),e.jsx("p",{className:"text-2xl font-extrabold text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]}),e.jsxs("div",{className:"flex justify-end pt-2 border-t gap-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{variant:"destructive",size:"sm",onClick:()=>c(s.id),children:[e.jsx(O,{className:"h-4 w-4 mr-1"})," Recusar"]}),e.jsxs(h,{variant:"default",size:"sm",onClick:()=>a(s.id),children:[e.jsx(U,{className:"h-4 w-4 mr-1"})," Aceitar"]})]}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>o(s),children:"Detalhes"})]})]})]})},fe=({status:s,onViewDetails:o,restaurantId:a})=>{const c=T(),{stopSoundLoop:t}=re(),{data:d,isLoading:m,isError:x,error:u,refetch:n}=w({queryKey:["orders",s,a],queryFn:()=>he(a,s),enabled:!!a}),p=D({mutationFn:async({orderId:l,newStatus:b})=>{const{error:C}=await f.from("orders").update({status:b}).eq("id",l);if(C)throw new Error(C.message);return b},onSuccess:l=>{y.success(`Pedido ${l==="confirmed"?"aceito":"recusado"} com sucesso!`),c.invalidateQueries({queryKey:["orders"]})},onError:l=>y.error(`Erro ao atualizar pedido: ${l.message}`)}),j=l=>{t(),p.mutate({orderId:l,newStatus:"confirmed"})},r=l=>{t(),p.mutate({orderId:l,newStatus:"cancelled"})},i=l=>{t(),o(l)};return m?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((l,b)=>e.jsx(P,{children:e.jsx(A,{className:"p-4 space-y-3",children:e.jsx(v,{className:"h-32 w-full"})})},b))}):x?e.jsxs(H,{variant:"destructive",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx(G,{children:"Erro ao carregar pedidos"}),e.jsx(J,{children:u instanceof Error?u.message:"Ocorreu um erro desconhecido."}),e.jsxs(h,{onClick:()=>n(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(me,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]}):!d||d.length===0?e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg border",children:[e.jsx(te,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifique o status selecionado ou aguarde novos pedidos."})]}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:d.map(l=>e.jsx(ge,{order:l,onViewDetails:i,onAccept:j,onDecline:r},l.id))})},Ve=()=>{const[s,o]=g.useState(null),[a,c]=g.useState(!1),[t,d]=g.useState(null);w({queryKey:["restaurantIdForOrdersPage"],queryFn:async()=>{const{data:n,error:p}=await f.from("restaurants").select("id").limit(1).single();if(p)throw new Error(p.message);return d(n.id),n.id}});const m=n=>{o(n),c(!0)},x=()=>{c(!1),o(null)},u=[{value:"all",label:"Todos"},{value:"pending",label:"Pendentes"},{value:"confirmed",label:"Confirmados"},{value:"preparing",label:"Em Preparação"},{value:"ready",label:"Prontos"},{value:"delivering",label:"Em Entrega"},{value:"delivered",label:"Entregues"},{value:"cancelled",label:"Cancelados"}];return e.jsxs(e.Fragment,{children:[e.jsx(xe,{order:s,isOpen:a,onClose:x}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:t?e.jsxs(z,{defaultValue:"pending",children:[e.jsx(V,{className:"w-full overflow-x-auto justify-start",children:u.map(n=>e.jsx($,{value:n.value,className:"whitespace-nowrap",children:n.label},n.value))}),u.map(n=>e.jsx(K,{value:n.value,className:"mt-6",children:e.jsx(fe,{status:n.value,onViewDetails:m,restaurantId:t})},n.value))]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Carregando dados do restaurante..."})]})})]})};export{Ve as default};
