import{j as e}from"./tanstack-BDgcxwLQ.js";import{u as y,r as n,L as v}from"./vendor-CIxFcw7z.js";import{L as b}from"./Logo-B2ImT60-.js";import{B as L}from"./button-Z6fjjtmF.js";import{L as x,I as f}from"./label-46rUugP1.js";import{C,b as E,c as S,d as k,a as A}from"./card-C6w8oa5_.js";import{c as R,L as g,u as d}from"./index-CX2OK0JH.js";import{s as i}from"./client-BskZ_u5h.js";import"./package-BZvv9FUk.js";import"./supabase-DGFirUEE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=R("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),q=async c=>{const{data:t,error:o}=await i.from("user_roles").select("role").eq("user_id",c).in("role",["admin","moderator"]).limit(1).single();return o&&o.code!=="PGRST116"?(console.error("Error checking role:",o),null):(t==null?void 0:t.role)||null},G=()=>{const c=y(),[t,o]=n.useState(!1),[m,j]=n.useState(""),[u,w]=n.useState(""),[l,h]=n.useState(null),p=async r=>{const a=await q(r.id);if(a==="admin"||a==="moderator")d.success("Login de administrador efetuado com sucesso!"),c("/dashboard",{replace:!0});else{d.error("Acesso negado.",{description:"Esta conta não possui permissão de administrador/moderador. Redirecionando para o menu.",duration:5e3}),await i.auth.signOut();const s=`${window.location.origin}${window.location.pathname}#/menu`;console.log("Redirecting non-admin to menu:",s),window.location.href=s}};n.useEffect(()=>{const{data:{subscription:r}}=i.auth.onAuthStateChange((a,s)=>{h(s),s!=null&&s.user&&p(s.user)});return i.auth.getSession().then(({data:{session:a}})=>{h(a),a!=null&&a.user&&p(a.user)}),()=>r.unsubscribe()},[c]);const N=async r=>{r.preventDefault(),o(!0);try{const{data:a,error:s}=await i.auth.signInWithPassword({email:m,password:u});if(s)throw s}catch(a){d.error(a.message||"Erro ao processar autenticação")}finally{o(!1)}};return l!=null&&l.user?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(g,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-primary"}),e.jsx("p",{className:"text-lg font-semibold",children:"Verificando permissões..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aguarde enquanto redirecionamos você."})]})}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(b,{className:"justify-center mb-4"})}),e.jsxs(C,{className:"shadow-xl border-2",children:[e.jsxs(E,{className:"space-y-1",children:[e.jsxs(S,{className:"text-2xl font-bold text-center flex items-center justify-center gap-2",children:[e.jsx(I,{className:"h-6 w-6 text-destructive"}),"Acesso do Restaurante"]}),e.jsx(k,{className:"text-center",children:"Utilize seu email e senha de administrador para acessar o painel."})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"email",children:"Email *"}),e.jsx(f,{id:"email",type:"email",placeholder:"seu@email.com",value:m,onChange:r=>j(r.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"password",children:"Senha *"}),e.jsx(f,{id:"password",type:"password",placeholder:"••••••••",value:u,onChange:r=>w(r.target.value),required:!0,className:"h-12"})]}),e.jsx(L,{type:"submit",className:"w-full",size:"lg",disabled:t,children:t?e.jsx(g,{className:"h-4 w-4 animate-spin mr-2"}):"Entrar no Painel"})]}),e.jsx("div",{className:"text-center pt-2",children:e.jsx(v,{to:"/auth",className:"text-sm text-muted-foreground hover:underline",children:"Acessar como Cliente"})})]})]})]})})};export{G as default};
