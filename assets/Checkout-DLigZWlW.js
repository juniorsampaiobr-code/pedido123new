import{j as e,b as os,c as ns,u as ae}from"./tanstack-D8i8yNxB.js";import{r as l,R as as,u as nr,h as ar,L as Xe}from"./vendor-Dl0Wzy4_.js";import{o as is,s as S,l as ls,u as cs,t as ds,e as ir,p as Ie,c as Ye,n as lr,Z as K}from"./types-BCrSgEF3.js";import{s as k}from"./client-BmrnLCXS.js";import{c as je,f as Oe,g as ye,P as Q,i as ge,h as us,l as cr,m as ms,b as be,n as dr,k as ur,a as ps,u as es,L as Fe,v as ss}from"./index-NnoqcsoS.js";import{B as J}from"./button-BNvhonYX.js";import{C as ie,b as le,c as ce,a as de}from"./card-M8Lr5FE1.js";import{I as T}from"./label--yHUTmGr.js";import{c as hs,R as mr,I as pr,a as hr,C as fr}from"./index-CrHRbhxz.js";import{u as xr,D as gr,a as jr,b as yr,c as br,d as vr,e as Nr}from"./index-y-RH82Vn.js";import{u as Cr}from"./index-PuW-_iwo.js";import{S as ue}from"./separator-Di6f2JGF.js";import{T as wr}from"./textarea-CHZd1IDR.js";import{A as Y,a as ee,b as se}from"./alert-Dr9Xi91r.js";import{F as fs,b as _,c as j,a as v,d as M,e as R}from"./form-Hxvj9ch6.js";import{P as xs}from"./PhoneInput-DW6htZ1L.js";import{Z as _r,M as Rr}from"./MapLocationSection-iL7XJZ9N.js";import{S as Er}from"./shopping-cart-O2I8VH0u.js";import{T as Ve}from"./terminal-D8tpFqP1.js";import{A as Pr}from"./arrow-left-CEhwDrdU.js";import{T as rs}from"./truck-Wjz5mf4X.js";import{S as gs,a as Sr}from"./store-DF_DwKfZ.js";import{M as ts}from"./map-pin-Ly3fL41A.js";import{P as Ir}from"./package-BJXYK2G-.js";import{C as Vr}from"./credit-card-DCBmtTq0.js";import{D as Fr}from"./dollar-sign-CS_y5pDI.js";import"./supabase-A1WgB1xz.js";import"./index-DxIR3hmn.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=je("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=je("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=je("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=je("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var $e="Radio",[Or,bs]=Oe($e),[$r,Tr]=Or($e),vs=l.forwardRef((s,t)=>{const{__scopeRadio:o,name:d,checked:a=!1,required:c,disabled:u,value:i="on",onCheck:x,form:h,...y}=s,[N,b]=l.useState(null),g=ye(t,L=>b(L)),I=l.useRef(!1),C=N?h||!!N.closest("form"):!0;return e.jsxs($r,{scope:o,checked:a,disabled:u,children:[e.jsx(Q.button,{type:"button",role:"radio","aria-checked":a,"data-state":_s(a),"data-disabled":u?"":void 0,disabled:u,value:i,...y,ref:g,onClick:ge(s.onClick,L=>{a||x==null||x(),C&&(I.current=L.isPropagationStopped(),I.current||L.stopPropagation())})}),C&&e.jsx(ws,{control:N,bubbles:!I.current,name:d,value:i,checked:a,required:c,disabled:u,form:h,style:{transform:"translateX(-100%)"}})]})});vs.displayName=$e;var Ns="RadioIndicator",Cs=l.forwardRef((s,t)=>{const{__scopeRadio:o,forceMount:d,...a}=s,c=Tr(Ns,o);return e.jsx(us,{present:d||c.checked,children:e.jsx(Q.span,{"data-state":_s(c.checked),"data-disabled":c.disabled?"":void 0,...a,ref:t})})});Cs.displayName=Ns;var Ar="RadioBubbleInput",ws=l.forwardRef(({__scopeRadio:s,control:t,checked:o,bubbles:d=!0,...a},c)=>{const u=l.useRef(null),i=ye(u,c),x=Cr(o),h=cr(t);return l.useEffect(()=>{const y=u.current;if(!y)return;const N=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(N,"checked").set;if(x!==o&&g){const I=new Event("click",{bubbles:d});g.call(y,o),y.dispatchEvent(I)}},[x,o,d]),e.jsx(Q.input,{type:"radio","aria-hidden":!0,defaultChecked:o,...a,tabIndex:-1,ref:i,style:{...a.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ws.displayName=Ar;function _s(s){return s?"checked":"unchecked"}var Dr=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ve="RadioGroup",[Mr,Bt]=Oe(ve,[hs,bs]),Rs=hs(),Es=bs(),[qr,Gr]=Mr(ve),Ps=l.forwardRef((s,t)=>{const{__scopeRadioGroup:o,name:d,defaultValue:a,value:c,required:u=!1,disabled:i=!1,orientation:x,dir:h,loop:y=!0,onValueChange:N,...b}=s,g=Rs(o),I=xr(h),[C,L]=ms({prop:c,defaultProp:a??null,onChange:N,caller:ve});return e.jsx(qr,{scope:o,name:d,required:u,disabled:i,value:C,onValueChange:L,children:e.jsx(mr,{asChild:!0,...g,orientation:x,dir:I,loop:y,children:e.jsx(Q.div,{role:"radiogroup","aria-required":u,"aria-orientation":x,"data-disabled":i?"":void 0,dir:I,...b,ref:t})})})});Ps.displayName=ve;var Ss="RadioGroupItem",Is=l.forwardRef((s,t)=>{const{__scopeRadioGroup:o,disabled:d,...a}=s,c=Gr(Ss,o),u=c.disabled||d,i=Rs(o),x=Es(o),h=l.useRef(null),y=ye(t,h),N=c.value===a.value,b=l.useRef(!1);return l.useEffect(()=>{const g=C=>{Dr.includes(C.key)&&(b.current=!0)},I=()=>b.current=!1;return document.addEventListener("keydown",g),document.addEventListener("keyup",I),()=>{document.removeEventListener("keydown",g),document.removeEventListener("keyup",I)}},[]),e.jsx(pr,{asChild:!0,...i,focusable:!u,active:N,children:e.jsx(vs,{disabled:u,required:c.required,checked:N,...x,...a,name:c.name,ref:y,onCheck:()=>c.onValueChange(a.value),onKeyDown:ge(g=>{g.key==="Enter"&&g.preventDefault()}),onFocus:ge(a.onFocus,()=>{var g;b.current&&((g=h.current)==null||g.click())})})})});Is.displayName=Ss;var zr="RadioGroupIndicator",Vs=l.forwardRef((s,t)=>{const{__scopeRadioGroup:o,...d}=s,a=Es(o);return e.jsx(Cs,{...a,...d,ref:t})});Vs.displayName=zr;var Fs=Ps,ks=Is,Br=Vs;const ke=l.forwardRef(({className:s,...t},o)=>e.jsx(Fs,{className:be("grid gap-2",s),...t,ref:o}));ke.displayName=Fs.displayName;const xe=l.forwardRef(({className:s,...t},o)=>e.jsx(ks,{ref:o,className:be("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Br,{className:"flex items-center justify-center",children:e.jsx(kr,{className:"h-2.5 w-2.5 fill-current text-current"})})}));xe.displayName=ks.displayName;const Ur=s=>{let t=s.replace(/\D/g,"");return t.length>14&&(t=t.slice(0,14)),t.length<=11?(t.length>9&&(t=`${t.slice(0,9)}-${t.slice(9)}`),t.length>6&&(t=`${t.slice(0,6)}.${t.slice(6)}`),t.length>3&&(t=`${t.slice(0,3)}.${t.slice(3)}`),t):(t.length>12&&(t=`${t.slice(0,12)}-${t.slice(12)}`),t.length>8&&(t=`${t.slice(0,8)}/${t.slice(8)}`),t.length>5&&(t=`${t.slice(0,5)}.${t.slice(5)}`),t.length>2&&(t=`${t.slice(0,2)}.${t.slice(2)}`),t)},Te=as.forwardRef(({className:s,value:t,onChange:o,...d},a)=>{const c=u=>{const i=u.target.value,x=Ur(i),h={...u,target:{...u.target,value:x}};o(h)};return e.jsx(T,{ref:a,type:"tel",className:be("w-full",s),placeholder:"CPF ou CNPJ",value:t,onChange:c,maxLength:18,...d})});Te.displayName="CpfCnpjInput";const Kr=(s,t,o,d)=>{const c=(o-s)*(Math.PI/180),u=(d-t)*(Math.PI/180),i=Math.sin(c/2)*Math.sin(c/2)+Math.cos(s*(Math.PI/180))*Math.cos(o*(Math.PI/180))*Math.sin(u/2)*Math.sin(u/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))},Hr=async s=>{const t=s.replace(/\s+/g," ").trim(),o=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t)}&limit=1`,d=new AbortController,a=setTimeout(()=>d.abort(),1e4);try{console.log("LOG: geocodeAddress - URL da API:",o);const c=await fetch(o,{signal:d.signal});if(!c.ok)return console.error("LOG: geocodeAddress - Resposta da API não OK. Status:",c.status),null;const u=await c.json();if(u&&Array.isArray(u)&&u.length>0){const i=u[0],x=parseFloat(i.lat),h=parseFloat(i.lon);if(Number.isFinite(x)&&Number.isFinite(h))return console.log("LOG: geocodeAddress - Sucesso. Coordenadas:",[x,h]),{lat:x,lng:h}}return console.warn("LOG: geocodeAddress - Falha. Nenhum resultado encontrado ou coordenadas inválidas para:",t),null}catch(c){return c instanceof Error&&c.name==="AbortError"?console.error("LOG: geocodeAddress - Timeout na requisição (10s). Endereço:",t):console.error("LOG: geocodeAddress - Erro durante a requisição:",c),null}finally{clearTimeout(a)}},Zr=(s,t,o)=>{const d=Kr(t[0],t[1],s[0],s[1]),a=o.find(c=>d<=c.max_distance_km);if(a){const c=a.delivery_fee||0,u=a.min_delivery_time_minutes||0,i=u+15;return{fee:parseFloat(c.toFixed(2)),minTime:u,maxTime:i}}return null};var Ne="Collapsible",[Jr,Ut]=Oe(Ne),[Qr,Ae]=Jr(Ne),Ls=l.forwardRef((s,t)=>{const{__scopeCollapsible:o,open:d,defaultOpen:a,disabled:c,onOpenChange:u,...i}=s,[x,h]=ms({prop:d,defaultProp:a??!1,onChange:u,caller:Ne});return e.jsx(Qr,{scope:o,disabled:c,contentId:dr(),open:x,onOpenToggle:l.useCallback(()=>h(y=>!y),[h]),children:e.jsx(Q.div,{"data-state":Me(x),"data-disabled":c?"":void 0,...i,ref:t})})});Ls.displayName=Ne;var Os="CollapsibleTrigger",$s=l.forwardRef((s,t)=>{const{__scopeCollapsible:o,...d}=s,a=Ae(Os,o);return e.jsx(Q.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":Me(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...d,ref:t,onClick:ge(s.onClick,a.onOpenToggle)})});$s.displayName=Os;var De="CollapsibleContent",Ts=l.forwardRef((s,t)=>{const{forceMount:o,...d}=s,a=Ae(De,s.__scopeCollapsible);return e.jsx(us,{present:o||a.open,children:({present:c})=>e.jsx(Wr,{...d,ref:t,present:c})})});Ts.displayName=De;var Wr=l.forwardRef((s,t)=>{const{__scopeCollapsible:o,present:d,children:a,...c}=s,u=Ae(De,o),[i,x]=l.useState(d),h=l.useRef(null),y=ye(t,h),N=l.useRef(0),b=N.current,g=l.useRef(0),I=g.current,C=u.open||i,L=l.useRef(C),q=l.useRef(void 0);return l.useEffect(()=>{const w=requestAnimationFrame(()=>L.current=!1);return()=>cancelAnimationFrame(w)},[]),ur(()=>{const w=h.current;if(w){q.current=q.current||{transitionDuration:w.style.transitionDuration,animationName:w.style.animationName},w.style.transitionDuration="0s",w.style.animationName="none";const H=w.getBoundingClientRect();N.current=H.height,g.current=H.width,L.current||(w.style.transitionDuration=q.current.transitionDuration,w.style.animationName=q.current.animationName),x(d)}},[u.open,d]),e.jsx(Q.div,{"data-state":Me(u.open),"data-disabled":u.disabled?"":void 0,id:u.contentId,hidden:!C,...c,ref:y,style:{"--radix-collapsible-content-height":b?`${b}px`:void 0,"--radix-collapsible-content-width":I?`${I}px`:void 0,...s.style},children:C&&a})});function Me(s){return s?"open":"closed"}var Xr=Ls;const Yr=Xr,et=$s,st=Ts,rt=()=>{const{items:s,subtotal:t,deliveryFee:o,total:d,totalItems:a}=ps(),[c,u]=l.useState(!1);return a===0?null:e.jsxs(Yr,{open:c,onOpenChange:u,className:"lg:hidden sticky top-0 z-40 bg-card border-b shadow-md",children:[e.jsx(et,{asChild:!0,children:e.jsxs("div",{className:"flex justify-between items-center p-4 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Er,{className:"h-5 w-5 text-primary"}),e.jsxs("span",{className:"font-semibold text-lg",children:["Seu Pedido (",a," ",a===1?"item":"itens",")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d)}),c?e.jsx(hr,{className:"h-5 w-5"}):e.jsx(fr,{className:"h-5 w-5"})]})]})}),e.jsxs(st,{className:"p-4 pt-0",children:[e.jsx(ue,{className:"mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto pr-2",children:s.map(i=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[i.quantity,"x ",i.name,i.notes&&e.jsxs("span",{className:"block text-xs italic",children:["(",i.notes,")"]})]}),e.jsx("span",{className:"font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i.price*i.quantity)})]},i.id))}),e.jsx(ue,{}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsx("span",{className:"font-medium text-primary",children:o>0?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o):"Grátis"})]})]}),e.jsx(ue,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d)})]})]})]})]})},tt=s=>s.replace(/\D/g,""),ot=s=>s.replace(/\D/g,""),nt=is({name:S().min(1,"Nome é obrigatório."),phone:S().min(1,"Telefone é obrigatório.").transform(tt).refine(s=>s.length>=10,{message:"O telefone deve ter pelo menos 10 dígitos (incluindo DDD)."}),email:S().email("Email inválido.").optional().or(ls("")),cpf_cnpj:S().optional().default("").transform(ot).refine(s=>s.length===0||s.length===11||s.length===14,{message:"CPF deve ter 11 dígitos ou CNPJ 14 dígitos."})}),at=({isOpen:s,onClose:t,customer:o})=>{const d=os(),a=cs({resolver:ds(nt),defaultValues:{name:"",phone:"",email:"",cpf_cnpj:""}});l.useEffect(()=>{o&&a.reset({name:o.name||"",phone:o.phone||"",email:o.email||"",cpf_cnpj:o.cpf_cnpj||""})},[o,a]);const c=ns({mutationFn:async i=>{if(!(o!=null&&o.id))throw new Error("ID do cliente não encontrado.");const x={name:i.name,phone:i.phone,email:i.email||null,cpf_cnpj:i.cpf_cnpj||null},{error:h}=await k.from("customers").update(x).eq("id",o.id);if(h)throw new Error(h.message)},onSuccess:()=>{es.success("Perfil atualizado com sucesso!"),d.invalidateQueries({queryKey:["checkoutCustomerData"]}),t()},onError:i=>{es.error(`Erro ao atualizar perfil: ${i.message}`)}}),u=i=>{c.mutate(i)};return o?e.jsx(gr,{open:s,onOpenChange:t,children:e.jsxs(jr,{className:"sm:max-w-[425px]",children:[e.jsxs(yr,{children:[e.jsxs(br,{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-5 w-5 text-primary"}),"Seu Perfil de Cliente"]}),e.jsx(vr,{children:"Atualize seus dados de contato e identificação."})]}),e.jsx(fs,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(u),className:"space-y-4 pt-4",children:[e.jsx(_,{control:a.control,name:"name",render:({field:i})=>e.jsxs(j,{children:[e.jsx(v,{children:"Nome Completo *"}),e.jsx(M,{children:e.jsx(T,{placeholder:"Seu nome",...i})}),e.jsx(R,{})]})}),e.jsx(_,{control:a.control,name:"phone",render:({field:i})=>e.jsxs(j,{children:[e.jsx(v,{children:"Telefone *"}),e.jsx(M,{children:e.jsx(xs,{...i})}),e.jsx(R,{})]})}),e.jsx(_,{control:a.control,name:"email",render:({field:i})=>e.jsxs(j,{children:[e.jsx(v,{children:"Email (Opcional)"}),e.jsx(M,{children:e.jsx(T,{placeholder:"seu@email.com",...i})}),e.jsx(R,{})]})}),e.jsx(_,{control:a.control,name:"cpf_cnpj",render:({field:i})=>e.jsxs(j,{children:[e.jsx(v,{children:"CPF/CNPJ (Opcional)"}),e.jsx(M,{children:e.jsx(Te,{...i})}),e.jsx(R,{})]})}),e.jsx(Nr,{className:"pt-4",children:e.jsxs(J,{type:"submit",disabled:c.isPending,children:[c.isPending?e.jsx(Fe,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(js,{className:"h-4 w-4 mr-2"}),"Salvar Alterações"]})})]})})]})}):null},As=s=>s.replace(/\D/g,""),Ds=s=>s.replace(/\D/g,""),Le=s=>s.replace(/\D/g,""),it=is({name:S().min(1,"Nome é obrigatório."),phone:S().min(1,"Telefone é obrigatório.").transform(As).refine(s=>s.length>=10,{message:"O telefone deve ter pelo menos 10 dígitos (incluindo DDD)."}),email:S().email("Email inválido.").optional().or(ls("")),delivery_option:ir(["delivery","pickup"],{required_error:"Selecione uma opção de entrega."}),street:S().optional().default(""),number:S().optional().default(""),complement:S().optional().default(""),neighborhood:S().optional().default(""),city:S().optional().default(""),zip_code:S().optional().default("").transform(Ds).refine(s=>s.length===8||s.length===0,{message:"CEP inválido. Deve conter 8 dígitos."}),latitude:Ie(s=>typeof s=="string"?parseFloat(s):s,Ye.number().optional().nullable()),longitude:Ie(s=>typeof s=="string"?parseFloat(s):s,Ye.number().optional().nullable()),payment_method_id:S().min(1,"Selecione uma forma de pagamento."),notes:S().optional(),cpf_cnpj:S().optional().default("").transform(Le).refine(s=>s.length===0||s.length===11||s.length===14,{message:"CPF deve ter 11 dígitos ou CNPJ 14 dígitos."}),change_for:Ie(s=>{if(s==null||s==="")return null;const t=String(s).replace(",","."),o=parseFloat(t);return isNaN(o)?t:o},lr({invalid_type_error:"O troco deve ser um número."}).optional().nullable())}).superRefine((s,t)=>{if(s.delivery_option==="delivery"?(s.street.trim()===""&&t.addIssue({code:K.custom,message:"Rua é obrigatória.",path:["street"]}),s.number.trim()===""&&t.addIssue({code:K.custom,message:"Número é obrigatório.",path:["number"]}),s.neighborhood.trim()===""&&t.addIssue({code:K.custom,message:"Bairro é obrigatório.",path:["neighborhood"]}),s.city.trim()===""&&t.addIssue({code:K.custom,message:"Cidade é obrigatória.",path:["city"]}),s.zip_code.length!==8&&t.addIssue({code:K.custom,message:"CEP é obrigatório e deve ter 8 dígitos.",path:["zip_code"]}),(s.latitude===null||s.longitude===null)&&t.addIssue({code:K.custom,message:"A localização deve ser salva no mapa para calcular a taxa de entrega.",path:["latitude"]})):s.latitude!==null||s.longitude,s.payment_method_id==="Dinheiro"&&s.change_for!==null&&s.change_for!==void 0&&s.change_for<=0&&t.addIssue({code:K.custom,message:"O valor do troco deve ser positivo.",path:["change_for"]}),s.payment_method_id==="Pagamento online: Pix/Cartão"){const a=Le(s.cpf_cnpj||"");a.length!==11&&a.length!==14&&t.addIssue({code:K.custom,message:"CPF/CNPJ é obrigatório para pagamento online.",path:["cpf_cnpj"]})}}),lt=()=>{const s=window.location.origin,o=window.location.pathname.split("/")[1];return o?`${s}/${o}`:s},ct=async()=>{const{data:s,error:t}=await k.from("restaurants").select("id, name, address, phone, email, street, number, neighborhood, city, zip_code, latitude, longitude, delivery_enabled").eq("is_active",!0).limit(1).single();if(t)throw new Error(`Erro ao buscar restaurante: ${t.message}`);if(!s)throw new Error("Nenhum restaurante ativo encontrado.");return s},dt=async s=>{const{data:t,error:o}=await k.from("restaurants").select("delivery_enabled").eq("id",s).single();if(o)throw new Error(`Erro ao buscar status de entrega: ${o.message}`);return t.delivery_enabled??!0},ut=async s=>{const{data:t,error:o}=await k.from("payment_methods").select("*").eq("restaurant_id",s).eq("is_active",!0).order("name",{ascending:!0});if(o)throw new Error(`Erro ao buscar métodos de pagamento: ${o.message}`);return t},mt=async s=>{const{data:t,error:o}=await k.from("delivery_zones").select("*").eq("restaurant_id",s).eq("is_active",!0).order("max_distance_km",{ascending:!0});if(o)throw new Error(`Erro ao buscar zonas de entrega: ${o.message}`);return t},pt=async()=>{const{data:{user:s}}=await k.auth.getUser();if(!s)return null;const{data:t,error:o}=await k.from("customers").select("*").eq("user_id",s.id).limit(1).single();if(o&&o.code!=="PGRST116")throw new Error(`Erro ao buscar dados do cliente: ${o.message}`);return t||null},ht=s=>{switch(s){case"DollarSign":return Fr;case"Smartphone":return Sr;case"CreditCard":return Vr;case"Package":return Ir;default:return gs}},ft=({subtotal:s,deliveryFee:t,total:o,items:d})=>e.jsxs(ie,{className:"sticky top-4",children:[e.jsx(le,{children:e.jsx(ce,{className:"text-xl",children:"Seu Pedido"})}),e.jsxs(de,{className:"space-y-3",children:[e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:d.map(a=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[a.quantity,"x ",a.name,a.notes&&e.jsxs("span",{className:"block text-xs italic",children:["(",a.notes,")"]})]}),e.jsx("span",{className:"font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.price*a.quantity)})]},a.id))}),e.jsx(ue,{}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsx("span",{className:"font-medium text-primary",children:t>0?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t):"Grátis"})]})]}),e.jsx(ue,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o)})]})]})]}),Kt=()=>{const s=lt(),t=nr();os();const o=ps(),{items:d,subtotal:a,deliveryFee:c,total:u,setDeliveryFee:i,clearCart:x}=o,[h]=ar(),[y,N]=l.useState(!1),[b,g]=l.useState(null),[I,C]=l.useState(null),[L,q]=l.useState(null),w=as.useRef(!1),[H,qe]=l.useState(!1),[Ms,Ge]=l.useState(!1),re=h.get("status"),Ce=h.get("external_reference"),ze=h.has("collection_id")||h.has("external_reference");l.useEffect(()=>{if(Ce)if(re==="approved"||re==="failure"||re==="pending"){t(`/order-success/${Ce}?status=${re}`,{replace:!0});return}else ze&&(window.history.replaceState({},document.title,window.location.pathname+window.location.hash.split("?")[0]),qe(!1));else qe(!1)},[Ce,re,ze,t]);const{data:m,isLoading:qs,isError:Gs,error:zs}=ae({queryKey:["checkoutRestaurantData"],queryFn:ct}),{data:G,isLoading:we}=ae({queryKey:["deliveryStatus",m==null?void 0:m.id],queryFn:()=>dt(m.id),enabled:!!(m!=null&&m.id)}),{data:W=[],isLoading:Bs}=ae({queryKey:["checkoutPaymentMethods",m==null?void 0:m.id],queryFn:()=>ut(m.id),enabled:!!(m!=null&&m.id)}),{data:Be=[],isLoading:Us}=ae({queryKey:["checkoutDeliveryZones",m==null?void 0:m.id],queryFn:()=>mt(m.id),enabled:!!(m!=null&&m.id)}),{data:z,isLoading:Ks}=ae({queryKey:["checkoutCustomerData"],queryFn:pt,staleTime:0}),Hs=qs||we||Bs||Us||Ks,Zs=Gs,Ue=zs,n=cs({resolver:ds(it),defaultValues:{name:"",phone:"",email:"",delivery_option:"delivery",street:"",number:"",complement:"",neighborhood:"",city:"",zip_code:"",payment_method_id:"",notes:"",cpf_cnpj:"",change_for:null,latitude:null,longitude:null},mode:"onBlur"});l.useEffect(()=>{z&&n.reset({...n.getValues(),name:z.name||"",phone:z.phone||"",email:z.email||"",cpf_cnpj:z.cpf_cnpj||""})},[z,n]);const D=n.watch("delivery_option"),_e=n.watch("payment_method_id"),X=W.find(r=>r.id===_e),me=(X==null?void 0:X.name)==="Pagamento online: Pix/Cartão",pe=(X==null?void 0:X.name)==="Dinheiro",V=n.watch("latitude"),F=n.watch("longitude");n.watch(["street","number","neighborhood","city","zip_code"]);const B=D==="delivery",Js=l.useMemo(()=>JSON.stringify({deliveryOption:D,deliveryEnabled:G,lat:V,lng:F}),[D,G,V,F]),Qs=l.useMemo(()=>typeof V=="number"&&typeof F=="number"&&!isNaN(V)&&!isNaN(F)?[V,F]:m!=null&&m.latitude&&(m!=null&&m.longitude)?[m.latitude,m.longitude]:[-23.55052,-46.633308],[V,F,m]),Ws=l.useMemo(()=>V===null||F===null?`map-${D}-null`:`map-${D}-${V.toFixed(6)}-${F.toFixed(6)}`,[B,D,V,F]),Re=l.useCallback(r=>{const p=r.road||r.logradouro||"",f=r.house_number||"",E=r.suburb||r.bairro||"",P=r.city||r.localidade||"",U=r.postcode||r.cep||"";n.setValue("street",p,{shouldValidate:!0}),n.setValue("number",f||"",{shouldValidate:!0}),n.setValue("complement",r.suburb||"",{shouldValidate:!0}),n.setValue("neighborhood",E,{shouldValidate:!0}),n.setValue("city",P,{shouldValidate:!0}),n.setValue("zip_code",U,{shouldValidate:!0})},[n]),Xs=l.useCallback(async(r,p)=>{n.setValue("latitude",r,{shouldValidate:!0}),n.setValue("longitude",p,{shouldValidate:!0});const f=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${r}&lon=${p}&addressdetails=1`,E=await fetch(f);if(E.ok){const P=await E.json();P.address&&Re(P.address)}},[n,Re]),Ys=l.useCallback(()=>{n.setValue("street","",{shouldValidate:!0}),n.setValue("number","",{shouldValidate:!0}),n.setValue("complement","",{shouldValidate:!0}),n.setValue("neighborhood","",{shouldValidate:!0}),n.setValue("city","",{shouldValidate:!0}),n.setValue("zip_code","",{shouldValidate:!0}),n.setValue("latitude",null,{shouldValidate:!0}),n.setValue("longitude",null,{shouldValidate:!0}),i(0),g(null),C(null),localStorage.removeItem("checkoutFormData")},[n,i]),Ee=l.useCallback(r=>{try{const p={name:r.name,phone:r.phone,email:r.email,delivery_option:r.delivery_option,street:r.street,number:r.number,complement:r.complement,neighborhood:r.neighborhood,city:r.city,zip_code:r.zip_code,latitude:r.latitude,longitude:r.longitude};localStorage.setItem("checkoutFormData",JSON.stringify(p))}catch(p){console.error("Failed to save form data to local storage",p)}},[]),Ke=l.useCallback(()=>{try{const r=localStorage.getItem("checkoutFormData");if(r){const p=JSON.parse(r);n.reset({...n.getValues(),...p,delivery_option:p.delivery_option||"delivery"})}}catch(r){console.error("Failed to load form data from local storage",r)}},[n]);l.useEffect(()=>{Ke()},[Ke]),l.useEffect(()=>{const r=n.watch(p=>{Ee(p)});return()=>r.unsubscribe()},[n,Ee]);const er=()=>{w.current||(q(null),w.current=!0,Promise.resolve().then(async()=>{try{const r=n.getValues(),[p,f,E,P,U]=[r.street,r.number,r.neighborhood,r.city,r.zip_code],oe=Ds(U);if(!(p&&f&&E&&P&&oe.length===8)){console.log("LOG: Validação de endereço incompleto falhou."),n.trigger(["street","number","neighborhood","city","zip_code"]),w.current=!1;return}console.log("LOG: Iniciando geocodificação para:",`${p}, ${f}, ${E}, ${P}, ${U}`);const fe=`${p}, ${f}, ${E}, ${P}, ${U}`,Z=await Hr(fe);Z?(console.log("LOG: Geocodificação bem-sucedida. Coordenadas:",Z),n.setValue("latitude",Z.lat,{shouldValidate:!0}),n.setValue("longitude",Z.lng,{shouldValidate:!0}),Ee(n.getValues())):(console.log("LOG: Geocodificação falhou ou retornou coordenadas inválidas."),setTimeout(()=>{q("Endereço não encontrado. Por favor, verifique se está correto e tente novamente."),n.setValue("latitude",null,{shouldValidate:!0}),n.setValue("longitude",null,{shouldValidate:!0})},100))}catch(r){console.error("LOG: Erro capturado durante a geocodificação:",r),setTimeout(()=>{q("Erro ao buscar coordenadas. Verifique sua conexão ou tente novamente."),n.setValue("latitude",null,{shouldValidate:!0}),n.setValue("longitude",null,{shouldValidate:!0})},100)}finally{w.current=!1}}).catch(r=>{console.error("LOG: Erro nao capturado:",r),w.current=!1}))};l.useEffect(()=>{pe||n.setValue("change_for",null,{shouldValidate:!0})},[pe,n]),l.useEffect(()=>{D==="pickup"&&(i(0),g(null),C(null),n.setValue("latitude",null,{shouldValidate:!0}),n.setValue("longitude",null,{shouldValidate:!0}))},[D,B,n,i,V,F]),l.useEffect(()=>{W.length>0&&!_e&&n.setValue("payment_method_id",W[0].id)},[W,_e,n]),l.useEffect(()=>{me?n.trigger("cpf_cnpj"):n.clearErrors("cpf_cnpj")},[me,n]),l.useEffect(()=>{const r=async()=>{if(D==="pickup"||!(m!=null&&m.latitude)||!(m!=null&&m.longitude)){i(0),g(null),C(null);return}if(we)return;if(G===!1){i(0),g(null),C(null),N(!1);return}N(!0),g(null);let f=null;if(V&&F)f=[V,F];else{i(0),C(null),N(!1);return}if(f){const E=[m.latitude,m.longitude],P=Zr(f,E,Be);P?(i(P.fee),g(null),C({minTime:P.minTime,maxTime:P.maxTime})):(i(0),g("Seu endereço está fora da nossa área de entrega."),C(null))}N(!1)},p=setTimeout(()=>{r()},500);return()=>clearTimeout(p)},[Js,m,Be,n,i,B,V,F,G,we]);const te=ns({mutationFn:async r=>{if(!m)throw new Error("Dados do restaurante indisponíveis.");if(r.delivery_option==="delivery"&&b)throw new Error(b);const p=[r.street,r.number,r.complement?`(${r.complement})`:null,r.neighborhood,r.city,r.zip_code].filter(Boolean).join(", "),f=r.delivery_option==="delivery"?p:"Retirada no Local";let E;const P=As(r.phone),U=Le(r.cpf_cnpj||""),{data:{user:oe}}=await k.auth.getUser(),he=(oe==null?void 0:oe.id)||null;if(!he)throw new Error("Autenticação necessária. Por favor, faça login para finalizar o pedido.");const{data:fe}=await k.from("customers").select("id, user_id, name, cpf_cnpj").eq("user_id",he).limit(1).single();if(fe){E=fe.id;const O={name:r.name,phone:P,email:r.email||null,cpf_cnpj:U||null},{error:A}=await k.from("customers").update(O).eq("id",E);if(A)throw new Error(`Erro ao atualizar cliente existente: ${A.message}`)}else{const O={name:r.name,phone:P,email:r.email||null,address:f,latitude:r.latitude,longitude:r.longitude,cpf_cnpj:U||null,user_id:he},{data:A,error:$}=await k.from("customers").insert(O).select("id").single();if($)throw new Error(`Erro ao criar cliente: ${$.message}`);E=A.id}const Z=me?"pending_payment":"pending",{data:Se,error:Je}=await k.from("orders").insert({restaurant_id:m.id,customer_id:E,status:Z,total_amount:u,delivery_fee:c,notes:r.notes,delivery_address:f,payment_method_id:r.payment_method_id,change_for:pe?r.change_for:null}).select("id").single();if(Je)throw new Error(`Erro ao criar pedido: ${Je.message}`);const or=d.map(O=>{const A=Number(O.quantity),$=Number(O.price),ne={order_id:Se.id,product_id:O.product_id,quantity:A,unit_price:$,subtotal:A*$};return O.notes&&O.notes.trim()&&(ne.notes=O.notes.trim()),ne}),{error:Qe}=await k.from("order_items").insert(or);if(Qe){console.error("LOG: Erro ao inserir com product_id, tentando sem product_id:",Qe);const O=d.map($=>{const ne=Number($.quantity),We=Number($.price);return{order_id:Se.id,quantity:ne,unit_price:We,subtotal:ne*We,notes:$.notes&&$.notes.trim()?$.notes.trim():null}}),{error:A}=await k.from("order_items").insert(O);if(A)throw new Error(`Erro ao adicionar itens do pedido: ${A.message}`)}return{orderId:Se.id,orderStatus:Z}},onSuccess:r=>{x();const p=r.orderStatus==="pending_payment"?`/payment/${r.orderId}`:`/order-success/${r.orderId}`,f=`${s}/#${p}`;console.log("LOG: Redirecionamento FORÇADO para:",f),window.location.href=f},onError:r=>{console.error("LOG: Erro ao processar pedido:",r),alert(`Falha ao finalizar pedido: ${r.message}. Verifique o console para mais detalhes.`)}}),sr=async r=>{if(!await n.trigger()){He(n.formState.errors);return}if(r.delivery_option==="delivery"&&b){alert(`Não é possível finalizar o pedido: ${b}`);return}te.mutate(r)},He=r=>{var f;console.error("Validation errors:",r);const p=Object.keys(r)[0];p&&console.error("LOG: Erro de validação:",((f=r[p])==null?void 0:f.message)||"Preencha todos os campos obrigatórios.")},Ze=te.isPending||y,rr=!B||!b&&c>=0,Pe=!B||V!==null&&F!==null,tr=!Ze&&rr&&Pe;return l.useEffect(()=>{if(d.length===0&&!te.isPending&&!H){const r=setTimeout(()=>{t("/menu",{replace:!0})},100);return()=>clearTimeout(r)}},[d.length,te.isPending,H,t]),d.length===0&&!te.isPending&&!H?e.jsx(ss,{}):Hs||H?e.jsx(ss,{}):Zs?e.jsx("div",{className:"container mx-auto p-4 max-w-6xl",children:e.jsxs(Y,{variant:"destructive",children:[e.jsx(Ve,{className:"h-4 w-4"}),e.jsx(ee,{children:"Erro de Conexão"}),e.jsx(se,{children:Ue instanceof Error?Ue.message:"Não foi possível carregar os dados."})]})}):e.jsxs(e.Fragment,{children:[e.jsx(at,{isOpen:Ms,onClose:()=>Ge(!1),customer:z}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b bg-card sticky top-0 z-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 max-w-6xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Xe,{to:"/menu",children:e.jsx(J,{variant:"ghost",size:"icon",className:"mr-4",children:e.jsx(Pr,{className:"h-5 w-5"})})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Finalizar Pedido"})]}),z&&e.jsx(J,{variant:"outline",size:"icon",onClick:()=>Ge(!0),"aria-label":"Editar Perfil",children:e.jsx(ys,{className:"h-5 w-5"})})]})}),e.jsx("div",{children:e.jsx(rt,{})}),e.jsxs("main",{className:"container mx-auto px-4 py-8 max-w-6xl pb-24 lg:pb-8",children:[" ",e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsx(fs,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(sr,He),className:"space-y-6",children:[e.jsxs(ie,{children:[e.jsx(le,{children:e.jsx(ce,{className:"text-xl",children:"1. Seus Dados"})}),e.jsxs(de,{className:"space-y-4",children:[e.jsx(_,{control:n.control,name:"name",render:({field:r})=>e.jsxs(j,{children:[e.jsx(v,{children:"Nome Completo *"}),e.jsx(T,{placeholder:"Seu nome",...r}),e.jsx(R,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_,{control:n.control,name:"phone",render:({field:r})=>e.jsxs(j,{children:[e.jsx(v,{children:"Telefone *"}),e.jsx(xs,{...r}),e.jsx(R,{})]})}),e.jsx(_,{control:n.control,name:"email",render:({field:r})=>e.jsxs(j,{children:[e.jsx(v,{children:"Email (Opcional)"}),e.jsx(T,{placeholder:"seu@email.com",...r}),e.jsx(R,{})]})})]})]})]}),e.jsxs(ie,{children:[e.jsx(le,{children:e.jsx(ce,{className:"text-xl",children:"2. Entrega"})}),e.jsxs(de,{className:"space-y-4",children:[e.jsx(_,{control:n.control,name:"delivery_option",render:({field:r})=>e.jsxs(j,{className:"space-y-3",children:[e.jsx(M,{children:e.jsxs(ke,{onValueChange:r.onChange,defaultValue:r.value,className:"flex flex-col space-y-1",children:[e.jsxs(j,{className:"flex items-center space-x-3 space-y-0 border p-4 rounded-lg cursor-pointer",children:[e.jsx(M,{children:e.jsx(xe,{value:"delivery"})}),e.jsx(rs,{className:"h-5 w-5 text-primary"}),e.jsxs(v,{className:be("font-normal flex-1 cursor-pointer"),children:["Delivery",G===!1&&e.jsx("span",{className:"block text-xs text-muted-foreground",children:" (Taxa de entrega desativada, entrega gratuita)"})]})]}),e.jsxs(j,{className:"flex items-center space-x-3 space-y-0 border p-4 rounded-lg cursor-pointer",children:[e.jsx(M,{children:e.jsx(xe,{value:"pickup"})}),e.jsx(gs,{className:"h-5 w-5 text-primary"}),e.jsx(v,{className:"font-normal flex-1 cursor-pointer",children:"Retirada no Local"})]})]})}),e.jsx(R,{})]})}),B&&e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(ts,{className:"h-4 w-4"})," Endereço de Entrega *"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(J,{type:"button",variant:"outline",size:"sm",onClick:r=>{r.preventDefault(),er()},disabled:y||w.current,children:[e.jsx(js,{className:"h-4 w-4 mr-2"})," ",y||w.current?"Buscando...":"Salvar Endereço"]}),e.jsxs(J,{type:"button",variant:"outline",size:"sm",onClick:Ys,children:[e.jsx(Lr,{className:"h-4 w-4 mr-2"})," Limpar"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(_,{control:n.control,name:"street",render:({field:r})=>e.jsxs(j,{className:"col-span-2",children:[e.jsx(v,{children:"Rua *"}),e.jsx(T,{...r}),e.jsx(R,{})]})}),e.jsx(_,{control:n.control,name:"number",render:({field:r})=>e.jsxs(j,{className:"col-span-1",children:[e.jsx(v,{children:"Número *"}),e.jsx(T,{...r}),e.jsx(R,{})]})})]}),e.jsx(_,{control:n.control,name:"complement",render:({field:r})=>e.jsxs(j,{children:[e.jsx(v,{children:"Complemento (Opcional)"}),e.jsx(T,{placeholder:"Apto, Bloco, Casa, etc.",...r,disabled:!1}),e.jsx(R,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(_,{control:n.control,name:"neighborhood",render:({field:r})=>e.jsxs(j,{children:[e.jsx(v,{children:"Bairro *"}),e.jsx(T,{...r}),e.jsx(R,{})]})}),e.jsx(_,{control:n.control,name:"city",render:({field:r})=>e.jsxs(j,{children:[e.jsx(v,{children:"Cidade *"}),e.jsx(T,{...r}),e.jsx(R,{})]})})]}),e.jsx(_,{control:n.control,name:"zip_code",render:({field:r})=>e.jsxs(j,{children:[e.jsx(v,{children:"CEP *"}),e.jsx(_r,{...r}),e.jsx(R,{})]})}),B&&Pe&&e.jsx("div",{children:e.jsx(Rr,{mapKey:Ws,markerPosition:Qs,onLocationChange:Xs,updateAddressFields:Re,restaurant:m})}),y&&G!==!1&&e.jsxs(Y,{children:[e.jsx(Fe,{className:"h-4 w-4 animate-spin"}),e.jsx(ee,{children:"Calculando Taxa..."}),e.jsx(se,{children:"Aguarde enquanto calculamos a taxa de entrega para o seu endereço."})]}),b&&G!==!1&&e.jsxs(Y,{variant:"destructive",children:[e.jsx(Ve,{className:"h-4 w-4"}),e.jsx(ee,{children:"Erro de Entrega"}),e.jsx(se,{children:b})]}),c>0&&!y&&G!==!1&&e.jsxs(Y,{className:"mt-4",children:[e.jsx(rs,{className:"h-4 w-4"}),e.jsx(ee,{children:"Taxa de Entrega Aplicada"}),e.jsxs(se,{children:["Taxa: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c)]})]}),L&&e.jsxs(Y,{variant:"destructive",className:"mt-4",children:[e.jsx(Ve,{className:"h-4 w-4"}),e.jsx(ee,{children:"Erro ao Buscar Endereço"}),e.jsx(se,{children:L})]}),B&&!Pe&&!L&&e.jsxs(Y,{variant:"destructive",children:[e.jsx(ts,{className:"h-4 w-4"}),e.jsx(ee,{children:"Localização Obrigatória"}),e.jsx(se,{children:'Clique em "Salvar Endereço" para confirmar a localização no mapa e calcular a taxa de entrega.'})]})]})]})]}),e.jsxs(ie,{children:[e.jsx(le,{children:e.jsx(ce,{className:"text-xl",children:"3. Pagamento"})}),e.jsxs(de,{className:"space-y-4",children:[e.jsx(_,{control:n.control,name:"payment_method_id",render:({field:r})=>e.jsxs(j,{className:"space-y-3",children:[e.jsx(M,{children:e.jsx(ke,{onValueChange:p=>{r.onChange(p);const f=W.find(E=>E.id===p);(f==null?void 0:f.name)!=="Dinheiro"&&n.setValue("change_for",null,{shouldValidate:!0}),(f==null?void 0:f.name)==="Pagamento online: Pix/Cartão"?n.trigger("cpf_cnpj"):n.clearErrors("cpf_cnpj")},defaultValue:r.value,className:"flex flex-col space-y-2",children:W.map(p=>{const f=ht(p.icon||"Store");return e.jsxs(j,{className:"flex items-center space-x-3 space-y-0 border p-4 rounded-lg cursor-pointer",children:[e.jsx(M,{children:e.jsx(xe,{value:p.id})}),e.jsx(f,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(v,{className:"font-normal cursor-pointer",children:p.name}),p.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:p.description})]})]},p.id)})})}),e.jsx(R,{})]})}),pe&&e.jsx(_,{control:n.control,name:"change_for",render:({field:r})=>e.jsxs(j,{children:[e.jsx(v,{children:"Troco para (Opcional)"}),e.jsx(T,{type:"number",placeholder:"Ex: 50.00",...r,value:r.value||"",onChange:p=>r.onChange(p.target.value?parseFloat(p.target.value):null)}),e.jsx(R,{})]})}),me&&e.jsx(_,{control:n.control,name:"cpf_cnpj",render:({field:r})=>e.jsxs(j,{children:[e.jsx(v,{children:"CPF/CNPJ *"}),e.jsx(Te,{...r}),e.jsx(R,{})]})})]})]}),e.jsxs(ie,{children:[e.jsx(le,{children:e.jsx(ce,{className:"text-xl",children:"4. Observações"})}),e.jsx(de,{children:e.jsx(_,{control:n.control,name:"notes",render:({field:r})=>e.jsxs(j,{children:[e.jsx(v,{children:"Observações do Pedido (Opcional)"}),e.jsx(wr,{placeholder:"Ex: Sem cebola, sem alface...",...r}),e.jsx(R,{})]})})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(Xe,{to:"/menu",className:"flex-1",children:e.jsx(J,{type:"button",variant:"outline",className:"w-full",children:"Voltar ao Menu"})}),e.jsx(J,{type:"submit",className:"flex-1",disabled:!tr,size:"lg",children:Ze?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"mr-2 h-4 w-4 animate-spin"}),"Processando..."]}):"Confirmar Pedido"})]})]})})}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(ft,{subtotal:a,deliveryFee:c,total:u,items:d})})]})]})]})]})};export{Kt as default};
