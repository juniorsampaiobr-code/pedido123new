import{b as G,u as K,c as B,j as e}from"./tanstack-D8i8yNxB.js";import{r as g,f as Le}from"./vendor-Dl0Wzy4_.js";import{s as T}from"./client-BmrnLCXS.js";import{c as F,u as P,B as S,b as k,p as Be,i as Fe,j as se,P as H,l as Z,k as Oe,q as ze,r as $e,R as ae,L as Ke,A as Ve,o as Qe,d as Ge,e as He,X as te}from"./index-CZXX2Rfq.js";import{C as re,a as ne,b as Ue,c as Xe}from"./card-Cm4B1FqD.js";import{S as oe,a as le,b as ie,c as ce,d as de,C as M,T as Je,e as Ze,f as We,g as Ye}from"./select-CId2LcxB.js";import{D as W,a as Y,b as es,c as ss,d as as,e as ts,B as rs}from"./index-Dpex0U03.js";import{S as E}from"./skeleton-DwwZ7771.js";import{S as I}from"./separator-CKT46beO.js";import{P as ns}from"./printer-BsozIBMT.js";import{useSound as os}from"./DashboardLayout-C_QVWQxN.js";import{A as me,a as ue,b as he,c as xe,d as pe,e as ge,f as fe,g as je,h as be}from"./alert-dialog-C0oL8bZ5.js";import{u as ls}from"./index-PuW-_iwo.js";import{S as ve}from"./shopping-cart-C7EISdsb.js";import{D as is}from"./dollar-sign-B8kr63NV.js";import{T as cs}from"./trash-2-D7bgoGeS.js";import"./supabase-A1WgB1xz.js";import"./index-BilWrBh0.js";import"./index-BB_oiUC3.js";import"./index-CL0hKtdb.js";import"./Logo-c7N0IEdG.js";import"./package-BAPC_PPU.js";import"./clock-BJEy0UJt.js";import"./credit-card-B1pYFIjb.js";import"./truck-WDN9obsu.js";import"./settings-C7Szzzm5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=F("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=F("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=F("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=F("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),ee={pending:{label:"Pendente"},preparing:{label:"Em Preparação"},ready:{label:"Pronto"},delivering:{label:"Em Entrega"},delivered:{label:"Entregue"},cancelled:{label:"Cancelado"},pending_payment:{label:"Aguardando Pagamento"}},xs=async s=>{const{data:a,error:t}=await T.from("order_items").select("*, products(name)").eq("order_id",s);if(t)throw new Error(t.message);return a},ps=async s=>{const{data:a,error:t}=await T.from("orders").select("*, customer:customers(name, phone, cpf_cnpj, email), payment_methods(name)").eq("id",s).limit(1).single();if(t)throw new Error(`Erro ao buscar detalhes do pedido: ${t.message}`);return a},gs=({order:s,isOpen:a,onClose:t})=>{var n;const h=G(),[i,r]=g.useState("pending"),{data:o,isLoading:m,isError:c}=K({queryKey:["orderDetails",s==null?void 0:s.id],queryFn:()=>ps(s.id),enabled:!!s&&a});g.useEffect(()=>{o!=null&&o.status&&r(o.status)},[o]);const{data:x,isLoading:p}=K({queryKey:["orderItems",s==null?void 0:s.id],queryFn:()=>xs(s.id),enabled:!!s&&a}),b=B({mutationFn:async l=>{if(!s)throw new Error("Pedido não encontrado.");const{error:j}=await T.from("orders").update({status:l}).eq("id",s.id);if(j)throw new Error(j.message)},onSuccess:(l,j)=>{P.success(`Status do pedido atualizado para "${ee[j].label}"`),h.invalidateQueries({queryKey:["orders"]}),t()},onError:l=>{P.error(`Erro ao atualizar status: ${l.message}`)}}),N=()=>{window.print()};if(!s||m)return e.jsx(W,{open:a,onOpenChange:t,children:e.jsxs(Y,{className:"sm:max-w-lg",children:[e.jsx(E,{className:"h-6 w-1/2 mb-4"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(E,{className:"h-4 w-full"}),e.jsx(E,{className:"h-4 w-full"}),e.jsx(E,{className:"h-4 w-full"}),e.jsx(I,{}),e.jsx(E,{className:"h-48 w-full"}),e.jsx(I,{}),e.jsx(E,{className:"h-10 w-full"})]})]})});if(c||!o)return null;const y=o.created_at?new Date(o.created_at).getTime().toString().slice(-4):"N/A",u=o.customer,f=((n=o.payment_methods)==null?void 0:n.name)||"Não Informado",v=o.change_for;return e.jsx(W,{open:a,onOpenChange:t,children:e.jsxs(Y,{className:"sm:max-w-lg",children:[e.jsxs(es,{children:[e.jsxs(ss,{children:["Detalhes do Pedido #",y]}),e.jsx(as,{children:"Gerencie os detalhes e o status deste pedido."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold",children:"Cliente"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nome: ",(u==null?void 0:u.name)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Telefone: ",(u==null?void 0:u.phone)||"N/A"]}),(u==null?void 0:u.email)&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Email: ",u.email]}),(u==null?void 0:u.cpf_cnpj)&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["CPF/CNPJ: ",u.cpf_cnpj]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Endereço: ",o.delivery_address||"Retirada no Local"]})]}),e.jsx(I,{}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold",children:"Pagamento"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Método: ",f]}),f==="Dinheiro"&&v!==null&&v!==void 0&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Troco para: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(v)]}),f==="Dinheiro"&&v==null&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Troco: Não precisa de troco"})]}),e.jsx(I,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Itens do Pedido"}),p?e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{className:"h-8 w-full"}),e.jsx(E,{className:"h-8 w-full"})]}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto pr-2",children:x==null?void 0:x.map(l=>{var j;return e.jsxs("div",{className:"flex justify-between items-start text-sm border-b pb-2 last:border-b-0",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[l.quantity,"x ",((j=l.products)==null?void 0:j.name)||"Produto desconhecido"]}),l.notes&&e.jsxs("p",{className:"text-xs text-destructive italic mt-1",children:["Obs: ",l.notes]})]}),e.jsx("span",{className:"text-muted-foreground",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(l.subtotal)})]},l.id)})})]}),e.jsx(I,{}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex flex-col pb-2",children:[e.jsx("span",{className:"font-semibold",children:"Observações do Pedido:"}),e.jsx("span",{className:"text-sm text-muted-foreground mt-1",children:o.notes||"Nenhuma observação."})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsx("span",{className:"font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o.delivery_fee||0)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-base",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o.total_amount)})]})]}),e.jsx(I,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Atualizar Status"}),e.jsxs(oe,{value:i,onValueChange:l=>r(l),children:[e.jsx(le,{children:e.jsx(ie,{placeholder:"Selecione um status"})}),e.jsx(ce,{children:Object.entries(ee).map(([l,{label:j}])=>e.jsx(de,{value:l,children:j},l))})]})]})]}),e.jsxs(ts,{className:"flex-col sm:flex-row sm:justify-between sm:space-x-2",children:[e.jsxs(S,{variant:"outline",onClick:N,className:"w-full sm:w-auto mb-2 sm:mb-0",children:[e.jsx(ns,{className:"h-4 w-4 mr-2"})," Imprimir Pedido"]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(S,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(S,{onClick:()=>b.mutate(i),disabled:b.isPending||i===o.status,children:b.isPending?"Salvando...":"Salvar Alterações"})]})]})]})})},Ne=({className:s,...a})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:k("mx-auto flex w-full justify-center",s),...a});Ne.displayName="Pagination";const ye=g.forwardRef(({className:s,...a},t)=>e.jsx("ul",{ref:t,className:k("flex flex-row items-center gap-1",s),...a}));ye.displayName="PaginationContent";const _=g.forwardRef(({className:s,...a},t)=>e.jsx("li",{ref:t,className:k("",s),...a}));_.displayName="PaginationItem";const q=({className:s,isActive:a,size:t="icon",...h})=>e.jsx("a",{"aria-current":a?"page":void 0,className:k(Be({variant:a?"outline":"ghost",size:t}),s),...h});q.displayName="PaginationLink";const we=({className:s,...a})=>e.jsxs(q,{"aria-label":"Go to previous page",size:"default",className:k("gap-1 pl-2.5",s),...a,children:[e.jsx(ds,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});we.displayName="PaginationPrevious";const Ce=({className:s,...a})=>e.jsxs(q,{"aria-label":"Go to next page",size:"default",className:k("gap-1 pr-2.5",s),...a,children:[e.jsx("span",{children:"Next"}),e.jsx(ms,{className:"h-4 w-4"})]});Ce.displayName="PaginationNext";const V=({className:s,...a})=>e.jsxs("span",{"aria-hidden":!0,className:k("flex h-9 w-9 items-center justify-center",s),...a,children:[e.jsx(us,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]});V.displayName="PaginationEllipsis";const fs=({currentPage:s,totalPages:a,onPageChange:t})=>{if(a<=1)return null;const i=(()=>{const r=[],m=Math.max(1,s-Math.floor(2.5)),c=Math.min(a,m+5-1);if(c-m+1<5){const x=Math.max(1,c-5+1);for(let p=x;p<=c;p++)r.push(p)}else for(let x=m;x<=c;x++)r.push(x);return r})();return e.jsx(Ne,{children:e.jsxs(ye,{children:[e.jsx(_,{children:e.jsx(we,{onClick:()=>t(s-1),className:k(s===1&&"pointer-events-none opacity-50")})}),i[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx(_,{children:e.jsx(q,{onClick:()=>t(1),children:"1"})}),i[0]>2&&e.jsx(_,{children:e.jsx(V,{})})]}),i.map(r=>e.jsx(_,{children:e.jsx(q,{isActive:r===s,onClick:()=>t(r),children:r})},r)),i[i.length-1]<a&&e.jsxs(e.Fragment,{children:[i[i.length-1]<a-1&&e.jsx(_,{children:e.jsx(V,{})}),e.jsx(_,{children:e.jsx(q,{onClick:()=>t(a),children:a})})]}),e.jsx(_,{children:e.jsx(Ce,{onClick:()=>t(s+1),className:k(s===a&&"pointer-events-none opacity-50")})})]})})};var O="Checkbox",[js,Ws]=Fe(O),[bs,U]=js(O);function vs(s){const{__scopeCheckbox:a,checked:t,children:h,defaultChecked:i,disabled:r,form:o,name:m,onCheckedChange:c,required:x,value:p="on",internal_do_not_use_render:b}=s,[N,y]=$e({prop:t,defaultProp:i??!1,onChange:c,caller:O}),[u,f]=g.useState(null),[v,n]=g.useState(null),l=g.useRef(!1),j=u?!!o||!!u.closest("form"):!0,A={checked:N,disabled:r,setChecked:y,control:u,setControl:f,name:m,form:o,value:p,hasConsumerStoppedPropagationRef:l,required:x,defaultChecked:D(i)?!1:i,isFormControl:j,bubbleInput:v,setBubbleInput:n};return e.jsx(bs,{scope:a,...A,children:Ns(b)?b(A):h})}var ke="CheckboxTrigger",Ee=g.forwardRef(({__scopeCheckbox:s,onKeyDown:a,onClick:t,...h},i)=>{const{control:r,value:o,disabled:m,checked:c,required:x,setControl:p,setChecked:b,hasConsumerStoppedPropagationRef:N,isFormControl:y,bubbleInput:u}=U(ke,s),f=se(i,p),v=g.useRef(c);return g.useEffect(()=>{const n=r==null?void 0:r.form;if(n){const l=()=>b(v.current);return n.addEventListener("reset",l),()=>n.removeEventListener("reset",l)}},[r,b]),e.jsx(H.button,{type:"button",role:"checkbox","aria-checked":D(c)?"mixed":c,"aria-required":x,"data-state":De(c),"data-disabled":m?"":void 0,disabled:m,value:o,...h,ref:f,onKeyDown:Z(a,n=>{n.key==="Enter"&&n.preventDefault()}),onClick:Z(t,n=>{b(l=>D(l)?!0:!l),u&&y&&(N.current=n.isPropagationStopped(),N.current||n.stopPropagation())})})});Ee.displayName=ke;var X=g.forwardRef((s,a)=>{const{__scopeCheckbox:t,name:h,checked:i,defaultChecked:r,required:o,disabled:m,value:c,onCheckedChange:x,form:p,...b}=s;return e.jsx(vs,{__scopeCheckbox:t,checked:i,defaultChecked:r,disabled:m,required:o,onCheckedChange:x,name:h,form:p,value:c,internal_do_not_use_render:({isFormControl:N})=>e.jsxs(e.Fragment,{children:[e.jsx(Ee,{...b,ref:a,__scopeCheckbox:t}),N&&e.jsx(_e,{__scopeCheckbox:t})]})})});X.displayName=O;var Pe="CheckboxIndicator",Se=g.forwardRef((s,a)=>{const{__scopeCheckbox:t,forceMount:h,...i}=s,r=U(Pe,t);return e.jsx(Oe,{present:h||D(r.checked)||r.checked===!0,children:e.jsx(H.span,{"data-state":De(r.checked),"data-disabled":r.disabled?"":void 0,...i,ref:a,style:{pointerEvents:"none",...s.style}})})});Se.displayName=Pe;var Ae="CheckboxBubbleInput",_e=g.forwardRef(({__scopeCheckbox:s,...a},t)=>{const{control:h,hasConsumerStoppedPropagationRef:i,checked:r,defaultChecked:o,required:m,disabled:c,name:x,value:p,form:b,bubbleInput:N,setBubbleInput:y}=U(Ae,s),u=se(t,y),f=ls(r),v=ze(h);g.useEffect(()=>{const l=N;if(!l)return;const j=window.HTMLInputElement.prototype,L=Object.getOwnPropertyDescriptor(j,"checked").set,z=!i.current;if(f!==r&&L){const $=new Event("click",{bubbles:z});l.indeterminate=D(r),L.call(l,D(r)?!1:r),l.dispatchEvent($)}},[N,f,r,i]);const n=g.useRef(D(r)?!1:r);return e.jsx(H.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??n.current,required:m,disabled:c,name:x,value:p,form:b,...a,tabIndex:-1,ref:u,style:{...a.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});_e.displayName=Ae;function Ns(s){return typeof s=="function"}function D(s){return s==="indeterminate"}function De(s){return D(s)?"indeterminate":s?"checked":"unchecked"}const J=g.forwardRef(({className:s,...a},t)=>e.jsx(X,{ref:t,className:k("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(Se,{className:k("flex items-center justify-center text-current"),children:e.jsx(M,{className:"h-4 w-4"})})}));J.displayName=X.displayName;const Te={pending:{label:"Pendente",icon:ve,color:"bg-yellow-500 hover:bg-yellow-600"},preparing:{label:"Em Preparação",icon:M,color:"bg-orange-500 hover:bg-orange-600"},ready:{label:"Pronto",icon:M,color:"bg-green-500 hover:bg-green-600"},delivering:{label:"Em Entrega",icon:M,color:"bg-indigo-500 hover:bg-indigo-600"},delivered:{label:"Entregue",icon:M,color:"bg-primary hover:bg-primary/90"},cancelled:{label:"Cancelado",icon:te,color:"bg-destructive hover:bg-destructive/90"},pending_payment:{label:"Aguardando Pag.",icon:is,color:"bg-gray-500 hover:bg-gray-600"}},ys=[{value:"pending",label:"Mudar para Pendente"},{value:"preparing",label:"Mudar para Em Preparação"},{value:"ready",label:"Mudar para Pronto"},{value:"delivering",label:"Mudar para Em Entrega"},{value:"delivered",label:"Mudar para Entregue"},{value:"cancelled",label:"Mudar para Cancelado"},{value:"pending_payment",label:"Mudar para Aguardando Pag."},{value:"delete",label:"Excluir Permanentemente"}],Q=12,ws=async(s,a,t)=>{const h=t*Q,i=h+Q-1;let r=T.from("orders").select("*, customer:customers(name, phone)",{count:"exact"}).eq("restaurant_id",s);a!=="all"&&(r=r.eq("status",a));const{data:o,error:m,count:c}=await r.order("created_at",{ascending:!1}).range(h,i);if(m)throw new Error(`Erro ao buscar pedidos: ${m.message}`);return{orders:o,count:c||0}},Cs=({order:s,onViewDetails:a,onAccept:t,onDecline:h,onDelete:i,isSelected:r,onSelect:o})=>{var p;const m=Te[s.status||"pending"],c=((p=s.customer)==null?void 0:p.name)||"Cliente Desconhecido",x=s.created_at?new Date(s.created_at).getTime().toString().slice(-4):"N/A";return e.jsxs(re,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col relative",children:[e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx(J,{checked:r,onCheckedChange:b=>o(s.id,!!b),className:"h-5 w-5"})}),e.jsxs(Ue,{className:"flex flex-row items-center justify-between space-y-0 pb-2 pl-12",children:[e.jsxs(Xe,{className:"text-lg font-bold flex items-center gap-2",children:["Pedido #",x]}),e.jsxs(rs,{className:k("text-white",m.color),children:[e.jsx(m.icon,{className:"h-3 w-3 mr-1"}),m.label]})]}),e.jsxs(ne,{className:"space-y-2 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",c]}),e.jsx("p",{className:"text-2xl font-extrabold text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]}),e.jsxs("div",{className:"flex justify-end pt-2 border-t gap-2",children:[(s.status==="pending"||s.status==="pending_payment")&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{variant:"destructive",size:"sm",onClick:()=>h(s.id),children:[e.jsx(te,{className:"h-4 w-4 mr-1"})," Recusar"]}),e.jsxs(S,{variant:"default",size:"sm",onClick:()=>t(s.id),children:[e.jsx(M,{className:"h-4 w-4 mr-1"})," Aceitar"]})]}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>a(s),children:"Detalhes"}),e.jsxs(me,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(S,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",children:e.jsx(cs,{className:"h-4 w-4"})})}),e.jsxs(he,{children:[e.jsxs(xe,{children:[e.jsx(pe,{children:"Tem certeza que deseja excluir?"}),e.jsxs(ge,{children:["Esta ação é permanente. O pedido #",x," será excluído permanentemente do sistema, incluindo todos os itens associados."]})]}),e.jsxs(fe,{children:[e.jsx(je,{children:"Cancelar"}),e.jsx(be,{onClick:()=>i(s.id),className:"bg-destructive hover:bg-destructive/90",children:"Excluir Permanentemente"})]})]})]})]})]})]})},ks=({status:s,onViewDetails:a,restaurantId:t,selectedOrders:h,setSelectedOrders:i,totalOrdersInView:r})=>{const o=G(),{stopSoundLoop:m}=os(),[c,x]=g.useState(0),{data:p,isLoading:b,isError:N,error:y,refetch:u}=K({queryKey:["orders",s,t,c],queryFn:()=>ws(t,s,c),enabled:!!t}),f=(p==null?void 0:p.orders)||[],v=(p==null?void 0:p.count)||0,n=Math.ceil(v/Q),l=B({mutationFn:async({orderId:d,newStatus:w})=>{const C=w==="pending"?"preparing":w,{error:R}=await T.from("orders").update({status:C}).eq("id",d);if(R)throw new Error(R.message);return C},onSuccess:d=>{P.success(`Pedido ${d==="preparing"?"aceito":"recusado"} com sucesso!`),o.invalidateQueries({queryKey:["orders"]})},onError:d=>P.error(`Erro ao atualizar pedido: ${d.message}`)}),j=B({mutationFn:async d=>{const{error:w}=await T.from("orders").delete().eq("id",d);if(w)throw new Error(w.message)},onSuccess:()=>{P.success("Pedido excluído permanentemente."),o.invalidateQueries({queryKey:["orders"]})},onError:d=>P.error(`Erro ao excluir pedido: ${d.message}`)}),A=d=>{m(),l.mutate({orderId:d,newStatus:"preparing"})},L=d=>{m(),l.mutate({orderId:d,newStatus:"cancelled"})},z=d=>{m(),a(d)},$=d=>{j.mutate(d)},Re=g.useCallback(d=>{x(d-1)},[]),Ie=g.useCallback((d,w)=>{i(C=>w?[...C,d]:C.filter(R=>R!==d))},[i]),Me=g.useCallback(d=>{if(d){const w=f.map(C=>C.id);i(C=>[...new Set([...C,...w])])}else{const w=new Set(f.map(C=>C.id));i(C=>C.filter(R=>!w.has(R)))}},[f,i]),qe=f.length>0&&f.every(d=>h.includes(d.id));return b?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((d,w)=>e.jsx(re,{children:e.jsx(ne,{className:"p-4 space-y-3",children:e.jsx(E,{className:"h-32 w-full"})})},w))}):N?e.jsxs(Ve,{variant:"destructive",children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx(Ge,{children:"Erro ao carregar pedidos"}),e.jsx(He,{children:y instanceof Error?y.message:"Ocorreu um erro desconhecido."}),e.jsxs(S,{onClick:()=>u(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]}):!f||f.length===0?e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg border",children:[e.jsx(ve,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifique o status selecionado ou aguarde novos pedidos."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg bg-muted/50",children:[e.jsx(J,{checked:qe,onCheckedChange:Me,className:"h-5 w-5"}),e.jsxs("span",{className:"text-sm font-medium",children:["Selecionar todos (",f.length,") nesta página."]}),r>0&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-auto",children:[r," pedidos selecionados no total."]})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:f.map(d=>e.jsx(Cs,{order:d,onViewDetails:z,onAccept:A,onDecline:L,onDelete:$,isSelected:h.includes(d.id),onSelect:Ie},d.id))}),n>1&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(fs,{currentPage:c+1,totalPages:n,onPageChange:Re})})]})},Ys=()=>{const{restaurant:s}=Le(),a=G(),[t,h]=g.useState(null),[i,r]=g.useState(!1),[o,m]=g.useState([]),[c,x]=g.useState(""),p=n=>{h(n),r(!0)},b=()=>{r(!1),h(null)},N=()=>{a.invalidateQueries({queryKey:["orders"]}),P.info("Atualizando pedidos...",{description:"Buscando novos dados no servidor."})},y=B({mutationFn:async({orderIds:n,action:l})=>{if(l==="delete"){const{error:j}=await T.from("orders").delete().in("id",n);if(j)throw new Error(j.message);return"deleted"}else{const j=l==="pending"?"preparing":l,{error:A}=await T.from("orders").update({status:j}).in("id",n);if(A)throw new Error(A.message);return"updated"}},onSuccess:(n,l)=>{if(n==="deleted")P.success(`${l.orderIds.length} pedidos excluídos permanentemente.`);else{const j=Te[l.action].label;P.success(`${l.orderIds.length} pedidos atualizados para "${j}".`)}m([]),x(""),a.invalidateQueries({queryKey:["orders"]})},onError:n=>{P.error(`Erro na ação em massa: ${n.message}`)}}),u=()=>{var n;!c||o.length===0||(c==="delete"?(n=document.getElementById("mass-delete-trigger"))==null||n.click():y.mutate({orderIds:o,action:c}))},f=[{value:"pending_payment",label:"Aguardando Pag."},{value:"pending",label:"Pendentes"},{value:"preparing",label:"Em Preparação"},{value:"ready",label:"Prontos"},{value:"delivering",label:"Em Entrega"},{value:"delivered",label:"Entregues"},{value:"cancelled",label:"Cancelados"},{value:"all",label:"Todos"}],v=y.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(gs,{order:t,isOpen:i,onClose:b}),e.jsxs(me,{children:[e.jsx(ue,{asChild:!0,children:e.jsx("button",{id:"mass-delete-trigger",className:"hidden"})}),e.jsxs(he,{children:[e.jsxs(xe,{children:[e.jsxs(pe,{children:["Tem certeza que deseja excluir ",o.length," pedidos?"]}),e.jsxs(ge,{children:["Esta ação é permanente. ",o.length," pedidos serão excluídos permanentemente do sistema."]})]}),e.jsxs(fe,{children:[e.jsx(je,{children:"Cancelar"}),e.jsx(be,{onClick:()=>y.mutate({orderIds:o,action:"delete"}),className:"bg-destructive hover:bg-destructive/90",disabled:v,children:v?"Excluindo...":"Excluir Permanentemente"})]})]})]}),e.jsxs("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(S,{variant:"outline",onClick:N,children:[e.jsx(ae,{className:"h-4 w-4 mr-2"})," Atualizar Dados"]})}),o.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-lg bg-card shadow-lg animate-fade-in",children:[e.jsx(hs,{className:"h-5 w-5 text-primary mr-2"}),e.jsxs("span",{className:"text-sm font-medium mr-4",children:[o.length," selecionado(s)"]}),e.jsxs(oe,{value:c,onValueChange:n=>x(n),children:[e.jsx(le,{className:"w-[200px]",children:e.jsx(ie,{placeholder:"Ação em Massa"})}),e.jsx(ce,{children:ys.map(n=>e.jsx(de,{value:n.value,children:n.label},n.value))})]}),e.jsx(S,{onClick:u,disabled:!c||v,children:v?e.jsx(Ke,{className:"h-4 w-4 animate-spin"}):"Aplicar"})]})]}),s!=null&&s.id?e.jsxs(Je,{defaultValue:"pending",children:[e.jsx(Ze,{className:"w-full overflow-x-auto justify-start",children:f.map(n=>e.jsx(We,{value:n.value,className:"whitespace-nowrap",children:n.label},n.value))}),f.map(n=>e.jsx(Ye,{value:n.value,className:"mt-6",children:e.jsx(ks,{status:n.value,onViewDetails:p,restaurantId:s.id,selectedOrders:o,setSelectedOrders:m,totalOrdersInView:o.length})},n.value))]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Carregando dados do restaurante..."})]})]})]})};export{Ys as default};
