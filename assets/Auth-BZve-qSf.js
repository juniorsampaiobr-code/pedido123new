import{j as e}from"./tanstack-C7aOFagJ.js";import{h as z,i as T,r as s,L as O}from"./vendor-DjsPZZVP.js";import{L as _}from"./Logo-mvnXOJpC.js";import{s as d,C as $,d as B,e as G,f as H,b as J,L as p,I as N,P as M,B as I,g as V,u as o}from"./index-CzF2IRzB.js";import{S as W}from"./separator-BJyWmt9G.js";import"./supabase-BAEEEeUB.js";const L=n=>n.replace(/\D/g,""),K=async()=>{const{data:n,error:l}=await d.from("restaurants").select("id").eq("is_active",!0).order("created_at",{ascending:!1}).limit(1).single();return l&&l.code!=="PGRST116"?(console.error("Error fetching active restaurant ID:",l),null):(n==null?void 0:n.id)||null},se=()=>{const n=z(),l=T(),[v,m]=s.useState(!1),[i,E]=s.useState(!1),[h,P]=s.useState(""),[f,U]=s.useState(""),[g,k]=s.useState(""),[x,R]=s.useState(""),[Q,w]=s.useState(null),[X,S]=s.useState(null),[u,A]=s.useState(null),[y,F]=s.useState(!0);s.useEffect(()=>{K().then(t=>{A(t),F(!1)})},[]);const C=t=>{const a=window.location.origin,r=window.location.pathname;return`${a}${r}#/menu/${t}`};s.useEffect(()=>{const{data:{subscription:t}}=d.auth.onAuthStateChange((a,r)=>{var c;if(S(r),w((r==null?void 0:r.user)??null),r!=null&&r.user&&u)if(((c=l.state)==null?void 0:c.from)==="/checkout")console.log("Redirecting customer to checkout after login."),n("/checkout",{replace:!0});else{const b=C(u);console.log("Redirecting customer to menu:",b),window.location.href=b}});return d.auth.getSession().then(({data:{session:a}})=>{var r;if(S(a),w((a==null?void 0:a.user)??null),a!=null&&a.user&&u){const c=(r=l.state)==null?void 0:r.from;if(c==="/checkout")console.log("User already logged in, redirecting to checkout:",c),n("/checkout",{replace:!0});else{const j=C(u);console.log("User already logged in, redirecting to menu:",j),window.location.href=j}}}),()=>t.unsubscribe()},[n,u,l.state]);const q=()=>g.trim()?L(x).length!==11?(o.error("O Telefone deve conter 11 dígitos (DDD + 9 dígitos)."),!1):h.trim()?f.length<6?(o.error("A Senha deve ter pelo menos 6 caracteres."),!1):!0:(o.error("O Email é obrigatório."),!1):(o.error("O Nome Completo é obrigatório."),!1),D=async t=>{if(t.preventDefault(),m(!0),!u){o.error("Nenhum restaurante ativo encontrado para redirecionamento."),m(!1);return}try{if(i){if(!q()){m(!1);return}const a=L(x),{data:r,error:c}=await d.auth.signUp({email:h,password:f,options:{data:{full_name:g,phone:a}}});if(c)throw c;r.session?o.success("Conta criada e login efetuado com sucesso!"):o.success("Conta criada! Verifique seu email para confirmar.")}else{const{error:a}=await d.auth.signInWithPassword({email:h,password:f});if(a)throw a;o.success("Login realizado com sucesso!")}}catch(a){a.message.includes("Email not confirmed")?o.error("Por favor, verifique seu e-mail para confirmar sua conta antes de fazer login."):o.error(a.message||"Erro ao processar autenticação")}finally{m(!1)}};return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(_,{className:"justify-center mb-4"})}),e.jsxs($,{className:"shadow-xl border-2",children:[e.jsxs(B,{className:"space-y-1",children:[e.jsx(G,{className:"text-2xl font-bold text-center",children:i?"Crie sua conta":"Acesse sua conta"}),e.jsx(H,{className:"text-center",children:i?"Preencha os campos para começar":"Utilize seu email e senha para fazer login"})]}),e.jsxs(J,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"fullName",children:"Nome Completo *"}),e.jsx(N,{id:"fullName",type:"text",placeholder:"Seu nome completo",value:g,onChange:t=>k(t.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"phone",children:"Telefone *"}),e.jsx(M,{id:"phone",value:x,onChange:t=>R(t.target.value),required:!0,className:"h-12"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formato: (99) 99999-9999"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"email",children:"Email *"}),e.jsx(N,{id:"email",type:"email",placeholder:"seu@email.com",value:h,onChange:t=>P(t.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"password",children:"Senha *"}),e.jsx(N,{id:"password",type:"password",placeholder:"••••••••",value:f,onChange:t=>U(t.target.value),required:!0,className:"h-12"})]}),e.jsx(I,{type:"submit",className:"w-full",size:"lg",disabled:v||y,children:v||y?e.jsx(V,{className:"h-4 w-4 animate-spin mr-2"}):i?"Criar conta":"Entrar"})]}),e.jsx("div",{className:"text-center",children:e.jsx(I,{variant:"link",type:"button",className:"p-0 h-auto",onClick:()=>E(!i),children:i?"Já tem uma conta? Faça login":"Não tem uma conta? Crie uma agora"})}),e.jsx(W,{className:"my-4"}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["É o dono de uma loja? ",e.jsx(O,{to:"/admin-auth",className:"text-primary hover:underline",children:"Acesse o painel de administração"})]})]})]})]})})};export{se as default};
