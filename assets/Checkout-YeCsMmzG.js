import{b as ue,j as e,u as Zr,c as Ie}from"./tanstack-d4AvmB45.js";import{r as f,u as Qr,h as Xr,j as Hr,L as Me}from"./vendor-CnEXr6gt.js";import{s as R}from"./client-D5i5GwB9.js";import{c as Wr,u as g,d as dr,e as Le,P as Ne,f as Ae,g as Jr,h as Yr,i as et,a as fe,L as me,p as rt,b as We}from"./index-DGr-FHe_.js";import{u as tt}from"./use-auth-status-b07NBuTX.js";import{o as lr,s as V,e as nt,u as Je,C as le,t as Ye}from"./types-DKlirIXB.js";import{B as Q}from"./button-yCXBISoV.js";import{C as X,b as H,c as W,a as J}from"./card-ByeNXrRP.js";import{L as T,I as ae}from"./label-DTW1f4gm.js";import{T as ot}from"./textarea-BXm_PSDk.js";import{c as ur,R as at,I as st}from"./index-L9Fububj.js";import{u as it}from"./index-DrlxvCXN.js";import{u as ct}from"./index-KNP7Yozt.js";import{S as er}from"./separator-B1OWCPVI.js";import{A as ne,a as se,b as ie}from"./alert-C5Wm4AQP.js";import{L as dt,Z as lt}from"./LazyMap-ZMNxUrJU.js";import{P as ut,M as mt}from"./PhoneInput-Du77Q7O5.js";import{C as ft,L as pt}from"./CustomerProfileModal-BZDIBBSw.js";import{D as rr,a as tr,b as ht,c as xt,d as gt}from"./dialog-BAjXRhMv.js";import{C as mr}from"./credit-card-CyoX-D6J.js";import{C as yt}from"./CpfCnpjInput-BDv-Lv2A.js";import{M as Oe,R as jt}from"./refresh-cw-u3P25bav.js";import{A as vt,a as wt,b as bt,c as _t,d as Nt,e as Ct,g as Et}from"./alert-dialog-DxqO34et.js";import{C as be}from"./circle-alert-CqkmdoJd.js";import{F as nr,b as Pt,d as St}from"./form-i_kzg4Wx.js";import{T as or}from"./terminal-B2Myb-xw.js";import{A as Rt}from"./arrow-left-CjbiionM.js";import{U as ar}from"./user-DrM4_4cc.js";import{T as ve}from"./truck-BMVaSLAs.js";import{C as It}from"./circle-check-big-BNeTSmVg.js";import{S as Mt}from"./save-DYAslvdk.js";import{D as At}from"./dollar-sign-CwpCbn5w.js";import"./supabase-BZV_3FV3.js";import"./skeleton-Drr-9Pql.js";import"./package-Iouc9VBC.js";import"./check-D6RzLTE5.js";import"./circle-x-D59uOWeE.js";import"./euro-DRuq8dx8.js";import"./format-BeKxgCCE.js";import"./pt-BR-CbDebePx.js";import"./index-V8ayWygS.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=Wr("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Ft=async r=>{const{data:o,error:t}=await R.from("payment_settings").select("mercado_pago_public_key").eq("restaurant_id",r).limit(1).single();if(t&&t.code!=="PGRST116")throw new Error(`Error fetching payment settings: ${t.message}`);return(o==null?void 0:o.mercado_pago_public_key)||null},fr=r=>ue({queryKey:["mercadoPagoPublicKey",r],queryFn:()=>Ft(r),enabled:!!r,staleTime:1/0}),Lt=(r,o,t,s)=>{const c=(t-r)*(Math.PI/180),h=(s-o)*(Math.PI/180),a=Math.sin(c/2)*Math.sin(c/2)+Math.cos(r*(Math.PI/180))*Math.cos(t*(Math.PI/180))*Math.sin(h/2)*Math.sin(h/2);return 6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))},sr=async r=>{if(typeof google>"u"||!google.maps)return console.error("Google Maps SDK não carregado"),g.error("Serviço de mapa não disponível. Tente novamente."),null;const o=r.replace(/\s+/g," ").trim(),t=new google.maps.Geocoder;return new Promise(s=>{const d=setTimeout(()=>{console.error("Timeout na requisição de geocodificação"),g.error("A requisição para encontrar o endereço demorou muito. Tente novamente."),s(null)},1e4);t.geocode({address:o,componentRestrictions:{country:"BR"}},(c,h)=>{if(clearTimeout(d),h==="OK"&&c&&c.length>0){const a=c[0].geometry.location,w=a.lat(),E=a.lng();if(Number.isFinite(w)&&Number.isFinite(E)){console.log("LOG: geocodeAddress (Google Maps Service) - Geocodificação bem-sucedida. Coordenadas:",[w,E]),s({lat:w,lng:E});return}}console.warn(`LOG: geocodeAddress (Google Maps Service) - Falha na busca. Status: ${h}. Endereço: ${o}`),Tt(o).then(s)})})},Tt=async r=>{const o=new AbortController,t=setTimeout(()=>o.abort(),1e4);try{const s=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(r)}&limit=1&addressdetails=1`;console.log("LOG: geocodeAddress - URL da API (Nominatim):",s);const d=await fetch(s,{signal:o.signal,headers:{"User-Agent":"Pedido123-App/1.0 (https://juniorsampaiobr-code.github.io/pedido123new/)"}});if(!d.ok)return console.error("LOG: geocodeAddress (Nominatim) - Resposta da API não OK. Status:",d.status),null;const c=await d.json();if(c&&Array.isArray(c)&&c.length>0){const h=c[0],a=parseFloat(h.lat),w=parseFloat(h.lon);if(Number.isFinite(a)&&Number.isFinite(w))return console.log("LOG: geocodeAddress (Nominatim) - Geocodificação bem-sucedida. Coordenadas:",[a,w]),clearTimeout(t),{lat:a,lng:w}}return console.warn("LOG: geocodeAddress (Nominatim) - Falha. Nenhum resultado encontrado ou coordenadas inválidas para:",r),g.error("Não foi possível encontrar o endereço. Verifique todos os campos e tente novamente."),null}catch(s){return s instanceof Error&&s.name==="AbortError"?(console.error("LOG: geocodeAddress (Nominatim) - Timeout na requisição (10s). Endereço:",r),g.error("A requisição para encontrar o endereço demorou muito. Tente novamente.")):(console.error("LOG: geocodeAddress (Nominatim) - Erro durante a requisição:",s),g.error("Ocorreu um erro ao buscar o endereço. Tente novamente.")),null}finally{clearTimeout(t)}},ir=(r,o,t)=>{const s=Lt(o[0],o[1],r[0],r[1]),d=t.find(c=>s<=c.max_distance_km);if(d){const c=d.delivery_fee||0,h=d.min_delivery_time_minutes||0,a=h+15;return{fee:parseFloat(c.toFixed(2)),minTime:h,maxTime:a}}return null};var Te="Radio",[kt,pr]=dr(Te),[Dt,Gt]=kt(Te),hr=f.forwardRef((r,o)=>{const{__scopeRadio:t,name:s,checked:d=!1,required:c,disabled:h,value:a="on",onCheck:w,form:E,...P}=r,[j,A]=f.useState(null),S=Le(o,G=>A(G)),M=f.useRef(!1),k=j?E||!!j.closest("form"):!0;return e.jsxs(Dt,{scope:t,checked:d,disabled:h,children:[e.jsx(Ne.button,{type:"button",role:"radio","aria-checked":d,"data-state":jr(d),"data-disabled":h?"":void 0,disabled:h,value:a,...P,ref:S,onClick:Ae(r.onClick,G=>{d||w==null||w(),k&&(M.current=G.isPropagationStopped(),M.current||G.stopPropagation())})}),k&&e.jsx(yr,{control:j,bubbles:!M.current,name:s,value:a,checked:d,required:c,disabled:h,form:E,style:{transform:"translateX(-100%)"}})]})});hr.displayName=Te;var xr="RadioIndicator",gr=f.forwardRef((r,o)=>{const{__scopeRadio:t,forceMount:s,...d}=r,c=Gt(xr,t);return e.jsx(Jr,{present:s||c.checked,children:e.jsx(Ne.span,{"data-state":jr(c.checked),"data-disabled":c.disabled?"":void 0,...d,ref:o})})});gr.displayName=xr;var $t="RadioBubbleInput",yr=f.forwardRef(({__scopeRadio:r,control:o,checked:t,bubbles:s=!0,...d},c)=>{const h=f.useRef(null),a=Le(h,c),w=ct(t),E=Yr(o);return f.useEffect(()=>{const P=h.current;if(!P)return;const j=window.HTMLInputElement.prototype,S=Object.getOwnPropertyDescriptor(j,"checked").set;if(w!==t&&S){const M=new Event("click",{bubbles:s});S.call(P,t),P.dispatchEvent(M)}},[w,t,s]),e.jsx(Ne.input,{type:"radio","aria-hidden":!0,defaultChecked:t,...d,tabIndex:-1,ref:a,style:{...d.style,...E,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});yr.displayName=$t;function jr(r){return r?"checked":"unchecked"}var Vt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Ce="RadioGroup",[qt,ro]=dr(Ce,[ur,pr]),vr=ur(),wr=pr(),[Bt,zt]=qt(Ce),br=f.forwardRef((r,o)=>{const{__scopeRadioGroup:t,name:s,defaultValue:d,value:c,required:h=!1,disabled:a=!1,orientation:w,dir:E,loop:P=!0,onValueChange:j,...A}=r,S=vr(t),M=it(E),[k,G]=et({prop:c,defaultProp:d??null,onChange:j,caller:Ce});return e.jsx(Bt,{scope:t,name:s,required:h,disabled:a,value:k,onValueChange:G,children:e.jsx(at,{asChild:!0,...S,orientation:w,dir:M,loop:P,children:e.jsx(Ne.div,{role:"radiogroup","aria-required":h,"aria-orientation":w,"data-disabled":a?"":void 0,dir:M,...A,ref:o})})})});br.displayName=Ce;var _r="RadioGroupItem",Nr=f.forwardRef((r,o)=>{const{__scopeRadioGroup:t,disabled:s,...d}=r,c=zt(_r,t),h=c.disabled||s,a=vr(t),w=wr(t),E=f.useRef(null),P=Le(o,E),j=c.value===d.value,A=f.useRef(!1);return f.useEffect(()=>{const S=k=>{Vt.includes(k.key)&&(A.current=!0)},M=()=>A.current=!1;return document.addEventListener("keydown",S),document.addEventListener("keyup",M),()=>{document.removeEventListener("keydown",S),document.removeEventListener("keyup",M)}},[]),e.jsx(st,{asChild:!0,...a,focusable:!h,active:j,children:e.jsx(hr,{disabled:h,required:c.required,checked:j,...w,...d,name:c.name,ref:P,onCheck:()=>c.onValueChange(d.value),onKeyDown:Ae(S=>{S.key==="Enter"&&S.preventDefault()}),onFocus:Ae(d.onFocus,()=>{var S;A.current&&((S=E.current)==null||S.click())})})})});Nr.displayName=_r;var Kt="RadioGroupIndicator",Cr=f.forwardRef((r,o)=>{const{__scopeRadioGroup:t,...s}=r,d=wr(t);return e.jsx(gr,{...d,...s,ref:o})});Cr.displayName=Kt;var Er=br,Pr=Nr,Ut=Cr;const Fe=f.forwardRef(({className:r,...o},t)=>e.jsx(Er,{className:fe("grid gap-2",r),...o,ref:t}));Fe.displayName=Er.displayName;const _e=f.forwardRef(({className:r,...o},t)=>e.jsx(Pr,{ref:t,className:fe("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...o,children:e.jsx(Ut,{className:"flex items-center justify-center",children:e.jsx(Ot,{className:"h-2.5 w-2.5 fill-current text-current"})})}));_e.displayName=Pr.displayName;var ke={};Object.defineProperty(ke,"__esModule",{value:!0});var Sr=ke.loadMercadoPago=void 0;const Rr="https://sdk.mercadopago.com/js/v2",Zt=/^https:\/\/sdk\.mercadopago\.com\/js\/v2\/?(\?.*)?$/,cr="MercadoPago has already been initialized in your window, please remove the duplicate import",Qt="MercadoPago.js not available",Xt="Failed to load MercadoPago.js",Ht=()=>{for(var r=document.querySelectorAll(`script[src^="${Rr}"`),o=0;o<r.length;o++){var t=r[o];if(Zt.test(t.src))return t}return null},Wt=()=>{const r=document.createElement("script");r.src=Rr;const o=document.head||document.body;if(!o)throw new Error("Expected document.body or document.head not to be null. MercadoPago requires a <body> or a <head> element, please add on your project.");return o.appendChild(r),r};let we=null;const Jt=()=>(we!==null||(we=new Promise((r,o)=>{if(typeof window>"u"){r(null);return}if(window.MercadoPago){console.warn(cr),r(window.MercadoPago);return}try{let t=Ht();t?console.warn(cr):t||(t=Wt()),t.addEventListener("load",()=>{window.MercadoPago?r(window.MercadoPago):o(new Error(Qt))}),t.addEventListener("error",()=>{o(new Error(Xt))})}catch(t){o(t);return}})),we);Sr=ke.loadMercadoPago=Jt;var Yt=function(r,o,t,s){function d(c){return c instanceof t?c:new t(function(h){h(c)})}return new(t||(t=Promise))(function(c,h){function a(P){try{E(s.next(P))}catch(j){h(j)}}function w(P){try{E(s.throw(P))}catch(j){h(j)}}function E(P){P.done?c(P.value):d(P.value).then(a,w)}E((s=s.apply(r,o||[])).next())})};class Z{static getInstance(){return Yt(this,void 0,void 0,function*(){if(this.publicKey)return this.loadedInstanceMercadoPago||(yield Sr(),this.loadedInstanceMercadoPago=!0),this.instanceMercadoPago||(this.instanceMercadoPago=new window.MercadoPago(this.publicKey,this.options)),this.instanceMercadoPago;console.error("Expected the PUBLIC_KEY to render the MercadoPago SDK React")})}}Z.publicKey=null;Z.options={};Z.instanceMercadoPago=void 0;Z.loadedInstanceMercadoPago=!1;function en(r,o){return Object.keys(r).length===Object.keys(o).length&&Object.keys(r).every(s=>Object.prototype.hasOwnProperty.call(o,s)&&r[s]===o[s])}const rn=(r,o)=>{const t=Object.assign(Object.assign({},o),{frontEndStack:"react"}),s=!en(Z.options,t);(r!==Z.publicKey||s)&&(Z.publicKey=r,Z.options=t,Z.instanceMercadoPago=void 0)},tn=({preferenceId:r,initPoint:o,onClose:t})=>{const{data:s,isLoading:d}=fr();return f.useEffect(()=>{if(s)try{rn(s,{locale:"pt-BR"})}catch(c){console.error("Erro ao inicializar Mercado Pago:",c),g.error("Erro ao carregar o SDK do Mercado Pago."),t();return}o&&(console.log("Redirecionando para o Mercado Pago:",o),window.location.href=o)},[s,t,o]),d||!s?e.jsx(rr,{open:!0,onOpenChange:t,children:e.jsx(tr,{className:"sm:max-w-[425px]",children:e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsx(me,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{children:"Carregando configurações de pagamento..."})]})})}):e.jsx(rr,{open:!0,onOpenChange:t,children:e.jsxs(tr,{className:"sm:max-w-[425px]",children:[e.jsxs(ht,{children:[e.jsxs(xt,{className:"flex items-center gap-2",children:[e.jsx(mr,{className:"h-5 w-5 text-primary"}),"Redirecionando para Pagamento"]}),e.jsx(gt,{children:"Você está sendo redirecionado para o checkout seguro do Mercado Pago."})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(me,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aguarde..."})]}),e.jsx(Q,{variant:"outline",onClick:t,children:"Cancelar e Voltar"})]})})},nn=({latitude:r,longitude:o,address:t,className:s})=>{const d=f.useMemo(()=>[r,o],[r,o]),c=f.useMemo(()=>[r,o],[r,o]);return e.jsxs(X,{className:fe("w-full",s),children:[e.jsxs(H,{children:[e.jsxs(W,{className:"text-lg flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5 text-primary"}),"Sua Localização"]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:t})]}),e.jsx(J,{className:"p-0",children:e.jsx("div",{className:"h-64 w-full rounded-b-lg overflow-hidden",children:e.jsx(dt,{center:c,markerPosition:d,onMarkerDragEnd:()=>{},zoom:16})})})]})},on=({isOpen:r,onConfirm:o})=>e.jsx(vt,{open:r,children:e.jsxs(wt,{children:[e.jsxs(bt,{children:[e.jsxs(_t,{className:"flex items-center gap-2 text-primary",children:[e.jsx(be,{className:"h-6 w-6"}),"Atenção ao Pagamento Online!"]}),e.jsxs(Nt,{children:["Você escolheu o pagamento online (Pix ou Cartão).",e.jsx("br",{}),e.jsx("br",{}),"Ao prosseguir, você será redirecionado para o checkout do Mercado Pago.",e.jsx("br",{}),e.jsx("br",{}),'**IMPORTANTE:** Se você escolher **PIX**, após o pagamento, você pode precisar clicar no botão **"Voltar ao site"** na tela do Mercado Pago para que seu pedido seja finalizado e rastreado corretamente.']})]}),e.jsx(Ct,{children:e.jsx(Et,{onClick:o,className:"w-full",children:"Entendi e Continuar"})})]})}),an=lr({zip_code:V().min(1,"CEP é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length===8,{message:"CEP deve ter 8 dígitos."}),street:V().min(1,"Rua é obrigatória."),number:V().min(1,"Número é obrigatório."),neighborhood:V().min(1,"Bairro é obrigatório."),city:V().min(1,"Cidade é obrigatória.")}),sn=lr({name:V().min(1,"Nome é obrigatório."),phone:V().min(1,"Telefone é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length>=10,{message:"O telefone deve ter pelo menos 10 dígitos."}),cpf_cnpj:V().min(1,"CPF/CNPJ é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length===11||r.length===14,{message:"CPF deve ter 11 dígitos ou CNPJ 14 dígitos."}),delivery_option:nt(["delivery","pickup"],{required_error:"Selecione uma opção de entrega."}),notes:V().optional(),payment_method_id:V().min(1,"Selecione um método de pagamento."),change_for:V().optional()}),cn=async r=>{const{data:o,error:t}=await R.from("restaurants").select("id, name, address, phone, email, street, number, neighborhood, city, zip_code, latitude, longitude, delivery_enabled").eq("id",r).eq("is_active",!0).limit(1).single();if(t)throw new Error(`Erro ao buscar restaurante: ${t.message}`);if(!o)throw new Error("Restaurante não encontrado ou inativo.");return o},dn=async r=>{const{data:o,error:t}=await R.from("delivery_zones").select("*").eq("restaurant_id",r).eq("is_active",!0).order("max_distance_km",{ascending:!0});if(t)throw new Error(`Erro ao buscar zonas de entrega: ${t.message}`);return o},ln=async r=>{const{data:o,error:t}=await R.from("payment_methods").select("*").eq("restaurant_id",r).eq("is_active",!0).order("name",{ascending:!0});if(t)throw new Error(`Erro ao buscar métodos de pagamento: ${t.message}`);return o},un=async r=>{const{data:o,error:t}=await R.from("customers").select("*").eq("user_id",r).limit(1).single();if(t&&t.code!=="PGRST116")throw new Error(t.message);return o||null},to=()=>{var Ue,Ze,Qe,Xe,He;const r=Qr(),o=Xr(),[t]=Hr(),s=Zr(),{items:d,totalAmount:c,clearCart:h}=rt(),{data:a,isLoading:w}=tt(),[E]=f.useState((Ue=o.state)==null?void 0:Ue.restaurantId),P=t.get("restaurantId"),j=E||P,{data:A}=fr(j),[S,M]=f.useState(!1),[k,G]=f.useState(!1),[pe,q]=f.useState(0),[ce,$]=f.useState(null),[Ee,B]=f.useState(!0),[Y,he]=f.useState(null),[Ir,Pe]=f.useState(!1),[Mr,Ar]=f.useState(null),[De,Or]=f.useState(null),[K,ee]=f.useState(!1),[Fr,Ge]=f.useState(!1),[$e,Se]=f.useState(null);f.useEffect(()=>{console.log("LOG: Checkout - User Status:",a?`Logged in as ${a.email}`:"Anonymous")},[a]);const{data:y,isLoading:Lr,isError:Tr,error:Ve,refetch:kr}=ue({queryKey:["checkoutRestaurantData",j],queryFn:()=>cn(j),enabled:!!j,staleTime:1/0}),{data:re,isLoading:Dr}=ue({queryKey:["checkoutDeliveryZones",j],queryFn:()=>dn(y.id),enabled:!!y,staleTime:1/0}),{data:U,isLoading:Gr}=ue({queryKey:["checkoutPaymentMethods",j],queryFn:()=>ln(y.id),enabled:!!y,staleTime:1/0}),{data:v,isLoading:qe,refetch:mn}=ue({queryKey:["checkoutCustomerData",a==null?void 0:a.id],queryFn:()=>un(a.id),enabled:!!a,staleTime:0}),xe=f.useMemo(()=>y!=null&&y.latitude&&(y!=null&&y.longitude)?[y.latitude,y.longitude]:null,[y]),Re=f.useCallback(async(n,i,m,x,p,u,C)=>{const b=[30,45];if(y&&y.delivery_enabled===!1){const _=`${i}, ${m}, ${p}, ${x}, ${n}`;let L=null;if(u&&C)L={lat:u,lng:C};else{G(!0);const te=g.loading("Validando endereço para frete grátis...");L=await sr(_),G(!1),g.dismiss(te)}if(!L)return q(0),$(null),B(!1),g.error("O endereço está errado ou incompleto, revise todos os campos e clique em salvar endereço."),{coords:null,fee:0,time:null,isValid:!1};if(he([L.lat,L.lng]),re&&re.length>0){const te=ir([L.lat,L.lng],xe,re);if(te)return q(0),$([te.minTime,te.maxTime]),B(!0),{coords:L,fee:0,time:[te.minTime,te.maxTime],isValid:!0}}return q(0),$(b),B(!0),{coords:L,fee:0,time:b,isValid:!0}}if(!y||!xe)return q(0),B(!0),$(b),{coords:null,fee:0,time:b,isValid:!0};const D=`${i}, ${m}, ${p}, ${x}, ${n}`;let F=null;if(u&&C)F={lat:u,lng:C};else{G(!0);const _=g.loading("Calculando taxa de entrega...");F=await sr(D),G(!1),g.dismiss(_)}if(!F)return q(0),$(null),B(!1),g.error("O endereço está errado ou incompleto, revise todos os campos e clique em salvar endereço."),{coords:null,fee:0,time:null,isValid:!1};if(he([F.lat,F.lng]),re&&re.length>0){const _=ir([F.lat,F.lng],xe,re);return _?(q(_.fee),$([_.minTime,_.maxTime]),B(!0),{coords:F,fee:_.fee,time:[_.minTime,_.maxTime],isValid:!0}):(q(0),$(null),B(!1),g.error("Endereço fora da área de entrega."),{coords:F,fee:0,time:null,isValid:!1})}else return q(0),$(b),B(!0),{coords:F,fee:0,time:b,isValid:!0}},[y,xe,re]),l=Je({resolver:Ye(sn),defaultValues:{name:"",phone:"",cpf_cnpj:"",delivery_option:"delivery",notes:"",payment_method_id:"",change_for:""},mode:"onBlur"}),N=Je({resolver:Ye(an),defaultValues:{zip_code:"",street:"",number:"",neighborhood:"",city:""},mode:"onBlur"}),O=l.watch("delivery_option"),$r=l.watch("payment_method_id"),oe=U==null?void 0:U.find(n=>n.id===$r),ge=(Ze=oe==null?void 0:oe.name)==null?void 0:Ze.includes("online"),de=(Qe=oe==null?void 0:oe.name)==null?void 0:Qe.includes("Dinheiro"),z=c+pe,I=N.watch(["zip_code","street","number","city","neighborhood"]);f.useEffect(()=>{const n=[15,30];O==="pickup"?(q(0),B(!0),ee(!0),$(n)):(ee(!1),$(null))},[O]),f.useEffect(()=>{if(v){let n="",i="",m="",x="",p="";if(v.address){const u=v.address.split(", ").map(C=>C.trim());u.length>=5?(n=u[0],i=u[1],m=u[2],x=u[3],p=u[4]):u.length>=4&&(n=u[0],m=u[1],x=u[2],p=u[3])}l.reset({...l.getValues(),name:v.name||"",phone:v.phone||"",cpf_cnpj:v.cpf_cnpj||"",change_for:""}),N.reset({zip_code:p,street:n,number:i,neighborhood:m,city:x}),v.address&&v.latitude&&v.longitude&&(he([v.latitude,v.longitude]),ee(!0),Re(p,n,i,x,m,v.latitude,v.longitude))}else if(a&&!qe){const n=a.user_metadata;l.reset({...l.getValues(),name:n.full_name||"",phone:n.phone||"",cpf_cnpj:n.cpf_cnpj||"",change_for:""})}},[v,l,a,qe,N,Re]);const ye=l.watch("change_for");f.useEffect(()=>{if(de&&ye&&ye.trim()!==""){const n=ye.replace(",","."),i=parseFloat(n);isNaN(i)?l.setError("change_for",{message:"O troco deve ser um número válido."}):i<z?l.setError("change_for",{message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z)}).`}):l.clearErrors("change_for")}else l.clearErrors("change_for")},[de,ye,z,l]);const je=Ie({mutationFn:async n=>{var u;const m=(u=(await R.auth.getUser()).data.user)==null?void 0:u.id;if(!(v!=null&&v.id)&&!m)throw new Error("ID do cliente ou usuário não encontrado.");const x=`${n.street}, ${n.number}, ${n.neighborhood}, ${n.city}, ${n.zip_code}`,p={user_id:(a==null?void 0:a.id)||null,name:l.getValues("name"),phone:l.getValues("phone"),email:(a==null?void 0:a.email)||null,cpf_cnpj:l.getValues("cpf_cnpj")||null,address:x,latitude:n.lat,longitude:n.lng};if(v!=null&&v.id){const{data:C,error:b}=await R.from("customers").update(p).eq("id",v.id).select().single();if(b)throw b;return C}else if(m){const{data:C,error:b}=await R.from("customers").insert(p).select().single();if(b)throw b;return C}else return{id:"anonymous",user_id:null,name:p.name,phone:p.phone,email:p.email,address:x,created_at:"",updated_at:"",latitude:n.lat,longitude:n.lng,cpf_cnpj:p.cpf_cnpj}},onSuccess:(n,i)=>{n.id!=="anonymous"&&s.invalidateQueries({queryKey:["checkoutCustomerData"]}),q(i.fee),$(i.time),B(i.isValid),ee(!0),he([i.lat,i.lng]),g.success("Endereço salvo e taxa de entrega calculada!")},onError:n=>{g.error(`Erro ao salvar endereço: ${n.message}`),ee(!1)}}),Vr=async()=>{if(O==="pickup")return;if(!await N.trigger()){g.error("Preencha todos os campos obrigatórios do endereço.");return}const i=N.getValues(),m=await Re(i.zip_code,i.street,i.number,i.city,i.neighborhood);if(!m.isValid){ee(!1);return}if(!m.coords){g.error("Não foi possível obter as coordenadas para salvar o endereço."),ee(!1);return}je.mutate({...i,lat:m.coords.lat,lng:m.coords.lng,fee:m.fee,time:m.time,isValid:m.isValid})},Be=Ie({mutationFn:async n=>{var u,C;(u=(await R.auth.getUser()).data.user)==null||u.id;const m=n.phone.replace(/\D/g,""),x=((C=n.cpf_cnpj)==null?void 0:C.replace(/\D/g,""))||null,p={user_id:(a==null?void 0:a.id)||null,name:n.name,phone:m,email:(a==null?void 0:a.email)||null,cpf_cnpj:x,address:O==="delivery"?`${I[1]}, ${I[2]}, ${I[4]}, ${I[3]}, ${I[0]}`:null,latitude:Y?Y[0]:null,longitude:Y?Y[1]:null};if(a)if(v){const{data:b,error:D}=await R.from("customers").update(p).eq("id",v.id).select().single();if(D)throw D;return b}else{const{data:b,error:D}=await R.from("customers").insert(p).select().single();if(D)throw D;return b}else{const{data:b,error:D}=await R.from("customers").insert(p).select().single();if(D)throw D;return b}},onSuccess:()=>{s.invalidateQueries({queryKey:["checkoutCustomerData"]})},onError:n=>{g.error(`Erro ao salvar dados do cliente: ${n.message}`)}}),ze=Ie({mutationFn:async({customerId:n,data:i})=>{if(!y)throw new Error("Dados do restaurante não disponíveis.");let m=null;if(de&&i.change_for&&i.change_for.trim()!==""){const _=i.change_for.replace(",","."),L=parseFloat(_);!isNaN(L)&&L>z&&(m=L)}let[x,p]=ce||[null,null];if((O==="delivery"||O==="pickup")&&(!x||!p)){const _=O==="pickup"?[15,30]:[30,45];x=_[0],p=_[1]}console.log("LOG: Tempo de entrega salvo no pedido:",x,p);const u={restaurant_id:y.id,customer_id:n,status:ge?"pending_payment":"pending",total_amount:z,delivery_fee:pe,delivery_address:O==="delivery"?`${I[1]}, ${I[2]}, ${I[4]}, ${I[3]}, ${I[0]}`:null,notes:i.notes,payment_method_id:i.payment_method_id,change_for:m,min_delivery_time_minutes:x,max_delivery_time_minutes:p},{data:C,error:b}=await R.from("orders").insert(u).select("id").single();if(b)throw b;const D=d.map(_=>({order_id:C.id,product_id:_.product.id,quantity:parseFloat(_.quantity.toFixed(3)),unit_price:parseFloat(_.product.price.toFixed(2)),subtotal:parseFloat(_.subtotal.toFixed(2)),notes:_.notes})),{error:F}=await R.from("order_items").insert(D);if(F)throw F;return C.id},onSuccess:n=>{s.invalidateQueries({queryKey:["orders"]})},onError:n=>{g.error(`Erro ao criar pedido: ${n.message}`)}}),qr=async n=>{if(console.log("LOG: onSubmit iniciado."),console.log("LOG: isOnlinePayment:",ge),console.log("LOG: deliveryOption:",O),console.log("LOG: isAddressSaved: ",K),console.log("LOG: change_for data:",n.change_for),de&&n.change_for&&n.change_for.trim()!==""){const x=n.change_for.replace(",","."),p=parseFloat(x);if(isNaN(p)){g.error("O troco deve ser um número válido.");return}if(p<z){l.setError("change_for",{type:"manual",message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z)}).`});return}}if(d.length===0){g.error("Seu carrinho está vazio."),r(`/menu/${j}`);return}if(O==="delivery"){if(!K){g.error("Você deve salvar e validar o endereço de entrega antes de finalizar o pedido.");return}if(!Ee){g.error("O endereço de entrega está fora da área de cobertura.");return}}let i;try{console.log("LOG: Criando/Atualizando cliente..."),i=(await Be.mutateAsync(n)).id,console.log("LOG: Cliente ID:",i)}catch(x){g.error(`Falha ao salvar cliente: ${x.message}`);return}let m;try{console.log("LOG: Criando pedido..."),m=await ze.mutateAsync({customerId:i,data:n}),console.log("LOG: Pedido ID:",m)}catch(x){g.error(`Falha ao criar pedido: ${x.message}`);return}ge?(console.log("LOG: Iniciando checkout Mercado Pago..."),await Br(m,n)):(console.log("LOG: Pagamento na entrega/retirada. Redirecionando para sucesso."),h(),r(`/order-success/${m}`,{replace:!0}))},Br=async(n,i)=>{if(!y)return;const m=window.location.origin+window.location.pathname,x=d.map(u=>({name:u.product.name,price:u.product.price,quantity:u.quantity})),p=g.loading("Preparando pagamento online...");try{console.log("LOG: Chamando Edge Function create-payment-preference...");const{data:u,error:C}=await R.functions.invoke("create-payment-preference",{body:{orderId:n,items:x,totalAmount:z,restaurantName:y.name,clientUrl:m,customerEmail:(a==null?void 0:a.email)||"cliente@anonimo.com",customerCpfCnpj:i.cpf_cnpj}});if(C)throw C;const{init_point:b}=u;console.log("LOG: Preferência MP criada. init_point:",b),Ar(n),Or(b),Pe(!0),g.dismiss(p)}catch(u){console.error("Erro ao criar preferência MP:",u),g.dismiss(p),g.error(`Erro no pagamento online: ${u.message}`),Pe(!1)}},zr=async()=>{await R.auth.signOut(),g.success("Você saiu da sua conta."),r("/auth",{replace:!0})},Kr=(n,i,m)=>{i&&m?(Se(n),Ge(!0)):(l.setValue("payment_method_id",n,{shouldValidate:!0}),Se(null))},Ur=()=>{$e&&l.setValue("payment_method_id",$e,{shouldValidate:!0}),Ge(!1),Se(null)};if(!j)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(ne,{variant:"destructive",className:"max-w-lg",children:[e.jsx(or,{className:"h-4 w-4"}),e.jsx(se,{children:"Erro de Rastreamento"}),e.jsx(ie,{children:"Não foi possível identificar o restaurante para o qual o pedido está sendo feito. Por favor, volte ao menu."}),e.jsx(Me,{to:"/",children:e.jsx(Q,{className:"mt-3",variant:"secondary",size:"sm",children:"Voltar"})})]})});if(d.length===0)return f.useEffect(()=>{r(`/menu/${j}`)},[r,j]),e.jsx(We,{});if(Lr||Dr||Gr||w)return e.jsx(We,{});if(Tr||!y)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(ne,{variant:"destructive",className:"max-w-lg",children:[e.jsx(or,{className:"h-4 w-4"}),e.jsx(se,{children:"Erro Crítico"}),e.jsx(ie,{children:Ve instanceof Error?Ve.message:"Não foi possível carregar os dados do restaurante."}),e.jsxs(Q,{onClick:()=>kr(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(jt,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]})});const Ke=Be.isPending||ze.isPending||je.isPending||k||O==="delivery"&&!K;return e.jsxs("div",{className:"min-h-screen bg-background py-4 sm:py-8 px-4 sm:px-8",children:[e.jsx(ft,{isOpen:S,onClose:()=>M(!1),customer:v}),e.jsx(on,{isOpen:Fr,onConfirm:Ur}),Ir&&De&&e.jsx(tn,{preferenceId:Mr,initPoint:De,onClose:()=>Pe(!1)}),e.jsxs("div",{className:"w-full lg:max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{to:`/menu/${j}`,children:e.jsx(Q,{variant:"ghost",size:"icon","aria-label":"Voltar ao Menu",children:e.jsx(Rt,{className:"h-6 w-6"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Finalizar Pedido"}),e.jsx("p",{className:"text-lg text-muted-foreground font-medium",children:y.name})]})]}),a&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Q,{variant:"outline",size:"sm",onClick:()=>M(!0),"aria-label":"Meu Perfil e Pedidos",children:[e.jsx(ar,{className:"h-4 w-4 mr-2"})," Perfil / Pedidos"]}),e.jsxs(Q,{variant:"outline",size:"sm",onClick:zr,children:[e.jsx(pt,{className:"h-4 w-4 mr-1"})," Sair"]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(X,{children:[e.jsx(H,{children:e.jsxs(W,{className:"text-xl flex items-center gap-2",children:[e.jsx(ar,{className:"h-5 w-5 text-primary"}),"Seus Dados"]})}),e.jsxs(J,{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:a?`Logado como ${a.email}. ${v?"Perfil de cliente encontrado.":"Preencha os dados para criar seu perfil de cliente."}`:"Você está fazendo um pedido anônimo."})}),e.jsxs(nr,{...l,children:[" ",e.jsx("form",{onSubmit:l.handleSubmit(qr),id:"checkout-form",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"name",children:"Nome Completo *"}),e.jsx(ae,{id:"name",...l.register("name")}),l.formState.errors.name&&e.jsx("p",{className:"text-destructive text-sm",children:l.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"phone",children:"Telefone *"}),e.jsx(le,{name:"phone",control:l.control,render:({field:n})=>e.jsx(ut,{id:"phone",...n})}),l.formState.errors.phone&&e.jsx("p",{className:"text-destructive text-sm",children:l.formState.errors.phone.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"cpf_cnpj",children:"CPF/CNPJ *"}),e.jsx(le,{name:"cpf_cnpj",control:l.control,render:({field:n})=>e.jsx(yt,{id:"cpf_cnpj",...n})}),l.formState.errors.cpf_cnpj&&e.jsx("p",{className:"text-destructive text-sm",children:l.formState.errors.cpf_cnpj.message})]})]})})]})]})]}),e.jsxs(X,{children:[e.jsx(H,{children:e.jsxs(W,{className:"text-xl flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-primary"}),"Opção de Entrega"]})}),e.jsx(J,{children:e.jsx(le,{name:"delivery_option",control:l.control,render:({field:n})=>e.jsxs(Fe,{onValueChange:n.onChange,value:n.value,className:"grid grid-cols-2 gap-4",children:[e.jsxs(T,{htmlFor:"delivery",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer",children:[e.jsx(_e,{value:"delivery",id:"delivery",className:"sr-only"}),e.jsx(ve,{className:"mb-3 h-6 w-6"}),e.jsx("span",{translate:"no",children:"Entrega"})]}),e.jsxs(T,{htmlFor:"pickup",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer",children:[e.jsx(_e,{value:"pickup",id:"pickup",className:"sr-only"}),e.jsx(Oe,{className:"mb-3 h-6 w-6"}),e.jsx("span",{translate:"no",children:"Retirada no Local"})]})]})})})]}),O==="delivery"&&e.jsxs(X,{className:fe(!K&&"border-destructive ring-2 ring-destructive/50"),children:[e.jsxs(H,{children:[e.jsxs(W,{className:"text-xl flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5 text-primary"}),"Endereço de Entrega",K&&e.jsx(It,{className:"h-5 w-5 text-green-500 ml-2"}),!K&&e.jsx(be,{className:"h-5 w-5 text-destructive ml-2"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Preencha e salve o endereço para calcular a taxa de entrega."})]}),e.jsxs(J,{className:"space-y-4",children:[y.delivery_enabled===!1&&e.jsxs(ne,{variant:"default",className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 text-blue-700",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx(se,{children:"Frete Grátis Ativo"}),e.jsx(ie,{children:"As taxas de entrega dinâmica estão desativadas. O frete será R$ 0,00."})]}),e.jsxs(nr,{...N,children:[" ",e.jsxs("form",{onSubmit:n=>{n.preventDefault(),Vr()},id:"address-form-inner",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2 md:col-span-1",children:[e.jsx(T,{htmlFor:"zip_code",children:"CEP *"}),e.jsx(le,{name:"zip_code",control:N.control,render:({field:n})=>e.jsx(Pt,{className:"flex-1 space-y-0",children:e.jsx(St,{children:e.jsx(lt,{placeholder:"Digite o CEP",...n})})})}),N.formState.errors.zip_code&&e.jsx("p",{className:"text-destructive text-sm",children:N.formState.errors.zip_code.message})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(T,{htmlFor:"street",children:"Rua *"}),e.jsx(ae,{id:"street",...N.register("street")}),N.formState.errors.street&&e.jsx("p",{className:"text-destructive text-sm",children:N.formState.errors.street.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"number",children:"Número *"}),e.jsx(ae,{id:"number",...N.register("number")}),N.formState.errors.number&&e.jsx("p",{className:"text-destructive text-sm",children:N.formState.errors.number.message})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(T,{htmlFor:"neighborhood",children:"Bairro *"}),e.jsx(ae,{id:"neighborhood",...N.register("neighborhood")}),N.formState.errors.neighborhood&&e.jsx("p",{className:"text-destructive text-sm",children:N.formState.errors.neighborhood.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"city",children:"Cidade *"}),e.jsx(ae,{id:"city",...N.register("city")}),N.formState.errors.city&&e.jsx("p",{className:"text-destructive text-sm",children:N.formState.errors.city.message})]}),e.jsxs(Q,{type:"submit",className:"w-full h-10 text-base mt-4",disabled:je.isPending||k,children:[je.isPending||k?e.jsx(me,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Salvar Endereço e Calcular Taxa"]})]})]}),k&&e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4 animate-spin"}),e.jsx(se,{children:"Calculando Taxa de Entrega..."})]}),K&&!k&&e.jsxs(e.Fragment,{children:[y.delivery_enabled!==!1&&!Ee&&e.jsxs(ne,{variant:"destructive",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx(se,{children:"Fora da Área de Entrega"}),e.jsx(ie,{children:"Seu endereço está fora da área de cobertura do restaurante."})]}),(y.delivery_enabled===!1||Ee&&ce)&&e.jsxs(ne,{variant:"default",className:"bg-green-50 dark:bg-green-900/20 border-green-200 text-green-700",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx(se,{children:"Entrega Disponível"}),e.jsxs(ie,{children:["Taxa de entrega: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(pe),". Tempo estimado: ",ce?`${ce[0]} - ${ce[1]}`:"30 - 45"," minutos."]})]})]}),K&&Y&&e.jsx("div",{className:"mt-6",children:e.jsx(nn,{latitude:Y[0],longitude:Y[1],address:`${I[1]}, ${I[2]} - ${I[4]}, ${I[3]}, ${I[0]}`})})]})]}),e.jsxs(X,{children:[e.jsx(H,{children:e.jsxs(W,{className:"text-xl flex items-center gap-2",children:[e.jsx(mr,{className:"h-5 w-5 text-primary"}),"Método de Pagamento *"]})}),e.jsxs(J,{children:[e.jsx(le,{name:"payment_method_id",control:l.control,render:({field:n})=>e.jsx(Fe,{onValueChange:i=>{var u;const m=U==null?void 0:U.find(C=>C.id===i),x=(u=m==null?void 0:m.name)==null?void 0:u.includes("online"),p=!!A&&A.trim()!=="";Kr(i,!!x,p)},value:n.value,className:"space-y-3",children:U==null?void 0:U.map(i=>{var u;const m=(u=i.name)==null?void 0:u.includes("online"),x=!!A&&A.trim()!=="",p=m&&!x;return e.jsx(T,{htmlFor:i.id,className:fe("flex items-center justify-between rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer",p&&"opacity-50 cursor-not-allowed"),children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(_e,{value:i.id,id:i.id,disabled:p}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",translate:"no",children:i.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i.description}),p&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:"Pagamento online indisponível (Chave Pública não configurada)."})]})]})},i.id)})})}),l.formState.errors.payment_method_id&&e.jsx("p",{className:"text-destructive text-sm mt-2",children:l.formState.errors.payment_method_id.message})]})]}),de&&e.jsxs(X,{children:[e.jsx(H,{children:e.jsxs(W,{className:"text-xl flex items-center gap-2",children:[e.jsx(At,{className:"h-5 w-5 text-primary"}),"Troco"]})}),e.jsx(J,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"change_for",children:"Precisa de troco para quanto? (Opcional)"}),e.jsx(ae,{id:"change_for",type:"number",step:"0.01",placeholder:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z),...l.register("change_for")}),((Xe=l.formState.errors.change_for)==null?void 0:Xe.message)&&e.jsx("p",{className:"text-destructive text-sm",children:l.formState.errors.change_for.message}),((He=l.formState.errors.change_for)==null?void 0:He.type)==="manual"&&e.jsx("p",{className:"text-destructive text-sm",children:l.formState.errors.change_for.message})]})})]}),e.jsxs(X,{children:[e.jsx(H,{children:e.jsxs(W,{className:"text-xl flex items-center gap-2",children:[e.jsx(mt,{className:"h-5 w-5 text-primary"}),"Observações"]})}),e.jsx(J,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"notes",children:"Notas para o restaurante (Opcional)"}),e.jsx(ot,{id:"notes",...l.register("notes"),rows:3,placeholder:"Ex: Entregar na portaria, sem pimenta, etc."})]})})]})]}),e.jsx("div",{className:"lg:col-span-1 space-y-6 sticky top-4 self-start",children:e.jsxs(X,{className:"shadow-lg",children:[e.jsx(H,{children:e.jsx(W,{className:"text-2xl",children:"Resumo"})}),e.jsxs(J,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:d.map(n=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"truncate max-w-[70%]",children:[n.quantity,"x ",n.product.name]}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n.subtotal)})]},n.product.id))}),e.jsx(er,{}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c)})]}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(pe)})]})]}),e.jsx(er,{}),e.jsxs("div",{className:"flex justify-between font-bold text-xl",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z)})]}),e.jsx(Q,{type:"submit",form:"checkout-form",className:"w-full h-12 text-lg",disabled:Ke,children:Ke?e.jsx(me,{className:"h-5 w-5 animate-spin mr-2"}):ge?"Pagar e Finalizar":"Confirmar Pedido"}),O==="delivery"&&!K&&e.jsxs(ne,{variant:"destructive",className:"mt-3",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx(ie,{className:"text-xs",children:"Salve o endereço acima para continuar."})]}),e.jsx(Me,{to:`/menu/${y.id}`,className:"block text-center text-sm text-muted-foreground hover:underline mt-2",children:"Voltar ao Cardápio"})]})]})})]})]})]})};export{to as default};
