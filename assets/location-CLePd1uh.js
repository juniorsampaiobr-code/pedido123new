const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./GoogleMapComponent-CMx2hgBL.js","./tanstack-d4AvmB45.js","./vendor-CnEXr6gt.js","./index-D6bl_y6n.js","./supabase-BZV_3FV3.js","./index-Cg43SKG2.css"])))=>i.map(i=>d[i]);
import{j as m}from"./tanstack-d4AvmB45.js";import{R as p,r as u}from"./vendor-CnEXr6gt.js";import{I as g}from"./label-D3zDN2-W.js";import{a as h,b as f,u as d}from"./index-D6bl_y6n.js";import{_ as M}from"./supabase-BZV_3FV3.js";const A=o=>{let e=o.replace(/\D/g,"");return e.length>8&&(e=e.slice(0,8)),e.length>5&&(e=`${e.slice(0,5)}-${e.slice(5)}`),e},v=p.forwardRef(({className:o,value:e,onChange:a,...t},s)=>{const n=r=>{const i=r.target.value,c=A(i),l={...r,target:{...r.target,value:c}};a(l)};return m.jsx(g,{ref:s,type:"tel",className:h("w-full",o),placeholder:"00000-000",value:e,onChange:n,maxLength:9,...t})});v.displayName="ZipCodeInput";const y=u.lazy(()=>M(()=>import("./GoogleMapComponent-CMx2hgBL.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(o=>({default:o.GoogleMapComponent}))),x=o=>{const{center:e,markerPosition:a,onMarkerDragEnd:t,zoom:s}=o,n=u.useMemo(()=>({lat:e[0],lng:e[1]}),[e]),r=u.useMemo(()=>({lat:a[0],lng:a[1]}),[a]);return m.jsx(u.Suspense,{fallback:m.jsx(f,{}),children:m.jsx(y,{center:n,markerPosition:r,onMarkerDragEnd:t,zoom:s})})},b=(o,e,a,t)=>{const n=(a-o)*(Math.PI/180),r=(t-e)*(Math.PI/180),i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(o*(Math.PI/180))*Math.cos(a*(Math.PI/180))*Math.sin(r/2)*Math.sin(r/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))},P=async o=>{if(typeof google>"u"||!google.maps)return console.error("Google Maps SDK não carregado"),d.error("Serviço de mapa não disponível. Tente novamente."),null;const e=o.replace(/\s+/g," ").trim(),a=new google.maps.Geocoder;return new Promise(t=>{const s=setTimeout(()=>{console.error("Timeout na requisição de geocodificação"),d.error("A requisição para encontrar o endereço demorou muito. Tente novamente."),t(null)},1e4);a.geocode({address:e,componentRestrictions:{country:"BR"}},(n,r)=>{if(clearTimeout(s),r==="OK"&&n&&n.length>0){const i=n[0].geometry.location,c=i.lat(),l=i.lng();if(Number.isFinite(c)&&Number.isFinite(l)){console.log("LOG: geocodeAddress (Google Maps Service) - Geocodificação bem-sucedida. Coordenadas:",[c,l]),t({lat:c,lng:l});return}}console.warn(`LOG: geocodeAddress (Google Maps Service) - Falha na busca. Status: ${r}. Endereço: ${e}`),G(e).then(t)})})},G=async o=>{const e=new AbortController,a=setTimeout(()=>e.abort(),1e4);try{const t=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(o)}&limit=1&addressdetails=1`;console.log("LOG: geocodeAddress - URL da API (Nominatim):",t);const s=await fetch(t,{signal:e.signal,headers:{"User-Agent":"Pedido123-App/1.0 (https://juniorsampaiobr-code.github.io/pedido123new/)"}});if(!s.ok)return console.error("LOG: geocodeAddress (Nominatim) - Resposta da API não OK. Status:",s.status),null;const n=await s.json();if(n&&Array.isArray(n)&&n.length>0){const r=n[0],i=parseFloat(r.lat),c=parseFloat(r.lon);if(Number.isFinite(i)&&Number.isFinite(c))return console.log("LOG: geocodeAddress (Nominatim) - Geocodificação bem-sucedida. Coordenadas:",[i,c]),clearTimeout(a),{lat:i,lng:c}}return console.warn("LOG: geocodeAddress (Nominatim) - Falha. Nenhum resultado encontrado ou coordenadas inválidas para:",o),d.error("Não foi possível encontrar o endereço. Verifique todos os campos e tente novamente."),null}catch(t){return t instanceof Error&&t.name==="AbortError"?(console.error("LOG: geocodeAddress (Nominatim) - Timeout na requisição (10s). Endereço:",o),d.error("A requisição para encontrar o endereço demorou muito. Tente novamente.")):(console.error("LOG: geocodeAddress (Nominatim) - Erro durante a requisição:",t),d.error("Ocorreu um erro ao buscar o endereço. Tente novamente.")),null}finally{clearTimeout(a)}},F=(o,e,a)=>{const t=b(e[0],e[1],o[0],o[1]),s=a.find(n=>t<=n.max_distance_km);if(s){const n=s.delivery_fee||0,r=s.min_delivery_time_minutes||0,i=r+15;return{fee:parseFloat(n.toFixed(2)),minTime:r,maxTime:i}}return null};export{x as L,v as Z,F as c,P as g};
