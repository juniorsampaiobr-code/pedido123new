import{j as e,a as W,b as H,u as Ie}from"./tanstack-C7aOFagJ.js";import{r as m,j as De}from"./vendor-DjsPZZVP.js";import{c as L,D as Be,q as qe,r as Fe,v as Le,a as k,O as Y,Q as ee,R as se,V as ae,U as Oe,W as ze,B as A,X as te,Y as ne,Z as re,s as T,_ as $e,$ as Ve,a0 as le,a1 as U,a2 as J,a3 as He,a4 as Ke,a5 as Qe,a6 as ce,S as ie,L as Ue,j as R,C as oe,b as de,a7 as Ge,e as Xe,f as Ze,a8 as Je}from"./index-oU9wrBDH.js";import{S as We,a as Ye,b as es,c as ss,d as as,T as ts,e as ns,f as rs,g as ls,B as cs}from"./select-C8zdN9g1.js";import{S}from"./skeleton-BlEt39fn.js";import{p as is}from"./pt-BR-CbDebePx.js";import{C as os}from"./credit-card-CEg9pr7x.js";import{C as ds}from"./calendar-BPmeKoD5.js";import{P as me}from"./package-HfEdqd-Z.js";import{T as ue}from"./truck-Dvc1D0fU.js";import{C as $,A as he,h as xe,a as pe,b as fe,c as ge,d as je,e as be,f as ve,g as ye}from"./alert-dialog-BHRyYxac.js";import{f as ms}from"./format-BeKxgCCE.js";import{u as us}from"./index-C3WaO5Hu.js";import{T as hs}from"./trash-2-DdUGgSDo.js";import"./supabase-BAEEEeUB.js";import"./index-BHgtb-8M.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=L("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=L("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=L("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=L("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=L("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),bs={pending:{label:"Pendente",icon:te,color:"bg-yellow-500"},preparing:{label:"Em Preparação",icon:me,color:"bg-orange-500"},ready:{label:"Pronto",icon:ne,color:"bg-green-500"},delivering:{label:"Em Entrega",icon:ue,color:"bg-blue-500"},delivered:{label:"Entregue",icon:$,color:"bg-purple-500"},cancelled:{label:"Cancelado",icon:re,color:"bg-destructive"},pending_payment:{label:"Aguardando Pagamento",icon:gs,color:"bg-gray-500"}},vs=async s=>{const{data:a,error:l}=await T.from("order_items").select("*, products(name)").eq("order_id",s);if(l)throw new Error(l.message);return a},ys=({order:s,isOpen:a,onClose:l})=>{var D,B,O,z;const[h,c]=m.useState([]),[n,o]=m.useState(!1),[d,i]=m.useState(null),[u,p]=m.useState("Carregando...");m.useEffect(()=>{a&&(async()=>{if(s!=null&&s.id){o(!0),i(null);try{const t=await vs(s.id);c(t)}catch(t){console.error("Failed to fetch order items:",t),i("Falha ao carregar itens do pedido.")}finally{o(!1)}}})()},[s==null?void 0:s.id,a]),m.useEffect(()=>{a&&s&&(async()=>{if(!(s!=null&&s.payment_method_id)){p("Não especificado");return}try{const{data:t,error:v}=await T.from("payment_methods").select("name").eq("id",s.payment_method_id).single();if(v)throw v;p((t==null?void 0:t.name)||"Método não encontrado")}catch(t){console.error("Failed to fetch payment method name:",t),p("Erro ao carregar")}})()},[a,s]),m.useEffect(()=>{s&&console.log("Order prop recebida:",s)},[s]);const g=((D=s==null?void 0:s.customer)==null?void 0:D.name)||"Cliente Desconhecido",b=(B=s==null?void 0:s.customer)==null?void 0:B.phone,y=(O=s==null?void 0:s.customer)==null?void 0:O.email,f=(z=s==null?void 0:s.customer)==null?void 0:z.cpf_cnpj,C=s==null?void 0:s.delivery_address,j=s!=null&&s.status?bs[s.status]:null,r=s!=null&&s.id?s.id.slice(-4):"N/A",x=s!=null&&s.created_at?new Date(s.created_at):null,N=x?ms(x,"dd 'de' MMMM 'de' yyyy 'às' HH:mm",{locale:is}):"Data desconhecida",P=s!=null&&s.change_for?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.change_for):null,I=s!=null&&s.delivery_fee?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.delivery_fee):"Grátis";return e.jsx(Be,{open:a,onOpenChange:l,children:e.jsxs(qe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Fe,{children:e.jsxs(Le,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Detalhes do Pedido #",r]}),j&&e.jsxs("span",{className:k("text-xs font-semibold px-2.5 py-0.5 rounded-full text-white flex items-center",j.color),children:[e.jsx(j.icon,{className:"w-3 h-3 mr-1"}),j.label]})]})}),d&&e.jsxs(Y,{variant:"destructive",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx(se,{children:"Erro"}),e.jsx(ae,{children:d})]}),n?e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{className:"h-4 w-1/3"}),e.jsx(S,{className:"h-10 w-full"}),e.jsx(S,{className:"h-4 w-1/3"}),e.jsx(S,{className:"h-20 w-full"}),e.jsx(S,{className:"h-4 w-1/3"}),e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((E,t)=>e.jsx(S,{className:"h-12 w-full"},t))}),e.jsx(S,{className:"h-4 w-1/3"}),e.jsx(S,{className:"h-6 w-full"})]}):s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(Oe,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Cliente"}),e.jsx("p",{children:g}),f&&e.jsxs("p",{className:"text-muted-foreground text-xs",children:["CPF/CNPJ: ",f]})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(js,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Telefone"}),e.jsx("p",{children:b||"Não informado"}),y&&e.jsx("p",{className:"text-muted-foreground text-xs",children:y})]})]}),e.jsxs("div",{className:"flex items-start md:col-span-2",children:[e.jsx(ze,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Endereço de Entrega"}),e.jsx("p",{children:C||"Retirada no local"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(os,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Método de Pagamento"}),e.jsx("p",{children:u}),P&&e.jsxs("p",{className:"text-muted-foreground text-xs",children:["Troco para: ",P]})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(ds,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Data do Pedido"}),e.jsx("p",{children:N})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Itens do Pedido"}),e.jsx("div",{className:"space-y-2",children:h.map(E=>{var t;return e.jsxs("div",{className:"flex justify-between items-start p-2 bg-muted/50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((t=E.products)==null?void 0:t.name)||"Produto não encontrado"}),E.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Obs: ",E.notes]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{children:[E.quantity," x ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(E.unit_price)]}),e.jsx("p",{className:"font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(E.subtotal)})]})]},E.id)})})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount-(s.delivery_fee||0))})]}),e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:I})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]})]}),e.jsx("div",{className:"pt-4",children:s.notes&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Observações do Cliente:"}),e.jsx("p",{className:"bg-muted p-2 rounded",children:s.notes})]})})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(A,{onClick:l,children:"Fechar"})})]})})},Ne=({className:s,...a})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:k("mx-auto flex w-full justify-center",s),...a});Ne.displayName="Pagination";const Ce=m.forwardRef(({className:s,...a},l)=>e.jsx("ul",{ref:l,className:k("flex flex-row items-center gap-1",s),...a}));Ce.displayName="PaginationContent";const _=m.forwardRef(({className:s,...a},l)=>e.jsx("li",{ref:l,className:k("",s),...a}));_.displayName="PaginationItem";const F=({className:s,isActive:a,size:l="icon",...h})=>e.jsx("a",{"aria-current":a?"page":void 0,className:k($e({variant:a?"outline":"ghost",size:l}),s),...h});F.displayName="PaginationLink";const we=({className:s,...a})=>e.jsxs(F,{"aria-label":"Go to previous page",size:"default",className:k("gap-1 pl-2.5",s),...a,children:[e.jsx(xs,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});we.displayName="PaginationPrevious";const ke=({className:s,...a})=>e.jsxs(F,{"aria-label":"Go to next page",size:"default",className:k("gap-1 pr-2.5",s),...a,children:[e.jsx("span",{children:"Next"}),e.jsx(ps,{className:"h-4 w-4"})]});ke.displayName="PaginationNext";const K=({className:s,...a})=>e.jsxs("span",{"aria-hidden":!0,className:k("flex h-9 w-9 items-center justify-center",s),...a,children:[e.jsx(fs,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]});K.displayName="PaginationEllipsis";const Ns=({currentPage:s,totalPages:a,onPageChange:l})=>{if(a<=1)return null;const c=(()=>{const n=[],d=Math.max(1,s-Math.floor(2.5)),i=Math.min(a,d+5-1);if(i-d+1<5){const u=Math.max(1,i-5+1);for(let p=u;p<=i;p++)n.push(p)}else for(let u=d;u<=i;u++)n.push(u);return n})();return e.jsx(Ne,{children:e.jsxs(Ce,{children:[e.jsx(_,{children:e.jsx(we,{onClick:()=>l(s-1),className:k(s===1&&"pointer-events-none opacity-50")})}),c[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx(_,{children:e.jsx(F,{onClick:()=>l(1),children:"1"})}),c[0]>2&&e.jsx(_,{children:e.jsx(K,{})})]}),c.map(n=>e.jsx(_,{children:e.jsx(F,{isActive:n===s,onClick:()=>l(n),children:n})},n)),c[c.length-1]<a&&e.jsxs(e.Fragment,{children:[c[c.length-1]<a-1&&e.jsx(_,{children:e.jsx(K,{})}),e.jsx(_,{children:e.jsx(F,{onClick:()=>l(a),children:a})})]}),e.jsx(_,{children:e.jsx(ke,{onClick:()=>l(s+1),className:k(s===a&&"pointer-events-none opacity-50")})})]})})};var V="Checkbox",[Cs,Us]=Ve(V),[ws,G]=Cs(V);function ks(s){const{__scopeCheckbox:a,checked:l,children:h,defaultChecked:c,disabled:n,form:o,name:d,onCheckedChange:i,required:u,value:p="on",internal_do_not_use_render:g}=s,[b,y]=Qe({prop:l,defaultProp:c??!1,onChange:i,caller:V}),[f,C]=m.useState(null),[j,r]=m.useState(null),x=m.useRef(!1),N=f?!!o||!!f.closest("form"):!0,P={checked:b,disabled:n,setChecked:y,control:f,setControl:C,name:d,form:o,value:p,hasConsumerStoppedPropagationRef:x,required:u,defaultChecked:M(c)?!1:c,isFormControl:N,bubbleInput:j,setBubbleInput:r};return e.jsx(ws,{scope:a,...P,children:Es(g)?g(P):h})}var Ee="CheckboxTrigger",Pe=m.forwardRef(({__scopeCheckbox:s,onKeyDown:a,onClick:l,...h},c)=>{const{control:n,value:o,disabled:d,checked:i,required:u,setControl:p,setChecked:g,hasConsumerStoppedPropagationRef:b,isFormControl:y,bubbleInput:f}=G(Ee,s),C=le(c,p),j=m.useRef(i);return m.useEffect(()=>{const r=n==null?void 0:n.form;if(r){const x=()=>g(j.current);return r.addEventListener("reset",x),()=>r.removeEventListener("reset",x)}},[n,g]),e.jsx(U.button,{type:"button",role:"checkbox","aria-checked":M(i)?"mixed":i,"aria-required":u,"data-state":Me(i),"data-disabled":d?"":void 0,disabled:d,value:o,...h,ref:C,onKeyDown:J(a,r=>{r.key==="Enter"&&r.preventDefault()}),onClick:J(l,r=>{g(x=>M(x)?!0:!x),f&&y&&(b.current=r.isPropagationStopped(),b.current||r.stopPropagation())})})});Pe.displayName=Ee;var X=m.forwardRef((s,a)=>{const{__scopeCheckbox:l,name:h,checked:c,defaultChecked:n,required:o,disabled:d,value:i,onCheckedChange:u,form:p,...g}=s;return e.jsx(ks,{__scopeCheckbox:l,checked:c,defaultChecked:n,disabled:d,required:o,onCheckedChange:u,name:h,form:p,value:i,internal_do_not_use_render:({isFormControl:b})=>e.jsxs(e.Fragment,{children:[e.jsx(Pe,{...g,ref:a,__scopeCheckbox:l}),b&&e.jsx(Re,{__scopeCheckbox:l})]})})});X.displayName=V;var Se="CheckboxIndicator",_e=m.forwardRef((s,a)=>{const{__scopeCheckbox:l,forceMount:h,...c}=s,n=G(Se,l);return e.jsx(He,{present:h||M(n.checked)||n.checked===!0,children:e.jsx(U.span,{"data-state":Me(n.checked),"data-disabled":n.disabled?"":void 0,...c,ref:a,style:{pointerEvents:"none",...s.style}})})});_e.displayName=Se;var Ae="CheckboxBubbleInput",Re=m.forwardRef(({__scopeCheckbox:s,...a},l)=>{const{control:h,hasConsumerStoppedPropagationRef:c,checked:n,defaultChecked:o,required:d,disabled:i,name:u,value:p,form:g,bubbleInput:b,setBubbleInput:y}=G(Ae,s),f=le(l,y),C=us(n),j=Ke(h);m.useEffect(()=>{const x=b;if(!x)return;const N=window.HTMLInputElement.prototype,I=Object.getOwnPropertyDescriptor(N,"checked").set,D=!c.current;if(C!==n&&I){const B=new Event("click",{bubbles:D});x.indeterminate=M(n),I.call(x,M(n)?!1:n),x.dispatchEvent(B)}},[b,C,n,c]);const r=m.useRef(M(n)?!1:n);return e.jsx(U.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??r.current,required:d,disabled:i,name:u,value:p,form:g,...a,tabIndex:-1,ref:f,style:{...a.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Re.displayName=Ae;function Es(s){return typeof s=="function"}function M(s){return s==="indeterminate"}function Me(s){return M(s)?"indeterminate":s?"checked":"unchecked"}const Z=m.forwardRef(({className:s,...a},l)=>e.jsx(X,{ref:l,className:k("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(_e,{className:k("flex items-center justify-center text-current"),children:e.jsx($,{className:"h-4 w-4"})})}));Z.displayName=X.displayName;const Te={pending:{label:"Pendente",icon:te,color:"bg-yellow-500 hover:bg-yellow-600"},preparing:{label:"Em Preparação",icon:me,color:"bg-orange-500 hover:bg-orange-600"},ready:{label:"Pronto",icon:ne,color:"bg-green-500 hover:bg-green-600"},delivering:{label:"Em Entrega",icon:ue,color:"bg-indigo-500 hover:bg-indigo-600"},delivered:{label:"Entregue",icon:$,color:"bg-primary hover:bg-primary/90"},cancelled:{label:"Cancelado",icon:re,color:"bg-destructive hover:bg-destructive/90"},pending_payment:{label:"Aguardando Pag.",icon:Ge,color:"bg-gray-500 hover:bg-gray-600"}},Ps=[{value:"pending",label:"Mudar para Pendente"},{value:"preparing",label:"Mudar para Em Preparação"},{value:"ready",label:"Mudar para Pronto"},{value:"delivering",label:"Mudar para Em Entrega"},{value:"delivered",label:"Mudar para Entregue"},{value:"cancelled",label:"Mudar para Cancelado"},{value:"pending_payment",label:"Mudar para Aguardando Pag."},{value:"delete",label:"Excluir Permanentemente"}],Q=12,Ss=async(s,a,l)=>{const h=l*Q,c=h+Q-1;let n=T.from("orders").select("*, customer:customers(name, phone)",{count:"exact"}).eq("restaurant_id",s);a!=="all"&&(n=n.eq("status",a));const{data:o,error:d,count:i}=await n.order("created_at",{ascending:!1}).range(h,c);if(d)throw new Error(`Erro ao buscar pedidos: ${d.message}`);return{orders:o,count:i||0}},_s=({order:s,onViewDetails:a,onAccept:l,onDecline:h,onDelete:c,isSelected:n,onSelect:o})=>{var p;const d=Te[s.status||"pending"],i=((p=s.customer)==null?void 0:p.name)||"Cliente Desconhecido",u=s.id?s.id.slice(-4):"N/A";return e.jsxs(oe,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col relative",children:[e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx(Z,{checked:n,onCheckedChange:g=>o(s.id,!!g),className:"h-5 w-5"})}),e.jsxs(Xe,{className:"flex flex-row items-center justify-between space-y-0 pb-2 pl-12",children:[e.jsxs(Ze,{className:"text-lg font-bold flex items-center gap-2",children:["Pedido #",u]}),e.jsxs(cs,{className:k("text-white",d.color),children:[e.jsx(d.icon,{className:"h-3 w-3 mr-1"}),d.label]})]}),e.jsxs(de,{className:"space-y-2 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",i]}),e.jsx("p",{className:"text-2xl font-extrabold text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]}),e.jsxs("div",{className:"flex justify-end pt-2 border-t gap-2",children:[(s.status==="pending"||s.status==="pending_payment")&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{variant:"destructive",size:"sm",onClick:()=>h(s.id),children:[e.jsx(Je,{className:"h-4 w-4 mr-1"})," Recusar"]}),e.jsxs(A,{variant:"default",size:"sm",onClick:()=>l(s.id),children:[e.jsx($,{className:"h-4 w-4 mr-1"})," Aceitar"]})]}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>a(s),children:"Detalhes"}),e.jsxs(he,{children:[e.jsx(xe,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",children:e.jsx(hs,{className:"h-4 w-4"})})}),e.jsxs(pe,{children:[e.jsxs(fe,{children:[e.jsx(ge,{children:"Tem certeza que deseja excluir?"}),e.jsxs(je,{children:["Esta ação é permanente. O pedido #",u," será excluído permanentemente do sistema, incluindo todos os itens associados."]})]}),e.jsxs(be,{children:[e.jsx(ve,{children:"Cancelar"}),e.jsx(ye,{onClick:()=>c(s.id),className:"bg-destructive hover:bg-destructive/90",children:"Excluir Permanentemente"})]})]})]})]})]})]})},As=({status:s,onViewDetails:a,restaurantId:l,selectedOrders:h,setSelectedOrders:c,totalOrdersInView:n})=>{const o=W(),[d,i]=m.useState(1),{data:u,isLoading:p,isError:g,error:b,refetch:y}=Ie({queryKey:["orders",s,l,d],queryFn:()=>Ss(l,s,d-1),enabled:!!l}),f=(u==null?void 0:u.orders)||[],C=(u==null?void 0:u.count)||0,j=Math.ceil(C/Q),r=H({mutationFn:async({orderId:t,newStatus:v})=>{const w=v==="pending"?"preparing":v,{error:q}=await T.from("orders").update({status:w}).eq("id",t);if(q)throw new Error(q.message);return w},onSuccess:t=>{R.success(`Pedido ${t==="preparing"?"aceito":"recusado"} com sucesso!`),o.invalidateQueries({queryKey:["orders"]})},onError:t=>R.error(`Erro ao atualizar pedido: ${t.message}`)}),x=H({mutationFn:async t=>{const{error:v}=await T.from("orders").delete().eq("id",t);if(v)throw new Error(v.message)},onSuccess:()=>{R.success("Pedido excluído permanentemente."),o.invalidateQueries({queryKey:["orders"]})},onError:t=>R.error(`Erro ao excluir pedido: ${t.message}`)}),N=t=>{r.mutate({orderId:t,newStatus:"preparing"})},P=t=>{r.mutate({orderId:t,newStatus:"cancelled"})},I=t=>{a(t)},D=t=>{x.mutate(t)},B=m.useCallback(t=>{i(t)},[]),O=m.useCallback((t,v)=>{c(w=>v?[...w,t]:w.filter(q=>q!==t))},[c]),z=m.useCallback(t=>{if(t){const v=f.map(w=>w.id);c(w=>[...new Set([...w,...v])])}else{const v=new Set(f.map(w=>w.id));c(w=>w.filter(q=>!v.has(q)))}},[f,c]),E=f.length>0&&f.every(t=>h.includes(t.id));return p?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((t,v)=>e.jsx(oe,{children:e.jsx(de,{className:"p-4 space-y-3",children:e.jsx(S,{className:"h-32 w-full"})})},v))}):g?e.jsxs(Y,{variant:"destructive",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx(se,{children:"Erro ao carregar pedidos"}),e.jsx(ae,{children:b instanceof Error?b.message:"Ocorreu um erro desconhecido."}),e.jsxs(A,{onClick:()=>y(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]}):!f||f.length===0?e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg border",children:[e.jsx(ie,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifique o status selecionado ou aguarde novos pedidos."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg bg-muted/50",children:[e.jsx(Z,{checked:E,onCheckedChange:z,className:"h-5 w-5"}),e.jsxs("span",{className:"text-sm font-medium",children:["Selecionar todos (",f.length,") nesta página."]}),n>0&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-auto",children:[n," pedidos selecionados no total."]})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:f.map(t=>e.jsx(_s,{order:t,onViewDetails:I,onAccept:N,onDecline:P,onDelete:D,isSelected:h.includes(t.id),onSelect:O},t.id))}),j>1&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(Ns,{currentPage:d,totalPages:j,onPageChange:B})})]})},Gs=()=>{const{userRestaurantId:s}=De(),a=W(),[l,h]=m.useState(null),[c,n]=m.useState(!1),[o,d]=m.useState([]),[i,u]=m.useState(""),p=r=>{h(r),n(!0)},g=()=>{n(!1),h(null)},b=()=>{a.invalidateQueries({queryKey:["orders",s]}),R.info("Atualizando pedidos...",{description:"Buscando novos dados no servidor."})},y=H({mutationFn:async({orderIds:r,action:x})=>{if(x==="delete"){const{error:N}=await T.from("orders").delete().in("id",r);if(N)throw new Error(N.message);return"deleted"}else{const N=x==="pending"?"preparing":x,{error:P}=await T.from("orders").update({status:N}).in("id",r);if(P)throw new Error(P.message);return"updated"}},onSuccess:(r,x)=>{if(r==="deleted")R.success(`${x.orderIds.length} pedidos excluídos permanentemente.`);else{const N=Te[x.action].label;R.success(`${x.orderIds.length} pedidos atualizados para "${N}".`)}d([]),u(""),a.invalidateQueries({queryKey:["orders",s]})},onError:r=>{R.error(`Erro na ação em massa: ${r.message}`)}}),f=()=>{var r;!i||o.length===0||(i==="delete"?(r=document.getElementById("mass-delete-trigger"))==null||r.click():y.mutate({orderIds:o,action:i}))},C=[{value:"pending_payment",label:"Aguardando Pag."},{value:"pending",label:"Pendentes"},{value:"preparing",label:"Em Preparação"},{value:"ready",label:"Prontos"},{value:"delivering",label:"Em Entrega"},{value:"delivered",label:"Entregues"},{value:"cancelled",label:"Cancelados"},{value:"all",label:"Todos"}],j=y.isPending;return s?e.jsxs(e.Fragment,{children:[e.jsx(ys,{order:l,isOpen:c,onClose:g}),e.jsxs(he,{children:[e.jsx(xe,{asChild:!0,children:e.jsx("button",{id:"mass-delete-trigger",className:"hidden"})}),e.jsxs(pe,{children:[e.jsxs(fe,{children:[e.jsxs(ge,{children:["Tem certeza que deseja excluir ",o.length," pedidos?"]}),e.jsxs(je,{children:["Esta ação é permanente. ",o.length," pedidos serão excluídos permanentemente do sistema."]})]}),e.jsxs(be,{children:[e.jsx(ve,{children:"Cancelar"}),e.jsx(ye,{onClick:()=>y.mutate({orderIds:o,action:"delete"}),className:"bg-destructive hover:bg-destructive/90",disabled:j,children:j?"Excluindo...":"Excluir Permanentemente"})]})]})]}),e.jsxs("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(A,{variant:"outline",onClick:b,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"})," Atualizar Dados"]})}),o.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-lg bg-card shadow-lg animate-fade-in",children:[e.jsx(ie,{className:"h-5 w-5 text-primary mr-2"}),e.jsxs("span",{className:"text-sm font-medium mr-4",children:[o.length," selecionado(s)"]}),e.jsxs(We,{value:i,onValueChange:r=>u(r),children:[e.jsx(Ye,{className:"w-[200px]",children:e.jsx(es,{placeholder:"Ação em Massa"})}),e.jsx(ss,{children:Ps.map(r=>e.jsx(as,{value:r.value,children:r.label},r.value))})]}),e.jsx(A,{onClick:f,disabled:!i||j,children:j?e.jsx(Ue,{className:"h-4 w-4 animate-spin"}):"Aplicar"})]})]}),s?e.jsxs(ts,{defaultValue:"pending",children:[e.jsx(ns,{className:"w-full overflow-x-auto justify-start",children:C.map(r=>e.jsx(rs,{value:r.value,className:"whitespace-nowrap",children:r.label},r.value))}),C.map(r=>e.jsx(ls,{value:r.value,className:"mt-6",children:e.jsx(As,{status:r.value,onViewDetails:p,restaurantId:s,selectedOrders:o,setSelectedOrders:d,totalOrdersInView:o.length})},r.value))]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Carregando dados do restaurante..."})]})]})]}):e.jsx("div",{className:"flex h-screen items-center justify-center",children:"Carregando..."})};export{Gs as default};
