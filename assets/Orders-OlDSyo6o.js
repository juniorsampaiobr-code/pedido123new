import{j as e,a as Y,b as G,u as De}from"./tanstack-C7aOFagJ.js";import{r as m,j as Be}from"./vendor-DjsPZZVP.js";import{c as q,D as Fe,q as $e,r as Le,v as qe,a as S,O as ee,Q as se,R as ae,V as te,U as Oe,W as ze,B as M,X as ne,Y as re,Z as le,s as D,_ as Ve,$ as He,a0 as oe,a1 as U,a2 as J,a3 as Ge,a4 as Ke,a5 as Qe,a6 as ie,S as ce,L as Ue,j as I,C as de,b as me,a7 as Xe,e as We,f as Ze,a8 as Je}from"./index-Yu3ysGx_.js";import{S as Ye,a as es,b as ss,c as as,d as ts,T as ns,e as rs,f as ls,g as os,B as is}from"./select-qu2DLuj9.js";import{S as A}from"./skeleton-D7pw91PA.js";import{p as cs}from"./pt-BR-CbDebePx.js";import{C as ds}from"./credit-card-Ds2M9Sd0.js";import{C as ms}from"./calendar-Ao_dsx9e.js";import{P as ue}from"./package-CfEjYH0f.js";import{T as pe}from"./truck-CwsV9bPR.js";import{C as V,A as he,h as xe,a as fe,b as ge,c as je,d as ye,e as be,f as ve,g as Ne}from"./alert-dialog-DR7_ebDR.js";import{f as us}from"./format-BeKxgCCE.js";import{u as ps}from"./index-C3WaO5Hu.js";import{P as hs}from"./printer-CTa6FK8T.js";import{T as xs}from"./trash-2-D2M0f1A9.js";import"./supabase-BAEEEeUB.js";import"./index-CVBDf82R.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=q("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=q("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=q("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=q("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=q("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),vs={pending:{label:"Pendente",icon:ne,color:"bg-yellow-500"},preparing:{label:"Em Preparação",icon:ue,color:"bg-orange-500"},ready:{label:"Pronto",icon:re,color:"bg-green-500"},delivering:{label:"Em Entrega",icon:pe,color:"bg-blue-500"},delivered:{label:"Entregue",icon:V,color:"bg-purple-500"},cancelled:{label:"Cancelado",icon:le,color:"bg-destructive"},pending_payment:{label:"Aguardando Pagamento",icon:ys,color:"bg-gray-500"}},Ns=async s=>{const{data:a,error:n}=await D.from("order_items").select("*, products(name)").eq("order_id",s);if(n)throw new Error(n.message);return a},ws=({order:s,isOpen:a,onClose:n})=>{var P,F,O,z;const[p,o]=m.useState([]),[t,c]=m.useState(!1),[u,l]=m.useState(null),[x,d]=m.useState("Carregando...");m.useEffect(()=>{a&&(async()=>{if(s!=null&&s.id){c(!0),l(null);try{const C=await Ns(s.id);o(C)}catch(C){console.error("Failed to fetch order items:",C),l("Falha ao carregar itens do pedido.")}finally{c(!1)}}})()},[s==null?void 0:s.id,a]),m.useEffect(()=>{a&&s&&(async()=>{if(!(s!=null&&s.payment_method_id)){d("Não especificado");return}try{const{data:C,error:i}=await D.from("payment_methods").select("name").eq("id",s.payment_method_id).single();if(i)throw i;d((C==null?void 0:C.name)||"Método não encontrado")}catch(C){console.error("Failed to fetch payment method name:",C),d("Erro ao carregar")}})()},[a,s]),m.useEffect(()=>{s&&console.log("Order prop recebida:",s)},[s]);const g=((P=s==null?void 0:s.customer)==null?void 0:P.name)||"Cliente Desconhecido",b=(F=s==null?void 0:s.customer)==null?void 0:F.phone,w=(O=s==null?void 0:s.customer)==null?void 0:O.email,v=(z=s==null?void 0:s.customer)==null?void 0:z.cpf_cnpj,h=s==null?void 0:s.delivery_address,k=s!=null&&s.status?vs[s.status]:null,y=s!=null&&s.id?s.id.slice(-4):"N/A",f=s!=null&&s.created_at?new Date(s.created_at):null,r=f?us(f,"dd 'de' MMMM 'de' yyyy 'às' HH:mm",{locale:cs}):"Data desconhecida",j=s!=null&&s.change_for?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.change_for):null,N=s!=null&&s.delivery_fee?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.delivery_fee):"Grátis";return e.jsx(Fe,{open:a,onOpenChange:n,children:e.jsxs($e,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Le,{children:e.jsxs(qe,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Detalhes do Pedido #",y]}),k&&e.jsxs("span",{className:S("text-xs font-semibold px-2.5 py-0.5 rounded-full text-white flex items-center",k.color),children:[e.jsx(k.icon,{className:"w-3 h-3 mr-1"}),k.label]})]})}),u&&e.jsxs(ee,{variant:"destructive",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx(ae,{children:"Erro"}),e.jsx(te,{children:u})]}),t?e.jsxs("div",{className:"space-y-4",children:[e.jsx(A,{className:"h-4 w-1/3"}),e.jsx(A,{className:"h-10 w-full"}),e.jsx(A,{className:"h-4 w-1/3"}),e.jsx(A,{className:"h-20 w-full"}),e.jsx(A,{className:"h-4 w-1/3"}),e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((R,C)=>e.jsx(A,{className:"h-12 w-full"},C))}),e.jsx(A,{className:"h-4 w-1/3"}),e.jsx(A,{className:"h-6 w-full"})]}):s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(Oe,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Cliente"}),e.jsx("p",{children:g}),v&&e.jsxs("p",{className:"text-muted-foreground text-xs",children:["CPF/CNPJ: ",v]})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(bs,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Telefone"}),e.jsx("p",{children:b||"Não informado"}),w&&e.jsx("p",{className:"text-muted-foreground text-xs",children:w})]})]}),e.jsxs("div",{className:"flex items-start md:col-span-2",children:[e.jsx(ze,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Endereço de Entrega"}),e.jsx("p",{children:h||"Retirada no local"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(ds,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Método de Pagamento"}),e.jsx("p",{children:x}),j&&e.jsxs("p",{className:"text-muted-foreground text-xs",children:["Troco para: ",j]})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(ms,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Data do Pedido"}),e.jsx("p",{children:r})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Itens do Pedido"}),e.jsx("div",{className:"space-y-2",children:p.map(R=>{var C;return e.jsxs("div",{className:"flex justify-between items-start p-2 bg-muted/50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((C=R.products)==null?void 0:C.name)||"Produto não encontrado"}),R.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Obs: ",R.notes]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{children:[R.quantity," x ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(R.unit_price)]}),e.jsx("p",{className:"font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(R.subtotal)})]})]},R.id)})})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount-(s.delivery_fee||0))})]}),e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:N})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]})]}),e.jsx("div",{className:"pt-4",children:s.notes&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Observações do Cliente:"}),e.jsx("p",{className:"bg-muted p-2 rounded",children:s.notes})]})})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(M,{onClick:n,children:"Fechar"})})]})})},we=({className:s,...a})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:S("mx-auto flex w-full justify-center",s),...a});we.displayName="Pagination";const Ce=m.forwardRef(({className:s,...a},n)=>e.jsx("ul",{ref:n,className:S("flex flex-row items-center gap-1",s),...a}));Ce.displayName="PaginationContent";const T=m.forwardRef(({className:s,...a},n)=>e.jsx("li",{ref:n,className:S("",s),...a}));T.displayName="PaginationItem";const L=({className:s,isActive:a,size:n="icon",...p})=>e.jsx("a",{"aria-current":a?"page":void 0,className:S(Ve({variant:a?"outline":"ghost",size:n}),s),...p});L.displayName="PaginationLink";const ke=({className:s,...a})=>e.jsxs(L,{"aria-label":"Go to previous page",size:"default",className:S("gap-1 pl-2.5",s),...a,children:[e.jsx(fs,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});ke.displayName="PaginationPrevious";const Pe=({className:s,...a})=>e.jsxs(L,{"aria-label":"Go to next page",size:"default",className:S("gap-1 pr-2.5",s),...a,children:[e.jsx("span",{children:"Next"}),e.jsx(gs,{className:"h-4 w-4"})]});Pe.displayName="PaginationNext";const K=({className:s,...a})=>e.jsxs("span",{"aria-hidden":!0,className:S("flex h-9 w-9 items-center justify-center",s),...a,children:[e.jsx(js,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]});K.displayName="PaginationEllipsis";const Cs=({currentPage:s,totalPages:a,onPageChange:n})=>{if(a<=1)return null;const o=(()=>{const t=[],u=Math.max(1,s-Math.floor(2.5)),l=Math.min(a,u+5-1);if(l-u+1<5){const x=Math.max(1,l-5+1);for(let d=x;d<=l;d++)t.push(d)}else for(let x=u;x<=l;x++)t.push(x);return t})();return e.jsx(we,{children:e.jsxs(Ce,{children:[e.jsx(T,{children:e.jsx(ke,{onClick:()=>n(s-1),className:S(s===1&&"pointer-events-none opacity-50")})}),o[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx(T,{children:e.jsx(L,{onClick:()=>n(1),children:"1"})}),o[0]>2&&e.jsx(T,{children:e.jsx(K,{})})]}),o.map(t=>e.jsx(T,{children:e.jsx(L,{isActive:t===s,onClick:()=>n(t),children:t})},t)),o[o.length-1]<a&&e.jsxs(e.Fragment,{children:[o[o.length-1]<a-1&&e.jsx(T,{children:e.jsx(K,{})}),e.jsx(T,{children:e.jsx(L,{onClick:()=>n(a),children:a})})]}),e.jsx(T,{children:e.jsx(Pe,{onClick:()=>n(s+1),className:S(s===a&&"pointer-events-none opacity-50")})})]})})};var H="Checkbox",[ks,Zs]=He(H),[Ps,X]=ks(H);function Es(s){const{__scopeCheckbox:a,checked:n,children:p,defaultChecked:o,disabled:t,form:c,name:u,onCheckedChange:l,required:x,value:d="on",internal_do_not_use_render:g}=s,[b,w]=Qe({prop:n,defaultProp:o??!1,onChange:l,caller:H}),[v,h]=m.useState(null),[k,y]=m.useState(null),f=m.useRef(!1),r=v?!!c||!!v.closest("form"):!0,j={checked:b,disabled:t,setChecked:w,control:v,setControl:h,name:u,form:c,value:d,hasConsumerStoppedPropagationRef:f,required:x,defaultChecked:B(o)?!1:o,isFormControl:r,bubbleInput:k,setBubbleInput:y};return e.jsx(Ps,{scope:a,...j,children:_s(g)?g(j):p})}var Ee="CheckboxTrigger",_e=m.forwardRef(({__scopeCheckbox:s,onKeyDown:a,onClick:n,...p},o)=>{const{control:t,value:c,disabled:u,checked:l,required:x,setControl:d,setChecked:g,hasConsumerStoppedPropagationRef:b,isFormControl:w,bubbleInput:v}=X(Ee,s),h=oe(o,d),k=m.useRef(l);return m.useEffect(()=>{const y=t==null?void 0:t.form;if(y){const f=()=>g(k.current);return y.addEventListener("reset",f),()=>y.removeEventListener("reset",f)}},[t,g]),e.jsx(U.button,{type:"button",role:"checkbox","aria-checked":B(l)?"mixed":l,"aria-required":x,"data-state":Me(l),"data-disabled":u?"":void 0,disabled:u,value:c,...p,ref:h,onKeyDown:J(a,y=>{y.key==="Enter"&&y.preventDefault()}),onClick:J(n,y=>{g(f=>B(f)?!0:!f),v&&w&&(b.current=y.isPropagationStopped(),b.current||y.stopPropagation())})})});_e.displayName=Ee;var W=m.forwardRef((s,a)=>{const{__scopeCheckbox:n,name:p,checked:o,defaultChecked:t,required:c,disabled:u,value:l,onCheckedChange:x,form:d,...g}=s;return e.jsx(Es,{__scopeCheckbox:n,checked:o,defaultChecked:t,disabled:u,required:c,onCheckedChange:x,name:p,form:d,value:l,internal_do_not_use_render:({isFormControl:b})=>e.jsxs(e.Fragment,{children:[e.jsx(_e,{...g,ref:a,__scopeCheckbox:n}),b&&e.jsx(Ie,{__scopeCheckbox:n})]})})});W.displayName=H;var Se="CheckboxIndicator",Re=m.forwardRef((s,a)=>{const{__scopeCheckbox:n,forceMount:p,...o}=s,t=X(Se,n);return e.jsx(Ge,{present:p||B(t.checked)||t.checked===!0,children:e.jsx(U.span,{"data-state":Me(t.checked),"data-disabled":t.disabled?"":void 0,...o,ref:a,style:{pointerEvents:"none",...s.style}})})});Re.displayName=Se;var Ae="CheckboxBubbleInput",Ie=m.forwardRef(({__scopeCheckbox:s,...a},n)=>{const{control:p,hasConsumerStoppedPropagationRef:o,checked:t,defaultChecked:c,required:u,disabled:l,name:x,value:d,form:g,bubbleInput:b,setBubbleInput:w}=X(Ae,s),v=oe(n,w),h=ps(t),k=Ke(p);m.useEffect(()=>{const f=b;if(!f)return;const r=window.HTMLInputElement.prototype,N=Object.getOwnPropertyDescriptor(r,"checked").set,P=!o.current;if(h!==t&&N){const F=new Event("click",{bubbles:P});f.indeterminate=B(t),N.call(f,B(t)?!1:t),f.dispatchEvent(F)}},[b,h,t,o]);const y=m.useRef(B(t)?!1:t);return e.jsx(U.input,{type:"checkbox","aria-hidden":!0,defaultChecked:c??y.current,required:u,disabled:l,name:x,value:d,form:g,...a,tabIndex:-1,ref:v,style:{...a.style,...k,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Ie.displayName=Ae;function _s(s){return typeof s=="function"}function B(s){return s==="indeterminate"}function Me(s){return B(s)?"indeterminate":s?"checked":"unchecked"}const Z=m.forwardRef(({className:s,...a},n)=>e.jsx(W,{ref:n,className:S("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(Re,{className:S("flex items-center justify-center text-current"),children:e.jsx(V,{className:"h-4 w-4"})})}));Z.displayName=W.displayName;const Te={pending:{label:"Pendente",icon:ne,color:"bg-yellow-500 hover:bg-yellow-600"},preparing:{label:"Em Preparação",icon:ue,color:"bg-orange-500 hover:bg-orange-600"},ready:{label:"Pronto",icon:re,color:"bg-green-500 hover:bg-green-600"},delivering:{label:"Em Entrega",icon:pe,color:"bg-indigo-500 hover:bg-indigo-600"},delivered:{label:"Entregue",icon:V,color:"bg-primary hover:bg-primary/90"},cancelled:{label:"Cancelado",icon:le,color:"bg-destructive hover:bg-destructive/90"},pending_payment:{label:"Aguardando Pag.",icon:Xe,color:"bg-gray-500 hover:bg-gray-600"}},Ss=[{value:"pending",label:"Mudar para Pendente"},{value:"preparing",label:"Mudar para Em Preparação"},{value:"ready",label:"Mudar para Pronto"},{value:"delivering",label:"Mudar para Em Entrega"},{value:"delivered",label:"Mudar para Entregue"},{value:"cancelled",label:"Mudar para Cancelado"},{value:"pending_payment",label:"Mudar para Aguardando Pag."},{value:"delete",label:"Excluir Permanentemente"}],Q=12,Rs=async(s,a,n)=>{const p=n*Q,o=p+Q-1;let t=D.from("orders").select("*, customer:customers(name, phone)",{count:"exact"}).eq("restaurant_id",s);a!=="all"&&(t=t.eq("status",a));const{data:c,error:u,count:l}=await t.order("created_at",{ascending:!1}).range(p,o);if(u)throw new Error(`Erro ao buscar pedidos: ${u.message}`);return{orders:c,count:l||0}},As=(s,a)=>{var b,w;const n=s.id?s.id.slice(-4):"N/A",p=((b=s.customer)==null?void 0:b.name)||"Cliente Desconhecido",o=((w=s.customer)==null?void 0:w.phone)||"Não informado",t=s.delivery_address||"Retirada no local",c=s.payment_method_id||"Não especificado",u=s.created_at?new Date(s.created_at).toLocaleString("pt-BR"):"Data desconhecida",l=s.change_for?`Troco para: ${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.change_for)}`:"",x=s.delivery_fee?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.delivery_fee):"Grátis",d=s.total_amount-(s.delivery_fee||0);let g="";return a.forEach(v=>{var h;g+=`
      <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
        <span>${v.quantity}x ${((h=v.products)==null?void 0:h.name)||"Produto não encontrado"}</span>
        <span>${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(v.subtotal)}</span>
      </div>
      ${v.notes?`<div style="font-size: 12px; color: #666; margin-bottom: 10px;">Obs: ${v.notes}</div>`:""}
    `}),`
    <div style="font-family: Arial, sans-serif; max-width: 300px; margin: 0 auto; padding: 20px;">
      <div style="text-align: center; border-bottom: 1px dashed #000; padding-bottom: 10px; margin-bottom: 10px;">
        <h2 style="margin: 0;">PEDIDO #${n}</h2>
        <p style="margin: 5px 0;">${u}</p>
      </div>
      
      <div style="margin-bottom: 15px;">
        <h3 style="margin: 0 0 5px 0;">Cliente</h3>
        <p style="margin: 0;">${p}</p>
        <p style="margin: 0;">${o}</p>
      </div>
      
      <div style="margin-bottom: 15px;">
        <h3 style="margin: 0 0 5px 0;">Entrega</h3>
        <p style="margin: 0;">${t}</p>
      </div>
      
      <div style="margin-bottom: 15px;">
        <h3 style="margin: 0 0 5px 0;">Itens</h3>
        ${g}
      </div>
      
      <div style="border-top: 1px dashed #000; padding-top: 10px; margin-bottom: 15px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <span>Subtotal:</span>
          <span>${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d)}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <span>Taxa de Entrega:</span>
          <span>${x}</span>
        </div>
        <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 16px; margin-top: 10px;">
          <span>Total:</span>
          <span>${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)}</span>
        </div>
      </div>
      
      <div style="margin-bottom: 15px;">
        <h3 style="margin: 0 0 5px 0;">Pagamento</h3>
        <p style="margin: 0;">${c}</p>
        ${l?`<p style="margin: 0;">${l}</p>`:""}
      </div>
      
      ${s.notes?`
        <div style="margin-bottom: 15px;">
          <h3 style="margin: 0 0 5px 0;">Observações</h3>
          <p style="margin: 0;">${s.notes}</p>
        </div>
      `:""}
      
      <div style="text-align: center; margin-top: 20px;">
        <p style="font-size: 12px;">Obrigado pela preferência!</p>
      </div>
    </div>
  `},Is=({order:s,onViewDetails:a,onAccept:n,onDecline:p,onDelete:o,isSelected:t,onSelect:c,onPrint:u})=>{var g;const l=Te[s.status||"pending"],x=((g=s.customer)==null?void 0:g.name)||"Cliente Desconhecido",d=s.id?s.id.slice(-4):"N/A";return e.jsxs(de,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col relative",children:[e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx(Z,{checked:t,onCheckedChange:b=>c(s.id,!!b),className:"h-5 w-5"})}),e.jsxs(We,{className:"flex flex-row items-center justify-between space-y-0 pb-2 pl-12",children:[e.jsxs(Ze,{className:"text-lg font-bold flex items-center gap-2",children:["Pedido #",d]}),e.jsxs(is,{className:S("text-white",l.color),children:[e.jsx(l.icon,{className:"h-3 w-3 mr-1"}),l.label]})]}),e.jsxs(me,{className:"space-y-2 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",x]}),e.jsx("p",{className:"text-2xl font-extrabold text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]}),e.jsxs("div",{className:"flex justify-end pt-2 border-t gap-2",children:[(s.status==="pending"||s.status==="pending_payment")&&e.jsxs(e.Fragment,{children:[e.jsxs(M,{variant:"destructive",size:"sm",onClick:()=>p(s.id),children:[e.jsx(Je,{className:"h-4 w-4 mr-1"})," Recusar"]}),e.jsxs(M,{variant:"default",size:"sm",onClick:()=>n(s.id),children:[e.jsx(V,{className:"h-4 w-4 mr-1"})," Aceitar"]})]}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>a(s),children:"Detalhes"}),e.jsx(M,{variant:"outline",size:"icon",onClick:()=>u(s),children:e.jsx(hs,{className:"h-4 w-4"})}),e.jsxs(he,{children:[e.jsx(xe,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",children:e.jsx(xs,{className:"h-4 w-4"})})}),e.jsxs(fe,{children:[e.jsxs(ge,{children:[e.jsx(je,{children:"Tem certeza que deseja excluir?"}),e.jsxs(ye,{children:["Esta ação é permanente. O pedido #",d," será excluído permanentemente do sistema, incluindo todos os itens associados."]})]}),e.jsxs(be,{children:[e.jsx(ve,{children:"Cancelar"}),e.jsx(Ne,{onClick:()=>o(s.id),className:"bg-destructive hover:bg-destructive/90",children:"Excluir Permanentemente"})]})]})]})]})]})]})},Ms=({status:s,onViewDetails:a,restaurantId:n,selectedOrders:p,setSelectedOrders:o,totalOrdersInView:t,onPrint:c})=>{const u=Y(),[l,x]=m.useState(1),{data:d,isLoading:g,isError:b,error:w,refetch:v}=De({queryKey:["orders",s,n,l],queryFn:()=>Rs(n,s,l-1),enabled:!!n}),h=(d==null?void 0:d.orders)||[],k=(d==null?void 0:d.count)||0,y=Math.ceil(k/Q),f=G({mutationFn:async({orderId:i,newStatus:E})=>{const _=E==="pending"?"preparing":E,{error:$}=await D.from("orders").update({status:_}).eq("id",i);if($)throw new Error($.message);return _},onSuccess:i=>{I.success(`Pedido ${i==="preparing"?"aceito":"recusado"} com sucesso!`),u.invalidateQueries({queryKey:["orders"]})},onError:i=>I.error(`Erro ao atualizar pedido: ${i.message}`)}),r=G({mutationFn:async i=>{const{error:E}=await D.from("orders").delete().eq("id",i);if(E)throw new Error(E.message)},onSuccess:()=>{I.success("Pedido excluído permanentemente."),u.invalidateQueries({queryKey:["orders"]})},onError:i=>I.error(`Erro ao excluir pedido: ${i.message}`)}),j=i=>{f.mutate({orderId:i,newStatus:"preparing"})},N=i=>{f.mutate({orderId:i,newStatus:"cancelled"})},P=i=>{a(i)},F=i=>{r.mutate(i)},O=m.useCallback(i=>{x(i)},[]),z=m.useCallback((i,E)=>{o(_=>E?[..._,i]:_.filter($=>$!==i))},[o]),R=m.useCallback(i=>{if(i){const E=h.map(_=>_.id);o(_=>[...new Set([..._,...E])])}else{const E=new Set(h.map(_=>_.id));o(_=>_.filter($=>!E.has($)))}},[h,o]),C=h.length>0&&h.every(i=>p.includes(i.id));return g?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((i,E)=>e.jsx(de,{children:e.jsx(me,{className:"p-4 space-y-3",children:e.jsx(A,{className:"h-32 w-full"})})},E))}):b?e.jsxs(ee,{variant:"destructive",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx(ae,{children:"Erro ao carregar pedidos"}),e.jsx(te,{children:w instanceof Error?w.message:"Ocorreu um erro desconhecido."}),e.jsxs(M,{onClick:()=>v(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]}):!h||h.length===0?e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg border",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifique o status selecionado ou aguarde novos pedidos."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg bg-muted/50",children:[e.jsx(Z,{checked:C,onCheckedChange:R,className:"h-5 w-5"}),e.jsxs("span",{className:"text-sm font-medium",children:["Selecionar todos (",h.length,") nesta página."]}),t>0&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-auto",children:[t," pedidos selecionados no total."]})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:h.map(i=>e.jsx(Is,{order:i,onViewDetails:P,onAccept:j,onDecline:N,onDelete:F,isSelected:p.includes(i.id),onSelect:z,onPrint:c},i.id))}),y>1&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(Cs,{currentPage:l,totalPages:y,onPageChange:O})})]})},Js=()=>{const{userRestaurantId:s}=Be(),a=Y(),[n,p]=m.useState(null),[o,t]=m.useState(!1),[c,u]=m.useState([]),[l,x]=m.useState(""),d=r=>{p(r),t(!0)},g=()=>{t(!1),p(null)},b=()=>{a.invalidateQueries({queryKey:["orders",s]}),I.info("Atualizando pedidos...",{description:"Buscando novos dados no servidor."})},w=async r=>{const{data:j,error:N}=await D.from("order_items").select("*, products(name)").eq("order_id",r);if(N)throw new Error(`Erro ao buscar itens do pedido: ${N.message}`);return j},v=async r=>{try{const j=await w(r.id),N=As(r,j),P=window.open("","_blank");P?(P.document.write(`
          <html>
            <head>
              <title>Pedido #${r.id?r.id.slice(-4):"N/A"}</title>
              <style>
                @media print {
                  body { margin: 0; }
                }
              </style>
            </head>
            <body>
              ${N}
              <script>
                window.onload = function() {
                  window.print();
                  window.onafterprint = function() {
                    window.close();
                  }
                }
              <\/script>
            </body>
          </html>
        `),P.document.close()):I.error("Não foi possível abrir a janela de impressão. Verifique as permissões do navegador.")}catch(j){console.error("Erro ao imprimir pedido:",j),I.error("Erro ao preparar impressão do pedido.")}},h=G({mutationFn:async({orderIds:r,action:j})=>{if(j==="delete"){const{error:N}=await D.from("orders").delete().in("id",r);if(N)throw new Error(N.message);return"deleted"}else{const N=j==="pending"?"preparing":j,{error:P}=await D.from("orders").update({status:N}).in("id",r);if(P)throw new Error(P.message);return"updated"}},onSuccess:(r,j)=>{if(r==="deleted")I.success(`${j.orderIds.length} pedidos excluídos permanentemente.`);else{const N=Te[j.action].label;I.success(`${j.orderIds.length} pedidos atualizados para "${N}".`)}u([]),x(""),a.invalidateQueries({queryKey:["orders",s]})},onError:r=>{I.error(`Erro na ação em massa: ${r.message}`)}}),k=()=>{var r;!l||c.length===0||(l==="delete"?(r=document.getElementById("mass-delete-trigger"))==null||r.click():h.mutate({orderIds:c,action:l}))},y=[{value:"pending_payment",label:"Aguardando Pag."},{value:"pending",label:"Pendentes"},{value:"preparing",label:"Em Preparação"},{value:"ready",label:"Prontos"},{value:"delivering",label:"Em Entrega"},{value:"delivered",label:"Entregues"},{value:"cancelled",label:"Cancelados"},{value:"all",label:"Todos"}],f=h.isPending;return s?e.jsxs(e.Fragment,{children:[e.jsx(ws,{order:n,isOpen:o,onClose:g}),e.jsxs(he,{children:[e.jsx(xe,{asChild:!0,children:e.jsx("button",{id:"mass-delete-trigger",className:"hidden"})}),e.jsxs(fe,{children:[e.jsxs(ge,{children:[e.jsxs(je,{children:["Tem certeza que deseja excluir ",c.length," pedidos?"]}),e.jsxs(ye,{children:["Esta ação é permanente. ",c.length," pedidos serão excluídos permanentemente do sistema."]})]}),e.jsxs(be,{children:[e.jsx(ve,{children:"Cancelar"}),e.jsx(Ne,{onClick:()=>h.mutate({orderIds:c,action:"delete"}),className:"bg-destructive hover:bg-destructive/90",disabled:f,children:f?"Excluindo...":"Excluir Permanentemente"})]})]})]}),e.jsxs("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(M,{variant:"outline",onClick:b,children:[e.jsx(ie,{className:"h-4 w-4 mr-2"})," Atualizar Dados"]})}),c.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-lg bg-card shadow-lg animate-fade-in",children:[e.jsx(ce,{className:"h-5 w-5 text-primary mr-2"}),e.jsxs("span",{className:"text-sm font-medium mr-4",children:[c.length," selecionado(s)"]}),e.jsxs(Ye,{value:l,onValueChange:r=>x(r),children:[e.jsx(es,{className:"w-[200px]",children:e.jsx(ss,{placeholder:"Ação em Massa"})}),e.jsx(as,{children:Ss.map(r=>e.jsx(ts,{value:r.value,children:r.label},r.value))})]}),e.jsx(M,{onClick:k,disabled:!l||f,children:f?e.jsx(Ue,{className:"h-4 w-4 animate-spin"}):"Aplicar"})]})]}),s?e.jsxs(ns,{defaultValue:"pending",children:[e.jsx(rs,{className:"w-full overflow-x-auto justify-start",children:y.map(r=>e.jsx(ls,{value:r.value,className:"whitespace-nowrap",children:r.label},r.value))}),y.map(r=>e.jsx(os,{value:r.value,className:"mt-6",children:e.jsx(Ms,{status:r.value,onViewDetails:d,restaurantId:s,selectedOrders:c,setSelectedOrders:u,totalOrdersInView:c.length,onPrint:v})},r.value))]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Carregando dados do restaurante..."})]})]})]}):e.jsx("div",{className:"flex h-screen items-center justify-center",children:"Carregando..."})};export{Js as default};
