const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./LocationPickerMap-BNEEALAO.js","./tanstack-A21VxrtK.js","./vendor-Dj3GGzPJ.js","./LocationPickerMap-Dgihpmma.css"])))=>i.map(i=>d[i]);
import{j as e,u as ie,a as ce,b as D}from"./tanstack-A21VxrtK.js";import{o as de,s as f,l as A,e as ue,p as I,c as B,u as me,t as he}from"./types-CxAtNUmv.js";import{s as L}from"./client-Cbu95aD0.js";import{B as k}from"./button-d9KMaeCA.js";import{C as Q,a as G,b as K,d as O}from"./card-DxPSZk-M.js";import{I as j,L as Z}from"./label-D9Ejycn5.js";import{T as pe,U as xe}from"./textarea-D2A8OWVN.js";import{S as je}from"./switch-COXGrvKC.js";import{c as H,k as ge,a as fe,L as X,u as n}from"./index-Dl70Wl3Z.js";import{F as be,a as c,b as d,e as u,c as m,d as x}from"./form-Co8qhXNT.js";import{S as ve}from"./skeleton-Bse8TmRo.js";import{r as h,R as ye}from"./vendor-Dj3GGzPJ.js";import{_ as we}from"./supabase-Cu3W1aAk.js";import{C as Ne,V as Ce}from"./volume-2-DKIefh6d.js";import{u as Ee}from"./use-sound-DDzP4fgF.js";import{A as Se,a as _e,b as Ve}from"./alert-C-8bE8aJ.js";import{C as Le,a as ke}from"./circle-x-dK17aooE.js";import{M as Me}from"./map-pin-_az_D5z8.js";import"./index-BUX6HQvJ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=H("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=H("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Pe=h.lazy(()=>we(()=>import("./LocationPickerMap-BNEEALAO.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).catch(r=>(console.error("Erro ao carregar LocationPickerMap:",r),{default:()=>e.jsxs("div",{className:"h-96 w-full rounded-lg bg-muted flex items-center justify-center border border-destructive",children:[e.jsx(Ne,{className:"h-10 w-10 text-destructive mx-auto mb-2"}),e.jsx("p",{className:"text-destructive text-center",children:"Falha ao carregar o mapa. Por favor, recarregue a página."})]})}))),Re=r=>e.jsx(h.Suspense,{fallback:e.jsx("div",{className:"h-96 w-full rounded-lg bg-muted flex items-center justify-center",children:e.jsx(ge,{})}),children:e.jsx(Pe,{...r})}),$e=r=>{let t=r.replace(/\D/g,"");return t.length>8&&(t=t.slice(0,8)),t.length>5&&(t=`${t.slice(0,5)}-${t.slice(5)}`),t},z=ye.forwardRef(({className:r,value:t,onChange:g,...y},w)=>{const b=i=>{const N=i.target.value,C=$e(N),E={...i,target:{...i.target,value:C}};g(E)};return e.jsx(j,{ref:w,type:"tel",className:fe("w-full",r),placeholder:"00000-000",value:t,onChange:b,maxLength:9,...y})});z.displayName="ZipCodeInput";const Ue=de({name:f().min(1,"O nome do restaurante é obrigatório."),description:f().optional(),logo_url:f().url("URL do logo inválida.").optional().or(A("")),street:f().optional(),number:f().optional(),neighborhood:f().optional(),city:f().optional(),zip_code:f().optional(),phone:f().optional(),email:f().email("Email inválido.").optional().or(A("")),is_active:ue().default(!0),latitude:I(r=>String(r).replace(",","."),B.number({invalid_type_error:"Latitude deve ser um número."}).optional().nullable()),longitude:I(r=>String(r).replace(",","."),B.number({invalid_type_error:"Longitude deve ser um número."}).optional().nullable())}),ze=async()=>{const{data:r,error:t}=await L.from("restaurants").select("*").limit(1).single();if(t)throw new Error(`Erro ao buscar dados do restaurante: ${t.message}`);if(!r)throw new Error("Nenhum restaurante encontrado.");return r},Te=({markerPosition:r,onLocationChange:t,updateAddressFields:g})=>{const[y,w]=h.useState(!1),b=r[0],i=r[1],N=h.useCallback(async(C,E)=>{w(!0);const R=n.loading("Buscando endereço para a nova localização...");try{const S=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${C}&lon=${E}&addressdetails=1`,o=await fetch(S);if(!o.ok)throw new Error("Falha ao obter detalhes do endereço.");const _=await o.json();_.address?(g(_.address),n.success("Endereço atualizado a partir do mapa.")):n.warning("Não foi possível encontrar um endereço para esta localização.")}catch(S){n.error(`Erro ao buscar endereço: ${S.message}`)}finally{w(!1),n.dismiss(R)}},[g]);return e.jsxs("div",{className:"space-y-2 relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Re,{center:r,markerPosition:r,onLocationChange:t,isInteractive:!0}),e.jsx("div",{className:"absolute top-4 left-4 z-[401]",children:e.jsxs(k,{type:"button",onClick:()=>N(b,i),disabled:y,className:"shadow-lg bg-card text-foreground hover:bg-muted",children:[y?e.jsx(X,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(J,{className:"h-4 w-4 mr-2"}),"Buscar Endereço no Mapa"]})})]}),e.jsxs("div",{className:"text-xs text-muted-foreground flex justify-between",children:[e.jsxs("span",{children:["Latitude: ",b==null?void 0:b.toFixed(6)]}),e.jsxs("span",{children:["Longitude: ",i==null?void 0:i.toFixed(6)]})]}),e.jsxs(Se,{variant:"default",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx(_e,{children:"Ajuste a Localização"}),e.jsx(Ve,{children:'Arraste o pino vermelho para o local exato do seu restaurante e clique em "Buscar Endereço no Mapa" para atualizar os campos de endereço.'})]})]})},ta=()=>{const r=ie(),{playSound:t}=Ee(),[g,y]=h.useState(null),[w,b]=h.useState(""),[i,N]=h.useState(""),[C,E]=h.useState(!1),[R,S]=h.useState(!1),{data:o,isLoading:_,isError:W,error:Y}=ce({queryKey:["restaurantSettings"],queryFn:ze,staleTime:1e3*60*5}),s=me({resolver:he(Ue),defaultValues:{name:"",description:"",logo_url:"",street:"",number:"",neighborhood:"",city:"",zip_code:"",phone:"",email:"",is_active:!0,latitude:null,longitude:null},mode:"onBlur"});h.useEffect(()=>{o&&(s.reset({name:o.name||"",description:o.description||"",logo_url:o.logo_url||"",street:o.street||"",number:o.number||"",neighborhood:o.neighborhood||"",city:o.city||"",zip_code:o.zip_code||"",phone:o.phone||"",email:o.email||"",is_active:o.is_active??!0,latitude:o.latitude??null,longitude:o.longitude??null}),o.latitude&&o.longitude&&S(!0))},[o,s.reset]);const M=s.watch("latitude"),F=s.watch("longitude"),ee=[-23.55052,-46.633308],ae=h.useMemo(()=>typeof M=="number"&&typeof F=="number"&&!isNaN(M)&&!isNaN(F)?[M,F]:ee,[M,F]),se=h.useCallback(a=>{s.setValue("street",a.road||a.logradouro||"",{shouldValidate:!0}),s.setValue("number",a.house_number||"",{shouldValidate:!0}),s.setValue("neighborhood",a.suburb||a.bairro||"",{shouldValidate:!0}),s.setValue("city",a.city||a.localidade||"",{shouldValidate:!0}),s.setValue("zip_code",a.postcode||a.cep||"",{shouldValidate:!0}),b((a.postcode||a.cep||"").replace(/\D/g,"")),N(a.house_number||"")},[s]),oe=async()=>{const a=w.replace(/\D/g,"");if(a.length!==8||!i){n.warning("Por favor, digite um CEP válido e o número da casa.");return}E(!0);const p=n.loading("Buscando endereço e coordenadas...");try{const v=await fetch(`https://viacep.com.br/ws/${a}/json/`);if(!v.ok)throw new Error("Falha na busca do CEP.");const l=await v.json();if(l.erro){n.error("CEP não encontrado.");return}s.setValue("street",l.logradouro,{shouldValidate:!0}),s.setValue("number",i,{shouldValidate:!0}),s.setValue("neighborhood",l.bairro,{shouldValidate:!0}),s.setValue("city",l.localidade,{shouldValidate:!0}),s.setValue("zip_code",l.cep,{shouldValidate:!0});const P=`${l.logradouro}, ${i}, ${l.localidade}, ${l.uf}`,V=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(P)}`,q=await(await fetch(V)).json();if(q.length>0){const{lat:ne,lon:le}=q[0];s.setValue("latitude",parseFloat(ne),{shouldValidate:!0}),s.setValue("longitude",parseFloat(le),{shouldValidate:!0}),S(!0),n.success("Endereço e mapa atualizados com sucesso!")}else n.warning("Endereço encontrado, mas não foi possível obter as coordenadas exatas. Ajuste o pino no mapa manualmente.")}catch(v){n.error(`Erro na busca: ${v.message}`)}finally{E(!1),n.dismiss(p)}},re=h.useCallback((a,p)=>{s.setValue("latitude",a,{shouldValidate:!0}),s.setValue("longitude",p,{shouldValidate:!0})},[s]),$=D({mutationFn:async a=>{if(!(o!=null&&o.id))throw new Error("ID do restaurante não disponível.");const{id:p,...v}={...a,id:o.id},{error:l}=await L.from("restaurants").update(v).eq("id",p);if(l)throw l},onSuccess:()=>{n.success("Configurações salvas com sucesso!"),r.invalidateQueries({queryKey:["restaurantSettings"]})},onError:a=>n.error(`Erro ao salvar configurações: ${a.message}`)}),U=D({mutationFn:async a=>{if(!(o!=null&&o.id))throw new Error("ID do restaurante não disponível.");if(a.type!=="audio/mpeg"&&a.type!=="audio/mp3")throw new Error("O arquivo deve ser do tipo MP3.");const p=`${o.id}/notification.mp3`;console.log(`[Sound Upload] Attempting upload to settings/${p}`);const{error:v}=await L.storage.from("settings").upload(p,a,{upsert:!0,contentType:"audio/mpeg"});if(v)throw v;const{data:l}=L.storage.from("settings").getPublicUrl(p);if(!l.publicUrl)throw new Error("Falha ao obter a URL pública do arquivo.");const P=`${l.publicUrl}?t=${new Date().getTime()}`;console.log(`[DB Update] Updating restaurant ID: ${o.id} with URL: ${P}`);const{error:V}=await L.from("restaurants").update({notification_sound_url:P}).eq("id",o.id);if(V)throw console.error("[DB Update Error] Supabase Error:",V),new Error(`Falha ao salvar URL no banco de dados: ${V.message}`)},onSuccess:()=>{n.success("Som de notificação atualizado com sucesso!"),r.invalidateQueries({queryKey:["restaurantSettings"]}),y(null)},onError:a=>{console.error("Erro detalhado no upload do som:",a),n.error(`Erro ao salvar som: ${a.message}`)}}),te=()=>{g&&U.mutate(g)},T=!!(o!=null&&o.notification_sound_url);return e.jsx("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsxs(Q,{children:[e.jsx(G,{children:e.jsx(K,{className:"text-2xl font-bold",children:"Configurações do Restaurante"})}),e.jsx(O,{children:_?e.jsx(ve,{className:"h-96 w-full"}):W?e.jsxs("p",{className:"text-destructive",children:["Erro ao carregar dados: ",Y.message]}):e.jsx(be,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(a=>$.mutate(a)),className:"space-y-6",children:[e.jsx(c,{control:s.control,name:"name",render:({field:a})=>e.jsxs(d,{children:[e.jsx(u,{children:"Nome do Restaurante *"}),e.jsx(m,{children:e.jsx(j,{...a})}),e.jsx(x,{})]})}),e.jsx(c,{control:s.control,name:"description",render:({field:a})=>e.jsxs(d,{children:[e.jsx(u,{children:"Descrição"}),e.jsx(m,{children:e.jsx(pe,{...a,rows:3})}),e.jsx(x,{})]})}),e.jsx(c,{control:s.control,name:"logo_url",render:({field:a})=>e.jsxs(d,{children:[e.jsx(u,{children:"URL do Logo"}),e.jsx(m,{children:e.jsx(j,{...a})}),e.jsx(x,{})]})}),e.jsx("div",{className:"pt-4 border-t mt-6",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Endereço e Localização"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{children:"Buscar Endereço por CEP e Número *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{placeholder:"Digite o CEP",value:w,onChange:a=>b(a.target.value)}),e.jsx(j,{placeholder:"Número",value:i,onChange:a=>N(a.target.value)}),e.jsx(k,{type:"button",onClick:oe,disabled:C,children:C?e.jsx(X,{className:"h-4 w-4 animate-spin"}):e.jsx(J,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Coloque o CEP e nº do estabelecimento e para melhor precisão mova o alfinete no mapa e salve as configurações"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(c,{control:s.control,name:"street",render:({field:a})=>e.jsxs(d,{className:"md:col-span-2",children:[e.jsx(u,{children:"Rua"}),e.jsx(m,{children:e.jsx(j,{...a,disabled:!0})}),e.jsx(x,{})]})}),e.jsx(c,{control:s.control,name:"number",render:({field:a})=>e.jsxs(d,{className:"md:col-span-1",children:[e.jsx(u,{children:"Número"}),e.jsx(m,{children:e.jsx(j,{...a,disabled:!0})}),e.jsx(x,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{control:s.control,name:"neighborhood",render:({field:a})=>e.jsxs(d,{children:[e.jsx(u,{children:"Bairro"}),e.jsx(m,{children:e.jsx(j,{...a,disabled:!0})}),e.jsx(x,{})]})}),e.jsx(c,{control:s.control,name:"city",render:({field:a})=>e.jsxs(d,{children:[e.jsx(u,{children:"Cidade"}),e.jsx(m,{children:e.jsx(j,{...a,disabled:!0})}),e.jsx(x,{})]})})]}),e.jsx(c,{control:s.control,name:"zip_code",render:({field:a})=>e.jsxs(d,{children:[e.jsx(u,{children:"CEP"}),e.jsx(m,{children:e.jsx(z,{...a,disabled:!0})}),e.jsx(x,{})]})}),e.jsx("div",{className:"pt-4 border-t",children:R&&e.jsx(Te,{markerPosition:ae,onLocationChange:re,updateAddressFields:se})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{control:s.control,name:"latitude",render:({field:a})=>e.jsxs(d,{children:[e.jsx(u,{children:"Latitude"}),e.jsx(m,{children:e.jsx(j,{...a,placeholder:"-22.7627908",value:a.value??""})}),e.jsx(x,{})]})}),e.jsx(c,{control:s.control,name:"longitude",render:({field:a})=>e.jsxs(d,{children:[e.jsx(u,{children:"Longitude"}),e.jsx(m,{children:e.jsx(j,{...a,placeholder:"-47.408315",value:a.value??""})}),e.jsx(x,{})]})})]}),e.jsx("h3",{className:"text-lg font-semibold pt-4 border-t mt-6",children:"Contato"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{control:s.control,name:"phone",render:({field:a})=>e.jsxs(d,{children:[e.jsx(u,{children:"Telefone"}),e.jsx(m,{children:e.jsx(j,{...a})}),e.jsx(x,{})]})}),e.jsx(c,{control:s.control,name:"email",render:({field:a})=>e.jsxs(d,{children:[e.jsx(u,{children:"Email"}),e.jsx(m,{children:e.jsx(j,{...a})}),e.jsx(x,{})]})})]}),e.jsx(c,{control:s.control,name:"is_active",render:({field:a})=>e.jsxs(d,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(u,{className:"font-normal",children:"Restaurante Ativo"}),e.jsx(m,{children:e.jsx(je,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsx(k,{type:"submit",className:"w-full h-12 text-lg",disabled:$.isPending,children:$.isPending?"Salvando...":"Salvar Configurações"})]})})})]}),e.jsxs(Q,{children:[e.jsxs(G,{children:[e.jsxs(K,{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Fe,{className:"h-6 w-6 text-primary"}),"Notificação Sonora"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Envie um arquivo MP3 para ser usado como som de notificação para novos pedidos."})]}),e.jsxs(O,{className:"space-y-4",children:[T&&e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-green-50/50 dark:bg-green-900/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Le,{className:"h-5 w-5 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"font-medium text-sm",children:"Som Salvo: notification.mp3"})]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:t,children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"})," Testar"]})]}),!T&&!_&&e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg bg-yellow-50/50 dark:bg-yellow-900/20",children:[e.jsx(ke,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"}),e.jsx("span",{className:"font-medium text-sm",children:"Nenhum som de notificação configurado."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"sound-upload",children:"Arquivo de Som (MP3)"}),e.jsxs("label",{className:"flex items-center justify-center w-full h-12 px-4 border-2 border-dashed rounded-md cursor-pointer hover:bg-muted",children:[e.jsx(xe,{className:"w-4 w-4 mr-2"}),e.jsx("span",{children:(g==null?void 0:g.name)||"Escolher Arquivo MP3"}),e.jsx("input",{id:"sound-upload",type:"file",className:"hidden",accept:".mp3",onChange:a=>{var p;return y(((p=a.target.files)==null?void 0:p[0])||null)}})]})]}),e.jsx(k,{onClick:te,className:"w-full h-12 text-lg",disabled:!g||U.isPending,children:U.isPending?"Salvando Som...":"Salvar Som de Notificação"})]})]})]})})};export{ta as default};
