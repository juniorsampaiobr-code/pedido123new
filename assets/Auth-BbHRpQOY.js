import{j as e}from"./tanstack-C7aOFagJ.js";import{h as R,i as z,r as o,L as O}from"./vendor-DjsPZZVP.js";import{L as T}from"./Logo-D8hkoL2G.js";import{s as g,C as B,d as H,e as J,f as V,b as W,g as x,I as v,P as _,B as I,L as $,h as s}from"./index-hMf46PLc.js";import{S as G}from"./separator-SbVpeRLs.js";import{u as K}from"./use-active-restaurant-id-CHHz1qdW.js";import"./supabase-BAEEEeUB.js";const E=l=>l.replace(/\D/g,""),se=()=>{var L;const l=R(),d=z(),[S,m]=o.useState(!1),[n,P]=o.useState(!1),[h,F]=o.useState(""),[f,U]=o.useState(""),[j,k]=o.useState(""),[N,A]=o.useState(""),[M,C]=o.useState(null),[Q,b]=o.useState(null),{data:y,isLoading:c}=K(),p=(L=d.state)==null?void 0:L.restaurantId,w=(r,t)=>{var u;const a=(u=d.state)==null?void 0:u.from,i=t||y;a==="/checkout"?(console.log("User logged in, redirecting to checkout."),l("/checkout",{replace:!0})):i?(console.log("User logged in, redirecting to specific menu:",i),l(`/menu/${i}`,{replace:!0})):(console.log("User logged in, no active restaurant found, redirecting to index."),l("/",{replace:!0}))};o.useEffect(()=>{if(c)return;const{data:{subscription:r}}=g.auth.onAuthStateChange((t,a)=>{b(a),C((a==null?void 0:a.user)??null),a!=null&&a.user&&w(a.user,p)});return g.auth.getSession().then(({data:{session:t}})=>{b(t),C((t==null?void 0:t.user)??null),t!=null&&t.user&&w(t.user,p)}),()=>r.unsubscribe()},[l,d.state,c,y,p]);const D=()=>j.trim()?E(N).length!==11?(s.error("O Telefone deve conter 11 dígitos (DDD + 9 dígitos)."),!1):h.trim()?f.length<6?(s.error("A Senha deve ter pelo menos 6 caracteres."),!1):!0:(s.error("O Email é obrigatório."),!1):(s.error("O Nome Completo é obrigatório."),!1),q=async r=>{var t;if(r.preventDefault(),m(!0),((t=d.state)==null?void 0:t.from)==="/checkout"&&!p){s.error("Erro: ID do restaurante de origem não encontrado."),m(!1);return}try{if(n){if(!D()){m(!1);return}const a=E(N),{data:i,error:u}=await g.auth.signUp({email:h,password:f,options:{data:{full_name:j,phone:a}}});if(u)throw u;i.session?s.success("Conta criada e login efetuado com sucesso!"):s.success("Conta criada! Verifique seu email para confirmar.")}else{const{error:a}=await g.auth.signInWithPassword({email:h,password:f});if(a)throw a;s.success("Login realizado com sucesso!")}}catch(a){a.message.includes("Email not confirmed")?s.error("Por favor, verifique seu e-mail para confirmar sua conta antes de fazer login."):s.error(a.message||"Erro ao processar autenticação")}finally{m(!1)}};return c?e.jsx(LoadingSpinner,{}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(T,{className:"justify-center mb-4"})}),e.jsxs(B,{className:"shadow-xl border-2",children:[e.jsxs(H,{className:"space-y-1",children:[e.jsx(J,{className:"text-2xl font-bold text-center",children:n?"Crie sua conta":"Acesse sua conta"}),e.jsx(V,{className:"text-center",children:n?"Preencha os campos para começar":"Utilize seu email e senha para fazer login"})]}),e.jsxs(W,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"fullName",children:"Nome Completo *"}),e.jsx(v,{id:"fullName",type:"text",placeholder:"Seu nome completo",value:j,onChange:r=>k(r.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"phone",children:"Telefone *"}),e.jsx(_,{id:"phone",value:N,onChange:r=>A(r.target.value),required:!0,className:"h-12"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formato: (99) 99999-9999"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"email",children:"Email *"}),e.jsx(v,{id:"email",type:"email",placeholder:"seu@email.com",value:h,onChange:r=>F(r.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"password",children:"Senha *"}),e.jsx(v,{id:"password",type:"password",placeholder:"••••••••",value:f,onChange:r=>U(r.target.value),required:!0,className:"h-12"})]}),e.jsx(I,{type:"submit",className:"w-full",size:"lg",disabled:S||c,children:S||c?e.jsx($,{className:"h-4 w-4 animate-spin mr-2"}):n?"Criar conta":"Entrar"})]}),e.jsx("div",{className:"text-center",children:e.jsx(I,{variant:"link",type:"button",className:"p-0 h-auto",onClick:()=>P(!n),children:n?"Já tem uma conta? Faça login":"Não tem uma conta? Crie uma agora"})}),e.jsx(G,{className:"my-4"}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["É o dono de uma loja? ",e.jsx(O,{to:"/admin-auth",className:"text-primary hover:underline",children:"Acesse o painel de administração"})]})]})]})]})})};export{se as default};
