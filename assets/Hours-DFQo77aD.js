import{y as $,j as e,d as q,e as I,r as g,a as N}from"./index-zkuE9Bm6.js";import{u as v}from"./useQuery-Bop5DQT3.js";import{u as A}from"./useMutation-DTwKCpeC.js";import{o as E,n as M,b as D,s as k,a as Q,u as R,t as B,d as K}from"./types-BjVHfDxe.js";import{s as f}from"./client-g0uDe16g.js";import{B as L}from"./button-3xZnEy7f.js";import{C as O,b as P,c as U,a as V}from"./card-B1F0wEox.js";import{S as W}from"./switch-D1y-lj2Q.js";import{F as Y,b as x,c as y,d as w,a as j,e as S}from"./form-gGgYvqwv.js";import{I as z}from"./label-CD9lqJez.js";import{C as G}from"./clock-8B-vU318.js";import{S as u}from"./skeleton-CBZEqJVS.js";import{S as J}from"./separator-DaMM4xLR.js";import"./index-CSKTzlwz.js";const b=$.forwardRef(({className:i,value:r,onChange:l,...c},d)=>e.jsxs("div",{className:q("relative w-32",i),children:[e.jsx(z,{ref:d,type:"time",value:r,onChange:l,className:"w-full pr-8 text-center font-medium",...c}),e.jsx(G,{className:"absolute right-2 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none"})]}));b.displayName="TimeInput";const p=[{day_of_week:0,label:"Domingo"},{day_of_week:1,label:"Segunda-feira"},{day_of_week:2,label:"Terça-feira"},{day_of_week:3,label:"Quarta-feira"},{day_of_week:4,label:"Quinta-feira"},{day_of_week:5,label:"Sexta-feira"},{day_of_week:6,label:"Sábado"}],X=E({day_of_week:M().min(0).max(6),is_open:D().default(!0),open_time:k().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Formato de hora inválido (HH:MM)").optional(),close_time:k().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Formato de hora inválido (HH:MM)").optional()}),Z=E({hours:Q(X).refine(i=>i.every(r=>!r.is_open||r.open_time&&r.close_time),{message:"Horário de abertura e fechamento são obrigatórios para dias abertos.",path:["hours"]})}),F=p.map(i=>({day_of_week:i.day_of_week,is_open:!0,open_time:"09:00",close_time:"18:00",restaurant_id:""})),ee=async i=>{const{data:r,error:l}=await f.from("business_hours").select("*").eq("restaurant_id",i).order("day_of_week",{ascending:!0});if(l)throw new Error(`Erro ao buscar horários: ${l.message}`);return r},_e=()=>{const i=I(),[r,l]=g.useState(null);v({queryKey:["restaurantId"],queryFn:async()=>{const{data:s,error:t}=await f.from("restaurants").select("id").limit(1).single();if(t)throw new Error(t.message);return l(s.id),s.id}});const{data:c,isLoading:d}=v({queryKey:["businessHours",r],queryFn:()=>ee(r),enabled:!!r}),m=R({resolver:B(Z),defaultValues:{hours:F.map(s=>({...s,open_time:s.open_time||"09:00",close_time:s.close_time||"18:00"}))},mode:"onBlur"}),{fields:H,replace:_}=K({control:m.control,name:"hours"});g.useEffect(()=>{if(c&&c.length>0){const s=c.sort((n,o)=>n.day_of_week-o.day_of_week),t=p.map(n=>{const o=s.find(a=>a.day_of_week===n.day_of_week);return{day_of_week:n.day_of_week,is_open:(o==null?void 0:o.is_open)??!1,open_time:(o==null?void 0:o.open_time)||"09:00",close_time:(o==null?void 0:o.close_time)||"18:00"}});_(t)}else r&&!d&&_(F.map(s=>({...s,restaurant_id:r})))},[c,r,d,_]);const h=A({mutationFn:async s=>{if(!r)throw new Error("ID do restaurante não disponível.");const t=s.hours.map(a=>({restaurant_id:r,day_of_week:a.day_of_week,is_open:a.is_open,open_time:a.is_open?a.open_time:null,close_time:a.is_open?a.close_time:null})),{error:n}=await f.from("business_hours").delete().eq("restaurant_id",r);if(n)throw new Error(`Erro ao limpar horários antigos: ${n.message}`);const{error:o}=await f.from("business_hours").insert(t);if(o)throw new Error(`Erro ao inserir novos horários: ${o.message}`)},onSuccess:()=>{N.success("Horários de funcionamento salvos com sucesso!"),i.invalidateQueries({queryKey:["businessHours"]})},onError:s=>{N.error(`Erro ao salvar horários: ${s.message}`)}}),C=s=>{h.mutate(s)},T=d||!r;return e.jsx("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:e.jsxs(O,{className:"max-w-3xl mx-auto",children:[e.jsxs(P,{children:[e.jsx(U,{className:"text-2xl font-bold",children:"Horário de Funcionamento"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure os horários de abertura e fechamento para cada dia da semana"})]}),e.jsx(V,{children:T?e.jsxs("div",{className:"space-y-4",children:[[...Array(7)].map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between py-3 border-b last:border-b-0",children:[e.jsx(u,{className:"h-5 w-24"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{className:"h-8 w-12"}),e.jsx(u,{className:"h-10 w-32"}),e.jsx(u,{className:"h-10 w-32"})]})]},t)),e.jsx(u,{className:"h-12 w-full mt-6"})]}):e.jsx(Y,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(C),className:"space-y-6",children:[H.map((s,t)=>{const n=p.find(a=>a.day_of_week===s.day_of_week),o=!m.watch(`hours.${t}.is_open`);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("div",{className:"w-32 font-medium",children:n==null?void 0:n.label}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(x,{control:m.control,name:`hours.${t}.is_open`,render:({field:a})=>e.jsxs(y,{className:"flex items-center space-x-2",children:[e.jsx(w,{children:e.jsx(W,{checked:a.value,onCheckedChange:a.onChange})}),e.jsx(j,{className:"text-sm font-normal w-16 text-right",children:a.value?"Aberto":"Fechado"})]})}),e.jsxs("div",{className:o?"opacity-50 pointer-events-none":"flex gap-4",children:[e.jsx(x,{control:m.control,name:`hours.${t}.open_time`,render:({field:a})=>e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"text-sm",children:"Abre:"}),e.jsx(w,{children:e.jsx(b,{...a})}),e.jsx(S,{})]})}),e.jsx(x,{control:m.control,name:`hours.${t}.close_time`,render:({field:a})=>e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"text-sm",children:"Fecha:"}),e.jsx(w,{children:e.jsx(b,{...a})}),e.jsx(S,{})]})})]})]})]}),t<p.length-1&&e.jsx(J,{})]},s.id)}),e.jsx(L,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground h-12 text-lg mt-6",disabled:h.isPending,children:h.isPending?"Salvando...":"Salvar Horários"}),m.formState.errors.hours&&e.jsx("p",{className:"text-destructive text-sm mt-2",children:m.formState.errors.hours.message})]})})})]})})};export{_e as default};
