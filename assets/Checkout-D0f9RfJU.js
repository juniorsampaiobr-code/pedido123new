import{b as le,j as e,u as nt,c as Ie}from"./tanstack-d4AvmB45.js";import{r as o,u as at,h as ot,j as it,L as ke}from"./vendor-CnEXr6gt.js";import{s as _}from"./client-D5i5GwB9.js";import{c as ct,d as gs,e as Ve,P as Ne,f as Me,g as lt,h as dt,i as mt,a as ue,u as b,L as me,p as ut,b as ns}from"./index-BVM0ZKKe.js";import{L as pt,g as as,c as Fe}from"./location-G_A7ZCpI.js";import{u as ft}from"./use-auth-status-b07NBuTX.js";import{o as ys,s as D,e as ht,u as os,C as we,t as is}from"./types-DKlirIXB.js";import{B as Z}from"./button-sGJM0hQN.js";import{C as X,b as H,c as J,a as W}from"./card-bda3VGPR.js";import{I as de,L}from"./label-7Jd0e7nr.js";import{T as xt}from"./textarea-DyGiQzn1.js";import{c as ws,R as gt,I as yt}from"./index-a2F-LK7k.js";import{u as wt}from"./index-DrlxvCXN.js";import{u as jt}from"./index-KNP7Yozt.js";import{S as cs}from"./separator-BF4X_NWe.js";import{A as ee,a as ne,b as ae}from"./alert-wKADoc-m.js";import{P as vt,M as bt}from"./PhoneInput-CjiJgAOy.js";import{S as _t,C as Nt,L as Ct}from"./CustomerProfileModal-m-H7_w3z.js";import{D as ls,a as ds,b as Et,c as Rt,d as St}from"./dialog-CRZVSUke.js";import{C as js}from"./credit-card-BBa6MssR.js";import{C as Pt}from"./CpfCnpjInput-CVySB51o.js";import{M as De}from"./map-pin-DPYLnFNz.js";import{A as $t,a as At,b as It,c as kt,d as Ft,e as Mt,g as Dt}from"./alert-dialog-DwSswoIh.js";import{C as be}from"./circle-alert-DUabkCaK.js";import{F as ms}from"./form-cds5xCp_.js";import{T as us}from"./terminal-DTxoy8V-.js";import{R as Ot}from"./pt-BR-BkrA6mON.js";import{A as Vt}from"./arrow-left-Opwdvs49.js";import{U as ps}from"./user-DmyB2um9.js";import{T as je}from"./truck-DdXkOFZU.js";import{C as Tt}from"./circle-check-big-Cl6yjp_H.js";import{S as Lt}from"./save-CUtLycmC.js";import{D as qt}from"./dollar-sign-BSq3S9ML.js";import"./supabase-BZV_3FV3.js";import"./skeleton-rZjoRa0B.js";import"./store-C5_qWEBR.js";import"./package-BMuViYet.js";import"./check-DvmpIwPb.js";import"./circle-x-DSaxyh5K.js";import"./euro-DClu9EOq.js";import"./format-BeKxgCCE.js";import"./index-DwYQFa9P.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=ct("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Bt=async r=>{const{data:s,error:n}=await _.from("payment_settings").select("mercado_pago_public_key").eq("restaurant_id",r).limit(1).single();if(n&&n.code!=="PGRST116")throw new Error(`Error fetching payment settings: ${n.message}`);return(s==null?void 0:s.mercado_pago_public_key)||null},vs=r=>le({queryKey:["mercadoPagoPublicKey",r],queryFn:()=>Bt(r),enabled:!!r,staleTime:1/0});var Te="Radio",[Gt,bs]=gs(Te),[Kt,Ut]=Gt(Te),_s=o.forwardRef((r,s)=>{const{__scopeRadio:n,name:c,checked:h=!1,required:x,disabled:w,value:i="on",onCheck:C,form:E,...j}=r,[l,k]=o.useState(null),S=Ve(s,G=>k(G)),I=o.useRef(!1),F=l?E||!!l.closest("form"):!0;return e.jsxs(Kt,{scope:n,checked:h,disabled:w,children:[e.jsx(Ne.button,{type:"button",role:"radio","aria-checked":h,"data-state":Rs(h),"data-disabled":w?"":void 0,disabled:w,value:i,...j,ref:S,onClick:Me(r.onClick,G=>{h||C==null||C(),F&&(I.current=G.isPropagationStopped(),I.current||G.stopPropagation())})}),F&&e.jsx(Es,{control:l,bubbles:!I.current,name:c,value:i,checked:h,required:x,disabled:w,form:E,style:{transform:"translateX(-100%)"}})]})});_s.displayName=Te;var Ns="RadioIndicator",Cs=o.forwardRef((r,s)=>{const{__scopeRadio:n,forceMount:c,...h}=r,x=Ut(Ns,n);return e.jsx(lt,{present:c||x.checked,children:e.jsx(Ne.span,{"data-state":Rs(x.checked),"data-disabled":x.disabled?"":void 0,...h,ref:s})})});Cs.displayName=Ns;var Qt="RadioBubbleInput",Es=o.forwardRef(({__scopeRadio:r,control:s,checked:n,bubbles:c=!0,...h},x)=>{const w=o.useRef(null),i=Ve(w,x),C=jt(n),E=dt(s);return o.useEffect(()=>{const j=w.current;if(!j)return;const l=window.HTMLInputElement.prototype,S=Object.getOwnPropertyDescriptor(l,"checked").set;if(C!==n&&S){const I=new Event("click",{bubbles:c});S.call(j,n),j.dispatchEvent(I)}},[C,n,c]),e.jsx(Ne.input,{type:"radio","aria-hidden":!0,defaultChecked:n,...h,tabIndex:-1,ref:i,style:{...h.style,...E,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Es.displayName=Qt;function Rs(r){return r?"checked":"unchecked"}var Zt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Ce="RadioGroup",[Xt,dn]=gs(Ce,[ws,bs]),Ss=ws(),Ps=bs(),[Ht,Jt]=Xt(Ce),$s=o.forwardRef((r,s)=>{const{__scopeRadioGroup:n,name:c,defaultValue:h,value:x,required:w=!1,disabled:i=!1,orientation:C,dir:E,loop:j=!0,onValueChange:l,...k}=r,S=Ss(n),I=wt(E),[F,G]=mt({prop:x,defaultProp:h??null,onChange:l,caller:Ce});return e.jsx(Ht,{scope:n,name:c,required:w,disabled:i,value:F,onValueChange:G,children:e.jsx(gt,{asChild:!0,...S,orientation:C,dir:I,loop:j,children:e.jsx(Ne.div,{role:"radiogroup","aria-required":w,"aria-orientation":C,"data-disabled":i?"":void 0,dir:I,...k,ref:s})})})});$s.displayName=Ce;var As="RadioGroupItem",Is=o.forwardRef((r,s)=>{const{__scopeRadioGroup:n,disabled:c,...h}=r,x=Jt(As,n),w=x.disabled||c,i=Ss(n),C=Ps(n),E=o.useRef(null),j=Ve(s,E),l=x.value===h.value,k=o.useRef(!1);return o.useEffect(()=>{const S=F=>{Zt.includes(F.key)&&(k.current=!0)},I=()=>k.current=!1;return document.addEventListener("keydown",S),document.addEventListener("keyup",I),()=>{document.removeEventListener("keydown",S),document.removeEventListener("keyup",I)}},[]),e.jsx(yt,{asChild:!0,...i,focusable:!w,active:l,children:e.jsx(_s,{disabled:w,required:x.required,checked:l,...C,...h,name:x.name,ref:j,onCheck:()=>x.onValueChange(h.value),onKeyDown:Me(S=>{S.key==="Enter"&&S.preventDefault()}),onFocus:Me(h.onFocus,()=>{var S;k.current&&((S=E.current)==null||S.click())})})})});Is.displayName=As;var Wt="RadioGroupIndicator",ks=o.forwardRef((r,s)=>{const{__scopeRadioGroup:n,...c}=r,h=Ps(n);return e.jsx(Cs,{...h,...c,ref:s})});ks.displayName=Wt;var Fs=$s,Ms=Is,Yt=ks;const Oe=o.forwardRef(({className:r,...s},n)=>e.jsx(Fs,{className:ue("grid gap-2",r),...s,ref:n}));Oe.displayName=Fs.displayName;const _e=o.forwardRef(({className:r,...s},n)=>e.jsx(Ms,{ref:n,className:ue("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...s,children:e.jsx(Yt,{className:"flex items-center justify-center",children:e.jsx(zt,{className:"h-2.5 w-2.5 fill-current text-current"})})}));_e.displayName=Ms.displayName;var Le={};Object.defineProperty(Le,"__esModule",{value:!0});var Ds=Le.loadMercadoPago=void 0;const Os="https://sdk.mercadopago.com/js/v2",er=/^https:\/\/sdk\.mercadopago\.com\/js\/v2\/?(\?.*)?$/,fs="MercadoPago has already been initialized in your window, please remove the duplicate import",sr="MercadoPago.js not available",tr="Failed to load MercadoPago.js",rr=()=>{for(var r=document.querySelectorAll(`script[src^="${Os}"`),s=0;s<r.length;s++){var n=r[s];if(er.test(n.src))return n}return null},nr=()=>{const r=document.createElement("script");r.src=Os;const s=document.head||document.body;if(!s)throw new Error("Expected document.body or document.head not to be null. MercadoPago requires a <body> or a <head> element, please add on your project.");return s.appendChild(r),r};let ve=null;const ar=()=>(ve!==null||(ve=new Promise((r,s)=>{if(typeof window>"u"){r(null);return}if(window.MercadoPago){console.warn(fs),r(window.MercadoPago);return}try{let n=rr();n?console.warn(fs):n||(n=nr()),n.addEventListener("load",()=>{window.MercadoPago?r(window.MercadoPago):s(new Error(sr))}),n.addEventListener("error",()=>{s(new Error(tr))})}catch(n){s(n);return}})),ve);Ds=Le.loadMercadoPago=ar;var or=function(r,s,n,c){function h(x){return x instanceof n?x:new n(function(w){w(x)})}return new(n||(n=Promise))(function(x,w){function i(j){try{E(c.next(j))}catch(l){w(l)}}function C(j){try{E(c.throw(j))}catch(l){w(l)}}function E(j){j.done?x(j.value):h(j.value).then(i,C)}E((c=c.apply(r,s||[])).next())})};class U{static getInstance(){return or(this,void 0,void 0,function*(){if(this.publicKey)return this.loadedInstanceMercadoPago||(yield Ds(),this.loadedInstanceMercadoPago=!0),this.instanceMercadoPago||(this.instanceMercadoPago=new window.MercadoPago(this.publicKey,this.options)),this.instanceMercadoPago;console.error("Expected the PUBLIC_KEY to render the MercadoPago SDK React")})}}U.publicKey=null;U.options={};U.instanceMercadoPago=void 0;U.loadedInstanceMercadoPago=!1;function ir(r,s){return Object.keys(r).length===Object.keys(s).length&&Object.keys(r).every(c=>Object.prototype.hasOwnProperty.call(s,c)&&r[c]===s[c])}const cr=(r,s)=>{const n=Object.assign(Object.assign({},s),{frontEndStack:"react"}),c=!ir(U.options,n);(r!==U.publicKey||c)&&(U.publicKey=r,U.options=n,U.instanceMercadoPago=void 0)},lr=({preferenceId:r,initPoint:s,onClose:n})=>{const{data:c,isLoading:h}=vs();return o.useEffect(()=>{if(c)try{cr(c,{locale:"pt-BR"})}catch(x){console.error("Erro ao inicializar Mercado Pago:",x),b.error("Erro ao carregar o SDK do Mercado Pago."),n();return}s&&(console.log("Redirecionando para o Mercado Pago:",s),window.location.href=s)},[c,n,s]),h||!c?e.jsx(ls,{open:!0,onOpenChange:n,children:e.jsx(ds,{className:"sm:max-w-[425px]",children:e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsx(me,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{children:"Carregando configurações de pagamento..."})]})})}):e.jsx(ls,{open:!0,onOpenChange:n,children:e.jsxs(ds,{className:"sm:max-w-[425px]",children:[e.jsxs(Et,{children:[e.jsxs(Rt,{className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-5 w-5 text-primary"}),"Redirecionando para Pagamento"]}),e.jsx(St,{children:"Você está sendo redirecionado para o checkout seguro do Mercado Pago."})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(me,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aguarde..."})]}),e.jsx(Z,{variant:"outline",onClick:n,children:"Cancelar e Voltar"})]})})},dr=({latitude:r,longitude:s,address:n,className:c})=>{const h=o.useMemo(()=>[r,s],[r,s]),x=o.useMemo(()=>[r,s],[r,s]);return e.jsxs(X,{className:ue("w-full",c),children:[e.jsxs(H,{children:[e.jsxs(J,{className:"text-lg flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5 text-primary"}),"Sua Localização"]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:n})]}),e.jsx(W,{className:"p-0",children:e.jsx("div",{className:"h-64 w-full rounded-b-lg overflow-hidden",children:e.jsx(pt,{center:x,markerPosition:h,onMarkerDragEnd:()=>{},zoom:16})})})]})},mr=({isOpen:r,onConfirm:s})=>e.jsx($t,{open:r,children:e.jsxs(At,{children:[e.jsxs(It,{children:[e.jsxs(kt,{className:"flex items-center gap-2 text-primary",children:[e.jsx(be,{className:"h-6 w-6"}),"Atenção ao Pagamento Online!"]}),e.jsxs(Ft,{children:["Você escolheu o pagamento online (Pix ou Cartão).",e.jsx("br",{}),e.jsx("br",{}),"Ao prosseguir, você será redirecionado para o checkout do Mercado Pago.",e.jsx("br",{}),e.jsx("br",{}),'**IMPORTANTE:** Se você escolher **PIX**, após o pagamento, você pode precisar clicar no botão **"Voltar ao site"** na tela do Mercado Pago para que seu pedido seja finalizado e rastreado corretamente.']})]}),e.jsx(Mt,{children:e.jsx(Dt,{onClick:s,className:"w-full",children:"Entendi e Continuar"})})]})}),ur=({onAddressSelect:r,defaultValue:s,disabled:n})=>{const c=o.useRef(null),h=o.useRef(null);return o.useEffect(()=>{!c.current||!window.google||!window.google.maps||!window.google.maps.places||(h.current=new window.google.maps.places.Autocomplete(c.current,{componentRestrictions:{country:"br"},fields:["address_components","geometry","formatted_address"],types:["address"]}),h.current.addListener("place_changed",()=>{var i,C,E;const x=(i=h.current)==null?void 0:i.getPlace();if(!x||!x.address_components||!x.geometry)return;const w={street:"",number:"",neighborhood:"",city:"",state:"",zip_code:"",latitude:((C=x.geometry.location)==null?void 0:C.lat())||0,longitude:((E=x.geometry.location)==null?void 0:E.lng())||0};x.address_components.forEach(j=>{const l=j.types;l.includes("route")&&(w.street=j.long_name),l.includes("street_number")&&(w.number=j.long_name),(l.includes("sublocality_level_1")||l.includes("sublocality"))&&(w.neighborhood=j.long_name),(l.includes("administrative_area_level_2")||l.includes("locality"))&&(w.city=j.long_name),l.includes("administrative_area_level_1")&&(w.state=j.short_name),l.includes("postal_code")&&(w.zip_code=j.long_name.replace(/\D/g,""))}),r(w)}))},[r]),e.jsxs("div",{className:"relative",children:[e.jsx(_t,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(de,{ref:c,placeholder:"Busque seu endereço (Rua, Número...)",defaultValue:s,className:"pl-10 h-12",disabled:n})]})},hs=r=>{if(!r)return"";let s=r.replace(/\D/g,"");return s.length>11&&(s=s.slice(0,11)),s.length>0&&(s=`(${s}`),s.length>3&&(s=`${s.slice(0,3)}) ${s.slice(3)}`),s.length>10&&(s=`${s.slice(0,10)}-${s.slice(10)}`),s},xs=r=>{if(!r)return"";let s=r.replace(/\D/g,"");return s.length>14&&(s=s.slice(0,14)),s.length<=11?(s.length>9&&(s=`${s.slice(0,9)}-${s.slice(9)}`),s.length>6&&(s=`${s.slice(0,6)}.${s.slice(6)}`),s.length>3&&(s=`${s.slice(0,3)}.${s.slice(3)}`)):(s.length>12&&(s=`${s.slice(0,12)}-${s.slice(12)}`),s.length>8&&(s=`${s.slice(0,8)}/${s.slice(8)}`),s.length>5&&(s=`${s.slice(0,5)}.${s.slice(5)}`),s.length>2&&(s=`${s.slice(0,2)}.${s.slice(2)}`)),s},pr=ys({zip_code:D().min(1,"CEP é obrigatório."),street:D().min(1,"Rua é obrigatória."),number:D().min(1,"Número é obrigatório."),complement:D().optional(),neighborhood:D().min(1,"Bairro é obrigatório."),city:D().min(1,"Cidade é obrigatória.")}),fr=ys({name:D().min(1,"Nome é obrigatório."),phone:D().min(1,"Telefone é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length>=10,{message:"O telefone deve ter pelo menos 10 dígitos."}),cpf_cnpj:D().min(1,"CPF/CNPJ é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length===11||r.length===14,{message:"CPF deve ter 11 dígitos ou CNPJ 14 dígitos."}),delivery_option:ht(["delivery","pickup"],{required_error:"Selecione uma opção de entrega."}),notes:D().optional(),payment_method_id:D().min(1,"Selecione um método de pagamento."),change_for:D().optional()}),hr=async r=>{const{data:s,error:n}=await _.from("restaurants").select("id, name, address, phone, email, street, number, neighborhood, city, zip_code, latitude, longitude, delivery_enabled").eq("id",r).eq("is_active",!0).limit(1).single();if(n)throw new Error(`Erro ao buscar restaurante: ${n.message}`);if(!s)throw new Error("Restaurante não encontrado ou inativo.");return s},xr=async r=>{const{data:s,error:n}=await _.from("delivery_zones").select("*").eq("restaurant_id",r).eq("is_active",!0).order("max_distance_km",{ascending:!0});if(n)throw new Error(`Erro ao buscar zonas de entrega: ${n.message}`);return s},gr=async r=>{const{data:s,error:n}=await _.from("payment_methods").select("*").eq("restaurant_id",r).eq("is_active",!0).order("name",{ascending:!0});if(n)throw new Error(`Erro ao buscar métodos de pagamento: ${n.message}`);return s},yr=async r=>{const{data:s,error:n}=await _.from("customers").select("*").eq("user_id",r).limit(1).single();if(n&&n.code!=="PGRST116")throw new Error(n.message);return s||null},mn=()=>{var We,Ye,es,ss,ts;const r=at(),s=ot(),[n]=it(),c=nt(),{items:h,totalAmount:x,clearCart:w}=ut(),{data:i,isLoading:C}=ft(),[E]=o.useState((We=s.state)==null?void 0:We.restaurantId),j=n.get("restaurantId"),l=E||j,{data:k}=vs(l),[S,I]=o.useState(!1),[F,G]=o.useState(!1),[pe,oe]=o.useState(0),[se,fe]=o.useState(null),[Ee,te]=o.useState(!0),[q,qe]=o.useState(null),[Vs,Re]=o.useState(!1),[Ts,Ls]=o.useState(null),[ze,qs]=o.useState(null),[z,Se]=o.useState(!1),[zs,Be]=o.useState(!1),[Ge,Pe]=o.useState(null),[$e,Bs]=o.useState(null),{data:g,isLoading:Gs,isError:Ks,error:Ke,refetch:Us}=le({queryKey:["checkoutRestaurantData",l],queryFn:()=>hr(l),enabled:!!l,staleTime:1/0}),{data:O,isLoading:Qs}=le({queryKey:["checkoutDeliveryZones",l],queryFn:()=>xr(g.id),enabled:!!g,staleTime:1/0}),{data:K,isLoading:Zs}=le({queryKey:["checkoutPaymentMethods",l],queryFn:()=>gr(g.id),enabled:!!g,staleTime:1/0}),{data:A,isLoading:Ue,refetch:wr}=le({queryKey:["checkoutCustomerData",i==null?void 0:i.id],queryFn:()=>yr(i.id),enabled:!!i,staleTime:0}),Q=o.useMemo(()=>g!=null&&g.latitude&&(g!=null&&g.longitude)?[g.latitude,g.longitude]:null,[g]),Xs=o.useCallback(async(t,a,m,p,f,u,R)=>{const M=[30,45];if(g&&g.delivery_enabled===!1){const $=`${a}, ${m}, ${f}, ${p}, ${t}`;let v=null;if(u&&R?v={lat:u,lng:R}:v=await as($),!v)return{coords:null,fee:0,time:null,isValid:!1};if(O&&O.length>0&&Q){const P=Fe([v.lat,v.lng],Q,O);if(P)return{coords:v,fee:0,time:[P.minTime,P.maxTime],isValid:!0}}return{coords:v,fee:0,time:M,isValid:!0}}if(!g||!Q)return{coords:null,fee:0,time:M,isValid:!0};const T=`${a}, ${m}, ${f}, ${p}, ${t}`;let N=null;if(u&&R?N={lat:u,lng:R}:N=await as(T),!N)return{coords:null,fee:0,time:null,isValid:!1};if(O&&O.length>0){const $=Fe([N.lat,N.lng],Q,O);return $?{coords:N,fee:$.fee,time:[$.minTime,$.maxTime],isValid:!0}:{coords:N,fee:0,time:null,isValid:!1}}else return{coords:null,fee:0,time:M,isValid:!0}},[g,Q,O]),d=os({resolver:is(fr),defaultValues:{name:"",phone:"",cpf_cnpj:"",delivery_option:"delivery",notes:"",payment_method_id:"",change_for:""},mode:"onBlur"}),y=os({resolver:is(pr),defaultValues:{zip_code:"",street:"",number:"",complement:"",neighborhood:"",city:""},mode:"onBlur"}),V=d.watch("delivery_option"),Hs=d.watch("payment_method_id"),re=K==null?void 0:K.find(t=>t.id===Hs),Ae=(Ye=re==null?void 0:re.name)==null?void 0:Ye.includes("online"),ie=(es=re==null?void 0:re.name)==null?void 0:es.includes("Dinheiro"),B=x+pe,he=y.watch(["zip_code","street","number","city","neighborhood","complement"]),Qe=o.useMemo(()=>{const[t,a,m,p,f,u]=he;return`${a}|${m}|${u||""}|${f}|${p}|${t}`},[he]);o.useEffect(()=>{if(!l)return;const t=_.channel("delivery-zones-changes").on("postgres_changes",{event:"*",schema:"public",table:"delivery_zones",filter:`restaurant_id=eq.${l}`},()=>{console.log("[Realtime] Zonas de entrega atualizadas. Invalidando query..."),c.invalidateQueries({queryKey:["checkoutDeliveryZones",l]}),b.info("As taxas de entrega foram atualizadas.",{duration:3e3})}).subscribe(),a=_.channel("restaurant-settings-changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"restaurants",filter:`id=eq.${l}`},()=>{console.log("[Realtime] Configurações do restaurante atualizadas. Invalidando query..."),c.invalidateQueries({queryKey:["checkoutRestaurantData",l]}),b.info("As configurações da loja foram atualizadas.",{duration:3e3})}).subscribe();return()=>{_.removeChannel(t),_.removeChannel(a)}},[l,c]),o.useEffect(()=>{if(z&&q&&Q&&O&&g)if(console.log("[Checkout] Recalculando taxa devido a mudanças nos dados...",{deliveryZones:O}),g.delivery_enabled===!1)oe(0),te(!0),se||fe([30,45]);else{const t=Fe(q,Q,O);t?(console.log("[Checkout] Nova taxa calculada:",t.fee),oe(t.fee),fe([t.minTime,t.maxTime]),te(!0)):(console.warn("[Checkout] Endereço agora fora da área de entrega."),te(!1),oe(0),b.warning("As zonas de entrega mudaram e seu endereço agora está fora da área de cobertura."))}},[O,g==null?void 0:g.delivery_enabled,q,Q,z]),o.useEffect(()=>{if(A)d.reset({...d.getValues(),name:A.name||"",phone:hs(A.phone||""),cpf_cnpj:xs(A.cpf_cnpj||""),change_for:""});else if(i&&!Ue){const t=i.user_metadata;d.reset({...d.getValues(),name:t.full_name||"",phone:hs(t.phone||""),cpf_cnpj:xs(t.cpf_cnpj||""),change_for:""})}},[A,i,Ue]),o.useEffect(()=>{V==="delivery"&&$e!==null&&Qe!==$e&&(Se(!1),oe(0),fe(null),te(!0),qe(null))},[Qe,$e,V]);const xe=d.watch("change_for");o.useEffect(()=>{if(ie&&xe&&xe.trim()!==""){const t=xe.replace(",","."),a=parseFloat(t);isNaN(a)?d.setError("change_for",{message:"O troco deve ser um número válido."}):a<B?d.setError("change_for",{message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(B)}).`}):d.clearErrors("change_for")}else d.clearErrors("change_for")},[ie,xe,B,d]);const ge=Ie({mutationFn:async t=>{var rs;G(!0);const a=`${t.street}, ${t.number}${t.complement?` - ${t.complement}`:""}, ${t.neighborhood}, ${t.city}, ${t.zip_code}`,m=await Xs(t.zip_code,t.street,t.number,t.city,t.neighborhood);if(G(!1),!m.isValid)throw new Error((g==null?void 0:g.delivery_enabled)===!1?"O endereço está errado ou incompleto, revise todos os campos.":"Endereço fora da área de entrega.");if(!m.coords)throw new Error("Não foi possível obter as coordenadas para salvar o endereço.");const f=(rs=(await _.auth.getUser()).data.user)==null?void 0:rs.id,u=d.getValues("name"),R=d.getValues("phone"),M=d.getValues("cpf_cnpj"),T=R.replace(/\D/g,""),N=M.replace(/\D/g,"");if(!u||T.length<10||!N||N.length!==11&&N.length!==14)throw new Error("Preencha Nome, Telefone (10+ dígitos) e CPF/CNPJ (11 ou 14 dígitos) nos Seus Dados antes de salvar o endereço.");if(!(A!=null&&A.id)&&!f)return{customer:{id:"anonymous",user_id:null,name:u,phone:T,email:null,address:a,created_at:"",updated_at:"",latitude:m.coords.lat,longitude:m.coords.lng,cpf_cnpj:N,street:t.street,number:t.number,neighborhood:t.neighborhood,city:t.city,zip_code:t.zip_code,complement:t.complement||null},feeResult:m};const $={name:u,phone:T,cpf_cnpj:N||null},v={user_id:(i==null?void 0:i.id)||null,...$,email:(i==null?void 0:i.email)||null,address:a,latitude:m.coords.lat,longitude:m.coords.lng,street:t.street,number:t.number,neighborhood:t.neighborhood,city:t.city,zip_code:t.zip_code,complement:t.complement||null},P="*, street, number, neighborhood, city, zip_code, complement";let Y;if(A!=null&&A.id){const{data:ye,error:ce}=await _.from("customers").update(v).eq("id",A.id).select(P).single();if(ce)throw ce;Y=ye}else if(f){const{data:ye,error:ce}=await _.from("customers").insert(v).select(P).single();if(ce)throw ce;Y=ye}else throw new Error("Não foi possível identificar o cliente para salvar.");return{customer:Y,feeResult:m}},onSuccess:(t,a)=>{const{customer:m,feeResult:p}=t;(m==null?void 0:m.id)!=="anonymous"&&c.invalidateQueries({queryKey:["checkoutCustomerData"]}),oe(p.fee),fe(p.time),te(p.isValid),Se(!0),qe([p.coords.lat,p.coords.lng]);const f=`${a.street}|${a.number}|${a.complement||""}|${a.neighborhood}|${a.city}|${a.zip_code}`;Bs(f),b.success("Endereço salvo e taxa de entrega calculada!")},onError:t=>{b.error(`Erro ao salvar endereço: ${t.message}`),te(!1),Se(!1)}}),Js=t=>{d.trigger(["name","phone","cpf_cnpj"]).then(a=>{a?ge.mutate(t):b.error("Preencha Nome, Telefone e CPF/CNPJ nos Seus Dados antes de salvar o endereço.")})},Ze=Ie({mutationFn:async t=>{var T,N;(T=(await _.auth.getUser()).data.user)==null||T.id;const m=t.phone.replace(/\D/g,""),p=((N=t.cpf_cnpj)==null?void 0:N.replace(/\D/g,""))||null;if(!t.name||m.length<10||p&&p.length!==11&&p.length!==14)throw new Error("Dados de contato incompletos ou inválidos.");const f=y.getValues(),u=V==="delivery"?`${f.street}, ${f.number}${f.complement?` - ${f.complement}`:""}, ${f.neighborhood}, ${f.city}, ${f.zip_code}`:null,R={user_id:(i==null?void 0:i.id)||null,name:t.name,phone:m,email:(i==null?void 0:i.email)||null,cpf_cnpj:p,address:u,latitude:q?q[0]:null,longitude:q?q[1]:null,street:y.getValues("street")||null,number:y.getValues("number")||null,neighborhood:y.getValues("neighborhood")||null,city:y.getValues("city")||null,zip_code:y.getValues("zip_code")||null,complement:y.getValues("complement")||null};i||(R.email=null);const M="*, street, number, neighborhood, city, zip_code, complement";if(i)if(A){const{data:$,error:v}=await _.from("customers").update(R).eq("id",A.id).select(M).single();if(v)throw v;return $}else{const{data:$,error:v}=await _.from("customers").insert(R).select(M).single();if(v)throw v;return $}else{const{data:$,error:v}=await _.from("customers").insert(R).select(M).single();if(v)throw v;return $}},onSuccess:()=>{c.invalidateQueries({queryKey:["checkoutCustomerData"]})},onError:t=>{b.error(`Erro ao salvar dados do cliente: ${t.message}`)}}),Xe=Ie({mutationFn:async({customerId:t,data:a})=>{if(!g)throw new Error("Dados do restaurante não disponíveis.");let m=null;if(ie&&a.change_for&&a.change_for.trim()!==""){const P=a.change_for.replace(",","."),Y=parseFloat(P);!isNaN(Y)&&Y>B&&(m=Y)}let[p,f]=se||[null,null];if((V==="delivery"||V==="pickup")&&(!p||!f)){const P=V==="pickup"?[15,30]:[30,45];p=P[0],f=P[1]}const u=y.getValues(),R=V==="delivery"?`${u.street}, ${u.number}${u.complement?` - ${u.complement}`:""}, ${u.neighborhood}, ${u.city}, ${u.zip_code}`:null,M={restaurant_id:g.id,customer_id:t,status:Ae?"pending_payment":"pending",total_amount:B,delivery_fee:pe,delivery_address:R,notes:a.notes,payment_method_id:a.payment_method_id,change_for:m,min_delivery_time_minutes:p,max_delivery_time_minutes:f},{data:T,error:N}=await _.from("orders").insert(M).select("id").single();if(N)throw N;const $=h.map(P=>({order_id:T.id,product_id:P.product.id,quantity:parseFloat(P.quantity.toFixed(3)),unit_price:parseFloat(P.product.price.toFixed(2)),subtotal:parseFloat(P.subtotal.toFixed(2)),notes:P.notes})),{error:v}=await _.from("order_items").insert($);if(v)throw v;return T.id},onSuccess:t=>{c.invalidateQueries({queryKey:["orders"]})},onError:t=>{b.error(`Erro ao criar pedido: ${t.message}`)}}),Ws=async t=>{if(ie&&t.change_for&&t.change_for.trim()!==""){const p=t.change_for.replace(",","."),f=parseFloat(p);if(isNaN(f)){b.error("O troco deve ser um número válido.");return}if(f<B){d.setError("change_for",{type:"manual",message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(B)}).`});return}}if(h.length===0){b.error("Seu carrinho está vazio."),r(`/menu/${l}`);return}if(V==="delivery"){if(!z){b.error("Você deve salvar e validar o endereço de entrega antes de finalizar o pedido.");return}if(!Ee){b.error("O endereço de entrega está fora da área de cobertura.");return}}let a;try{a=(await Ze.mutateAsync(t)).id}catch(p){b.error(`Falha ao salvar cliente: ${p.message}`);return}let m;try{m=await Xe.mutateAsync({customerId:a,data:t})}catch(p){b.error(`Falha ao criar pedido: ${p.message}`);return}Ae?await Ys(m,t):(w(),r(`/order-success/${m}`,{replace:!0}))},Ys=async(t,a)=>{if(!g)return;const m=window.location.origin+window.location.pathname,p=h.map(u=>({name:u.product.name,price:u.product.price,quantity:u.quantity})),f=b.loading("Preparando pagamento online...");try{const{data:u,error:R}=await _.functions.invoke("create-payment-preference",{body:{orderId:t,items:p,totalAmount:B,restaurantName:g.name,clientUrl:m,customerEmail:(i==null?void 0:i.email)||"cliente@anonimo.com",customerCpfCnpj:a.cpf_cnpj}});if(R)throw R;const{init_point:M}=u;Ls(t),qs(M),Re(!0),b.dismiss(f)}catch(u){b.dismiss(f),b.error(`Erro no pagamento online: ${u.message}`),Re(!1)}},et=async()=>{await _.auth.signOut(),b.success("Você saiu da sua conta."),r("/auth",{replace:!0})},st=(t,a,m)=>{a&&m?(Pe(t),Be(!0)):(d.setValue("payment_method_id",t,{shouldValidate:!0}),Pe(null))},tt=()=>{Ge&&d.setValue("payment_method_id",Ge,{shouldValidate:!0}),Be(!1),Pe(null)},rt=o.useCallback(t=>{y.setValue("street",t.street),y.setValue("neighborhood",t.neighborhood),y.setValue("city",t.city),y.setValue("zip_code",t.zip_code),y.setValue("number",t.number),y.setValue("complement",""),b.info("Endereço encontrado! Verifique o número e clique em Salvar.")},[y]),He=o.useMemo(()=>{const[t,a,m,p,f,u]=he;return a&&m&&f&&p&&t?`${a}, ${m}${u?` - ${u}`:""} - ${f}, ${p}, ${t}`:""},[he]);if(!l)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(ee,{variant:"destructive",className:"max-w-lg",children:[e.jsx(us,{className:"h-4 w-4"}),e.jsx(ne,{children:"Erro de Rastreamento"}),e.jsx(ae,{children:"Não foi possível identificar o restaurante para o qual o pedido está sendo feito. Por favor, volte ao menu."}),e.jsx(ke,{to:"/",children:e.jsx(Z,{className:"mt-3",variant:"secondary",size:"sm",children:"Voltar"})})]})});if(h.length===0)return o.useEffect(()=>{r(`/menu/${l}`)},[r,l]),e.jsx(ns,{});if(Gs||Qs||Zs||C)return e.jsx(ns,{});if(Ks||!g)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(ee,{variant:"destructive",className:"max-w-lg",children:[e.jsx(us,{className:"h-4 w-4"}),e.jsx(ne,{children:"Erro Crítico"}),e.jsx(ae,{children:Ke instanceof Error?Ke.message:"Não foi possível carregar os dados do restaurante."}),e.jsxs(Z,{onClick:()=>Us(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(Ot,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]})});const Je=Ze.isPending||Xe.isPending||ge.isPending||F||V==="delivery"&&!z;return e.jsx("div",{className:"min-h-screen bg-background w-full overflow-x-hidden",children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-6 py-4 sm:py-8 max-w-5xl space-y-6 sm:space-y-8",children:[e.jsx(Nt,{isOpen:S,onClose:()=>I(!1),customer:A}),e.jsx(mr,{isOpen:zs,onConfirm:tt}),Vs&&ze&&e.jsx(lr,{preferenceId:Ts,initPoint:ze,onClose:()=>Re(!1)}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto",children:[e.jsx(ke,{to:`/menu/${l}`,children:e.jsx(Z,{variant:"ghost",size:"icon","aria-label":"Voltar ao Menu",children:e.jsx(Vt,{className:"h-6 w-6"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg sm:text-3xl font-bold text-foreground",children:"Finalizar Pedido"}),e.jsx("p",{className:"text-xs sm:text-lg text-muted-foreground font-medium truncate max-w-full",children:g.name})]})]}),i&&e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto justify-end",children:[e.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>I(!0),"aria-label":"Meu Perfil e Pedidos",className:"flex-1 sm:flex-none text-xs sm:text-sm h-8 sm:h-9",children:[e.jsx(ps,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"})," ",e.jsx("span",{className:"truncate",children:"Perfil / Pedidos"})]}),e.jsxs(Z,{variant:"outline",size:"sm",onClick:et,className:"flex-shrink-0 text-xs sm:text-sm h-8 sm:h-9",children:[e.jsx(Ct,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"})," Sair"]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 sm:gap-8 w-full",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6 min-w-0",children:[e.jsxs(X,{className:"w-full overflow-hidden",children:[e.jsx(H,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(J,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(ps,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Seus Dados"]})}),e.jsxs(W,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx("div",{className:"flex justify-between items-center mb-3 sm:mb-4",children:e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:i?`Logado como ${i.email}`:"Pedido anônimo"})}),e.jsx(ms,{...d,children:e.jsx("form",{onSubmit:d.handleSubmit(Ws),id:"checkout-form",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"name",className:"text-xs sm:text-sm",children:"Nome Completo *"}),e.jsx(de,{id:"name",...d.register("name"),className:"h-9 sm:h-12 text-sm w-full"}),d.formState.errors.name&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:d.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"phone",className:"text-xs sm:text-sm",children:"Telefone *"}),e.jsx(we,{name:"phone",control:d.control,render:({field:t})=>e.jsx(vt,{id:"phone",...t,className:"h-9 sm:h-12 text-sm w-full"})}),d.formState.errors.phone&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:d.formState.errors.phone.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"cpf_cnpj",className:"text-xs sm:text-sm",children:"CPF/CNPJ *"}),e.jsx(we,{name:"cpf_cnpj",control:d.control,render:({field:t})=>e.jsx(Pt,{id:"cpf_cnpj",...t,className:"h-9 sm:h-12 text-sm w-full"})}),d.formState.errors.cpf_cnpj&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:d.formState.errors.cpf_cnpj.message})]})]})})})]})]}),e.jsxs(X,{className:"w-full overflow-hidden",children:[e.jsx(H,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(J,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Opção de Entrega"]})}),e.jsx(W,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsx(we,{name:"delivery_option",control:d.control,render:({field:t})=>e.jsxs(Oe,{onValueChange:t.onChange,value:t.value,className:"grid grid-cols-2 gap-2 sm:gap-4 min-w-0 w-full",children:[e.jsxs(L,{htmlFor:"delivery",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-2 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer text-center w-full max-w-full",children:[e.jsx(_e,{value:"delivery",id:"delivery",className:"sr-only"}),e.jsx(je,{className:"mb-1.5 sm:mb-3 h-4 w-4 sm:h-6 sm:w-6 flex-shrink-0"}),e.jsx("span",{translate:"no",className:"text-xs sm:text-base break-words w-full",children:"Entrega"})]}),e.jsxs(L,{htmlFor:"pickup",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-2 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer text-center w-full max-w-full",children:[e.jsx(_e,{value:"pickup",id:"pickup",className:"sr-only"}),e.jsx(De,{className:"mb-1.5 sm:mb-3 h-4 w-4 sm:h-6 sm:w-6 flex-shrink-0"}),e.jsx("span",{translate:"no",className:"text-xs sm:text-base break-words w-full",children:"Retirada no Local"})]})]})})})]}),V==="delivery"&&e.jsxs(X,{className:ue("w-full overflow-hidden",!z&&"border-destructive ring-2 ring-destructive/50"),children:[e.jsxs(H,{className:"px-3 sm:px-6 py-3 sm:py-6",children:[e.jsxs(J,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Endereço de Entrega",z&&e.jsx(Tt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-green-500 ml-2 flex-shrink-0"}),!z&&e.jsx(be,{className:"h-4 w-4 sm:h-5 sm:w-5 text-destructive ml-2 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Preencha e salve para calcular a taxa."})]}),e.jsxs(W,{className:"space-y-3 sm:space-y-4 px-3 pb-3 sm:p-6 sm:pt-0",children:[g.delivery_enabled===!1&&e.jsxs(ee,{variant:"default",className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 text-blue-700 p-2 sm:p-4",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx(ne,{className:"text-sm font-semibold",children:"Frete Grátis Ativo"}),e.jsx(ae,{className:"text-xs sm:text-sm",children:"Taxas dinâmicas desativadas. Frete R$ 0,00."})]}),e.jsx(ms,{...y,children:e.jsxs("form",{onSubmit:y.handleSubmit(Js),id:"address-form-inner",className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"address-search",className:"text-xs sm:text-sm",children:"Buscar Endereço"}),e.jsx(ur,{onAddressSelect:rt,disabled:F})]}),e.jsx("input",{type:"hidden",...y.register("zip_code")}),e.jsx("input",{type:"hidden",...y.register("street")}),e.jsx("input",{type:"hidden",...y.register("neighborhood")}),e.jsx("input",{type:"hidden",...y.register("city")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"number",className:"text-xs sm:text-sm",children:"Número *"}),e.jsx(de,{id:"number",...y.register("number"),placeholder:"Nº",className:"h-9 sm:h-12 text-sm"}),y.formState.errors.number&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:y.formState.errors.number.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"complement",className:"text-xs sm:text-sm",children:"Complemento"}),e.jsx(de,{id:"complement",...y.register("complement"),placeholder:"Apto, Bloco...",className:"h-9 sm:h-12 text-sm"})]})]}),y.watch("street")&&e.jsxs("div",{className:"bg-muted p-2 sm:p-3 rounded text-xs sm:text-sm break-words overflow-hidden",children:[e.jsx("p",{children:e.jsx("strong",{children:"Endereço:"})}),e.jsxs("p",{children:[y.watch("street"),y.watch("number")?`, ${y.watch("number")}`:"",y.watch("complement")?` - ${y.watch("complement")}`:""]}),e.jsxs("p",{children:[y.watch("neighborhood")," - ",y.watch("city")]})]}),e.jsxs(Z,{type:"submit",className:"w-full h-auto py-2 text-xs sm:text-base mt-2 whitespace-normal",disabled:ge.isPending||F,children:[ge.isPending||F?e.jsx(me,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin mr-2"}):e.jsx(Lt,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2"}),"Salvar e Calcular"]})]})}),F&&e.jsxs(ee,{className:"flex items-center gap-2 p-2 sm:p-4",children:[e.jsx(me,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin"}),e.jsx(ne,{className:"text-xs sm:text-sm",children:"Calculando..."})]}),z&&!F&&e.jsxs(e.Fragment,{children:[g.delivery_enabled!==!1&&!Ee&&e.jsxs(ee,{variant:"destructive",className:"p-2 sm:p-4",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx(ne,{className:"text-sm",children:"Fora da Área"}),e.jsx(ae,{className:"text-xs",children:"Endereço fora da área de cobertura."})]}),(g.delivery_enabled===!1||Ee&&se)&&e.jsxs(ee,{variant:"default",className:"bg-green-50 dark:bg-green-900/20 border-green-200 text-green-700 p-2 sm:p-4",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx(ne,{className:"text-sm",children:"Entrega Disponível"}),e.jsxs(ae,{className:"text-xs",children:["Taxa: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(pe),". Tempo: ",se?`${se[0]}-${se[1]}`:"30-45"," min."]})]})]}),z&&q&&He&&e.jsx("div",{className:"mt-4 w-full overflow-hidden rounded-md border",children:e.jsx(dr,{latitude:q[0],longitude:q[1],address:He,className:"w-full"})})]})]}),e.jsxs(X,{className:"w-full overflow-hidden",children:[e.jsx(H,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(J,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(js,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Pagamento *"]})}),e.jsxs(W,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx(we,{name:"payment_method_id",control:d.control,render:({field:t})=>e.jsx(Oe,{onValueChange:a=>{var u;const m=K==null?void 0:K.find(R=>R.id===a),p=(u=m==null?void 0:m.name)==null?void 0:u.includes("online"),f=!!k&&k.trim()!=="";st(a,!!p,f)},value:t.value,className:"space-y-2 sm:space-y-3 w-full",children:K==null?void 0:K.map(a=>{var u;const m=(u=a.name)==null?void 0:u.includes("online"),p=!!k&&k.trim()!=="",f=m&&!p;return e.jsx(L,{htmlFor:a.id,className:ue("flex items-center justify-between rounded-md border-2 border-muted bg-popover p-2.5 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer w-full max-w-full",f&&"opacity-50 cursor-not-allowed"),children:e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 overflow-hidden min-w-0 w-full",children:[e.jsx(_e,{value:a.id,id:a.id,disabled:f,className:"flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-xs sm:text-base break-words w-full leading-tight whitespace-normal",translate:"no",children:a.name}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground truncate",children:a.description}),f&&e.jsx("p",{className:"text-[10px] text-destructive mt-0.5",children:"Indisponível no momento."})]})]})},a.id)})})}),d.formState.errors.payment_method_id&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm mt-2",children:d.formState.errors.payment_method_id.message})]})]}),ie&&e.jsxs(X,{className:"w-full overflow-hidden",children:[e.jsx(H,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(J,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(qt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Troco"]})}),e.jsx(W,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"change_for",className:"text-xs sm:text-sm",children:"Precisa de troco para quanto?"}),e.jsx(de,{id:"change_for",type:"number",step:"0.01",placeholder:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(B),...d.register("change_for"),className:"h-9 sm:h-12 text-sm w-full"}),((ss=d.formState.errors.change_for)==null?void 0:ss.message)&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:d.formState.errors.change_for.message}),((ts=d.formState.errors.change_for)==null?void 0:ts.type)==="manual"&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:d.formState.errors.change_for.message})]})})]}),e.jsxs(X,{className:"w-full overflow-hidden",children:[e.jsx(H,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(J,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(bt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Observações"]})}),e.jsx(W,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(L,{htmlFor:"notes",className:"text-xs sm:text-sm",children:"Notas para o restaurante"}),e.jsx(xt,{id:"notes",...d.register("notes"),rows:3,placeholder:"Ex: Entregar na portaria, sem pimenta...",className:"text-sm w-full"})]})})]})]}),e.jsx("div",{className:"lg:col-span-1 space-y-6 sticky top-4 self-start min-w-0",children:e.jsxs(X,{className:"shadow-lg w-full overflow-hidden",children:[e.jsx(H,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsx(J,{className:"text-lg sm:text-2xl",children:"Resumo"})}),e.jsxs(W,{className:"space-y-3 sm:space-y-4 px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:h.map(t=>e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsxs("span",{className:"truncate max-w-[70%]",children:[t.quantity,"x ",t.product.name]}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.subtotal)})]},t.product.id))}),e.jsx(cs,{}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm text-muted-foreground",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x)})]}),e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm text-muted-foreground",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(pe)})]})]}),e.jsx(cs,{}),e.jsxs("div",{className:"flex justify-between font-bold text-base sm:text-xl",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(B)})]}),e.jsx(Z,{type:"submit",form:"checkout-form",className:"w-full h-10 sm:h-12 text-sm sm:text-lg",disabled:Je,children:Je?e.jsx(me,{className:"h-4 w-4 sm:h-5 sm:w-5 animate-spin mr-2"}):Ae?"Pagar e Finalizar":"Confirmar Pedido"}),V==="delivery"&&!z&&e.jsxs(ee,{variant:"destructive",className:"mt-3 p-2 sm:p-4",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx(ae,{className:"text-xs",children:"Salve o endereço acima para continuar."})]}),e.jsx(ke,{to:`/menu/${g.id}`,className:"block text-center text-xs sm:text-sm text-muted-foreground hover:underline mt-2",children:"Voltar ao Cardápio"})]})]})})]})]})})};export{mn as default};
