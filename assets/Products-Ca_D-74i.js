import{u as T,c as O,j as e,b as V}from"./tanstack-d4AvmB45.js";import{s as C}from"./client-D5i5GwB9.js";import{B as v}from"./button-B8dmpRtR.js";import{C as U,b as xe,a as Q,c as Le}from"./card-Dzq-r3Qm.js";import{S as pe,a as ge,b as fe,c as ve,d as ye,B as R,T as Ke,e as Ue,f as ue,g as je}from"./select-BMbHcLBq.js";import{S as F}from"./switch-BSY1PB9U.js";import{S as k}from"./skeleton-DXlzrkpb.js";import{A as be,a as _e,b as we}from"./alert-ixtnl3E5.js";import{c as W,u as N,L as I,a as Qe}from"./index-M_BmhEeJ.js";import{r as E,i as Re}from"./vendor-CnEXr6gt.js";import{o as H,s as P,c as G,b as $,u as J,t as X,p as Ne,l as Ce,i as Ee}from"./types-DKlirIXB.js";import{D as Y,a as Z,b as ee,c as se,d as re,e as ae,f as ie}from"./dialog-BTJrCoDq.js";import{F as ne,a as x,b as u,c as p,d as j,e as b}from"./form-CBwAJEV6.js";import{I as A}from"./label-l02Jq0qO.js";import{T as oe}from"./textarea-BDpjNuwh.js";import{P as le}from"./plus-DQ6zC2M2.js";import{S as Ie}from"./save-BzjWdWhl.js";import{A as Se,a as ke,b as qe,c as Pe,d as De,e as Me,f as Ae,g as Oe}from"./alert-dialog-BQqGm3Jj.js";import{T as B}from"./trash-2-CD6RQh9o.js";import{T as Fe}from"./terminal-CNLz0hxN.js";import"./supabase-BZV_3FV3.js";import"./index-BZ1KI_NL.js";import"./index-DrlxvCXN.js";import"./index-BdQq_4o_.js";import"./index-BkK3GbF_.js";import"./index-KNP7Yozt.js";import"./check-BYdjnTV7.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=W("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=W("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=W("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=W("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),We=H({name:P().min(1,"O nome é obrigatório."),description:P().optional(),display_order:G.number().default(0),is_active:$().default(!0)}),Te=({isOpen:a,onClose:o,restaurantId:s})=>{const g=T(),l=J({resolver:X(We),defaultValues:{name:"",description:"",display_order:0,is_active:!0}}),m=O({mutationFn:async t=>{if(!s)throw new Error("ID do restaurante não encontrado.");const{error:i}=await C.from("categories").insert({restaurant_id:s,name:t.name,description:t.description,display_order:t.display_order,is_active:t.is_active});if(i)throw new Error(i.message)},onSuccess:()=>{N.success("Categoria criada com sucesso!"),g.invalidateQueries({queryKey:["categoriesWithProducts",s]}),g.invalidateQueries({queryKey:["categories",s]}),o(),l.reset()},onError:t=>{N.error(`Erro ao criar categoria: ${t.message}`)}}),f=t=>{m.mutate(t)};return e.jsx(Y,{open:a,onOpenChange:o,children:e.jsxs(Z,{className:"sm:max-w-[425px]",children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Nova Categoria"}),e.jsx(re,{children:"Gerencie as categorias dos seus produtos"})]}),e.jsx(ne,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(f),className:"space-y-4 pt-4",children:[e.jsx(x,{control:l.control,name:"name",render:({field:t})=>e.jsxs(u,{children:[e.jsx(p,{children:"Nome *"}),e.jsx(j,{children:e.jsx(A,{placeholder:"",...t})}),e.jsx(b,{})]})}),e.jsx(x,{control:l.control,name:"description",render:({field:t})=>e.jsxs(u,{children:[e.jsx(p,{children:"Descrição"}),e.jsx(j,{children:e.jsx(oe,{placeholder:"",...t})}),e.jsx(b,{})]})}),e.jsx(x,{control:l.control,name:"display_order",render:({field:t})=>e.jsxs(u,{children:[e.jsx(p,{children:"Ordem de Exibição"}),e.jsx(j,{children:e.jsx(A,{type:"number",...t})}),e.jsx(b,{})]})}),e.jsx(x,{control:l.control,name:"is_active",render:({field:t})=>e.jsxs(u,{className:"flex flex-row items-center space-x-3 space-y-0 pt-2",children:[e.jsx(j,{children:e.jsx(F,{checked:t.value,onCheckedChange:t.onChange,id:"is_active"})}),e.jsx(p,{htmlFor:"is_active",className:"font-normal cursor-pointer",children:"Ativa"})]})}),e.jsxs(ae,{className:"pt-4",children:[e.jsx(ie,{asChild:!0,children:e.jsx(v,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(v,{type:"submit",disabled:m.isPending||!s,children:m.isPending?"Criando...":"Criar"})]})]})})]})})},He=H({name:P().min(1,"O nome é obrigatório."),description:P().optional(),price:Ne(a=>String(a).replace(",","."),G.number({invalid_type_error:"O preço deve ser um número."}).positive("O preço deve ser maior que zero.")),category_id:P().min(1,"A categoria é obrigatória."),image_url:P().url("URL inválida.").optional().or(Ce("")),image_file:Ee(File).optional(),is_price_by_weight:$().default(!1),is_available:$().default(!0)}).refine(a=>a.image_url||a.image_file,{message:"É necessário enviar uma imagem ou uma URL.",path:["image_file"]}),Ge=async a=>{const{data:o,error:s}=await C.from("categories").select("id, name").eq("restaurant_id",a).eq("is_active",!0);if(s)throw new Error(s.message);return o},Je=({isOpen:a,onClose:o,restaurantId:s})=>{const g=T(),[l,m]=E.useState(!1),{data:f,isLoading:t}=V({queryKey:["categories",s],queryFn:()=>Ge(s),enabled:!!s&&a}),i=J({resolver:X(He),defaultValues:{name:"",description:"",price:0,is_price_by_weight:!1,is_available:!0,image_url:"",category_id:""}}),y=O({mutationFn:async r=>{if(!s)throw new Error("ID do restaurante não encontrado.");let h=r.image_url;if(r.image_file){const w=r.image_file,q=`${s}/${Date.now()}-${w.name}`,{error:D}=await C.storage.from("products").upload(q,w);if(D)throw new Error(`Erro no upload da imagem: ${D.message}`);const{data:d}=C.storage.from("products").getPublicUrl(q);h=d.publicUrl}const{error:c}=await C.from("products").insert({restaurant_id:s,name:r.name,description:r.description,price:r.price,category_id:r.category_id,image_url:h,is_price_by_weight:r.is_price_by_weight,is_available:r.is_available});if(c)throw new Error(c.message)},onSuccess:()=>{N.success("Produto criado com sucesso!"),g.invalidateQueries({queryKey:["products"]}),o(),i.reset()},onError:r=>{N.error(`Erro ao criar produto: ${r.message}`)}}),_=r=>{y.mutate(r)};return e.jsxs(e.Fragment,{children:[e.jsx(Te,{isOpen:l,onClose:()=>m(!1),restaurantId:s}),e.jsx(Y,{open:a,onOpenChange:o,children:e.jsxs(Z,{className:"sm:max-w-lg",children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Novo Produto"}),e.jsx(re,{children:"Adicione um novo item ao seu cardápio."})]}),e.jsx(ne,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(_),children:[e.jsxs("div",{className:"space-y-4 py-2 pb-4 max-h-[70vh] overflow-y-auto pr-4",children:[e.jsx(x,{control:i.control,name:"name",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Nome *"}),e.jsx(j,{children:e.jsx(A,{placeholder:"Nome do produto",...r})}),e.jsx(b,{})]})}),e.jsx(x,{control:i.control,name:"description",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Descrição"}),e.jsx(j,{children:e.jsx(oe,{placeholder:"Ingredientes, detalhes, etc.",...r})}),e.jsx(b,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(x,{control:i.control,name:"price",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Preço (R$) unitário *"}),e.jsx(j,{children:e.jsx(A,{type:"text",placeholder:"0,00",...r})}),e.jsx(b,{})]})}),e.jsx(x,{control:i.control,name:"category_id",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Categoria *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(pe,{onValueChange:r.onChange,value:r.value,disabled:t||!s,children:[e.jsx(j,{children:e.jsx(ge,{children:e.jsx(fe,{placeholder:"Selecione uma categoria"})})}),e.jsx(ve,{children:f==null?void 0:f.map(h=>e.jsx(ye,{value:h.id,children:h.name},h.id))})]}),e.jsx(v,{type:"button",variant:"outline",size:"icon",onClick:()=>m(!0),disabled:!s,children:e.jsx(le,{className:"h-4 w-4"})})]}),e.jsx(b,{})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Imagem do Produto"}),e.jsx(x,{control:i.control,name:"image_file",render:({field:r})=>{var h;return e.jsxs(u,{children:[e.jsx(j,{children:e.jsxs("label",{className:"flex items-center justify-center w-full h-12 px-4 border-2 border-dashed rounded-md cursor-pointer hover:bg-muted",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:((h=r.value)==null?void 0:h.name)||"Escolher Imagem"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:c=>{var w;return r.onChange((w=c.target.files)==null?void 0:w[0])}})]})}),e.jsx(b,{})]})}}),e.jsx(x,{control:i.control,name:"image_url",render:({field:r})=>e.jsxs(u,{children:[e.jsx(j,{children:e.jsx(A,{placeholder:"Ou cole a URL da imagem",...r})}),e.jsx(b,{})]})})]}),e.jsx(x,{control:i.control,name:"is_price_by_weight",render:({field:r})=>e.jsxs(u,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(p,{children:"Produto pesável (preço por kg)"}),e.jsx(j,{children:e.jsx(F,{checked:r.value,onCheckedChange:r.onChange})})]})}),e.jsx(x,{control:i.control,name:"is_available",render:({field:r})=>e.jsxs(u,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(p,{children:"Produto disponível"}),e.jsx(j,{children:e.jsx(F,{checked:r.value,onCheckedChange:r.onChange})})]})})]}),e.jsxs(ae,{className:"pt-4 border-t",children:[e.jsx(ie,{asChild:!0,children:e.jsx(v,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(v,{type:"submit",disabled:y.isPending||!s,children:y.isPending?"Criando...":"Criar Produto"})]})]})})]})})]})},Xe=H({name:P().min(1,"O nome é obrigatório."),description:P().optional(),price:Ne(a=>String(a).replace(",","."),G.number({invalid_type_error:"O preço deve ser um número."}).positive("O preço deve ser maior que zero.")),category_id:P().optional(),image_url:P().url("URL inválida.").optional().or(Ce("")),image_file:Ee(File).optional(),is_price_by_weight:$().default(!1),is_available:$().default(!0)}),Ye=async a=>{const{data:o,error:s}=await C.from("categories").select("id, name").eq("restaurant_id",a).eq("is_active",!0);if(s)throw new Error(s.message);return o},Ze=({isOpen:a,onClose:o,product:s})=>{const g=T(),[l,m]=E.useState(null);E.useEffect(()=>{s!=null&&s.restaurant_id&&m(s.restaurant_id)},[s,a]);const{data:f,isLoading:t}=V({queryKey:["categories",l],queryFn:()=>Ye(l),enabled:!!l&&a}),i=J({resolver:X(Xe)});E.useEffect(()=>{s&&i.reset({name:s.name,description:s.description||"",price:s.price,category_id:s.category_id||void 0,image_url:s.image_url||"",is_price_by_weight:s.is_price_by_weight||!1,is_available:s.is_available??!0,image_file:void 0})},[s,i,a]);const y=O({mutationFn:async r=>{if(!(s!=null&&s.id)||!l)throw new Error("ID do produto ou restaurante não encontrado.");let h=s.image_url;if(r.image_file){const w=r.image_file,q=`${l}/${Date.now()}-${w.name}`,{error:D}=await C.storage.from("products").upload(q,w);if(D)throw new Error(`Erro no upload da imagem: ${D.message}`);const{data:d}=C.storage.from("products").getPublicUrl(q);h=d.publicUrl}else h=r.image_url||null;const{error:c}=await C.from("products").update({name:r.name,description:r.description,price:r.price,category_id:r.category_id||null,image_url:h,is_price_by_weight:r.is_price_by_weight,is_available:r.is_available}).eq("id",s.id);if(c)throw c},onSuccess:()=>{N.success("Produto atualizado com sucesso!"),g.invalidateQueries({queryKey:["products",l]}),g.invalidateQueries({queryKey:["menuData"]}),o()},onError:r=>{N.error(`Erro ao atualizar produto: ${r.message}`)}}),_=r=>{y.mutate(r)};return e.jsx(Y,{open:a,onOpenChange:o,children:e.jsxs(Z,{className:"sm:max-w-lg",children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Editar Produto"}),e.jsx(re,{children:"Atualize as informações do item do seu cardápio."})]}),e.jsx(ne,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(_),children:[e.jsxs("div",{className:"space-y-4 py-2 pb-4 max-h-[70vh] overflow-y-auto pr-4",children:[e.jsx(x,{control:i.control,name:"name",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Nome *"}),e.jsx(j,{children:e.jsx(A,{...r})}),e.jsx(b,{})]})}),e.jsx(x,{control:i.control,name:"description",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Descrição"}),e.jsx(j,{children:e.jsx(oe,{...r})}),e.jsx(b,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(x,{control:i.control,name:"price",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Preço (R$) *"}),e.jsx(j,{children:e.jsx(A,{type:"text",...r})}),e.jsx(b,{})]})}),e.jsx(x,{control:i.control,name:"category_id",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Categoria"}),e.jsxs(pe,{onValueChange:r.onChange,value:r.value,disabled:t||!l,children:[e.jsx(j,{children:e.jsx(ge,{children:e.jsx(fe,{placeholder:"Selecione uma categoria"})})}),e.jsx(ve,{children:f==null?void 0:f.map(h=>e.jsx(ye,{value:h.id,children:h.name},h.id))})]}),e.jsx(b,{})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Imagem do Produto"}),e.jsx(x,{control:i.control,name:"image_file",render:({field:r})=>{var h;return e.jsxs(u,{children:[e.jsx(j,{children:e.jsxs("label",{className:"flex items-center justify-center w-full h-12 px-4 border-2 border-dashed rounded-md cursor-pointer hover:bg-muted",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:((h=r.value)==null?void 0:h.name)||"Escolher Nova Imagem"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:c=>{var w;return r.onChange((w=c.target.files)==null?void 0:w[0])}})]})}),e.jsx(b,{})]})}}),e.jsx(x,{control:i.control,name:"image_url",render:({field:r})=>e.jsxs(u,{children:[e.jsx(j,{children:e.jsx(A,{placeholder:"Ou cole a URL da imagem",...r})}),e.jsx(b,{})]})})]}),e.jsx(x,{control:i.control,name:"is_price_by_weight",render:({field:r})=>e.jsxs(u,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(p,{children:"Produto pesável (preço por kg)"}),e.jsx(j,{children:e.jsx(F,{checked:r.value,onCheckedChange:r.onChange})})]})}),e.jsx(x,{control:i.control,name:"is_available",render:({field:r})=>e.jsxs(u,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(p,{children:"Produto disponível"}),e.jsx(j,{children:e.jsx(F,{checked:r.value,onCheckedChange:r.onChange})})]})})]}),e.jsxs(ae,{className:"pt-4 border-t",children:[e.jsx(ie,{asChild:!0,children:e.jsx(v,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(v,{type:"submit",disabled:y.isPending||!l,children:y.isPending?"Salvando...":"Salvar Alterações"})]})]})})]})})},es=H({name:P().min(1,"O nome é obrigatório."),description:P().optional(),display_order:G.number().default(0),is_active:$().default(!0)}),ss=({isOpen:a,onClose:o,category:s,restaurantId:g})=>{const l=T(),m=J({resolver:X(es),defaultValues:{name:"",description:"",display_order:0,is_active:!0}});E.useEffect(()=>{s&&m.reset({name:s.name||"",description:s.description||"",display_order:s.display_order??0,is_active:s.is_active??!0})},[s,m,a]);const f=O({mutationFn:async i=>{if(!(s!=null&&s.id))throw new Error("ID da categoria não encontrado.");const y={name:i.name,description:i.description,display_order:i.display_order,is_active:i.is_active},{error:_}=await C.from("categories").update(y).eq("id",s.id);if(_)throw new Error(_.message)},onSuccess:()=>{N.success("Categoria atualizada com sucesso!"),l.invalidateQueries({queryKey:["categoriesWithProducts",g]}),l.invalidateQueries({queryKey:["categories",g]}),l.invalidateQueries({queryKey:["menuData"]}),o()},onError:i=>{N.error(`Erro ao atualizar categoria: ${i.message}`)}}),t=i=>{f.mutate(i)};return e.jsx(Y,{open:a,onOpenChange:o,children:e.jsxs(Z,{className:"sm:max-w-[425px]",children:[e.jsxs(ee,{children:[e.jsxs(se,{children:["Editar Categoria: ",s==null?void 0:s.name]}),e.jsx(re,{children:"Atualize as informações da categoria."})]}),e.jsx(ne,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(t),className:"space-y-4 pt-4",children:[e.jsx(x,{control:m.control,name:"name",render:({field:i})=>e.jsxs(u,{children:[e.jsx(p,{children:"Nome *"}),e.jsx(j,{children:e.jsx(A,{placeholder:"",...i})}),e.jsx(b,{})]})}),e.jsx(x,{control:m.control,name:"description",render:({field:i})=>e.jsxs(u,{children:[e.jsx(p,{children:"Descrição"}),e.jsx(j,{children:e.jsx(oe,{placeholder:"",...i})}),e.jsx(b,{})]})}),e.jsx(x,{control:m.control,name:"display_order",render:({field:i})=>e.jsxs(u,{children:[e.jsx(p,{children:"Ordem de Exibição"}),e.jsx(j,{children:e.jsx(A,{type:"number",...i})}),e.jsx(b,{})]})}),e.jsx(x,{control:m.control,name:"is_active",render:({field:i})=>e.jsxs(u,{className:"flex flex-row items-center space-x-3 space-y-0 pt-2",children:[e.jsx(j,{children:e.jsx(F,{checked:i.value,onCheckedChange:i.onChange,id:"is_active_edit"})}),e.jsx(p,{htmlFor:"is_active_edit",className:"font-normal cursor-pointer",children:"Ativa"})]})}),e.jsxs(ae,{className:"pt-4",children:[e.jsx(ie,{asChild:!0,children:e.jsx(v,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsxs(v,{type:"submit",disabled:f.isPending||!(s!=null&&s.id),children:[f.isPending?e.jsx(I,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Salvar Alterações"]})]})]})})]})})},rs=async a=>{const{data:o,error:s}=await C.from("categories").select("*").eq("restaurant_id",a).order("display_order",{ascending:!0});if(s)throw new Error(`Erro ao buscar categorias: ${s.message}`);const{data:g,error:l}=await C.from("products").select("id, name, category_id, is_available").eq("restaurant_id",a);if(l)throw new Error(`Erro ao buscar produtos: ${l.message}`);return o.map(f=>({...f,products:g.filter(t=>t.category_id===f.id)}))},as=({restaurantId:a})=>{const o=T(),[s,g]=E.useState(!1),[l,m]=E.useState(!1),[f,t]=E.useState(null),[i,y]=E.useState(null),{data:_,isLoading:r,isError:h,error:c}=V({queryKey:["categoriesWithProducts",a],queryFn:()=>rs(a),enabled:!!a}),w=d=>{y(d)},q=O({mutationFn:async d=>{const{error:M}=await C.from("categories").delete().eq("id",d);if(M)throw new Error(M.message)},onSuccess:()=>{N.success("Categoria excluída com sucesso!"),o.invalidateQueries({queryKey:["categoriesWithProducts",a]}),o.invalidateQueries({queryKey:["categories",a]}),o.invalidateQueries({queryKey:["menuData"]}),y(null)},onError:d=>{N.error(`Erro ao excluir categoria: ${d.message}`),y(null)}}),D=_==null?void 0:_.find(d=>d.id===i);return e.jsxs(e.Fragment,{children:[e.jsx(Te,{isOpen:s,onClose:()=>g(!1),restaurantId:a}),e.jsx(ss,{isOpen:l,onClose:()=>{m(!1),t(null)},category:f,restaurantId:a}),e.jsx(Se,{open:!!i,onOpenChange:d=>!d&&y(null),children:e.jsxs(ke,{children:[e.jsxs(qe,{children:[e.jsx(Pe,{children:"Tem certeza que deseja excluir esta categoria?"}),e.jsxs(De,{children:['Esta ação é permanente. A categoria "',(D==null?void 0:D.name)||"selecionada",'" será removida.',e.jsx("br",{}),"**Atenção:** Os produtos associados a esta categoria não serão excluídos, mas ficarão sem categoria."]})]}),e.jsxs(Me,{children:[e.jsx(Ae,{disabled:q.isPending,children:"Cancelar"}),e.jsxs(Oe,{onClick:()=>q.mutate(i),className:"bg-destructive hover:bg-destructive/90",disabled:q.isPending,children:[q.isPending?e.jsx(I,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(B,{className:"h-4 w-4 mr-2"}),"Excluir"]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Categorias"}),e.jsxs(v,{onClick:()=>g(!0),disabled:!a,children:[e.jsx(le,{className:"mr-2 h-4 w-4"})," Nova Categoria"]})]}),r&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[...Array(3)].map((d,M)=>e.jsxs(U,{children:[e.jsx(xe,{children:e.jsx(k,{className:"h-6 w-3/4"})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsx(k,{className:"h-4 w-1/4"}),e.jsx(k,{className:"h-4 w-1/2"}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(k,{className:"h-8 w-full"}),e.jsx(k,{className:"h-8 w-full"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(k,{className:"h-10 w-full"}),e.jsx(k,{className:"h-10 w-10"})]})]})]},M))}),h&&e.jsxs(be,{variant:"destructive",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx(_e,{children:"Erro ao carregar categorias"}),e.jsx(we,{children:c instanceof Error?c.message:"Ocorreu um erro desconhecido."})]}),_&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:_.map(d=>e.jsxs(U,{children:[e.jsxs(xe,{className:"flex flex-row items-start justify-between",children:[e.jsx(Le,{children:d.name}),d.is_active&&e.jsx(R,{children:"Ativa"})]}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ordem: ",d.display_order??0]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium mb-2",children:["Produtos (",d.products.length,"):"]}),e.jsx("div",{className:"space-y-2",children:d.products.length>0?d.products.map(M=>e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-2 rounded-md",children:[e.jsx("span",{className:"text-sm",children:M.name}),M.is_available&&e.jsx(R,{variant:"secondary",children:"Disponível"})]},M.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum produto nesta categoria."})})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[e.jsxs(v,{variant:"outline",className:"w-full",onClick:()=>{t(d),m(!0)},children:[e.jsx(ce,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsx(v,{variant:"destructive",size:"icon",onClick:()=>w(d.id),children:e.jsx(B,{className:"h-4 w-4"})})]})]})]},d.id))})]})]})},is=({product:a,onEditClick:o,onUpdateStatus:s,onDeleteClick:g})=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-card hover:bg-accent transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:a.image_url||"/placeholder.svg",alt:a.name,className:"w-16 h-16 object-cover rounded-md border"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.price)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{variant:a.is_available?"default":"secondary",children:a.is_available?"Disponível":"Indisponível"}),e.jsx(F,{checked:a.is_available??!1,onCheckedChange:s}),e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>o(a),children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>g(a.id),children:e.jsx(B,{className:"h-4 w-4"})})]})]}),ns=async a=>{const{data:o,error:s}=await C.from("products").select("*").eq("restaurant_id",a).order("created_at",{ascending:!1});if(s)throw new Error(`Erro ao buscar produtos: ${s.message}`);return o},As=()=>{const a=T(),{userRestaurantId:o}=Re(),[s,g]=E.useState(!1),[l,m]=E.useState(!1),[f,t]=E.useState(null),[i,y]=E.useState(null),[_,r]=E.useState(()=>{if(typeof window<"u"){const n=localStorage.getItem("productsLayout");return n==="grid"||n==="list"?n:"grid"}return"grid"}),h=E.useCallback(n=>{r(n),localStorage.setItem("productsLayout",n)},[]),{data:c,isLoading:w,isError:q,error:D}=V({queryKey:["products",o],queryFn:()=>ns(o),enabled:!!o}),d=n=>{t(n),m(!0)},M=O({mutationFn:async({id:n,is_available:S})=>{const{error:z}=await C.from("products").update({is_available:S}).eq("id",n);if(z)throw new Error(z.message)},onSuccess:()=>{a.invalidateQueries({queryKey:["products"]}),N.success("Status do produto atualizado!")},onError:n=>{N.error(`Erro ao atualizar produto: ${n.message}`)}}),L=O({mutationFn:async n=>{const{error:S}=await C.from("products").delete().eq("id",n);if(S)throw new Error(S.message)},onSuccess:()=>{a.invalidateQueries({queryKey:["products"]}),a.invalidateQueries({queryKey:["menuData"]}),N.success("Produto excluído com sucesso!"),y(null)},onError:n=>{N.error(`Erro ao excluir produto: ${n.message}`),y(null)}}),de=O({mutationFn:async n=>{if(!c||c.length===0||!o)return;const S=c.map(ze=>ze.id),{error:z}=await C.from("products").update({is_available:n}).in("id",S);if(z)throw new Error(z.message)},onSuccess:(n,S)=>{a.invalidateQueries({queryKey:["products"]}),a.invalidateQueries({queryKey:["menuData"]}),N.success(`Todos os produtos foram ${S?"ativados":"desativados"} com sucesso!`)},onError:n=>{N.error(`Erro ao atualizar status em massa: ${n.message}`)}}),me=n=>{if(!c||c.length===0){N.info("Nenhum produto para atualizar.");return}de.mutate(n)},he=n=>{L.mutate(n)},te=c==null?void 0:c.find(n=>n.id===i),K=de.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(Je,{isOpen:s,onClose:()=>g(!1),restaurantId:o}),e.jsx(Ze,{isOpen:l,onClose:()=>m(!1),product:f}),e.jsx(Se,{open:!!i,onOpenChange:n=>!n&&y(null),children:e.jsxs(ke,{children:[e.jsxs(qe,{children:[e.jsx(Pe,{children:"Tem certeza que deseja excluir este produto?"}),e.jsxs(De,{children:['Esta ação é permanente. O produto "',(te==null?void 0:te.name)||"selecionado",'" será removido do cardápio.']})]}),e.jsxs(Me,{children:[e.jsx(Ae,{disabled:L.isPending,children:"Cancelar"}),e.jsx(Oe,{onClick:()=>he(i),className:"bg-destructive hover:bg-destructive/90",disabled:L.isPending,children:L.isPending?"Excluindo...":"Excluir"})]})]})}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:e.jsxs(Ke,{defaultValue:"products",children:[e.jsxs(Ue,{children:[e.jsx(ue,{value:"products",children:"Produtos"}),e.jsx(ue,{value:"categories",children:"Categorias"})]}),e.jsxs(je,{value:"products",className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Produtos"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(v,{variant:"outline",size:"icon",onClick:()=>h(_==="grid"?"list":"grid"),children:_==="grid"?e.jsx(Ve,{className:"h-4 w-4"}):e.jsx(Be,{className:"h-4 w-4"})}),e.jsx(v,{variant:"outline",onClick:()=>me(!0),disabled:K||w||!c||c.length===0,children:K?e.jsx(I,{className:"h-4 w-4 animate-spin mr-2"}):"Ativar Todos"}),e.jsx(v,{variant:"outline",onClick:()=>me(!1),disabled:K||w||!c||c.length===0,children:K?e.jsx(I,{className:"h-4 w-4 animate-spin mr-2"}):"Desativar Todos"}),e.jsxs(v,{onClick:()=>g(!0),children:[e.jsx(le,{className:"mr-2 h-4 w-4"})," Novo Produto"]})]})]}),w&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((n,S)=>e.jsxs(U,{className:"overflow-hidden",children:[e.jsx(k,{className:"h-48 w-full"}),e.jsxs(Q,{className:"p-4 space-y-3",children:[e.jsx(k,{className:"h-5 w-3/4"}),e.jsx(k,{className:"h-6 w-1/3"}),e.jsxs("div",{className:"flex justify-between items-center border-t pt-3 mt-3",children:[e.jsx(k,{className:"h-5 w-1/2"}),e.jsx(k,{className:"h-6 w-12"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(k,{className:"h-10 w-full"}),e.jsx(k,{className:"h-10 w-10"})]})]})]},S))}),q&&e.jsxs(be,{variant:"destructive",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx(_e,{children:"Erro ao carregar produtos"}),e.jsx(we,{children:D.message})]}),c&&e.jsx("div",{className:Qe(_==="grid"?"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"space-y-4"),children:c.map(n=>_==="grid"?e.jsxs(U,{className:"overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:n.image_url||"/placeholder.svg",alt:n.name,className:"w-full h-48 object-cover"}),n.is_available&&e.jsx(R,{className:"absolute top-2 right-2",children:"Disponível"})]}),e.jsxs(Q,{className:"p-4 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"text-lg font-semibold truncate",children:n.name}),e.jsx("p",{className:"text-xl font-bold text-primary mt-1 mb-3",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n.price)})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-t pt-3",children:[e.jsx("label",{htmlFor:`active-${n.id}`,className:"text-sm font-medium",children:"Produto Ativo"}),e.jsx(F,{id:`active-${n.id}`,checked:n.is_available??!1,onCheckedChange:S=>{M.mutate({id:n.id,is_available:S})}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{variant:"outline",className:"w-full",onClick:()=>d(n),children:[e.jsx(ce,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsx(v,{variant:"destructive",size:"icon",onClick:()=>y(n.id),children:e.jsx(B,{className:"h-4 w-4"})})]})]})]})]},n.id):e.jsx(is,{product:n,onEditClick:d,onUpdateStatus:S=>M.mutate({id:n.id,is_available:S}),onDeleteClick:he},n.id))})]}),e.jsx(je,{value:"categories",children:e.jsx(as,{restaurantId:o})})]})})]})};export{As as default};
