import{j as e}from"./tanstack-QxCZ3Wpf.js";import{u as F,r as n,L as U}from"./vendor-CIxFcw7z.js";import{L as I}from"./Logo-DNSyGO9c.js";import{B as v}from"./button-U4wKQAEJ.js";import{L as h,I as g}from"./label-DUOZaaI-.js";import{C as R,b as D,c as z,d as O,a as T}from"./card-ChYInxld.js";import{c as C,L as w,u as s}from"./index-BMINKugR.js";import{s as m}from"./client-BskZ_u5h.js";import{P as V}from"./PhoneInput-G6p71oos.js";import{S as _}from"./separator-C3dm_VkJ.js";import"./package-Bj-HFETK.js";import"./supabase-DGFirUEE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=C("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=C("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),b=i=>i.replace(/\D/g,""),M=async i=>{const{data:c,error:l}=await m.from("user_roles").select("role").eq("user_id",i).in("role",["admin","moderator"]).limit(1).single();return l&&l.code!=="PGRST116"?(console.error("Error checking role:",l),null):(c==null?void 0:c.role)||null},se=()=>{const i=F(),[c,l]=n.useState(!1),[o,S]=n.useState(!1),[d,k]=n.useState(""),[u,L]=n.useState(""),[p,P]=n.useState(""),[x,E]=n.useState(""),[f,j]=n.useState(null),N=async r=>{const a=await M(r.id);if(a==="admin"||a==="moderator")s.success("Login de administrador efetuado com sucesso!"),i("/dashboard",{replace:!0});else{s.error("Acesso negado.",{description:"Esta conta não possui permissão de administrador/moderador. Redirecionando para o menu.",duration:5e3}),await m.auth.signOut();const t=`${window.location.origin}${window.location.pathname}#/menu`;console.log("Redirecting non-admin to menu:",t),window.location.href=t}};n.useEffect(()=>{m.auth.getSession().then(({data:{session:a}})=>{j(a),a!=null&&a.user&&N(a.user)});const{data:{subscription:r}}=m.auth.onAuthStateChange((a,t)=>{j(t),t!=null&&t.user&&N(t.user)});return()=>r.unsubscribe()},[i]);const A=()=>{if(o){if(!p.trim())return s.error("O Nome Completo é obrigatório."),!1;if(b(x).length!==11)return s.error("O Telefone deve conter 11 dígitos (DDD + 9 dígitos)."),!1}return d.trim()?u.length<6?(s.error("A Senha deve ter pelo menos 6 caracteres."),!1):!0:(s.error("O Email é obrigatório."),!1)},q=async r=>{if(r.preventDefault(),!!A()){l(!0);try{if(o){const a=b(x),{data:t,error:y}=await m.auth.signUp({email:d,password:u,options:{data:{full_name:p,phone:a}}});if(y)throw y;t.session?s.success("Conta de administrador criada e login efetuado!"):s.success("Conta criada! Verifique seu email para confirmar.")}else{const{error:a}=await m.auth.signInWithPassword({email:d,password:u});if(a)throw a;s.success("Login realizado com sucesso!")}}catch(a){a.message.includes("Email not confirmed")?s.error("Por favor, verifique seu e-mail para confirmar sua conta."):s.error(a.message||"Erro ao processar autenticação")}finally{l(!1)}}};return f!=null&&f.user?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-primary"}),e.jsx("p",{className:"text-lg font-semibold",children:"Verificando permissões..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aguarde enquanto redirecionamos você."})]})}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(I,{className:"justify-center mb-4"})}),e.jsxs(R,{className:"shadow-xl border-2",children:[e.jsxs(D,{className:"space-y-1",children:[e.jsxs(z,{className:"text-2xl font-bold text-center flex items-center justify-center gap-2",children:[o?e.jsx(H,{className:"h-6 w-6 text-primary"}):e.jsx(B,{className:"h-6 w-6 text-destructive"}),o?"Cadastre sua Loja":"Acesso do Restaurante"]}),e.jsx(O,{className:"text-center",children:o?"Crie sua conta de administrador para gerenciar sua loja.":"Utilize seu email e senha de administrador para acessar o painel."})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"fullName",children:"Nome Completo *"}),e.jsx(g,{id:"fullName",type:"text",placeholder:"Seu nome completo",value:p,onChange:r=>P(r.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"phone",children:"Telefone *"}),e.jsx(V,{id:"phone",value:x,onChange:r=>E(r.target.value),required:!0,className:"h-12"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formato: (99) 99999-9999"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"email",children:"Email *"}),e.jsx(g,{id:"email",type:"email",placeholder:"seu@email.com",value:d,onChange:r=>k(r.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"password",children:"Senha *"}),e.jsx(g,{id:"password",type:"password",placeholder:"••••••••",value:u,onChange:r=>L(r.target.value),required:!0,className:"h-12"})]}),e.jsx(v,{type:"submit",className:"w-full",size:"lg",disabled:c,children:c?e.jsx(w,{className:"h-4 w-4 animate-spin mr-2"}):o?"Criar Conta Admin":"Entrar no Painel"})]}),e.jsx("div",{className:"text-center",children:e.jsx(v,{variant:"link",type:"button",className:"p-0 h-auto",onClick:()=>S(!o),children:o?"Já tem uma conta? Faça login":"Não tem uma conta? Cadastre-se agora"})}),e.jsx(_,{className:"my-4"}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["É um cliente? ",e.jsx(U,{to:"/auth",className:"text-primary hover:underline",children:"Acesse como Cliente"})]})]})]})]})})};export{se as default};
