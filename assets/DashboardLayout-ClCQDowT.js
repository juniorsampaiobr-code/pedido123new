import{j as e,b as Y,u as Z}from"./tanstack-DS1wz2fm.js";import{k as N,L as O,r as a,u as ee,O as oe}from"./vendor-DPb28zz8.js";import{s as x}from"./client-BP8r4skJ.js";import{L as _}from"./Logo-Bcd6_0C0.js";import{c as g,b as z,u as d,v as ae,T as D,d as I,e as q,L as re}from"./index-V4cgCgal.js";import{P as R}from"./package-CX5ArCx1.js";import{S as E}from"./shopping-cart-wCYPB_Dm.js";import{C as V}from"./clock-EzjqR2Oo.js";import{C as H}from"./credit-card-CKTI8Ewn.js";import{T as $}from"./truck-CVxsbWL_.js";import{S as F}from"./settings-BVWZkV_d.js";import{B as j}from"./button-_Kx6vQmI.js";import{A as se,b as te,c as ne,d as ie,e as le,f as ce,h as de}from"./alert-dialog-C7Ri-SaB.js";import{S as ue,f as he,a as me}from"./sheet-8v_slv5i.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=g("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=g("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=g("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=g("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=g("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=g("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),ge=[{href:"/dashboard",label:"Dashboard",icon:B},{href:"/products",label:"Produtos",icon:R},{href:"/orders",label:"Pedidos",icon:E},{href:"/cashier",label:"Caixa",icon:Q},{href:"/hours",label:"Hor√°rios",icon:V},{href:"/payments",label:"Pagamentos",icon:H},{href:"/delivery",label:"Taxa de Entrega",icon:$},{href:"/settings",label:"Configura√ß√µes",icon:F}],be=()=>{const s=N();return e.jsxs("aside",{className:"w-64 flex-shrink-0 border-r bg-card h-screen sticky top-0 flex-col flex",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx(_,{})}),e.jsx("nav",{className:"flex-grow p-4",children:e.jsx("ul",{children:ge.map(t=>e.jsx("li",{children:e.jsxs(O,{to:t.href,className:z("flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors",s.pathname===t.href?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted hover:text-foreground"),children:[e.jsx(t.icon,{className:"h-4 w-4"}),t.label]})},t.href))})})]})},ye=({isOpen:s,onEnable:t})=>e.jsx(se,{open:s,children:e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsxs(ie,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-6 w-6 text-primary"}),"Ativar Notifica√ß√µes Sonoras?"]}),e.jsxs(le,{children:["Para garantir que voc√™ n√£o perca nenhum novo pedido, precisamos da sua permiss√£o para tocar um som de notifica√ß√£o.",e.jsx("br",{}),e.jsx("br",{}),'Ao clicar em "Ativar", um som de teste ser√° reproduzido.']})]}),e.jsx(ce,{children:e.jsx(de,{onClick:t,className:"w-full",children:"Sim, ativar som"})})]})}),ve=[{href:"/dashboard",label:"Dashboard",icon:B},{href:"/products",label:"Produtos",icon:R},{href:"/orders",label:"Pedidos",icon:E},{href:"/cashier",label:"Caixa",icon:Q},{href:"/hours",label:"Hor√°rios",icon:V},{href:"/payments",label:"Pagamentos",icon:H},{href:"/delivery",label:"Taxa de Entrega",icon:$},{href:"/settings",label:"Configura√ß√µes",icon:F}],Se=()=>{const s=N(),[t,h]=a.useState(!1);return e.jsxs(ue,{open:t,onOpenChange:h,children:[e.jsx(he,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",children:e.jsx(pe,{className:"h-6 w-6"})})}),e.jsxs(me,{side:"left",className:"flex flex-col w-64",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx(_,{})}),e.jsx("nav",{className:"flex-grow p-4",children:e.jsx("ul",{children:ve.map(m=>e.jsx("li",{children:e.jsxs(O,{to:m.href,onClick:()=>h(!1),className:z("flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors",s.pathname===m.href?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted hover:text-foreground"),children:[e.jsx(m.icon,{className:"h-4 w-4"}),m.label]})},m.href))})})]})]})},k=768;function je(){const[s,t]=a.useState(void 0);return a.useEffect(()=>{const h=window.matchMedia(`(max-width: ${k-1}px)`),m=()=>{t(window.innerWidth<k)};return h.addEventListener("change",m),t(window.innerWidth<k),()=>h.removeEventListener("change",m)},[]),!!s}const T=a.createContext(null),we=()=>{const s=a.useContext(T);if(!s)throw new Error("useSound must be used within a DashboardLayout");return s},Ce=[{href:"/dashboard",label:"Dashboard"},{href:"/products",label:"Produtos"},{href:"/orders",label:"Pedidos"},{href:"/cashier",label:"Caixa"},{href:"/hours",label:"Hor√°rios"},{href:"/payments",label:"Pagamentos"},{href:"/delivery",label:"Taxa de Entrega"},{href:"/settings",label:"Configura√ß√µes"}],ke=s=>{const t=Ce.find(h=>h.href===s);return t?t.label:"Dashboard"},Ne=()=>{const s=ee(),t=N(),h=Y(),[m,L]=a.useState(null),r=a.useRef(null),[n,y]=a.useState("loading"),[U,A]=a.useState(!1),[b,w]=a.useState(null),P=je(),[l,f]=a.useState(()=>localStorage.getItem("soundNotificationStatus")||"disabled");a.useEffect(()=>{localStorage.setItem("soundNotificationStatus",l)},[l]);const{data:u,isLoading:W}=Z({queryKey:["dashboardRestaurant"],queryFn:async()=>{const{data:o,error:c}=await x.from("restaurants").select("*").limit(1).single();if(c)throw new Error(c.message);return o},enabled:!!m,staleTime:1/0});a.useEffect(()=>{var o;u!=null&&u.notification_sound_url?((o=r.current)==null?void 0:o.src)!==u.notification_sound_url&&y("loading"):y("error")},[u==null?void 0:u.notification_sound_url]),a.useEffect(()=>{!localStorage.getItem("hasSeenSoundPermissionModal")&&l!=="enabled"&&n==="ready"&&A(!0)},[l,n]),a.useEffect(()=>{(async()=>{const{data:{session:i}}=await x.auth.getSession();i!=null&&i.user?L(i.user):s("/auth")})();const{data:{subscription:c}}=x.auth.onAuthStateChange((i,S)=>{i==="SIGNED_OUT"?s("/"):S!=null&&S.user?L(S.user):s("/auth")});return()=>c.unsubscribe()},[s]);const p=a.useCallback(()=>{r.current&&(r.current.pause(),r.current.loop=!1,w(null))},[]),M=a.useCallback(o=>{if(l==="enabled"&&r.current&&n==="ready"){if(b)return;w(o),r.current.loop=!0,r.current.play().catch(c=>{console.error("Erro na reprodu√ß√£o autom√°tica de √°udio:",c),w(null),d.warning("N√£o foi poss√≠vel tocar o som automaticamente.",{description:"Interaja com a p√°gina para permitir a reprodu√ß√£o de som."})})}},[l,n,b]);a.useEffect(()=>{const o=x.channel("new-orders-toast").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders"},c=>{h.invalidateQueries({queryKey:["orders"]});const i=c.new;i.status==="pending"&&i.id&&(d.info("üîî Novo pedido recebido!",{description:`Pedido #${i.id.slice(-4)} est√° aguardando confirma√ß√£o.`,duration:15e3}),M(i.id))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders"},c=>{h.invalidateQueries({queryKey:["orders"]});const i=c.new;i.id===b&&p(),i.status==="pending"&&i.id&&c.old.status==="pending_payment"&&d.success("‚úÖ Pagamento Confirmado!",{description:`Pedido #${i.id.slice(-4)} foi pago e est√° pronto para preparo.`,duration:5e3})}).subscribe();return()=>{x.removeChannel(o)}},[h,M,p,b]);const C=a.useCallback(()=>{if(l==="enabled"&&r.current&&n==="ready"){p(),r.current.loop=!1,r.current.currentTime=0;const o=r.current.play();o!==void 0&&o.then(()=>{console.log("Som de teste tocado com sucesso")}).catch(c=>{console.error("Erro ao tocar som de teste:",c),d.error("N√£o foi poss√≠vel tocar o som de teste.",{description:"Seu navegador pode ter bloqueado a reprodu√ß√£o. Interaja com a p√°gina e tente novamente."})})}else n==="ready"?(f("enabled"),setTimeout(()=>C(),100)):(d.error("Som de notifica√ß√£o n√£o est√° pronto ou configurado.",{description:"Verifique se a URL do som est√° correta nas Configura√ß√µes."}),f("error"))},[l,n,p]),G=async()=>{if(n!=="ready"||!r.current){d.error("O arquivo de som ainda n√£o est√° pronto. Tente novamente em um momento.");return}try{r.current.currentTime=0,await r.current.play(),f("enabled"),d.success("Notifica√ß√µes sonoras ativadas!"),localStorage.setItem("hasSeenSoundPermissionModal","true")}catch(o){console.error("Audio activation failed from modal:",o),d.error("Falha ao ativar o som.",{description:"Seu navegador pode ter bloqueado a reprodu√ß√£o. Por favor, tente ativar manualmente no √≠cone do cabe√ßalho."}),f("error")}finally{A(!1)}},X=async()=>{if(l==="enabled"){p(),f("disabled"),d.info("Notifica√ß√µes sonoras desativadas.");return}if(n!=="ready"||!r.current){d.error("Som de notifica√ß√£o n√£o est√° pronto ou configurado."),f("error");return}try{r.current.currentTime=0,await r.current.play(),f("enabled"),d.success("Notifica√ß√µes sonoras ativadas!",{description:"Voc√™ ouviu o som de teste."})}catch(o){console.error("Audio activation failed:",o),d.error("Falha ao ativar o som.",{description:"Seu navegador pode ter bloqueado. Clique na p√°gina e tente novamente."}),f("error")}},J=async()=>{await x.auth.signOut()};if(!m||W)return e.jsx(ae,{});const v=n!=="ready";return e.jsxs(T.Provider,{value:{playSound:C,stopSoundLoop:p,soundStatus:l,loopingOrderId:b},children:[e.jsx(ye,{isOpen:U,onEnable:G}),e.jsxs("div",{className:"flex min-h-screen bg-muted/40",children:[!P&&e.jsx(be,{}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"border-b bg-background sticky top-0 z-40",children:e.jsxs("div",{className:"container max-w-none mx-auto px-4 sm:px-8 h-16 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[P&&e.jsx(Se,{}),e.jsx(E,{className:"h-6 w-6 hidden sm:block"}),e.jsx("h1",{className:"text-xl font-semibold",children:ke(t.pathname)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(D,{children:[e.jsx(I,{asChild:!0,children:e.jsx(j,{variant:"outline",size:"sm",onClick:C,disabled:v,children:"Testar Som"})}),v&&e.jsx(q,{children:n==="loading"?"Carregando som...":"Som n√£o dispon√≠vel"})]}),e.jsxs(D,{children:[e.jsx(I,{asChild:!0,children:e.jsxs(j,{variant:"outline",size:"icon",onClick:X,disabled:v,"aria-label":l==="enabled"?"Desativar som":"Ativar som",children:[n==="loading"&&e.jsx(re,{className:"h-4 w-4 animate-spin"}),n==="ready"&&l==="enabled"&&e.jsx(K,{className:"h-4 w-4 text-green-500"}),n==="ready"&&l==="disabled"&&e.jsx(xe,{className:"h-4 w-4"}),n==="error"&&e.jsx(fe,{className:"h-4 w-4 text-destructive"})]})}),v&&e.jsx(q,{children:n==="loading"?"Carregando som...":"Som n√£o dispon√≠vel"})]}),e.jsx(j,{variant:"outline",onClick:J,children:"Sair"})]})]})}),e.jsx(oe,{context:{restaurant:u}})]}),(u==null?void 0:u.notification_sound_url)&&e.jsx("audio",{ref:r,src:u.notification_sound_url,onCanPlayThrough:()=>{y("ready"),console.log("√Åudio carregado e pronto para tocar.")},onError:o=>{console.error("Erro ao carregar o √°udio:",o),d.error("Erro ao carregar o som de notifica√ß√£o.",{description:"Verifique o arquivo em Configura√ß√µes."}),y("error"),f("error")},className:"hidden"})]})]})},Ee=a.memo(Ne),$e=Object.freeze(Object.defineProperty({__proto__:null,SoundContext:T,default:Ee,useSound:we},Symbol.toStringTag,{value:"Module"}));export{$e as D,K as V,we as u};
