import{j as e,u as He,b as ee}from"./tanstack-QxCZ3Wpf.js";import{s as A}from"./client-BskZ_u5h.js";import{S as B}from"./skeleton-BS0qfoBU.js";import{A as te,a as se,b as oe}from"./alert-BG7PqNzd.js";import{r as i,u as We}from"./vendor-CIxFcw7z.js";import{o as ne,n as qe,u as ae,t as le,c as Ve}from"./types-C33Up_9v.js";import{B as j}from"./button-DL5uV3lc.js";import{D as ie,a as ce,b as de,c as ue,d as me,e as he}from"./dialog-Tl7meOpr.js";import{F as fe,a as xe,b as Ue,c as Xe,d as $e,e as Ye}from"./form-BBfSeyGg.js";import{c as Qe,a as F,b as _,T as Ge,d as Ke,e as Je,f as Ze,g as M,P as H,h as U,i as L,j as T,k as er,u as W}from"./index-BKj90VFL.js";import{P as pe}from"./plus-BIce6CRp.js";import{S as X}from"./shopping-cart-B854SoFt.js";import{I as be}from"./label-C5Lc_XnX.js";import{C as ge,a as rr}from"./card-CJsbal2t.js";import{B as ve,c as tr}from"./index-DgM4tFaR.js";import{M as sr}from"./map-pin-CKxKUHQG.js";import{C as or,a as nr}from"./circle-x-CFepb7Dn.js";import{C as we}from"./clock-BCH5fjSM.js";import{S as ar,a as lr,b as ir,c as cr,d as dr}from"./sheet-BIlO1LFd.js";import{S as ur}from"./separator-BZeP2wcf.js";import{u as mr}from"./index-BvB5LvD-.js";import{T as hr}from"./trash-2-CUz2VQT7.js";import{C as fr,L as xr}from"./CustomerProfileModal-BZ9SGLk5.js";import{T as pr}from"./terminal-CiovsXE1.js";import{U as br}from"./user--9S8uSAv.js";import"./supabase-DGFirUEE.js";import"./index-Cn-6WXuf.js";import"./PhoneInput-CYE1kiSN.js";import"./save-CptGD2BG.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=Qe("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),gr=ne({quantity:qe().min(1,"Mínimo 1 item.")}),vr=({product:r,isOpen:t,onClose:s})=>{const{addItem:n}=F(),o=ae({resolver:le(gr),defaultValues:{quantity:1},values:{quantity:1}}),a=o.watch("quantity"),c=m=>{const u=a+m;u>=1&&o.setValue("quantity",u)},d=m=>{r&&(n({product_id:r.id,name:r.name,price:r.price,quantity:m.quantity,image_url:r.image_url}),s(),o.reset({quantity:1}))};if(!r)return null;const l=r.price*a;return e.jsx(ie,{open:t,onOpenChange:s,children:e.jsxs(ce,{className:"sm:max-w-[425px] p-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.image_url||"/placeholder.svg",alt:r.name,className:"w-full h-48 object-cover"}),e.jsxs(de,{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent p-4 flex flex-col justify-end items-start text-left space-y-0",children:[e.jsx(ue,{className:"text-2xl font-bold text-white drop-shadow-md",children:r.name}),e.jsxs(me,{className:"sr-only",children:["Detalhes e opções de personalização para ",r.name,"."]})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r.description}),e.jsx(fe,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(d),className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-y py-3",children:[e.jsx(xe,{className:"text-base font-semibold",children:"Quantidade"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{type:"button",variant:"outline",size:"icon",onClick:()=>c(-1),disabled:a<=1,children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-8 text-center font-bold text-lg",children:a}),e.jsx(j,{type:"button",variant:"outline",size:"icon",onClick:()=>c(1),children:e.jsx(pe,{className:"h-4 w-4"})})]})]}),e.jsxs(he,{className:_("pt-4","sm:justify-between sm:space-x-0"),children:[e.jsxs("div",{className:"text-xl font-bold text-foreground hidden sm:block",children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(l)]}),e.jsxs(j,{type:"submit",className:"w-full sm:w-auto h-12 text-lg",disabled:o.formState.isSubmitting,children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),"Adicionar ao Pedido"]})]})]})})]})]})})},wr=ne({weight_in_grams:Ve.number({invalid_type_error:"Deve ser um número."}).positive("A quantidade deve ser maior que zero.")}),jr=({product:r,isOpen:t,onClose:s})=>{const{addItem:n}=F(),o=ae({resolver:le(wr),defaultValues:{weight_in_grams:void 0}}),a=o.watch("weight_in_grams"),c=i.useMemo(()=>!r||!a||a<=0?0:r.price/1e3*a,[r,a]),d=l=>{r&&(n({product_id:r.id,name:`${r.name} (${l.weight_in_grams}g)`,price:c,quantity:1,image_url:r.image_url,is_price_by_weight:!0}),s(),o.reset({weight_in_grams:void 0}))};return r?e.jsx(ie,{open:t,onOpenChange:s,children:e.jsxs(ce,{className:"sm:max-w-[425px]",children:[e.jsxs(de,{className:"text-center",children:[e.jsx(ue,{className:"text-2xl",children:"Quanto você deseja?"}),e.jsxs(me,{children:[e.jsx("span",{className:"block text-lg font-semibold mt-2",children:r.name}),e.jsxs("span",{className:"block text-muted-foreground",children:[new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.price)," por kg"]})]})]}),e.jsx(fe,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(d),className:"space-y-6 pt-4",children:[e.jsx(Ue,{control:o.control,name:"weight_in_grams",render:({field:l})=>e.jsxs(Xe,{children:[e.jsx(xe,{className:"text-base",children:"Quantidade em gramas"}),e.jsx($e,{children:e.jsx(be,{type:"number",placeholder:"Ex: 500",className:"h-12 text-lg text-center",...l,value:l.value===void 0||l.value===null?"":String(l.value),onChange:m=>{const u=m.target.value;l.onChange(u===""?void 0:parseFloat(u))}})}),e.jsx(Ye,{})]})}),e.jsxs(he,{className:"flex-col-reverse sm:flex-row sm:justify-between sm:space-x-2 w-full",children:[e.jsxs("div",{className:"text-xl font-bold text-foreground text-center sm:text-left mb-4 sm:mb-0",children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c)]}),e.jsxs(j,{type:"submit",className:"w-full sm:w-auto h-12 text-lg",disabled:o.formState.isSubmitting||!o.formState.isValid,children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),"Adicionar"]})]})]})})]})}):null},Q=({src:r,alt:t,placeholder:s="/placeholder.svg",className:n="",...o})=>{const[a,c]=i.useState(!0),[d,l]=i.useState(!1),m=i.useRef(null);return i.useEffect(()=>{if(!r){c(!1);return}const u=new Image;u.src=r,u.onload=()=>{c(!1),l(!1)},u.onerror=()=>{c(!1),l(!0)}},[r]),e.jsxs("div",{className:`relative overflow-hidden ${n}`,children:[a&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 animate-pulse"}),e.jsx("img",{ref:m,src:d?s:r,alt:t,className:`${a?"opacity-0":"opacity-100"} transition-opacity duration-300 w-full h-full object-cover`,...o})]})},Se=i.memo(({id:r,name:t,description:s,price:n,image_url:o,is_price_by_weight:a,is_available:c,onClick:d})=>{const l=c===!1;return e.jsxs(ge,{className:_("overflow-hidden group transition-shadow duration-300 flex flex-col",l?"cursor-not-allowed":"hover:shadow-xl cursor-pointer"),onClick:d,children:[e.jsxs("div",{className:"relative h-32 sm:h-40",children:[" ",e.jsx(Q,{src:o||"/placeholder.svg",alt:t,className:_("w-full h-full object-cover",!l&&"group-hover:scale-105 transition-transform duration-300",l&&"filter grayscale")}),l&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx(ve,{variant:"destructive",className:"text-lg",children:"Indisponível"})})]}),e.jsxs(rr,{className:_("p-3 flex flex-col flex-grow",l&&"opacity-60"),children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-1 truncate",children:t})," ",e.jsxs("p",{className:"text-xs text-muted-foreground mb-2 flex-grow line-clamp-2",children:[" ",s]}),e.jsxs("p",{className:"text-base font-bold text-primary text-right mt-2",children:[" ",a?`${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)} / kg`:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)]})]})]},r)});Se.displayName="ProductCard";function Sr(r,t){const[s,n]=i.useState(r);return i.useEffect(()=>{const o=setTimeout(()=>{n(r)},t);return()=>{clearTimeout(o)}},[r,t]),s}const yr=()=>{const r=new Date,t=String(r.getHours()).padStart(2,"0"),s=String(r.getMinutes()).padStart(2,"0");return`${t}:${s}`},Nr=()=>new Date().getDay(),ye=r=>{const t=Nr(),s=yr(),n=r.find(l=>l.day_of_week===t);if(!n||!n.is_open)return{isOpen:!1,todayHours:"Fechado hoje"};const o=n.open_time,a=n.close_time;if(!o||!a)return{isOpen:!1,todayHours:"Horário não configurado"};const c=s>=o&&s<=a,d=`${o.substring(0,5)} - ${a.substring(0,5)}`;return{isOpen:c,todayHours:d}},Cr=({restaurant:r,hours:t})=>{const{isOpen:s,todayHours:n}=ye(t),o=[r.street,r.number,r.neighborhood,r.city,r.zip_code].filter(Boolean).join(", ");return e.jsxs("div",{className:"space-y-3 text-center",children:[o&&e.jsxs("div",{className:"flex items-center justify-center text-sm text-muted-foreground",children:[e.jsx(sr,{className:"h-4 w-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate max-w-full",children:o})]}),e.jsxs("div",{className:"flex items-center justify-center text-sm font-medium",children:[e.jsxs("div",{className:_("flex items-center gap-1 px-3 py-1 rounded-full",s?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"),children:[s?e.jsx(or,{className:"h-4 w-4"}):e.jsx(nr,{className:"h-4 w-4"}),e.jsx("span",{children:s?"Aberto Agora":"Fechado"})]}),e.jsxs("div",{className:"ml-4 flex items-center text-muted-foreground",children:[e.jsx(we,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:n})]})]})]})},_r=()=>e.jsxs(te,{variant:"destructive",className:"mb-8",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(se,{className:"font-bold",children:"Loja Fechada no Momento"}),e.jsx(oe,{children:"Não é possível adicionar itens ao carrinho ou fazer pedidos fora do nosso horário de funcionamento."})]}),Pr=({onClick:r})=>{const{totalItems:t,subtotal:s}=F();return t===0?null:e.jsxs(Ge,{children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(j,{size:"lg",className:"relative h-14 w-14 rounded-full shadow-lg",onClick:r,children:[e.jsx(X,{className:"h-6 w-6"}),e.jsx(ve,{variant:"destructive",className:"absolute -top-1 -right-1 px-2 py-1 text-xs rounded-full",children:t})]})}),e.jsxs(Je,{children:[e.jsxs("p",{children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Clique para ver seu carrinho"})]})]})};function Rr(r,t){return i.useReducer((s,n)=>t[s][n]??s,r)}var G="ScrollArea",[Ne,wt]=Ze(G),[Er,S]=Ne(G),Ce=i.forwardRef((r,t)=>{const{__scopeScrollArea:s,type:n="hover",dir:o,scrollHideDelay:a=600,...c}=r,[d,l]=i.useState(null),[m,u]=i.useState(null),[f,h]=i.useState(null),[p,v]=i.useState(null),[P,z]=i.useState(null),[w,D]=i.useState(0),[k,N]=i.useState(0),[R,E]=i.useState(!1),[I,y]=i.useState(!1),g=M(t,b=>l(b)),x=mr(o);return e.jsx(Er,{scope:s,type:n,dir:x,scrollHideDelay:a,scrollArea:d,viewport:m,onViewportChange:u,content:f,onContentChange:h,scrollbarX:p,onScrollbarXChange:v,scrollbarXEnabled:R,onScrollbarXEnabledChange:E,scrollbarY:P,onScrollbarYChange:z,scrollbarYEnabled:I,onScrollbarYEnabledChange:y,onCornerWidthChange:D,onCornerHeightChange:N,children:e.jsx(H.div,{dir:x,...c,ref:g,style:{position:"relative","--radix-scroll-area-corner-width":w+"px","--radix-scroll-area-corner-height":k+"px",...r.style}})})});Ce.displayName=G;var _e="ScrollAreaViewport",Pe=i.forwardRef((r,t)=>{const{__scopeScrollArea:s,children:n,nonce:o,...a}=r,c=S(_e,s),d=i.useRef(null),l=M(t,d,c.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),e.jsx(H.div,{"data-radix-scroll-area-viewport":"",...a,ref:l,style:{overflowX:c.scrollbarXEnabled?"scroll":"hidden",overflowY:c.scrollbarYEnabled?"scroll":"hidden",...r.style},children:e.jsx("div",{ref:c.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});Pe.displayName=_e;var C="ScrollAreaScrollbar",K=i.forwardRef((r,t)=>{const{forceMount:s,...n}=r,o=S(C,r.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:c}=o,d=r.orientation==="horizontal";return i.useEffect(()=>(d?a(!0):c(!0),()=>{d?a(!1):c(!1)}),[d,a,c]),o.type==="hover"?e.jsx(Tr,{...n,ref:t,forceMount:s}):o.type==="scroll"?e.jsx(Ar,{...n,ref:t,forceMount:s}):o.type==="auto"?e.jsx(Re,{...n,ref:t,forceMount:s}):o.type==="always"?e.jsx(J,{...n,ref:t}):null});K.displayName=C;var Tr=i.forwardRef((r,t)=>{const{forceMount:s,...n}=r,o=S(C,r.__scopeScrollArea),[a,c]=i.useState(!1);return i.useEffect(()=>{const d=o.scrollArea;let l=0;if(d){const m=()=>{window.clearTimeout(l),c(!0)},u=()=>{l=window.setTimeout(()=>c(!1),o.scrollHideDelay)};return d.addEventListener("pointerenter",m),d.addEventListener("pointerleave",u),()=>{window.clearTimeout(l),d.removeEventListener("pointerenter",m),d.removeEventListener("pointerleave",u)}}},[o.scrollArea,o.scrollHideDelay]),e.jsx(U,{present:s||a,children:e.jsx(Re,{"data-state":a?"visible":"hidden",...n,ref:t})})}),Ar=i.forwardRef((r,t)=>{const{forceMount:s,...n}=r,o=S(C,r.__scopeScrollArea),a=r.orientation==="horizontal",c=Y(()=>l("SCROLL_END"),100),[d,l]=Rr("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return i.useEffect(()=>{if(d==="idle"){const m=window.setTimeout(()=>l("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(m)}},[d,o.scrollHideDelay,l]),i.useEffect(()=>{const m=o.viewport,u=a?"scrollLeft":"scrollTop";if(m){let f=m[u];const h=()=>{const p=m[u];f!==p&&(l("SCROLL"),c()),f=p};return m.addEventListener("scroll",h),()=>m.removeEventListener("scroll",h)}},[o.viewport,a,l,c]),e.jsx(U,{present:s||d!=="hidden",children:e.jsx(J,{"data-state":d==="hidden"?"hidden":"visible",...n,ref:t,onPointerEnter:L(r.onPointerEnter,()=>l("POINTER_ENTER")),onPointerLeave:L(r.onPointerLeave,()=>l("POINTER_LEAVE"))})})}),Re=i.forwardRef((r,t)=>{const s=S(C,r.__scopeScrollArea),{forceMount:n,...o}=r,[a,c]=i.useState(!1),d=r.orientation==="horizontal",l=Y(()=>{if(s.viewport){const m=s.viewport.offsetWidth<s.viewport.scrollWidth,u=s.viewport.offsetHeight<s.viewport.scrollHeight;c(d?m:u)}},10);return O(s.viewport,l),O(s.content,l),e.jsx(U,{present:n||a,children:e.jsx(J,{"data-state":a?"visible":"hidden",...o,ref:t})})}),J=i.forwardRef((r,t)=>{const{orientation:s="vertical",...n}=r,o=S(C,r.__scopeScrollArea),a=i.useRef(null),c=i.useRef(0),[d,l]=i.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),m=De(d.viewport,d.content),u={...n,sizes:d,onSizesChange:l,hasThumb:m>0&&m<1,onThumbChange:h=>a.current=h,onThumbPointerUp:()=>c.current=0,onThumbPointerDown:h=>c.current=h};function f(h,p){return Mr(h,c.current,d,p)}return s==="horizontal"?e.jsx(Lr,{...u,ref:t,onThumbPositionChange:()=>{if(o.viewport&&a.current){const h=o.viewport.scrollLeft,p=re(h,d,o.dir);a.current.style.transform=`translate3d(${p}px, 0, 0)`}},onWheelScroll:h=>{o.viewport&&(o.viewport.scrollLeft=h)},onDragScroll:h=>{o.viewport&&(o.viewport.scrollLeft=f(h,o.dir))}}):s==="vertical"?e.jsx(Dr,{...u,ref:t,onThumbPositionChange:()=>{if(o.viewport&&a.current){const h=o.viewport.scrollTop,p=re(h,d);a.current.style.transform=`translate3d(0, ${p}px, 0)`}},onWheelScroll:h=>{o.viewport&&(o.viewport.scrollTop=h)},onDragScroll:h=>{o.viewport&&(o.viewport.scrollTop=f(h))}}):null}),Lr=i.forwardRef((r,t)=>{const{sizes:s,onSizesChange:n,...o}=r,a=S(C,r.__scopeScrollArea),[c,d]=i.useState(),l=i.useRef(null),m=M(t,l,a.onScrollbarXChange);return i.useEffect(()=>{l.current&&d(getComputedStyle(l.current))},[l]),e.jsx(Te,{"data-orientation":"horizontal",...o,ref:m,sizes:s,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":$(s)+"px",...r.style},onThumbPointerDown:u=>r.onThumbPointerDown(u.x),onDragScroll:u=>r.onDragScroll(u.x),onWheelScroll:(u,f)=>{if(a.viewport){const h=a.viewport.scrollLeft+u.deltaX;r.onWheelScroll(h),Ie(h,f)&&u.preventDefault()}},onResize:()=>{l.current&&a.viewport&&c&&n({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:l.current.clientWidth,paddingStart:V(c.paddingLeft),paddingEnd:V(c.paddingRight)}})}})}),Dr=i.forwardRef((r,t)=>{const{sizes:s,onSizesChange:n,...o}=r,a=S(C,r.__scopeScrollArea),[c,d]=i.useState(),l=i.useRef(null),m=M(t,l,a.onScrollbarYChange);return i.useEffect(()=>{l.current&&d(getComputedStyle(l.current))},[l]),e.jsx(Te,{"data-orientation":"vertical",...o,ref:m,sizes:s,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":$(s)+"px",...r.style},onThumbPointerDown:u=>r.onThumbPointerDown(u.y),onDragScroll:u=>r.onDragScroll(u.y),onWheelScroll:(u,f)=>{if(a.viewport){const h=a.viewport.scrollTop+u.deltaY;r.onWheelScroll(h),Ie(h,f)&&u.preventDefault()}},onResize:()=>{l.current&&a.viewport&&c&&n({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:l.current.clientHeight,paddingStart:V(c.paddingTop),paddingEnd:V(c.paddingBottom)}})}})}),[kr,Ee]=Ne(C),Te=i.forwardRef((r,t)=>{const{__scopeScrollArea:s,sizes:n,hasThumb:o,onThumbChange:a,onThumbPointerUp:c,onThumbPointerDown:d,onThumbPositionChange:l,onDragScroll:m,onWheelScroll:u,onResize:f,...h}=r,p=S(C,s),[v,P]=i.useState(null),z=M(t,g=>P(g)),w=i.useRef(null),D=i.useRef(""),k=p.viewport,N=n.content-n.viewport,R=T(u),E=T(l),I=Y(f,10);function y(g){if(w.current){const x=g.clientX-w.current.left,b=g.clientY-w.current.top;m({x,y:b})}}return i.useEffect(()=>{const g=x=>{const b=x.target;(v==null?void 0:v.contains(b))&&R(x,N)};return document.addEventListener("wheel",g,{passive:!1}),()=>document.removeEventListener("wheel",g,{passive:!1})},[k,v,N,R]),i.useEffect(E,[n,E]),O(v,I),O(p.content,I),e.jsx(kr,{scope:s,scrollbar:v,hasThumb:o,onThumbChange:T(a),onThumbPointerUp:T(c),onThumbPositionChange:E,onThumbPointerDown:T(d),children:e.jsx(H.div,{...h,ref:z,style:{position:"absolute",...h.style},onPointerDown:L(r.onPointerDown,g=>{g.button===0&&(g.target.setPointerCapture(g.pointerId),w.current=v.getBoundingClientRect(),D.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),y(g))}),onPointerMove:L(r.onPointerMove,y),onPointerUp:L(r.onPointerUp,g=>{const x=g.target;x.hasPointerCapture(g.pointerId)&&x.releasePointerCapture(g.pointerId),document.body.style.webkitUserSelect=D.current,p.viewport&&(p.viewport.style.scrollBehavior=""),w.current=null})})})}),q="ScrollAreaThumb",Ae=i.forwardRef((r,t)=>{const{forceMount:s,...n}=r,o=Ee(q,r.__scopeScrollArea);return e.jsx(U,{present:s||o.hasThumb,children:e.jsx(Ir,{ref:t,...n})})}),Ir=i.forwardRef((r,t)=>{const{__scopeScrollArea:s,style:n,...o}=r,a=S(q,s),c=Ee(q,s),{onThumbPositionChange:d}=c,l=M(t,f=>c.onThumbChange(f)),m=i.useRef(void 0),u=Y(()=>{m.current&&(m.current(),m.current=void 0)},100);return i.useEffect(()=>{const f=a.viewport;if(f){const h=()=>{if(u(),!m.current){const p=zr(f,d);m.current=p,d()}};return d(),f.addEventListener("scroll",h),()=>f.removeEventListener("scroll",h)}},[a.viewport,u,d]),e.jsx(H.div,{"data-state":c.hasThumb?"visible":"hidden",...o,ref:l,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:L(r.onPointerDownCapture,f=>{const p=f.target.getBoundingClientRect(),v=f.clientX-p.left,P=f.clientY-p.top;c.onThumbPointerDown({x:v,y:P})}),onPointerUp:L(r.onPointerUp,c.onThumbPointerUp)})});Ae.displayName=q;var Z="ScrollAreaCorner",Le=i.forwardRef((r,t)=>{const s=S(Z,r.__scopeScrollArea),n=!!(s.scrollbarX&&s.scrollbarY);return s.type!=="scroll"&&n?e.jsx(Or,{...r,ref:t}):null});Le.displayName=Z;var Or=i.forwardRef((r,t)=>{const{__scopeScrollArea:s,...n}=r,o=S(Z,s),[a,c]=i.useState(0),[d,l]=i.useState(0),m=!!(a&&d);return O(o.scrollbarX,()=>{var f;const u=((f=o.scrollbarX)==null?void 0:f.offsetHeight)||0;o.onCornerHeightChange(u),l(u)}),O(o.scrollbarY,()=>{var f;const u=((f=o.scrollbarY)==null?void 0:f.offsetWidth)||0;o.onCornerWidthChange(u),c(u)}),m?e.jsx(H.div,{...n,ref:t,style:{width:a,height:d,position:"absolute",right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:0,...r.style}}):null});function V(r){return r?parseInt(r,10):0}function De(r,t){const s=r/t;return isNaN(s)?0:s}function $(r){const t=De(r.viewport,r.content),s=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,n=(r.scrollbar.size-s)*t;return Math.max(n,18)}function Mr(r,t,s,n="ltr"){const o=$(s),a=o/2,c=t||a,d=o-c,l=s.scrollbar.paddingStart+c,m=s.scrollbar.size-s.scrollbar.paddingEnd-d,u=s.content-s.viewport,f=n==="ltr"?[0,u]:[u*-1,0];return ke([l,m],f)(r)}function re(r,t,s="ltr"){const n=$(t),o=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=t.scrollbar.size-o,c=t.content-t.viewport,d=a-n,l=s==="ltr"?[0,c]:[c*-1,0],m=tr(r,l);return ke([0,c],[0,d])(m)}function ke(r,t){return s=>{if(r[0]===r[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(r[1]-r[0]);return t[0]+n*(s-r[0])}}function Ie(r,t){return r>0&&r<t}var zr=(r,t=()=>{})=>{let s={left:r.scrollLeft,top:r.scrollTop},n=0;return function o(){const a={left:r.scrollLeft,top:r.scrollTop},c=s.left!==a.left,d=s.top!==a.top;(c||d)&&t(),s=a,n=window.requestAnimationFrame(o)}(),()=>window.cancelAnimationFrame(n)};function Y(r,t){const s=T(r),n=i.useRef(0);return i.useEffect(()=>()=>window.clearTimeout(n.current),[]),i.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(s,t)},[s,t])}function O(r,t){const s=T(t);er(()=>{let n=0;if(r){const o=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(s)});return o.observe(r),()=>{window.cancelAnimationFrame(n),o.unobserve(r)}}},[r,s])}var Oe=Ce,Br=Pe,Fr=Le;const Me=i.forwardRef(({className:r,children:t,...s},n)=>e.jsxs(Oe,{ref:n,className:_("relative overflow-hidden",r),...s,children:[e.jsx(Br,{className:"h-full w-full rounded-[inherit]",children:t}),e.jsx(ze,{}),e.jsx(Fr,{})]}));Me.displayName=Oe.displayName;const ze=i.forwardRef(({className:r,orientation:t="vertical",...s},n)=>e.jsx(K,{ref:n,orientation:t,className:_("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...s,children:e.jsx(Ae,{className:"relative flex-1 rounded-full bg-border"})}));ze.displayName=K.displayName;const Hr=({item:r})=>{const{updateQuantity:t,removeItem:s}=F();return e.jsxs("div",{className:"flex items-center gap-4 py-3",children:[e.jsx(Q,{src:r.image_url||"/placeholder.svg",alt:r.name,className:"w-16 h-16 rounded-md object-cover"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-semibold leading-tight",children:r.name}),e.jsx("p",{className:"text-sm text-primary font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.price)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!r.is_price_by_weight&&e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>t(r.id,r.quantity-1),children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-6 text-center font-bold",children:r.quantity}),e.jsx(j,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>t(r.id,r.quantity+1),children:e.jsx(pe,{className:"h-4 w-4"})})]}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive hover:text-destructive",onClick:()=>s(r.id),children:e.jsx(hr,{className:"h-4 w-4"})})]})]})},Wr=({isOpen:r,onOpenChange:t})=>{const s=We(),{items:n,subtotal:o,total:a,clearCart:c}=F(),d=()=>{t(!1),s("/pre-checkout")};return e.jsx(ar,{open:r,onOpenChange:t,children:e.jsxs(lr,{className:"flex flex-col",children:[e.jsxs(ir,{children:[e.jsx(cr,{className:"text-2xl",children:"Seu Carrinho"}),e.jsx(dr,{className:"sr-only",children:"Lista de itens no seu carrinho e resumo do pedido."})]}),e.jsx(ur,{}),n.length===0?e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-center",children:[e.jsx(X,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Seu carrinho está vazio"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Adicione produtos do cardápio para começar."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"flex-grow -mx-6 px-6",children:e.jsx("div",{className:"divide-y",children:n.map(l=>e.jsx(Hr,{item:l},l.id))})}),e.jsxs("div",{className:"border-t pt-4 mt-4 space-y-4",children:[e.jsxs("div",{className:"w-full space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-base",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal:"}),e.jsx("span",{className:"font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a)})]})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(j,{variant:"outline",onClick:c,className:"flex-1",children:"Limpar Carrinho"}),e.jsx(j,{className:"w-full flex-1",onClick:d,children:"Finalizar Pedido"})]})]})]})]})})},qr=async()=>{const{data:r,error:t}=await A.from("restaurants").select("*").eq("is_active",!0).limit(1).single();if(t)throw new Error(`Erro ao buscar restaurante: ${t.message}`);if(!r)throw new Error("Nenhum restaurante ativo encontrado.");const s=r.id,[n,o,a]=await Promise.all([A.from("categories").select("*").eq("restaurant_id",s).eq("is_active",!0).order("display_order",{ascending:!0}),A.from("products").select("*").eq("restaurant_id",s),A.from("business_hours").select("*").eq("restaurant_id",s)]);if(n.error)throw new Error(`Erro ao buscar categorias: ${n.error.message}`);if(o.error)throw new Error(`Erro ao buscar produtos: ${o.error.message}`);if(a.error)throw new Error(`Erro ao buscar horários: ${a.error.message}`);const c=(n.data||[]).map(d=>({...d,products:(o.data||[]).filter(l=>l.category_id===d.id)})).filter(d=>d.products.length>0);return{restaurant:r,menu:c,hours:a.data}},Vr=async()=>{const{data:{user:r}}=await A.auth.getUser();if(!r)return null;const{data:t,error:s}=await A.from("customers").select("*").eq("user_id",r.id).limit(1).single();if(s&&s.code!=="PGRST116")return console.warn("Erro ao buscar dados do cliente (pode ser normal se o cliente for novo):",s.message),null;if(t)return t;const n=r.user_metadata;return{id:r.id,user_id:r.id,name:n.full_name||"",phone:n.phone||"",email:r.email||"",address:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),latitude:null,longitude:null,cpf_cnpj:null}},jt=()=>{const r=He(),{data:t,isLoading:s,isError:n,error:o}=ee({queryKey:["menuData"],queryFn:qr,staleTime:1e3*60*5,gcTime:1e3*60*10}),{data:a,isLoading:c}=ee({queryKey:["menuCustomerData"],queryFn:Vr,staleTime:0}),[d,l]=i.useState(null),[m,u]=i.useState(!1),[f,h]=i.useState(!1),[p,v]=i.useState(!1),[P,z]=i.useState(""),w=Sr(P,300),[D,k]=i.useState(!1),{isOpen:N}=i.useMemo(()=>t!=null&&t.hours?ye(t.hours):{isOpen:!1,todayHours:"Carregando..."},[t==null?void 0:t.hours]),R=i.useMemo(()=>t!=null&&t.menu?w?t.menu.map(x=>({...x,products:x.products.filter(b=>b.name.toLowerCase().includes(w.toLowerCase())||b.description&&b.description.toLowerCase().includes(w.toLowerCase()))})).filter(x=>x.products.length>0):t.menu:[],[t==null?void 0:t.menu,w]),E=i.useCallback(x=>{if(!N){W.error("A loja está fechada.",{description:"Não é possível adicionar itens ao carrinho no momento."});return}if(!x.is_available){W.info("Produto indisponível",{description:"Este item não está disponível no momento."});return}l(x),x.is_price_by_weight?h(!0):u(!0)},[N]),I=async()=>{const{error:x}=await A.auth.signOut();if(x)W.error("Erro ao sair.",{description:x.message});else{W.success("Você saiu da sua conta."),r.invalidateQueries({queryKey:["menuCustomerData"]});const b=`${window.location.origin}${window.location.pathname}#/auth`;window.location.href=b}};if(s)return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-5xl",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx(B,{className:"h-24 w-24 rounded-full mx-auto mb-4"}),e.jsx(B,{className:"h-10 w-1/2 mx-auto mb-2"}),e.jsx(B,{className:"h-6 w-3/4 mx-auto"})]}),e.jsx("div",{className:"space-y-10",children:[...Array(3)].map((x,b)=>e.jsxs("div",{children:[e.jsx(B,{className:"h-9 w-1/3 mb-6"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(3)].map((Be,Fe)=>e.jsx(ge,{className:"p-4",children:e.jsx(B,{className:"h-48 w-full"})},Fe))})]},b))})]});if(n)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs(te,{variant:"destructive",children:[e.jsx(pr,{className:"h-4 w-4"}),e.jsx(se,{children:"Erro ao carregar o cardápio"}),e.jsx(oe,{children:o instanceof Error?o.message:"Ocorreu um erro desconhecido."})]})});const{restaurant:y,hours:g}=t;return e.jsxs(e.Fragment,{children:[e.jsx(vr,{product:d,isOpen:m,onClose:()=>u(!1)}),e.jsx(jr,{product:d,isOpen:f,onClose:()=>h(!1)}),e.jsx(Wr,{isOpen:p,onOpenChange:v}),e.jsx(fr,{isOpen:D,onClose:()=>k(!1),customer:a}),e.jsxs("div",{className:_("container mx-auto px-4 py-8 max-w-5xl"),children:[e.jsxs("header",{className:"text-center mb-8 relative",children:[y.logo_url&&e.jsx("div",{className:"w-20 h-20 mx-auto rounded-full mb-4 overflow-hidden border-4 border-card shadow-lg",children:e.jsx(Q,{src:y.logo_url,alt:y.name,className:"w-full h-full object-cover"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight mb-2",children:y.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:y.description}),e.jsx(Cr,{restaurant:y,hours:g})]}),!N&&e.jsx(_r,{}),e.jsx("div",{className:"mb-8 sticky top-0 z-30 bg-background pt-4 -mt-4",children:e.jsx(be,{type:"text",placeholder:"Buscar produtos...",className:"w-full p-3 h-10 text-base",value:P,onChange:x=>z(x.target.value)})}),e.jsx("main",{className:_(!N&&"opacity-50 pointer-events-none"),children:R.length===0?e.jsx("div",{className:"text-center py-16",children:e.jsx("p",{className:"text-muted-foreground text-lg",children:w?"Nenhum produto encontrado.":"Nenhum item no cardápio no momento."})}):e.jsx("div",{className:"space-y-10",children:R.map(x=>e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold border-b-2 border-primary pb-2 mb-6",children:x.name}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:x.products.map(b=>e.jsx(Se,{id:b.id,name:b.name,description:b.description,price:b.price,image_url:b.image_url,is_price_by_weight:b.is_price_by_weight,is_available:b.is_available,onClick:()=>E(b)},b.id))})]},x.id))})})]}),a&&e.jsxs("div",{className:"fixed top-4 left-4 z-50 flex gap-2",children:[e.jsx(j,{variant:"outline",size:"icon",onClick:()=>k(!0),"aria-label":"Editar Perfil",className:"h-14 w-14 rounded-full shadow-lg bg-card",children:e.jsx(br,{className:"h-6 w-6"})}),e.jsx(j,{variant:"destructive",size:"icon",onClick:I,"aria-label":"Sair da Conta",className:"h-14 w-14 rounded-full shadow-lg bg-destructive hover:bg-destructive/90 text-white",children:e.jsx(xr,{className:"h-6 w-6"})})]}),N&&e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsx(Pr,{onClick:()=>v(!0)})})]})};export{jt as default};
