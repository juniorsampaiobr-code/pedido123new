import{b as O,u as F,c as A,j as e}from"./tanstack-DXzASLyu.js";import{s as f}from"./client-lAKPhnc8.js";import{B as g}from"./button-DP4ALDeA.js";import{C as P,b as re,a as $,c as fe}from"./card-C-CnIMNv.js";import{S as te,a as ne,b as oe,c as le,d as ce,T as ve,e as ye,f as ae,g as ie}from"./select-DqCYTfPg.js";import{S as I}from"./switch-b2H8BWSL.js";import{D as L,a as z,b as U,c as R,d as K,e as B,g as V,B as T}from"./index-rPgJERu9.js";import{S as w}from"./skeleton-B0AKWOGq.js";import{A as de,a as me,b as he}from"./alert-De_8ugH3.js";import{c as Q,u as k,b as be}from"./index-DXHl_ahK.js";import{r as S}from"./vendor-YgypLURK.js";import{o as W,s as E,p as xe,c as G,l as ue,i as je,b as D,u as H,t as J}from"./types-CUwlEUMq.js";import{F as X,b as x,c as u,a as p,d as j,e as b}from"./form-CEsID2yz.js";import{I as q}from"./label-DXwFgiHT.js";import{T as Y}from"./textarea-DuayklBH.js";import{P as Z,T as ee}from"./trash-2-CThyG1KH.js";import{U as pe}from"./upload-CcJzcbqx.js";import{T as ge}from"./terminal-CQzCYpR2.js";import"./supabase-Bm28tI2t.js";import"./index-x5CuAdtz.js";import"./index-DvUVZ62n.js";import"./index-DWN4L6UK.js";import"./index-CUvv1sQ9.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=Q("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=Q("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=Q("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Ne=W({name:E().min(1,"O nome é obrigatório."),description:E().optional(),price:xe(a=>String(a).replace(",","."),G.number({invalid_type_error:"O preço deve ser um número."}).positive("O preço deve ser maior que zero.")),category_id:E().optional(),image_url:E().url("URL inválida.").optional().or(ue("")),image_file:je(File).optional(),is_price_by_weight:D().default(!1),is_available:D().default(!0)}).refine(a=>a.image_url||a.image_file,{message:"É necessário enviar uma imagem ou uma URL.",path:["image_file"]}),Ce=async a=>{const{data:l,error:t}=await f.from("categories").select("id, name").eq("restaurant_id",a).eq("is_active",!0);if(t)throw new Error(t.message);return l},Ee=({isOpen:a,onClose:l})=>{const t=O(),[d,v]=S.useState(null);F({queryKey:["restaurantId"],queryFn:async()=>{const{data:i,error:s}=await f.from("restaurants").select("id").limit(1).single();if(s)throw new Error(s.message);return v(i.id),i.id},enabled:a});const{data:m,isLoading:c}=F({queryKey:["categories",d],queryFn:()=>Ce(d),enabled:!!d}),o=H({resolver:J(Ne),defaultValues:{name:"",description:"",price:0,is_price_by_weight:!1,is_available:!0,image_url:""}}),r=A({mutationFn:async i=>{if(!d)throw new Error("ID do restaurante não encontrado.");let s=i.image_url;if(i.image_file){const _=i.image_file,C=`${d}/${Date.now()}-${_.name}`,{error:n}=await f.storage.from("products").upload(C,_);if(n)throw new Error(`Erro no upload da imagem: ${n.message}`);const{data:N}=f.storage.from("products").getPublicUrl(C);s=N.publicUrl}const{error:h}=await f.from("products").insert({restaurant_id:d,name:i.name,description:i.description,price:i.price,category_id:i.category_id,image_url:s,is_price_by_weight:i.is_price_by_weight,is_available:i.is_available});if(h)throw new Error(h.message)},onSuccess:()=>{k.success("Produto criado com sucesso!"),t.invalidateQueries({queryKey:["products"]}),l(),o.reset()},onError:i=>{k.error(`Erro ao criar produto: ${i.message}`)}}),y=i=>{r.mutate(i)};return e.jsx(L,{open:a,onOpenChange:l,children:e.jsxs(z,{className:"sm:max-w-lg",children:[e.jsxs(U,{children:[e.jsx(R,{children:"Novo Produto"}),e.jsx(K,{children:"Adicione um novo item ao seu cardápio."})]}),e.jsx(X,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(y),children:[e.jsxs("div",{className:"space-y-4 py-2 pb-4 max-h-[70vh] overflow-y-auto pr-4",children:[e.jsx(x,{control:o.control,name:"name",render:({field:i})=>e.jsxs(u,{children:[e.jsx(p,{children:"Nome *"}),e.jsx(j,{children:e.jsx(q,{placeholder:"Nome do produto",...i})}),e.jsx(b,{})]})}),e.jsx(x,{control:o.control,name:"description",render:({field:i})=>e.jsxs(u,{children:[e.jsx(p,{children:"Descrição"}),e.jsx(j,{children:e.jsx(Y,{placeholder:"Ingredientes, detalhes, etc.",...i})}),e.jsx(b,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(x,{control:o.control,name:"price",render:({field:i})=>e.jsxs(u,{children:[e.jsx(p,{children:"Preço (R$) unitário *"}),e.jsx(j,{children:e.jsx(q,{type:"text",placeholder:"0,00",...i})}),e.jsx(b,{})]})}),e.jsx(x,{control:o.control,name:"category_id",render:({field:i})=>e.jsxs(u,{children:[e.jsx(p,{children:"Categoria"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{onValueChange:i.onChange,defaultValue:i.value,disabled:c,children:[e.jsx(j,{children:e.jsx(ne,{children:e.jsx(oe,{placeholder:"Selecione uma categoria"})})}),e.jsx(le,{children:m==null?void 0:m.map(s=>e.jsx(ce,{value:s.id,children:s.name},s.id))})]}),e.jsx(g,{type:"button",variant:"outline",size:"icon",onClick:()=>k.info("Função para adicionar categoria em breve."),children:e.jsx(Z,{className:"h-4 w-4"})})]}),e.jsx(b,{})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Imagem do Produto"}),e.jsx(x,{control:o.control,name:"image_file",render:({field:i})=>{var s;return e.jsxs(u,{children:[e.jsx(j,{children:e.jsxs("label",{className:"flex items-center justify-center w-full h-12 px-4 border-2 border-dashed rounded-md cursor-pointer hover:bg-muted",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:((s=i.value)==null?void 0:s.name)||"Escolher Imagem"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:h=>{var _;return i.onChange((_=h.target.files)==null?void 0:_[0])}})]})}),e.jsx(b,{})]})}}),e.jsx(x,{control:o.control,name:"image_url",render:({field:i})=>e.jsxs(u,{children:[e.jsx(j,{children:e.jsx(q,{placeholder:"Ou cole a URL da imagem",...i})}),e.jsx(b,{})]})})]}),e.jsx(x,{control:o.control,name:"is_price_by_weight",render:({field:i})=>e.jsxs(u,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(p,{children:"Produto pesável (preço por kg)"}),e.jsx(j,{children:e.jsx(I,{checked:i.value,onCheckedChange:i.onChange})})]})}),e.jsx(x,{control:o.control,name:"is_available",render:({field:i})=>e.jsxs(u,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(p,{children:"Produto disponível"}),e.jsx(j,{children:e.jsx(I,{checked:i.value,onCheckedChange:i.onChange})})]})})]}),e.jsxs(B,{className:"pt-4 border-t",children:[e.jsx(V,{asChild:!0,children:e.jsx(g,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(g,{type:"submit",disabled:r.isPending,children:r.isPending?"Criando...":"Criar Produto"})]})]})})]})})},Se=W({name:E().min(1,"O nome é obrigatório."),description:E().optional(),price:xe(a=>String(a).replace(",","."),G.number({invalid_type_error:"O preço deve ser um número."}).positive("O preço deve ser maior que zero.")),category_id:E().optional(),image_url:E().url("URL inválida.").optional().or(ue("")),image_file:je(File).optional(),is_price_by_weight:D().default(!1),is_available:D().default(!0)}),ke=async a=>{const{data:l,error:t}=await f.from("categories").select("id, name").eq("restaurant_id",a).eq("is_active",!0);if(t)throw new Error(t.message);return l},qe=({isOpen:a,onClose:l,product:t})=>{const d=O(),[v,m]=S.useState(null);F({queryKey:["restaurantId"],queryFn:async()=>{const{data:s,error:h}=await f.from("restaurants").select("id").limit(1).single();if(h)throw new Error(h.message);return m(s.id),s.id},enabled:a});const{data:c,isLoading:o}=F({queryKey:["categories",v],queryFn:()=>ke(v),enabled:!!v}),r=H({resolver:J(Se)});S.useEffect(()=>{t&&r.reset({name:t.name,description:t.description||"",price:t.price,category_id:t.category_id||void 0,image_url:t.image_url||"",is_price_by_weight:t.is_price_by_weight||!1,is_available:t.is_available??!0,image_file:void 0})},[t,r,a]);const y=A({mutationFn:async s=>{if(!(t!=null&&t.id)||!v)throw new Error("ID do produto ou restaurante não encontrado.");let h=t.image_url;if(s.image_file){const C=s.image_file,n=`${v}/${Date.now()}-${C.name}`,{error:N}=await f.storage.from("products").upload(n,C);if(N)throw new Error(`Erro no upload da imagem: ${N.message}`);const{data:M}=f.storage.from("products").getPublicUrl(n);h=M.publicUrl}else h=s.image_url||null;const{error:_}=await f.from("products").update({name:s.name,description:s.description,price:s.price,category_id:s.category_id,image_url:h,is_price_by_weight:s.is_price_by_weight,is_available:s.is_available}).eq("id",t.id);if(_)throw _},onSuccess:()=>{k.success("Produto atualizado com sucesso!"),d.invalidateQueries({queryKey:["products"]}),l()},onError:s=>{k.error(`Erro ao atualizar produto: ${s.message}`)}}),i=s=>{y.mutate(s)};return e.jsx(L,{open:a,onOpenChange:l,children:e.jsxs(z,{className:"sm:max-w-lg",children:[e.jsxs(U,{children:[e.jsx(R,{children:"Editar Produto"}),e.jsx(K,{children:"Atualize as informações do item do seu cardápio."})]}),e.jsx(X,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(i),children:[e.jsxs("div",{className:"space-y-4 py-2 pb-4 max-h-[70vh] overflow-y-auto pr-4",children:[e.jsx(x,{control:r.control,name:"name",render:({field:s})=>e.jsxs(u,{children:[e.jsx(p,{children:"Nome *"}),e.jsx(j,{children:e.jsx(q,{...s})}),e.jsx(b,{})]})}),e.jsx(x,{control:r.control,name:"description",render:({field:s})=>e.jsxs(u,{children:[e.jsx(p,{children:"Descrição"}),e.jsx(j,{children:e.jsx(Y,{...s})}),e.jsx(b,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(x,{control:r.control,name:"price",render:({field:s})=>e.jsxs(u,{children:[e.jsx(p,{children:"Preço (R$) *"}),e.jsx(j,{children:e.jsx(q,{type:"text",...s})}),e.jsx(b,{})]})}),e.jsx(x,{control:r.control,name:"category_id",render:({field:s})=>e.jsxs(u,{children:[e.jsx(p,{children:"Categoria"}),e.jsxs(te,{onValueChange:s.onChange,value:s.value,disabled:o,children:[e.jsx(j,{children:e.jsx(ne,{children:e.jsx(oe,{placeholder:"Selecione uma categoria"})})}),e.jsx(le,{children:c==null?void 0:c.map(h=>e.jsx(ce,{value:h.id,children:h.name},h.id))})]}),e.jsx(b,{})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Imagem do Produto"}),e.jsx(x,{control:r.control,name:"image_file",render:({field:s})=>{var h;return e.jsxs(u,{children:[e.jsx(j,{children:e.jsxs("label",{className:"flex items-center justify-center w-full h-12 px-4 border-2 border-dashed rounded-md cursor-pointer hover:bg-muted",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:((h=s.value)==null?void 0:h.name)||"Escolher Nova Imagem"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:_=>{var C;return s.onChange((C=_.target.files)==null?void 0:C[0])}})]})}),e.jsx(b,{})]})}}),e.jsx(x,{control:r.control,name:"image_url",render:({field:s})=>e.jsxs(u,{children:[e.jsx(j,{children:e.jsx(q,{placeholder:"Ou cole a URL da imagem",...s})}),e.jsx(b,{})]})})]}),e.jsx(x,{control:r.control,name:"is_price_by_weight",render:({field:s})=>e.jsxs(u,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(p,{children:"Produto pesável (preço por kg)"}),e.jsx(j,{children:e.jsx(I,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(x,{control:r.control,name:"is_available",render:({field:s})=>e.jsxs(u,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(p,{children:"Produto disponível"}),e.jsx(j,{children:e.jsx(I,{checked:s.value,onCheckedChange:s.onChange})})]})})]}),e.jsxs(B,{className:"pt-4 border-t",children:[e.jsx(V,{asChild:!0,children:e.jsx(g,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(g,{type:"submit",disabled:y.isPending,children:y.isPending?"Salvando...":"Salvar Alterações"})]})]})})]})})},Fe=W({name:E().min(1,"O nome é obrigatório."),description:E().optional(),display_order:G.number().default(0),is_active:D().default(!0)}),Ie=({isOpen:a,onClose:l})=>{const t=O(),[d,v]=S.useState(null);F({queryKey:["restaurantId"],queryFn:async()=>{const{data:r,error:y}=await f.from("restaurants").select("id").limit(1).single();if(y)throw new Error(y.message);return v(r.id),r.id},enabled:a});const m=H({resolver:J(Fe),defaultValues:{name:"",description:"",display_order:0,is_active:!0}}),c=A({mutationFn:async r=>{if(!d)throw new Error("ID do restaurante não encontrado.");const{error:y}=await f.from("categories").insert({restaurant_id:d,name:r.name,description:r.description,display_order:r.display_order,is_active:r.is_active});if(y)throw new Error(y.message)},onSuccess:()=>{k.success("Categoria criada com sucesso!"),t.invalidateQueries({queryKey:["categoriesWithProducts"]}),l(),m.reset()},onError:r=>{k.error(`Erro ao criar categoria: ${r.message}`)}}),o=r=>{c.mutate(r)};return e.jsx(L,{open:a,onOpenChange:l,children:e.jsxs(z,{className:"sm:max-w-[425px]",children:[e.jsxs(U,{children:[e.jsx(R,{children:"Nova Categoria"}),e.jsx(K,{children:"Gerencie as categorias dos seus produtos"})]}),e.jsx(X,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(o),className:"space-y-4 pt-4",children:[e.jsx(x,{control:m.control,name:"name",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Nome *"}),e.jsx(j,{children:e.jsx(q,{placeholder:"",...r})}),e.jsx(b,{})]})}),e.jsx(x,{control:m.control,name:"description",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Descrição"}),e.jsx(j,{children:e.jsx(Y,{placeholder:"",...r})}),e.jsx(b,{})]})}),e.jsx(x,{control:m.control,name:"display_order",render:({field:r})=>e.jsxs(u,{children:[e.jsx(p,{children:"Ordem de Exibição"}),e.jsx(j,{children:e.jsx(q,{type:"number",...r})}),e.jsx(b,{})]})}),e.jsx(x,{control:m.control,name:"is_active",render:({field:r})=>e.jsxs(u,{className:"flex flex-row items-center space-x-3 space-y-0 pt-2",children:[e.jsx(j,{children:e.jsx(I,{checked:r.value,onCheckedChange:r.onChange,id:"is_active"})}),e.jsx(p,{htmlFor:"is_active",className:"font-normal cursor-pointer",children:"Ativa"})]})}),e.jsxs(B,{className:"pt-4",children:[e.jsx(V,{asChild:!0,children:e.jsx(g,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(g,{type:"submit",disabled:c.isPending,children:c.isPending?"Criando...":"Criar"})]})]})})]})})},Pe=async()=>{const{data:a,error:l}=await f.from("restaurants").select("id").limit(1).single();if(l)throw new Error(`Erro ao buscar restaurante: ${l.message}`);if(!a)throw new Error("Nenhum restaurante ativo encontrado.");const t=a.id,{data:d,error:v}=await f.from("categories").select("*").eq("restaurant_id",t).order("display_order",{ascending:!0});if(v)throw new Error(`Erro ao buscar categorias: ${v.message}`);const{data:m,error:c}=await f.from("products").select("id, name, category_id, is_available").eq("restaurant_id",t);if(c)throw new Error(`Erro ao buscar produtos: ${c.message}`);return d.map(r=>({...r,products:m.filter(y=>y.category_id===r.id)}))},De=()=>{const[a,l]=S.useState(!1),{data:t,isLoading:d,isError:v,error:m}=F({queryKey:["categoriesWithProducts"],queryFn:Pe});return e.jsxs(e.Fragment,{children:[e.jsx(Ie,{isOpen:a,onClose:()=>l(!1)}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Categorias"}),e.jsxs(g,{onClick:()=>l(!0),children:[e.jsx(Z,{className:"mr-2 h-4 w-4"})," Nova Categoria"]})]}),d&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[...Array(3)].map((c,o)=>e.jsxs(P,{children:[e.jsx(re,{children:e.jsx(w,{className:"h-6 w-3/4"})}),e.jsxs($,{className:"space-y-4",children:[e.jsx(w,{className:"h-4 w-1/4"}),e.jsx(w,{className:"h-4 w-1/2"}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(w,{className:"h-8 w-full"}),e.jsx(w,{className:"h-8 w-full"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(w,{className:"h-10 w-full"}),e.jsx(w,{className:"h-10 w-10"})]})]})]},o))}),v&&e.jsxs(de,{variant:"destructive",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx(me,{children:"Erro ao carregar categorias"}),e.jsx(he,{children:m instanceof Error?m.message:"Ocorreu um erro desconhecido."})]}),t&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:t.map(c=>e.jsxs(P,{children:[e.jsxs(re,{className:"flex flex-row items-start justify-between",children:[e.jsx(fe,{children:c.name}),c.is_active&&e.jsx(T,{children:"Ativa"})]}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ordem: ",c.display_order??0]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium mb-2",children:["Produtos (",c.products.length,"):"]}),e.jsx("div",{className:"space-y-2",children:c.products.length>0?c.products.map(o=>e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-2 rounded-md",children:[e.jsx("span",{className:"text-sm",children:o.name}),o.is_available&&e.jsx(T,{variant:"secondary",children:"Disponível"})]},o.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum produto nesta categoria."})})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[e.jsxs(g,{variant:"outline",className:"w-full",children:[e.jsx(se,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsx(g,{variant:"destructive",size:"icon",children:e.jsx(ee,{className:"h-4 w-4"})})]})]})]},c.id))})]})]})},Me=({product:a,onEditClick:l,onUpdateStatus:t})=>e.jsxs(P,{className:"flex items-center gap-4 p-4",children:[e.jsx("img",{src:a.image_url||"/placeholder.svg",alt:a.name,className:"w-24 h-24 object-cover rounded-md"}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:a.name}),a.is_available&&e.jsx(T,{children:"Disponível"})]}),e.jsx("p",{className:"text-lg font-bold text-primary mt-1",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.price)})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:`list-active-${a.id}`,className:"text-sm font-medium",children:"Ativo"}),e.jsx(I,{id:`list-active-${a.id}`,checked:a.is_available??!1,onCheckedChange:t})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"outline",size:"icon",onClick:()=>l(a),children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(g,{variant:"destructive",size:"icon",children:e.jsx(ee,{className:"h-4 w-4"})})]})]})]}),$e=async()=>{const{data:a,error:l}=await f.from("restaurants").select("id").eq("is_active",!0).limit(1).single();if(l)throw new Error(`Erro ao buscar restaurante: ${l.message}`);if(!a)throw new Error("Nenhum restaurante ativo encontrado.");const{data:t,error:d}=await f.from("products").select("*").eq("restaurant_id",a.id).order("created_at",{ascending:!1});if(d)throw new Error(`Erro ao buscar produtos: ${d.message}`);return t},ts=()=>{const a=O(),[l,t]=S.useState(!1),[d,v]=S.useState(!1),[m,c]=S.useState(null),[o,r]=S.useState("grid"),{data:y,isLoading:i,isError:s,error:h}=F({queryKey:["products"],queryFn:$e}),_=n=>{c(n),v(!0)},C=A({mutationFn:async({id:n,is_available:N})=>{const{error:M}=await f.from("products").update({is_available:N}).eq("id",n);if(M)throw new Error(M.message)},onSuccess:()=>{a.invalidateQueries({queryKey:["products"]}),k.success("Status do produto atualizado!")},onError:n=>{k.error(`Erro ao atualizar produto: ${n.message}`)}});return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{isOpen:l,onClose:()=>t(!1)}),e.jsx(qe,{isOpen:d,onClose:()=>v(!1),product:m}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:e.jsxs(ve,{defaultValue:"products",children:[e.jsxs(ye,{children:[e.jsx(ae,{value:"products",children:"Produtos"}),e.jsx(ae,{value:"categories",children:"Categorias"})]}),e.jsxs(ie,{value:"products",className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Produtos"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(g,{variant:"outline",size:"icon",onClick:()=>r(n=>n==="grid"?"list":"grid"),children:o==="grid"?e.jsx(_e,{className:"h-4 w-4"}):e.jsx(we,{className:"h-4 w-4"})}),e.jsx(g,{variant:"outline",children:"Ativar Todos"}),e.jsx(g,{variant:"outline",children:"Desativar Todos"}),e.jsxs(g,{onClick:()=>t(!0),children:[e.jsx(Z,{className:"mr-2 h-4 w-4"})," Novo Produto"]})]})]}),i&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((n,N)=>e.jsxs(P,{className:"overflow-hidden",children:[e.jsx(w,{className:"h-48 w-full"}),e.jsxs($,{className:"p-4 space-y-3",children:[e.jsx(w,{className:"h-5 w-3/4"}),e.jsx(w,{className:"h-6 w-1/3"}),e.jsxs("div",{className:"flex justify-between items-center border-t pt-3 mt-3",children:[e.jsx(w,{className:"h-5 w-1/2"}),e.jsx(w,{className:"h-6 w-12"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(w,{className:"h-10 w-full"}),e.jsx(w,{className:"h-10 w-10"})]})]})]},N))}),s&&e.jsxs(de,{variant:"destructive",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx(me,{children:"Erro ao carregar produtos"}),e.jsx(he,{children:h.message})]}),y&&e.jsx("div",{className:be(o==="grid"?"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"space-y-4"),children:y.map(n=>o==="grid"?e.jsxs(P,{className:"overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:n.image_url||"/placeholder.svg",alt:n.name,className:"w-full h-48 object-cover"}),n.is_available&&e.jsx(T,{className:"absolute top-2 right-2",children:"Disponível"})]}),e.jsxs($,{className:"p-4 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"text-lg font-semibold truncate",children:n.name}),e.jsx("p",{className:"text-xl font-bold text-primary mt-1 mb-3",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n.price)})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-t pt-3",children:[e.jsx("label",{htmlFor:`active-${n.id}`,className:"text-sm font-medium",children:"Produto Ativo"}),e.jsx(I,{id:`active-${n.id}`,checked:n.is_available??!1,onCheckedChange:N=>{C.mutate({id:n.id,is_available:N})}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{variant:"outline",className:"w-full",onClick:()=>_(n),children:[e.jsx(se,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsx(g,{variant:"destructive",size:"icon",children:e.jsx(ee,{className:"h-4 w-4"})})]})]})]})]},n.id):e.jsx(Me,{product:n,onEditClick:_,onUpdateStatus:N=>C.mutate({id:n.id,is_available:N})},n.id))})]}),e.jsx(ie,{value:"categories",children:e.jsx(De,{})})]})})]})};export{ts as default};
