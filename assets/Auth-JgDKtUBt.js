import{j as e}from"./tanstack-C7aOFagJ.js";import{h as B,i as _,r as n}from"./vendor-DjsPZZVP.js";import{L as H}from"./Logo-DUcawE6i.js";import{s as x,d as J,C as V,e as W,f as $,g as G,b as K,h as u,I as v,P as M,i as Q,B as L,L as X,j as s}from"./index-CUkYmbMO.js";import{u as Y}from"./use-active-restaurant-id-Bu-0y77Z.js";import"./supabase-BAEEEeUB.js";const E=o=>o.replace(/\D/g,""),U=o=>o.replace(/\D/g,""),ce=()=>{var P;const o=B(),d=_(),[b,m]=n.useState(!1),[c,D]=n.useState(!1),[p,k]=n.useState(""),[h,q]=n.useState(""),[j,A]=n.useState(""),[C,R]=n.useState(""),[N,z]=n.useState(""),[Z,S]=n.useState(null),[ee,y]=n.useState(null),{data:w,isLoading:l}=Y(),f=(P=d.state)==null?void 0:P.restaurantId,I=(t,r)=>{var g;const a=(g=d.state)==null?void 0:g.from,i=r||w;a==="/checkout"?(console.log("User logged in, redirecting to checkout."),o("/checkout",{replace:!0})):i?(console.log("User logged in, redirecting to specific menu:",i),o(`/menu/${i}`,{replace:!0})):(console.log("User logged in, no active restaurant found, redirecting to index."),o("/",{replace:!0}))};n.useEffect(()=>{if(l)return;const{data:{subscription:t}}=x.auth.onAuthStateChange((r,a)=>{y(a),S((a==null?void 0:a.user)??null),a!=null&&a.user&&I(a.user,f)});return x.auth.getSession().then(({data:{session:r}})=>{y(r),S((r==null?void 0:r.user)??null),r!=null&&r.user&&I(r.user,f)}),()=>t.unsubscribe()},[o,d.state,l,w,f]);const O=()=>j.trim()?E(C).length!==11?(s.error("O Telefone deve conter 11 dígitos (DDD + 9 dígitos)."),!1):U(N).length!==11?(s.error("O CPF é obrigatório e deve conter 11 dígitos."),!1):p.trim()?h.length<6?(s.error("A Senha deve ter pelo menos 6 caracteres."),!1):!0:(s.error("O Email é obrigatório."),!1):(s.error("O Nome Completo é obrigatório."),!1),T=async t=>{var r;if(t.preventDefault(),m(!0),((r=d.state)==null?void 0:r.from)==="/checkout"&&!f){s.error("Erro: ID do restaurante de origem não encontrado."),m(!1);return}try{if(c){if(!O()){m(!1);return}const a=E(C),i=U(N),{data:g,error:F}=await x.auth.signUp({email:p,password:h,options:{data:{full_name:j,phone:a,cpf_cnpj:i}}});if(F)throw F;g.session?s.success("Conta criada e login efetuado com sucesso!"):s.success("Conta criada! Verifique seu email para confirmar.")}else{const{error:a}=await x.auth.signInWithPassword({email:p,password:h});if(a)throw a;s.success("Login realizado com sucesso!")}}catch(a){a.message.includes("Email not confirmed")?s.error("Por favor, verifique seu e-mail para confirmar sua conta antes de fazer login."):s.error(a.message||"Erro ao processar autenticação")}finally{m(!1)}};return l?e.jsx(J,{}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(H,{className:"justify-center mb-4"})}),e.jsxs(V,{className:"shadow-xl border-2",children:[e.jsxs(W,{className:"space-y-1",children:[e.jsx($,{className:"text-2xl font-bold text-center",children:c?"Crie sua conta":"Acesse sua conta"}),e.jsx(G,{className:"text-center",children:c?"Preencha os campos para começar":"Utilize seu email e senha para fazer login"})]}),e.jsxs(K,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"fullName",children:"Nome Completo *"}),e.jsx(v,{id:"fullName",type:"text",placeholder:"Seu nome completo",value:j,onChange:t=>A(t.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"phone",children:"Telefone *"}),e.jsx(M,{id:"phone",value:C,onChange:t=>R(t.target.value),required:!0,className:"h-12"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formato: (99) 99999-9999"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"cpfCnpj",children:"CPF *"}),e.jsx(Q,{id:"cpfCnpj",value:N,onChange:t=>z(t.target.value),required:!0,className:"h-12"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Apenas CPF (11 dígitos) é obrigatório no cadastro."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"email",children:"Email *"}),e.jsx(v,{id:"email",type:"email",placeholder:"seu@email.com",value:p,onChange:t=>k(t.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"password",children:"Senha *"}),e.jsx(v,{id:"password",type:"password",placeholder:"••••••••",value:h,onChange:t=>q(t.target.value),required:!0,className:"h-12"})]}),e.jsx(L,{type:"submit",className:"w-full",size:"lg",disabled:b||l,children:b||l?e.jsx(X,{className:"h-4 w-4 animate-spin mr-2"}):c?"Criar conta":"Entrar"})]}),e.jsx("div",{className:"text-center",children:e.jsx(L,{variant:"link",type:"button",className:"p-0 h-auto",onClick:()=>D(!c),children:c?"Já tem uma conta? Faça login":"Não tem uma conta? Crie uma agora"})})]})]})]})})};export{ce as default};
