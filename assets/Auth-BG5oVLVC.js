import{j as e}from"./tanstack-QxCZ3Wpf.js";import{u as F,f as q,r as s}from"./vendor-CIxFcw7z.js";import{L as D}from"./Logo-BdF-Nyxa.js";import{B as w}from"./button-BYPZCtHl.js";import{L as m,I as g}from"./label-nniXn7wN.js";import{C as I,b as z,c as A,d as k,a as O}from"./card-DqfxAoFS.js";import{L as T,u as o}from"./index-DWQb1L7G.js";import{s as u}from"./client-BskZ_u5h.js";import{P as $}from"./PhoneInput-CesKJTuE.js";import"./package-B2Fam48u.js";import"./supabase-DGFirUEE.js";const C=d=>d.replace(/\D/g,""),Z=()=>{const d=F();q();const[x,h]=s.useState(!1),[n,b]=s.useState(!1),[i,S]=s.useState(""),[c,y]=s.useState(""),[p,P]=s.useState(""),[f,E]=s.useState(""),[B,j]=s.useState(null),[R,N]=s.useState(null),v=()=>{const t=window.location.origin,r=window.location.pathname.split("/")[1];return r?`${t}/${r}/#/menu`:`${t}/#/menu`};s.useEffect(()=>{const{data:{subscription:t}}=u.auth.onAuthStateChange((a,r)=>{if(N(r),j((r==null?void 0:r.user)??null),r!=null&&r.user){const l=v();console.log("Redirecting customer to menu:",l),window.location.href=l}});return u.auth.getSession().then(({data:{session:a}})=>{if(N(a),j((a==null?void 0:a.user)??null),a!=null&&a.user){const r=v();console.log("User already logged in, redirecting to menu:",r),window.location.href=r}}),()=>t.unsubscribe()},[d]);const L=()=>p.trim()?C(f).length!==11?(o.error("O Telefone deve conter 11 dígitos (DDD + 9 dígitos)."),!1):i.trim()?c.length<6?(o.error("A Senha deve ter pelo menos 6 caracteres."),!1):!0:(o.error("O Email é obrigatório."),!1):(o.error("O Nome Completo é obrigatório."),!1),U=async t=>{t.preventDefault(),h(!0);try{if(n){if(!L()){h(!1);return}const a=C(f),{data:r,error:l}=await u.auth.signUp({email:i,password:c,options:{data:{full_name:p,phone:a}}});if(l)throw l;r.session?o.success("Conta criada e login efetuado com sucesso!"):o.success("Conta criada! Verifique seu email para confirmar.")}else{const{error:a}=await u.auth.signInWithPassword({email:i,password:c});if(a)throw a;o.success("Login realizado com sucesso!")}}catch(a){a.message.includes("Email not confirmed")?o.error("Por favor, verifique seu e-mail para confirmar sua conta antes de fazer login."):o.error(a.message||"Erro ao processar autenticação")}finally{h(!1)}};return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(D,{className:"justify-center mb-4"})}),e.jsxs(I,{className:"shadow-xl border-2",children:[e.jsxs(z,{className:"space-y-1",children:[e.jsx(A,{className:"text-2xl font-bold text-center",children:n?"Crie sua conta":"Acesse sua conta"}),e.jsx(k,{className:"text-center",children:n?"Preencha os campos para começar":"Utilize seu email e senha para fazer login"})]}),e.jsxs(O,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"fullName",children:"Nome Completo *"}),e.jsx(g,{id:"fullName",type:"text",placeholder:"Seu nome completo",value:p,onChange:t=>P(t.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"phone",children:"Telefone *"}),e.jsx($,{id:"phone",value:f,onChange:t=>E(t.target.value),required:!0,className:"h-12"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formato: (99) 99999-9999"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"email",children:"Email *"}),e.jsx(g,{id:"email",type:"email",placeholder:"seu@email.com",value:i,onChange:t=>S(t.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"password",children:"Senha *"}),e.jsx(g,{id:"password",type:"password",placeholder:"••••••••",value:c,onChange:t=>y(t.target.value),required:!0,className:"h-12"})]}),e.jsx(w,{type:"submit",className:"w-full",size:"lg",disabled:x,children:x?e.jsx(T,{className:"h-4 w-4 animate-spin mr-2"}):n?"Criar conta":"Entrar"})]}),e.jsx("div",{className:"text-center",children:e.jsx(w,{variant:"link",type:"button",className:"p-0 h-auto",onClick:()=>b(!n),children:n?"Já tem uma conta? Faça login":"Não tem uma conta? Crie uma agora"})})]})]})]})})};export{Z as default};
