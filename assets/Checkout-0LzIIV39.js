import{b as xe,j as e,u as os,c as De}from"./tanstack-d4AvmB45.js";import{r as a,u as as,h as is,j as cs,L as Fe}from"./vendor-CnEXr6gt.js";import{s as N}from"./client-D5i5GwB9.js";import{c as ls,d as wt,e as ze,P as Se,f as Te,g as ds,h as ms,i as us,a as ye,u as b,L as ge,p as ps,b as at}from"./index-BiuH-c2o.js";import{L as fs,g as it,c as Me,Z as hs}from"./location-C6lOpUO9.js";import{u as xs}from"./use-auth-status-b07NBuTX.js";import{o as jt,s as T,e as gs,u as ct,C as pe,t as lt}from"./types-DKlirIXB.js";import{B as H}from"./button-BR0SBW8q.js";import{C as J,b as W,c as Y,a as ee}from"./card-DPPI47RZ.js";import{I as ce,L as V}from"./label-BV5C2S3n.js";import{T as ys}from"./textarea-9PXXeSiO.js";import{c as vt,R as ws,I as js}from"./index-DXUUKreF.js";import{u as vs}from"./index-DrlxvCXN.js";import{u as bs}from"./index-KNP7Yozt.js";import{S as dt}from"./separator-BiFDDGEy.js";import{A as ie,a as fe,b as he}from"./alert-OtVAhwWG.js";import{P as _s,M as Ns}from"./PhoneInput-CHd5GWwg.js";import{S as Cs,C as Es,L as Ss}from"./CustomerProfileModal-pqsYNyED.js";import{D as mt,a as ut,b as Rs,c as Ps,d as $s}from"./dialog-BSqkV896.js";import{C as bt}from"./credit-card-IW_TOYNB.js";import{C as ks}from"./CpfCnpjInput-DEyBkQAB.js";import{M as Oe}from"./map-pin-C0cUxGvp.js";import{A as As,a as Is,b as Ds,c as Fs,d as Ms,e as Vs,g as Ts}from"./alert-dialog-BZyYylkI.js";import{C as Ce}from"./circle-alert-u1wieMuG.js";import{F as pt}from"./form-Dy-mVovi.js";import{T as ft}from"./terminal-DDQavVT_.js";import{R as Os}from"./pt-BR-QOiGrE8y.js";import{A as Ls}from"./arrow-left-B4ZdY7Ng.js";import{U as ht}from"./user-BeoBYUve.js";import{T as Ve}from"./truck-BLgTgaoB.js";import{C as zs}from"./circle-check-big-B7NYTIT5.js";import{S as qs}from"./save-DDNBG71V.js";import{D as Bs}from"./dollar-sign-CgYVK6a1.js";import"./supabase-BZV_3FV3.js";import"./skeleton-BCh3y-o-.js";import"./store-D8G3dj6f.js";import"./package-LQuOLYZp.js";import"./check-DZE0K_Bg.js";import"./circle-x-CL9S8_mY.js";import"./euro-BnHbi1gl.js";import"./format-BeKxgCCE.js";import"./index-CoBSFt2y.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=ls("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Ks=async r=>{const{data:t,error:n}=await N.from("payment_settings").select("mercado_pago_public_key").eq("restaurant_id",r).limit(1).single();if(n&&n.code!=="PGRST116")throw new Error(`Error fetching payment settings: ${n.message}`);return(t==null?void 0:t.mercado_pago_public_key)||null},_t=r=>xe({queryKey:["mercadoPagoPublicKey",r],queryFn:()=>Ks(r),enabled:!!r,staleTime:1e3*60*60*24});var qe="Radio",[Us,Nt]=wt(qe),[Zs,Qs]=Us(qe),Ct=a.forwardRef((r,t)=>{const{__scopeRadio:n,name:u,checked:f=!1,required:h,disabled:j,value:c="on",onCheck:E,form:S,...v}=r,[i,D]=a.useState(null),R=ze(t,B=>D(B)),I=a.useRef(!1),F=i?S||!!i.closest("form"):!0;return e.jsxs(Zs,{scope:n,checked:f,disabled:j,children:[e.jsx(Se.button,{type:"button",role:"radio","aria-checked":f,"data-state":Pt(f),"data-disabled":j?"":void 0,disabled:j,value:c,...v,ref:R,onClick:Te(r.onClick,B=>{f||E==null||E(),F&&(I.current=B.isPropagationStopped(),I.current||B.stopPropagation())})}),F&&e.jsx(Rt,{control:i,bubbles:!I.current,name:u,value:c,checked:f,required:h,disabled:j,form:S,style:{transform:"translateX(-100%)"}})]})});Ct.displayName=qe;var Et="RadioIndicator",St=a.forwardRef((r,t)=>{const{__scopeRadio:n,forceMount:u,...f}=r,h=Qs(Et,n);return e.jsx(ds,{present:u||h.checked,children:e.jsx(Se.span,{"data-state":Pt(h.checked),"data-disabled":h.disabled?"":void 0,...f,ref:t})})});St.displayName=Et;var Xs="RadioBubbleInput",Rt=a.forwardRef(({__scopeRadio:r,control:t,checked:n,bubbles:u=!0,...f},h)=>{const j=a.useRef(null),c=ze(j,h),E=bs(n),S=ms(t);return a.useEffect(()=>{const v=j.current;if(!v)return;const i=window.HTMLInputElement.prototype,R=Object.getOwnPropertyDescriptor(i,"checked").set;if(E!==n&&R){const I=new Event("click",{bubbles:u});R.call(v,n),v.dispatchEvent(I)}},[E,n,u]),e.jsx(Se.input,{type:"radio","aria-hidden":!0,defaultChecked:n,...f,tabIndex:-1,ref:c,style:{...f.style,...S,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Rt.displayName=Xs;function Pt(r){return r?"checked":"unchecked"}var Hs=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Re="RadioGroup",[Js,un]=wt(Re,[vt,Nt]),$t=vt(),kt=Nt(),[Ws,Ys]=Js(Re),At=a.forwardRef((r,t)=>{const{__scopeRadioGroup:n,name:u,defaultValue:f,value:h,required:j=!1,disabled:c=!1,orientation:E,dir:S,loop:v=!0,onValueChange:i,...D}=r,R=$t(n),I=vs(S),[F,B]=us({prop:h,defaultProp:f??null,onChange:i,caller:Re});return e.jsx(Ws,{scope:n,name:u,required:j,disabled:c,value:F,onValueChange:B,children:e.jsx(ws,{asChild:!0,...R,orientation:E,dir:I,loop:v,children:e.jsx(Se.div,{role:"radiogroup","aria-required":j,"aria-orientation":E,"data-disabled":c?"":void 0,dir:I,...D,ref:t})})})});At.displayName=Re;var It="RadioGroupItem",Dt=a.forwardRef((r,t)=>{const{__scopeRadioGroup:n,disabled:u,...f}=r,h=Ys(It,n),j=h.disabled||u,c=$t(n),E=kt(n),S=a.useRef(null),v=ze(t,S),i=h.value===f.value,D=a.useRef(!1);return a.useEffect(()=>{const R=F=>{Hs.includes(F.key)&&(D.current=!0)},I=()=>D.current=!1;return document.addEventListener("keydown",R),document.addEventListener("keyup",I),()=>{document.removeEventListener("keydown",R),document.removeEventListener("keyup",I)}},[]),e.jsx(js,{asChild:!0,...c,focusable:!j,active:i,children:e.jsx(Ct,{disabled:j,required:h.required,checked:i,...E,...f,name:h.name,ref:v,onCheck:()=>h.onValueChange(f.value),onKeyDown:Te(R=>{R.key==="Enter"&&R.preventDefault()}),onFocus:Te(f.onFocus,()=>{var R;D.current&&((R=S.current)==null||R.click())})})})});Dt.displayName=It;var er="RadioGroupIndicator",Ft=a.forwardRef((r,t)=>{const{__scopeRadioGroup:n,...u}=r,f=kt(n);return e.jsx(St,{...f,...u,ref:t})});Ft.displayName=er;var Mt=At,Vt=Dt,tr=Ft;const Le=a.forwardRef(({className:r,...t},n)=>e.jsx(Mt,{className:ye("grid gap-2",r),...t,ref:n}));Le.displayName=Mt.displayName;const Ee=a.forwardRef(({className:r,...t},n)=>e.jsx(Vt,{ref:n,className:ye("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...t,children:e.jsx(tr,{className:"flex items-center justify-center",children:e.jsx(Gs,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Ee.displayName=Vt.displayName;var Be={};Object.defineProperty(Be,"__esModule",{value:!0});var Tt=Be.loadMercadoPago=void 0;const Ot="https://sdk.mercadopago.com/js/v2",sr=/^https:\/\/sdk\.mercadopago\.com\/js\/v2\/?(\?.*)?$/,xt="MercadoPago has already been initialized in your window, please remove the duplicate import",rr="MercadoPago.js not available",nr="Failed to load MercadoPago.js",or=()=>{for(var r=document.querySelectorAll(`script[src^="${Ot}"`),t=0;t<r.length;t++){var n=r[t];if(sr.test(n.src))return n}return null},ar=()=>{const r=document.createElement("script");r.src=Ot;const t=document.head||document.body;if(!t)throw new Error("Expected document.body or document.head not to be null. MercadoPago requires a <body> or a <head> element, please add on your project.");return t.appendChild(r),r};let Ne=null;const ir=()=>(Ne!==null||(Ne=new Promise((r,t)=>{if(typeof window>"u"){r(null);return}if(window.MercadoPago){console.warn(xt),r(window.MercadoPago);return}try{let n=or();n?console.warn(xt):n||(n=ar()),n.addEventListener("load",()=>{window.MercadoPago?r(window.MercadoPago):t(new Error(rr))}),n.addEventListener("error",()=>{t(new Error(nr))})}catch(n){t(n);return}})),Ne);Tt=Be.loadMercadoPago=ir;var cr=function(r,t,n,u){function f(h){return h instanceof n?h:new n(function(j){j(h)})}return new(n||(n=Promise))(function(h,j){function c(v){try{S(u.next(v))}catch(i){j(i)}}function E(v){try{S(u.throw(v))}catch(i){j(i)}}function S(v){v.done?h(v.value):f(v.value).then(c,E)}S((u=u.apply(r,t||[])).next())})};class U{static getInstance(){return cr(this,void 0,void 0,function*(){if(this.publicKey)return this.loadedInstanceMercadoPago||(yield Tt(),this.loadedInstanceMercadoPago=!0),this.instanceMercadoPago||(this.instanceMercadoPago=new window.MercadoPago(this.publicKey,this.options)),this.instanceMercadoPago;console.error("Expected the PUBLIC_KEY to render the MercadoPago SDK React")})}}U.publicKey=null;U.options={};U.instanceMercadoPago=void 0;U.loadedInstanceMercadoPago=!1;function lr(r,t){return Object.keys(r).length===Object.keys(t).length&&Object.keys(r).every(u=>Object.prototype.hasOwnProperty.call(t,u)&&r[u]===t[u])}const dr=(r,t)=>{const n=Object.assign(Object.assign({},t),{frontEndStack:"react"}),u=!lr(U.options,n);(r!==U.publicKey||u)&&(U.publicKey=r,U.options=n,U.instanceMercadoPago=void 0)},mr=({preferenceId:r,initPoint:t,onClose:n})=>{const{data:u,isLoading:f}=_t();return a.useEffect(()=>{if(u)try{dr(u,{locale:"pt-BR"})}catch(h){console.error("Erro ao inicializar Mercado Pago:",h),b.error("Erro ao carregar o SDK do Mercado Pago."),n();return}t&&(console.log("Redirecionando para o Mercado Pago:",t),window.location.href=t)},[u,n,t]),f||!u?e.jsx(mt,{open:!0,onOpenChange:n,children:e.jsx(ut,{className:"sm:max-w-[425px]",children:e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsx(ge,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{children:"Carregando configurações de pagamento..."})]})})}):e.jsx(mt,{open:!0,onOpenChange:n,children:e.jsxs(ut,{className:"sm:max-w-[425px]",children:[e.jsxs(Rs,{children:[e.jsxs(Ps,{className:"flex items-center gap-2",children:[e.jsx(bt,{className:"h-5 w-5 text-primary"}),"Redirecionando para Pagamento"]}),e.jsx($s,{children:"Você está sendo redirecionado para o checkout seguro do Mercado Pago."})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(ge,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aguarde..."})]}),e.jsx(H,{variant:"outline",onClick:n,children:"Cancelar e Voltar"})]})})},ur=({latitude:r,longitude:t,address:n,className:u})=>{const f=a.useMemo(()=>[r,t],[r,t]),h=a.useMemo(()=>[r,t],[r,t]);return e.jsxs(J,{className:ye("w-full",u),children:[e.jsxs(W,{children:[e.jsxs(Y,{className:"text-lg flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5 text-primary"}),"Sua Localização"]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:n})]}),e.jsx(ee,{className:"p-0",children:e.jsx("div",{className:"h-64 w-full rounded-b-lg overflow-hidden",children:e.jsx(fs,{center:h,markerPosition:f,onMarkerDragEnd:()=>{},zoom:16})})})]})},pr=({isOpen:r,onConfirm:t})=>e.jsx(As,{open:r,children:e.jsxs(Is,{children:[e.jsxs(Ds,{children:[e.jsxs(Fs,{className:"flex items-center gap-2 text-primary",children:[e.jsx(Ce,{className:"h-6 w-6"}),"Atenção ao Pagamento Online!"]}),e.jsxs(Ms,{children:["Você escolheu o pagamento online (Pix ou Cartão).",e.jsx("br",{}),e.jsx("br",{}),"Ao prosseguir, você será redirecionado para o checkout seguro do Mercado Pago.",e.jsx("br",{}),e.jsx("br",{}),'**IMPORTANTE:** Se você escolher **PIX**, após o pagamento, você pode precisar clicar no botão **"Voltar ao site"** na tela do Mercado Pago para que seu pedido seja finalizado e rastreado corretamente.']})]}),e.jsx(Vs,{children:e.jsx(Ts,{onClick:t,className:"w-full",children:"Entendi e Continuar"})})]})}),fr=({onAddressSelect:r,defaultValue:t,disabled:n})=>{const u=a.useRef(null),f=a.useRef(null);return a.useEffect(()=>{!u.current||!window.google||!window.google.maps||!window.google.maps.places||(f.current=new window.google.maps.places.Autocomplete(u.current,{componentRestrictions:{country:"br"},fields:["address_components","geometry","formatted_address"],types:["address"]}),f.current.addListener("place_changed",()=>{var c,E,S;const h=(c=f.current)==null?void 0:c.getPlace();if(!h||!h.address_components||!h.geometry)return;const j={street:"",number:"",neighborhood:"",city:"",state:"",zip_code:"",latitude:((E=h.geometry.location)==null?void 0:E.lat())||0,longitude:((S=h.geometry.location)==null?void 0:S.lng())||0};h.address_components.forEach(v=>{const i=v.types;i.includes("route")&&(j.street=v.long_name),i.includes("street_number")&&(j.number=v.long_name),(i.includes("sublocality_level_1")||i.includes("sublocality")||i.includes("sublocality_level_2")||i.includes("sublocality_level_3")||i.includes("neighborhood")||i.includes("political"))&&(j.neighborhood||(j.neighborhood=v.long_name)),(i.includes("administrative_area_level_2")||i.includes("locality"))&&(j.city=v.long_name),i.includes("administrative_area_level_1")&&(j.state=v.short_name),i.includes("postal_code")&&(j.zip_code=v.long_name.replace(/\D/g,""))}),r(j)}))},[r]),e.jsxs("div",{className:"relative",children:[e.jsx(Cs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ce,{ref:u,placeholder:"Busque seu endereço (Rua, Número...)",defaultValue:t,className:"pl-10 h-12",disabled:n})]})},gt=r=>{if(!r)return"";let t=r.replace(/\D/g,"");return t.length>11&&(t=t.slice(0,11)),t.length>0&&(t=`(${t}`),t.length>3&&(t=`${t.slice(0,3)}) ${t.slice(3)}`),t.length>10&&(t=`${t.slice(0,10)}-${t.slice(10)}`),t},yt=r=>{if(!r)return"";let t=r.replace(/\D/g,"");return t.length>14&&(t=t.slice(0,14)),t.length<=11?(t.length>9&&(t=`${t.slice(0,9)}-${t.slice(9)}`),t.length>6&&(t=`${t.slice(0,6)}.${t.slice(6)}`),t.length>3&&(t=`${t.slice(0,3)}.${t.slice(3)}`)):(t.length>12&&(t=`${t.slice(0,12)}-${t.slice(12)}`),t.length>8&&(t=`${t.slice(0,8)}/${t.slice(8)}`),t.length>5&&(t=`${t.slice(0,5)}.${t.slice(5)}`),t.length>2&&(t=`${t.slice(0,2)}.${t.slice(2)}`)),t},hr=jt({zip_code:T().min(1,"CEP é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length===8,{message:"O CEP deve ter 8 dígitos."}),street:T().min(1,"Rua é obrigatória."),number:T().min(1,"Número é obrigatório."),complement:T().optional(),neighborhood:T().min(1,"Bairro é obrigatório."),city:T().min(1,"Cidade é obrigatória.")}),xr=jt({name:T().min(1,"Nome é obrigatório."),phone:T().min(1,"Telefone é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length>=10,{message:"O telefone deve ter pelo menos 10 dígitos."}),cpf_cnpj:T().min(1,"CPF/CNPJ é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length===11||r.length===14,{message:"CPF deve ter 11 dígitos ou CNPJ 14 dígitos."}),delivery_option:gs(["delivery","pickup"],{required_error:"Selecione uma opção de entrega."}),notes:T().optional(),payment_method_id:T().min(1,"Selecione um método de pagamento."),change_for:T().optional()}),gr=async r=>{const{data:t,error:n}=await N.from("restaurants").select("id, name, address, phone, email, street, number, neighborhood, city, zip_code, latitude, longitude, delivery_enabled").eq("id",r).eq("is_active",!0).limit(1).single();if(n)throw new Error(`Erro ao buscar restaurante: ${n.message}`);if(!t)throw new Error("Restaurante não encontrado ou inativo.");return t},yr=async r=>{const{data:t,error:n}=await N.from("delivery_zones").select("*").eq("restaurant_id",r).eq("is_active",!0).order("max_distance_km",{ascending:!0});if(n)throw new Error(`Erro ao buscar zonas de entrega: ${n.message}`);return t},wr=async r=>{const{data:t,error:n}=await N.from("payment_methods").select("*").eq("restaurant_id",r).eq("is_active",!0).order("name",{ascending:!0});if(n)throw new Error(`Erro ao buscar métodos de pagamento: ${n.message}`);return t},jr=async r=>{const{data:t,error:n}=await N.from("customers").select("*, complement").eq("user_id",r).limit(1).single();if(n&&n.code!=="PGRST116")throw new Error(n.message);return t||null},pn=()=>{var et,tt,st,rt,nt;const r=as(),t=is(),[n]=cs(),u=os(),{items:f,totalAmount:h,clearCart:j}=ps(),{data:c,isLoading:E}=xs(),[S]=a.useState((et=t.state)==null?void 0:et.restaurantId),v=n.get("restaurantId"),i=S||v,{data:D}=_t(i),[R,I]=a.useState(!1),[F,B]=a.useState(!1),[we,Z]=a.useState(0),[te,re]=a.useState(null),[Pe,G]=a.useState(!0),[L,le]=a.useState(null),[Lt,$e]=a.useState(!1),[zt,qt]=a.useState(null),[Ge,Bt]=a.useState(null),[z,ne]=a.useState(!1),[Gt,Ke]=a.useState(!1),[Ue,ke]=a.useState(null),[Ae,de]=a.useState(null),oe=a.useRef(null),{data:x,isLoading:Kt,isError:Ut,error:Ze,refetch:Zt}=xe({queryKey:["checkoutRestaurantData",i],queryFn:()=>gr(i),enabled:!!i,staleTime:1e3*60*5}),{data:O,isLoading:Qt}=xe({queryKey:["checkoutDeliveryZones",i],queryFn:()=>yr(x.id),enabled:!!x,staleTime:1e3*60*5}),{data:K,isLoading:Xt}=xe({queryKey:["checkoutPaymentMethods",i],queryFn:()=>wr(x.id),enabled:!!x,staleTime:1/0}),{data:w,isLoading:Qe,refetch:vr}=xe({queryKey:["checkoutCustomerData",c==null?void 0:c.id],queryFn:()=>jr(c.id),enabled:!!c,staleTime:0}),Q=a.useMemo(()=>x!=null&&x.latitude&&(x!=null&&x.longitude)?[x.latitude,x.longitude]:null,[x]);a.useEffect(()=>{const s=async()=>{document.hidden?(console.log("Página oculta. Iniciando timer de expiração de 20 minutos..."),oe.current=setTimeout(async()=>{console.log("Timer expirado. Deslogando usuário..."),await N.auth.signOut(),b.error("Sessão expirada.",{description:"Você ficou fora da página de checkout por mais de 20 minutos. Por favor, identifique-se novamente.",duration:6e3}),r("/auth",{state:{from:"/checkout",restaurantId:i},replace:!0})},12e5)):(console.log("Página visível. Cancelando timer de expiração."),oe.current&&(clearTimeout(oe.current),oe.current=null))};return document.addEventListener("visibilitychange",s),()=>{document.removeEventListener("visibilitychange",s),oe.current&&clearTimeout(oe.current)}},[r,i]);const Ht=a.useCallback(async(s,o,m,p,g,y,C)=>{const P=[30,45];if(x&&x.delivery_enabled===!1){const A=`${o}, ${m}, ${g}, ${p}, ${s}`;let _=null;if(y&&C?_={lat:y,lng:C}:_=await it(A),!_)return{coords:null,fee:0,time:null,isValid:!1};if(O&&O.length>0&&Q){const k=Me([_.lat,_.lng],Q,O);if(k)return{coords:_,fee:0,time:[k.minTime,k.maxTime],isValid:!0}}return{coords:_,fee:0,time:P,isValid:!0}}if(!x||!Q)return{coords:null,fee:0,time:P,isValid:!0};const X=`${o}, ${m}, ${g}, ${p}, ${s}`;let $=null;if(y&&C?$={lat:y,lng:C}:$=await it(X),!$)return{coords:null,fee:0,time:null,isValid:!1};if(O&&O.length>0){const A=Me([$.lat,$.lng],Q,O);return A?{coords:$,fee:A.fee,time:[A.minTime,A.maxTime],isValid:!0}:{coords:$,fee:0,time:null,isValid:!1}}else return{coords:$,fee:0,time:P,isValid:!0}},[x,Q,O]),d=ct({resolver:lt(xr),defaultValues:{name:"",phone:"",cpf_cnpj:"",delivery_option:"delivery",notes:"",payment_method_id:"",change_for:""},mode:"onBlur"}),l=ct({resolver:lt(hr),defaultValues:{zip_code:"",street:"",number:"",complement:"",neighborhood:"",city:""},mode:"onBlur"});a.useEffect(()=>{l.reset({zip_code:"",street:"",number:"",complement:"",neighborhood:"",city:""}),ne(!1),le(null),de(null),Z(0),re(null),G(!0)},[]);const M=d.watch("delivery_option"),Jt=d.watch("payment_method_id"),ae=K==null?void 0:K.find(s=>s.id===Jt),Ie=(tt=ae==null?void 0:ae.name)==null?void 0:tt.includes("online"),me=(st=ae==null?void 0:ae.name)==null?void 0:st.includes("Dinheiro"),q=h+we,je=l.watch(["zip_code","street","number","city","neighborhood","complement"]),Xe=a.useMemo(()=>{const[s,o,m,p,g,y]=je;return`${o}|${m}|${y||""}|${g}|${p}|${s}`},[je]);a.useEffect(()=>{if(!i)return;const s=N.channel("delivery-zones-changes").on("postgres_changes",{event:"*",schema:"public",table:"delivery_zones",filter:`restaurant_id=eq.${i}`},()=>{console.log("[Realtime] Zonas de entrega atualizadas. Invalidando query..."),u.invalidateQueries({queryKey:["checkoutDeliveryZones",i]}),b.info("As taxas de entrega foram atualizadas.",{duration:3e3})}).subscribe(),o=N.channel("restaurant-settings-changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"restaurants",filter:`id=eq.${i}`},()=>{console.log("[Realtime] Configurações do restaurante atualizadas. Invalidando query..."),u.invalidateQueries({queryKey:["checkoutRestaurantData",i]}),b.info("As configurações da loja foram atualizadas.",{duration:3e3})}).subscribe();return()=>{N.removeChannel(s),N.removeChannel(o)}},[i,u]),a.useEffect(()=>{if(M==="pickup"){Z(0),G(!0);return}if(z&&L&&Q&&O&&x)if(console.log("[Checkout] Recalculando taxa devido a mudanças nos dados...",{deliveryZones:O}),x.delivery_enabled===!1)Z(0),G(!0),te||re([30,45]);else{const s=Me(L,Q,O);s?(console.log("[Checkout] Nova taxa calculada:",s.fee),Z(s.fee),re([s.minTime,s.maxTime]),G(!0)):(console.warn("[Checkout] Endereço agora fora da área de entrega."),G(!1),Z(0),b.warning("As zonas de entrega mudaram e seu endereço agora está fora da área de cobertura."))}},[O,x==null?void 0:x.delivery_enabled,L,Q,z,M,te,x]),a.useEffect(()=>{if(w){if(d.reset({...d.getValues(),name:w.name||"",phone:gt(w.phone||""),cpf_cnpj:yt(w.cpf_cnpj||""),change_for:""}),w.street&&w.zip_code&&(l.reset({zip_code:w.zip_code,street:w.street,number:w.number||"",complement:w.complement||"",neighborhood:w.neighborhood||"",city:w.city||""}),w.latitude&&w.longitude)){le([Number(w.latitude),Number(w.longitude)]),ne(!0);const s=`${w.street}|${w.number}|${w.complement||""}|${w.neighborhood}|${w.city}|${w.zip_code}`;de(s)}}else if(c&&!Qe){const s=c.user_metadata;d.reset({...d.getValues(),name:s.full_name||"",phone:gt(s.phone||""),cpf_cnpj:yt(s.cpf_cnpj||""),change_for:""})}},[w,c,Qe,d,l]),a.useEffect(()=>{M==="delivery"&&Ae!==null&&Xe!==Ae&&(ne(!1),Z(0),re(null),G(!0),le(null),de(null))},[Xe,Ae,M]);const ve=d.watch("change_for");a.useEffect(()=>{if(me&&ve&&ve.trim()!==""){const s=ve.replace(",","."),o=parseFloat(s);isNaN(o)?d.setError("change_for",{message:"O troco deve ser um número válido."}):o<q?d.setError("change_for",{message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(q)}).`}):d.clearErrors("change_for")}else d.clearErrors("change_for")},[me,ve,q,d]);const be=De({mutationFn:async s=>{var ot;B(!0);const o=`${s.street}, ${s.number}${s.complement?` - ${s.complement}`:""}, ${s.neighborhood}, ${s.city}, ${s.zip_code}`,m=await Ht(s.zip_code,s.street,s.number,s.city,s.neighborhood);if(B(!1),!m.isValid)throw new Error((x==null?void 0:x.delivery_enabled)===!1?"O endereço está errado ou incompleto, revise todos os campos.":"Endereço fora da área de entrega.");if(!m.coords)throw new Error("Não foi possível obter as coordenadas para salvar o endereço.");const p=d.getValues("name"),g=d.getValues("phone"),y=d.getValues("cpf_cnpj"),C=g.replace(/\D/g,""),P=y.replace(/\D/g,"")||null;if(!p||C.length<10||!P||P.length!==11&&P.length!==14)throw new Error("Preencha Nome, Telefone (10+ dígitos) e CPF/CNPJ (11 ou 14 dígitos) nos Seus Dados antes de salvar o endereço.");const $=(ot=(await N.auth.getUser()).data.user)==null?void 0:ot.id;if(!(w!=null&&w.id)&&!$)return{customer:{id:"anonymous",user_id:null,name:p,phone:C,email:null,address:o,created_at:"",updated_at:"",latitude:m.coords.lat,longitude:m.coords.lng,cpf_cnpj:P,street:s.street,number:s.number,neighborhood:s.neighborhood,city:s.city,zip_code:s.zip_code,complement:s.complement||null},feeResult:m};const A={name:p,phone:C,cpf_cnpj:P},_={user_id:(c==null?void 0:c.id)||null,...A,email:(c==null?void 0:c.email)||null,address:o,latitude:m.coords.lat,longitude:m.coords.lng,street:s.street,number:s.number,neighborhood:s.neighborhood,city:s.city,zip_code:s.zip_code,complement:s.complement||null},k="*, street, number, neighborhood, city, zip_code, complement";let se;if(w!=null&&w.id){const{data:_e,error:ue}=await N.from("customers").update(_).eq("id",w.id).select(k).single();if(ue)throw ue;se=_e}else if($){const{data:_e,error:ue}=await N.from("customers").insert(_).select(k).single();if(ue)throw ue;se=_e}else throw new Error("Não foi possível identificar o cliente para salvar.");return{customer:se,feeResult:m}},onSuccess:(s,o)=>{const{customer:m,feeResult:p}=s;(m==null?void 0:m.id)!=="anonymous"&&u.invalidateQueries({queryKey:["checkoutCustomerData"]}),Z(p.fee),re(p.time),G(p.isValid),ne(!0),le([p.coords.lat,p.coords.lng]);const g=`${o.street}|${o.number}|${o.complement||""}|${o.neighborhood}|${o.city}|${o.zip_code}`;de(g),b.success("Endereço salvo e taxa de entrega calculada!")},onError:s=>{b.error(`Erro ao salvar endereço: ${s.message}`),G(!1),ne(!1)}}),Wt=s=>{console.log("[Checkout] Iniciando salvamento de endereço:",s),l.trigger().then(o=>{o?d.trigger(["name","phone","cpf_cnpj"]).then(m=>{m?(console.log("[Checkout] Dados de contato válidos, chamando mutação."),be.mutate(s)):(console.warn("[Checkout] Dados de contato inválidos:",d.getValues()),b.error("Preencha Nome, Telefone e CPF/CNPJ nos Seus Dados antes de salvar o endereço."))}):(console.warn("[Checkout] Dados de endereço inválidos:",l.formState.errors),b.error("Preencha todos os campos obrigatórios do endereço."))})},He=De({mutationFn:async s=>{var X,$;(X=(await N.auth.getUser()).data.user)==null||X.id;const m=s.phone.replace(/\D/g,""),p=(($=s.cpf_cnpj)==null?void 0:$.replace(/\D/g,""))||null;if(!s.name||m.length<10||p&&p.length!==11&&p.length!==14)throw new Error("Dados de contato incompletos ou inválidos.");const g=l.getValues(),y=M==="delivery"?`${g.street}, ${g.number}${g.complement?` - ${g.complement}`:""}, ${g.neighborhood}, ${g.city}, ${g.zip_code}`:null,C={user_id:(c==null?void 0:c.id)||null,name:s.name,phone:m,email:(c==null?void 0:c.email)||null,cpf_cnpj:p,address:y,latitude:L?L[0]:null,longitude:L?L[1]:null,street:l.getValues("street")||null,number:l.getValues("number")||null,neighborhood:l.getValues("neighborhood")||null,city:l.getValues("city")||null,zip_code:l.getValues("zip_code")||null,complement:l.getValues("complement")||null};c||(C.email=null);const P="*, street, number, neighborhood, city, zip_code, complement";if(c)if(w){const{data:A,error:_}=await N.from("customers").update(C).eq("id",w.id).select(P).single();if(_)throw _;return A}else{const{data:A,error:_}=await N.from("customers").insert(C).select(P).single();if(_)throw _;return A}else{const{data:A,error:_}=await N.from("customers").insert(C).select(P).single();if(_)throw _;return A}},onSuccess:()=>{u.invalidateQueries({queryKey:["checkoutCustomerData"]})},onError:s=>{b.error(`Erro ao salvar dados do cliente: ${s.message}`)}}),Je=De({mutationFn:async({customerId:s,data:o})=>{if(!x)throw new Error("Dados do restaurante não disponíveis.");let m=null;if(me&&o.change_for&&o.change_for.trim()!==""){const k=o.change_for.replace(",","."),se=parseFloat(k);!isNaN(se)&&se>q&&(m=se)}let[p,g]=te||[null,null];if((M==="delivery"||M==="pickup")&&(!p||!g)){const k=M==="pickup"?[15,30]:[30,45];p=k[0],g=k[1]}const y=l.getValues(),C=M==="delivery"?`${y.street}, ${y.number}${y.complement?` - ${y.complement}`:""}, ${y.neighborhood}, ${y.city}, ${y.zip_code}`:null,P={restaurant_id:x.id,customer_id:s,status:Ie?"pending_payment":"pending",total_amount:q,delivery_fee:we,delivery_address:C,notes:o.notes,payment_method_id:o.payment_method_id,change_for:m,min_delivery_time_minutes:p,max_delivery_time_minutes:g},{data:X,error:$}=await N.from("orders").insert(P).select("id").single();if($)throw $;const A=f.map(k=>({order_id:X.id,product_id:k.product.id,quantity:parseFloat(k.quantity.toFixed(3)),unit_price:parseFloat(k.product.price.toFixed(2)),subtotal:parseFloat(k.subtotal.toFixed(2)),notes:k.notes})),{error:_}=await N.from("order_items").insert(A);if(_)throw _;return X.id},onSuccess:s=>{u.invalidateQueries({queryKey:["orders"]})},onError:s=>{b.error(`Erro ao criar pedido: ${s.message}`)}}),Yt=async s=>{if(me&&s.change_for&&s.change_for.trim()!==""){const p=s.change_for.replace(",","."),g=parseFloat(p);if(isNaN(g)){b.error("O troco deve ser um número válido.");return}if(g<q){d.setError("change_for",{type:"manual",message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(q)}).`});return}}if(f.length===0){b.error("Seu carrinho está vazio."),r(`/menu/${i}`);return}if(M==="delivery"){if(!z){b.error("Você deve salvar e validar o endereço de entrega antes de finalizar o pedido.");return}if(!Pe){b.error("O endereço de entrega está fora da área de cobertura.");return}}let o;try{o=(await He.mutateAsync(s)).id}catch(p){b.error(`Falha ao salvar cliente: ${p.message}`);return}let m;try{m=await Je.mutateAsync({customerId:o,data:s})}catch(p){b.error(`Falha ao criar pedido: ${p.message}`);return}Ie?await es(m,s):(j(),r(`/order-success/${m}`,{replace:!0}))},es=async(s,o)=>{if(!x)return;const m=window.location.origin+window.location.pathname,p=f.map(y=>({name:y.product.name,price:y.product.price,quantity:y.quantity})),g=b.loading("Preparando pagamento online...");try{const{data:y,error:C}=await N.functions.invoke("create-payment-preference",{body:{orderId:s,items:p,totalAmount:q,restaurantName:x.name,clientUrl:m,customerEmail:(c==null?void 0:c.email)||"cliente@anonimo.com",customerCpfCnpj:o.cpf_cnpj}});if(C)throw C;const{init_point:P}=y;qt(s),Bt(P),$e(!0),b.dismiss(g)}catch(y){b.dismiss(g),b.error(`Erro no pagamento online: ${y.message}`),$e(!1)}},ts=async()=>{await N.auth.signOut(),b.success("Você saiu da sua conta."),r("/auth",{replace:!0})},ss=(s,o,m)=>{o&&m?(ke(s),Ke(!0)):(d.setValue("payment_method_id",s,{shouldValidate:!0}),ke(null))},rs=()=>{Ue&&d.setValue("payment_method_id",Ue,{shouldValidate:!0}),Ke(!1),ke(null)},ns=a.useCallback(s=>{l.setValue("zip_code",s.zip_code,{shouldValidate:!0}),l.setValue("street",s.street,{shouldValidate:!0}),l.setValue("neighborhood",s.neighborhood,{shouldValidate:!0}),l.setValue("city",s.city,{shouldValidate:!0}),l.setValue("number",s.number,{shouldValidate:!0}),l.setValue("complement","",{shouldValidate:!0}),s.number?b.info("Endereço encontrado! Verifique o número e clique em Salvar."):b.warning("Endereço encontrado! Por favor, preencha o campo 'Número' e clique em Salvar."),ne(!1),Z(0),re(null),G(!0),le(null),de(null)},[l]),We=a.useMemo(()=>{const[s,o,m,p,g,y]=je;return o&&m&&g&&p&&s?`${o}, ${m}${y?` - ${y}`:""} - ${g}, ${p}, ${s}`:""},[je]);if(!i)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(ie,{variant:"destructive",className:"max-w-lg",children:[e.jsx(ft,{className:"h-4 w-4"}),e.jsx(fe,{children:"Erro de Rastreamento"}),e.jsx(he,{children:"Não foi possível identificar o restaurante para o qual o pedido está sendo feito. Por favor, volte ao menu."}),e.jsx(Fe,{to:"/",children:e.jsx(H,{className:"mt-3",variant:"secondary",size:"sm",children:"Voltar"})})]})});if(f.length===0)return a.useEffect(()=>{r(`/menu/${i}`)},[r,i]),e.jsx(at,{});if(Kt||Qt||Xt||E)return e.jsx(at,{});if(Ut||!x)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(ie,{variant:"destructive",className:"max-w-lg",children:[e.jsx(ft,{className:"h-4 w-4"}),e.jsx(fe,{children:"Erro Crítico"}),e.jsx(he,{children:Ze instanceof Error?Ze.message:"Não foi possível carregar os dados do restaurante."}),e.jsxs(H,{onClick:()=>Zt(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(Os,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]})});const Ye=He.isPending||Je.isPending||be.isPending||F||M==="delivery"&&!z;return e.jsx("div",{className:"min-h-screen bg-background w-full overflow-x-hidden",children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-6 py-4 sm:py-8 max-w-5xl space-y-6 sm:space-y-8",children:[e.jsx(Es,{isOpen:R,onClose:()=>I(!1),customer:w}),e.jsx(pr,{isOpen:Gt,onConfirm:rs}),Lt&&Ge&&e.jsx(mr,{preferenceId:zt,initPoint:Ge,onClose:()=>$e(!1)}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto",children:[e.jsx(Fe,{to:`/menu/${i}`,children:e.jsx(H,{variant:"ghost",size:"icon","aria-label":"Voltar ao Menu",children:e.jsx(Ls,{className:"h-6 w-6"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg sm:text-3xl font-bold text-foreground",children:"Finalizar Pedido"}),e.jsx("p",{className:"text-xs sm:text-lg text-muted-foreground font-medium truncate max-w-full",children:x.name})]})]}),c&&e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto justify-end",children:[e.jsxs(H,{variant:"outline",size:"sm",onClick:()=>I(!0),"aria-label":"Meu Perfil e Pedidos",className:"flex-1 sm:flex-none text-xs sm:text-sm h-8 sm:h-9",children:[e.jsx(ht,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"})," ",e.jsx("span",{className:"truncate",children:"Perfil / Pedidos"})]}),e.jsxs(H,{variant:"outline",size:"sm",onClick:ts,className:"flex-shrink-0 text-xs sm:text-sm h-8 sm:h-9",children:[e.jsx(Ss,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"})," Sair"]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 sm:gap-8 w-full",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6 min-w-0",children:[e.jsxs(J,{className:"w-full overflow-hidden",children:[e.jsx(W,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(Y,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(ht,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Seus Dados"]})}),e.jsxs(ee,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx("div",{className:"flex justify-between items-center mb-3 sm:mb-4",children:e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:c?`Logado como ${c.email}`:"Pedido anônimo"})}),e.jsx(pt,{...d,children:e.jsx("form",{onSubmit:d.handleSubmit(Yt),id:"checkout-form",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(V,{htmlFor:"name",className:"text-xs sm:text-sm",children:"Nome Completo *"}),e.jsx(ce,{id:"name",...d.register("name"),className:"h-9 sm:h-12 text-sm w-full"}),d.formState.errors.name&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:d.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(V,{htmlFor:"phone",className:"text-xs sm:text-sm",children:"Telefone *"}),e.jsx(pe,{name:"phone",control:d.control,render:({field:s})=>e.jsx(_s,{id:"phone",...s,className:"h-9 sm:h-12 text-sm w-full"})}),d.formState.errors.phone&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:d.formState.errors.phone.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(V,{htmlFor:"cpf_cnpj",className:"text-xs sm:text-sm",children:"CPF/CNPJ *"}),e.jsx(pe,{name:"cpf_cnpj",control:d.control,render:({field:s})=>e.jsx(ks,{id:"cpf_cnpj",...s,className:"h-9 sm:h-12 text-sm w-full"})}),d.formState.errors.cpf_cnpj&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:d.formState.errors.cpf_cnpj.message})]})]})})})]})]}),e.jsxs(J,{className:"w-full overflow-hidden",children:[e.jsx(W,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(Y,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(Ve,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Opção de Entrega"]})}),e.jsx(ee,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsx(pe,{name:"delivery_option",control:d.control,render:({field:s})=>e.jsxs(Le,{onValueChange:s.onChange,value:s.value,className:"grid grid-cols-2 gap-2 sm:gap-4 min-w-0 w-full",children:[e.jsxs(V,{htmlFor:"delivery",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-2 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer text-center w-full max-w-full",children:[e.jsx(Ee,{value:"delivery",id:"delivery",className:"sr-only"}),e.jsx(Ve,{className:"mb-1.5 sm:mb-3 h-4 w-4 sm:h-6 sm:w-6 flex-shrink-0"}),e.jsx("span",{translate:"no",className:"text-xs sm:text-base break-words w-full",children:"Entrega"})]}),e.jsxs(V,{htmlFor:"pickup",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-2 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer text-center w-full max-w-full",children:[e.jsx(Ee,{value:"pickup",id:"pickup",className:"sr-only"}),e.jsx(Oe,{className:"mb-1.5 sm:mb-3 h-4 w-4 sm:h-6 sm:w-6 flex-shrink-0"}),e.jsx("span",{translate:"no",className:"text-xs sm:text-base break-words w-full",children:"Retirada no Local"})]})]})})})]}),M==="delivery"&&e.jsxs(J,{className:ye("w-full overflow-hidden",!z&&"border-destructive ring-2 ring-destructive/50"),children:[e.jsxs(W,{className:"px-3 sm:px-6 py-3 sm:py-6",children:[e.jsxs(Y,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Endereço de Entrega",z&&e.jsx(zs,{className:"h-4 w-4 sm:h-5 sm:w-5 text-green-500 ml-2 flex-shrink-0"}),!z&&e.jsx(Ce,{className:"h-4 w-4 sm:h-5 sm:w-5 text-destructive ml-2 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Preencha e salve para calcular a taxa."})]}),e.jsxs(ee,{className:"space-y-3 sm:space-y-4 px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx(pt,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(Wt),id:"address-form-inner",className:"space-y-3 sm:space-y-4",autoComplete:"off",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(V,{htmlFor:"address-search",className:"text-xs sm:text-sm",children:"Buscar Endereço"}),e.jsx(fr,{onAddressSelect:ns,disabled:F})]}),e.jsx("input",{type:"hidden",...l.register("street")}),e.jsx("input",{type:"hidden",...l.register("city")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(V,{htmlFor:"neighborhood",className:"text-xs sm:text-sm",children:"Bairro *"}),e.jsx(ce,{id:"neighborhood",...l.register("neighborhood"),placeholder:"Seu bairro",className:"h-9 sm:h-12 text-sm"}),l.formState.errors.neighborhood&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:l.formState.errors.neighborhood.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(V,{htmlFor:"zip_code",className:"text-xs sm:text-sm",children:"CEP *"}),e.jsx(pe,{name:"zip_code",control:l.control,render:({field:s})=>e.jsx(hs,{id:"zip_code",...s,className:"h-9 sm:h-12 text-sm"})}),l.formState.errors.zip_code&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:l.formState.errors.zip_code.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(V,{htmlFor:"number",className:"text-xs sm:text-sm",children:"Número *"}),e.jsx(ce,{id:"number",...l.register("number"),placeholder:"Nº",className:"h-9 sm:h-12 text-sm",autoComplete:"off"}),l.formState.errors.number&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:l.formState.errors.number.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(V,{htmlFor:"complement",className:"text-xs sm:text-sm",children:"Complemento"}),e.jsx(ce,{id:"complement",...l.register("complement"),placeholder:"Apto, Bloco...",className:"h-9 sm:h-12 text-sm",autoComplete:"off"})]})]}),l.watch("street")&&e.jsxs("div",{className:"bg-muted p-2 sm:p-3 rounded text-xs sm:text-sm break-words overflow-hidden",children:[e.jsx("p",{children:e.jsx("strong",{children:"Endereço:"})}),e.jsxs("p",{children:[l.watch("street"),l.watch("number")?`, ${l.watch("number")}`:"",l.watch("complement")?` - ${l.watch("complement")}`:""]}),e.jsxs("p",{children:[l.watch("neighborhood"),", ",l.watch("city")]})]}),e.jsxs(H,{type:"submit",className:"w-full h-auto py-2 text-xs sm:text-base mt-2 whitespace-normal",disabled:be.isPending||F,children:[be.isPending||F?e.jsx(ge,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin mr-2"}):e.jsx(qs,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2"}),"Salvar e Calcular"]})]})}),F&&e.jsxs(ie,{className:"flex items-center gap-2 p-2 sm:p-4",children:[e.jsx(ge,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin"}),e.jsx(fe,{className:"text-xs sm:text-sm",children:"Calculando..."})]}),z&&!F&&e.jsxs(e.Fragment,{children:[x.delivery_enabled!==!1&&!Pe&&e.jsxs(ie,{variant:"destructive",className:"p-2 sm:p-4",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx(fe,{className:"text-sm",children:"Fora da Área"}),e.jsx(he,{className:"text-xs",children:"Endereço fora da área de cobertura."})]}),(x.delivery_enabled===!1||Pe&&te)&&e.jsxs(ie,{variant:"default",className:"bg-green-50 dark:bg-green-900/20 border-green-200 text-green-700 p-2 sm:p-4",children:[e.jsx(Ve,{className:"h-4 w-4"}),e.jsx(fe,{className:"text-sm",children:"Entrega Disponível"}),e.jsxs(he,{className:"text-xs",children:["Taxa: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(we),". Tempo: ",te?`${te[0]}-${te[1]}`:"30-45"," min."]})]})]}),z&&L&&We&&e.jsx("div",{className:"mt-4 w-full overflow-hidden rounded-md border",children:e.jsx(ur,{latitude:L[0],longitude:L[1],address:We,className:"w-full"})})]})]}),e.jsxs(J,{className:"w-full overflow-hidden",children:[e.jsx(W,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(Y,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(bt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Pagamento *"]})}),e.jsxs(ee,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx(pe,{name:"payment_method_id",control:d.control,render:({field:s})=>e.jsx(Le,{onValueChange:o=>{var y;const m=K==null?void 0:K.find(C=>C.id===o),p=(y=m==null?void 0:m.name)==null?void 0:y.includes("online"),g=!!D&&D.trim()!=="";ss(o,!!p,g)},value:s.value,className:"space-y-2 sm:space-y-3 w-full",children:K==null?void 0:K.map(o=>{var y;const m=(y=o.name)==null?void 0:y.includes("online"),p=!!D&&D.trim()!=="",g=m&&!p;return e.jsx(V,{htmlFor:o.id,className:ye("flex items-center justify-between rounded-md border-2 border-muted bg-popover p-2.5 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer w-full max-w-full",g&&"opacity-50 cursor-not-allowed"),children:e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 overflow-hidden min-w-0 w-full",children:[e.jsx(Ee,{value:o.id,id:o.id,disabled:g,className:"flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-xs sm:text-base break-words w-full leading-tight whitespace-normal",translate:"no",children:o.name}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground truncate",children:o.description}),g&&e.jsx("p",{className:"text-[10px] text-destructive mt-0.5",children:"Indisponível no momento."})]})]})},o.id)})})}),d.formState.errors.payment_method_id&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm mt-2",children:d.formState.errors.payment_method_id.message})]})]}),me&&e.jsxs(J,{className:"w-full overflow-hidden",children:[e.jsx(W,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(Y,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(Bs,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Troco"]})}),e.jsx(ee,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(V,{htmlFor:"change_for",className:"text-xs sm:text-sm",children:"Precisa de troco para quanto?"}),e.jsx(ce,{id:"change_for",type:"number",step:"0.01",placeholder:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(q),...d.register("change_for"),className:"h-9 sm:h-12 text-sm w-full"}),((rt=d.formState.errors.change_for)==null?void 0:rt.message)&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:d.formState.errors.change_for.message}),((nt=d.formState.errors.change_for)==null?void 0:nt.type)==="manual"&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:d.formState.errors.change_for.message})]})})]}),e.jsxs(J,{className:"w-full overflow-hidden",children:[e.jsx(W,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(Y,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(Ns,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Observações"]})}),e.jsx(ee,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(V,{htmlFor:"notes",className:"text-xs sm:text-sm",children:"Notas para o restaurante"}),e.jsx(ys,{id:"notes",...d.register("notes"),rows:3,placeholder:"Ex: Entregar na portaria, sem pimenta...",className:"text-sm w-full"})]})})]})]}),e.jsx("div",{className:"lg:col-span-1 space-y-6 sticky top-4 self-start min-w-0",children:e.jsxs(J,{className:"shadow-lg w-full overflow-hidden",children:[e.jsx(W,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsx(Y,{className:"text-lg sm:text-2xl",children:"Resumo"})}),e.jsxs(ee,{className:"space-y-3 sm:space-y-4 px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:f.map(s=>e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsxs("span",{className:"truncate max-w-[70%]",children:[s.quantity,"x ",s.product.name]}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.subtotal)})]},s.product.id))}),e.jsx(dt,{}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm text-muted-foreground",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(h)})]}),e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm text-muted-foreground",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(we)})]})]}),e.jsx(dt,{}),e.jsxs("div",{className:"flex justify-between font-bold text-base sm:text-xl",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(q)})]}),e.jsx(H,{type:"submit",form:"checkout-form",className:"w-full h-10 sm:h-12 text-sm sm:text-lg",disabled:Ye,children:Ye?e.jsx(ge,{className:"h-4 w-4 sm:h-5 sm:w-5 animate-spin mr-2"}):Ie?"Pagar e Finalizar":"Confirmar Pedido"}),M==="delivery"&&!z&&e.jsxs(ie,{variant:"destructive",className:"mt-3 p-2 sm:p-4",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx(he,{className:"text-xs",children:"Salve o endereço acima para continuar."})]}),e.jsx(Fe,{to:`/menu/${x.id}`,className:"block text-center text-xs sm:text-sm text-muted-foreground hover:underline mt-2",children:"Voltar ao Cardápio"})]})]})})]})]})})};export{pn as default};
