import{b as E,u as P,c as T,j as e}from"./tanstack-DXzASLyu.js";import{r as f,f as _}from"./vendor-YgypLURK.js";import{s as v}from"./client-lAKPhnc8.js";import{B as u}from"./button-DP4ALDeA.js";import{C as D,a as A,b as q,c as O}from"./card-C-CnIMNv.js";import{S as k,a as R,b as B,c as L,d as M,T as I,e as F,f as z,g as V,C as $}from"./select-DqCYTfPg.js";import{D as K,a as Q,b as U,c as H,d as X,e as G,B as J}from"./index-rPgJERu9.js";import{S as j}from"./skeleton-B0AKWOGq.js";import{A as W,a as Y,b as Z}from"./alert-De_8ugH3.js";import{c as ee,u as b,b as se,X as ae}from"./index-DXHl_ahK.js";import{S as N}from"./separator-BRCASUWm.js";import{P as re}from"./printer-DAtqbVfS.js";import{useSound as te}from"./DashboardLayout-ChvUFp38.js";import{T as le}from"./terminal-CQzCYpR2.js";import{S as ne}from"./shopping-cart-4QEFDznm.js";import{C as oe}from"./clock-rZxylPop.js";import{C,a as ie}from"./circle-x-74y0LQVq.js";import{U as ce}from"./utensils-CwGIGk6T.js";import{P as de}from"./package-CJ1WO16U.js";import{T as me}from"./truck-gSPMqLHL.js";import{D as ue}from"./dollar-sign-By9Vc7J5.js";import"./supabase-Bm28tI2t.js";import"./index-x5CuAdtz.js";import"./index-DvUVZ62n.js";import"./index-DWN4L6UK.js";import"./index-CUvv1sQ9.js";import"./Logo-B-xW5QzC.js";import"./credit-card-CWjkqqva.js";import"./settings-XJBXxZUx.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=ee("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),S={pending:{label:"Pendente"},confirmed:{label:"Confirmado"},preparing:{label:"Em Preparação"},ready:{label:"Pronto"},delivering:{label:"Em Entrega"},delivered:{label:"Entregue"},cancelled:{label:"Cancelado"},pending_payment:{label:"Aguardando Pagamento"}},xe=async s=>{const{data:o,error:r}=await v.from("order_items").select("*, products(name)").eq("order_id",s);if(r)throw new Error(r.message);return o},he=({order:s,isOpen:o,onClose:r})=>{var x,h;const c=E(),[l,i]=f.useState("pending");f.useEffect(()=>{s!=null&&s.status&&i(s.status)},[s]);const{data:d,isLoading:m}=P({queryKey:["orderItems",s==null?void 0:s.id],queryFn:()=>xe(s.id),enabled:!!s&&o}),n=T({mutationFn:async t=>{if(!s)throw new Error("Pedido não encontrado.");const{error:a}=await v.from("orders").update({status:t}).eq("id",s.id);if(a)throw new Error(a.message)},onSuccess:(t,a)=>{b.success(`Status do pedido atualizado para "${S[a].label}"`),c.invalidateQueries({queryKey:["orders"]}),r()},onError:t=>{b.error(`Erro ao atualizar status: ${t.message}`)}}),y=()=>{window.print()};if(!s)return null;const p=s.created_at?new Date(s.created_at).getTime().toString().slice(-4):"N/A";return e.jsx(K,{open:o,onOpenChange:r,children:e.jsxs(Q,{className:"sm:max-w-lg",children:[e.jsxs(U,{children:[e.jsxs(H,{children:["Detalhes do Pedido #",p]}),e.jsx(X,{children:"Gerencie os detalhes e o status deste pedido."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold",children:"Cliente"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nome: ",((x=s.customer)==null?void 0:x.name)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Telefone: ",((h=s.customer)==null?void 0:h.phone)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Endereço: ",s.delivery_address||"N/A"]})]}),e.jsx(N,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Itens do Pedido"}),m?e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"h-8 w-full"}),e.jsx(j,{className:"h-8 w-full"})]}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto pr-2",children:d==null?void 0:d.map(t=>{var a;return e.jsxs("div",{className:"flex justify-between items-start text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[t.quantity,"x ",((a=t.products)==null?void 0:a.name)||"Produto desconhecido"]}),t.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground italic",children:["Obs: ",t.notes]})]}),e.jsx("span",{className:"text-muted-foreground",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.subtotal)})]},t.id)})})]}),e.jsx(N,{}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsx("span",{className:"font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.delivery_fee||0)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-base",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]})]}),e.jsx(N,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Atualizar Status"}),e.jsxs(k,{value:l,onValueChange:t=>i(t),children:[e.jsx(R,{children:e.jsx(B,{placeholder:"Selecione um status"})}),e.jsx(L,{children:Object.entries(S).map(([t,{label:a}])=>e.jsx(M,{value:t,children:a},t))})]})]})]}),e.jsxs(G,{className:"flex-col sm:flex-row sm:justify-between sm:space-x-2",children:[e.jsxs(u,{variant:"outline",onClick:y,className:"w-full sm:w-auto mb-2 sm:mb-0",children:[e.jsx(re,{className:"h-4 w-4 mr-2"})," Imprimir Pedido"]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(u,{variant:"outline",onClick:r,children:"Cancelar"}),e.jsx(u,{onClick:()=>n.mutate(l),disabled:n.isPending||l===s.status,children:n.isPending?"Salvando...":"Salvar Alterações"})]})]})]})})},ge={pending:{label:"Pendente",icon:oe,color:"bg-yellow-500 hover:bg-yellow-600"},confirmed:{label:"Confirmado",icon:C,color:"bg-blue-500 hover:bg-blue-600"},preparing:{label:"Em Preparação",icon:ce,color:"bg-orange-500 hover:bg-orange-600"},ready:{label:"Pronto",icon:de,color:"bg-green-500 hover:bg-green-600"},delivering:{label:"Em Entrega",icon:me,color:"bg-indigo-500 hover:bg-indigo-600"},delivered:{label:"Entregue",icon:C,color:"bg-primary hover:bg-primary/90"},cancelled:{label:"Cancelado",icon:ie,color:"bg-destructive hover:bg-destructive/90"},pending_payment:{label:"Aguardando Pag.",icon:ue,color:"bg-gray-500 hover:bg-gray-600"}},fe=async(s,o)=>{let r=v.from("orders").select("*, customer:customers(name, phone)").eq("restaurant_id",s).order("created_at",{ascending:!1});o!=="all"&&(r=r.eq("status",o));const{data:c,error:l}=await r;if(l)throw new Error(`Erro ao buscar pedidos: ${l.message}`);return c},je=({order:s,onViewDetails:o,onAccept:r,onDecline:c})=>{var m;const l=ge[s.status||"pending"],i=((m=s.customer)==null?void 0:m.name)||"Cliente Desconhecido",d=s.created_at?new Date(s.created_at).getTime().toString().slice(-4):"N/A";return e.jsxs(D,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col",children:[e.jsxs(q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs(O,{className:"text-lg font-bold flex items-center gap-2",children:["Pedido #",d]}),e.jsxs(J,{className:se("text-white",l.color),children:[e.jsx(l.icon,{className:"h-3 w-3 mr-1"}),l.label]})]}),e.jsxs(A,{className:"space-y-2 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",i]}),e.jsx("p",{className:"text-2xl font-extrabold text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]}),e.jsxs("div",{className:"flex justify-end pt-2 border-t gap-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(u,{variant:"destructive",size:"sm",onClick:()=>c(s.id),children:[e.jsx(ae,{className:"h-4 w-4 mr-1"})," Recusar"]}),e.jsxs(u,{variant:"default",size:"sm",onClick:()=>r(s.id),children:[e.jsx($,{className:"h-4 w-4 mr-1"})," Aceitar"]})]}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>o(s),children:"Detalhes"})]})]})]})},be=({status:s,onViewDetails:o,restaurantId:r})=>{const c=E(),{stopSoundLoop:l}=te(),{data:i,isLoading:d,isError:m,error:n,refetch:y}=P({queryKey:["orders",s,r],queryFn:()=>fe(r,s),enabled:!!r}),p=T({mutationFn:async({orderId:a,newStatus:g})=>{const{error:w}=await v.from("orders").update({status:g}).eq("id",a);if(w)throw new Error(w.message);return g},onSuccess:a=>{b.success(`Pedido ${a==="confirmed"?"aceito":"recusado"} com sucesso!`),c.invalidateQueries({queryKey:["orders"]})},onError:a=>b.error(`Erro ao atualizar pedido: ${a.message}`)}),x=a=>{l(),p.mutate({orderId:a,newStatus:"confirmed"})},h=a=>{l(),p.mutate({orderId:a,newStatus:"cancelled"})},t=a=>{l(),o(a)};return d?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((a,g)=>e.jsx(D,{children:e.jsx(A,{className:"p-4 space-y-3",children:e.jsx(j,{className:"h-32 w-full"})})},g))}):m?e.jsxs(W,{variant:"destructive",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx(Y,{children:"Erro ao carregar pedidos"}),e.jsx(Z,{children:n instanceof Error?n.message:"Ocorreu um erro desconhecido."}),e.jsxs(u,{onClick:()=>y(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]}):!i||i.length===0?e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg border",children:[e.jsx(ne,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifique o status selecionado ou aguarde novos pedidos."})]}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:i.map(a=>e.jsx(je,{order:a,onViewDetails:t,onAccept:x,onDecline:h},a.id))})},Ge=()=>{const{restaurant:s}=_(),[o,r]=f.useState(null),[c,l]=f.useState(!1),i=n=>{r(n),l(!0)},d=()=>{l(!1),r(null)},m=[{value:"pending_payment",label:"Aguardando Pag."},{value:"pending",label:"Pendentes"},{value:"confirmed",label:"Confirmados"},{value:"preparing",label:"Em Preparação"},{value:"ready",label:"Prontos"},{value:"delivering",label:"Em Entrega"},{value:"delivered",label:"Entregues"},{value:"cancelled",label:"Cancelados"},{value:"all",label:"Todos"}];return e.jsxs(e.Fragment,{children:[e.jsx(he,{order:o,isOpen:c,onClose:d}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:s!=null&&s.id?e.jsxs(I,{defaultValue:"pending_payment",children:[e.jsx(F,{className:"w-full overflow-x-auto justify-start",children:m.map(n=>e.jsx(z,{value:n.value,className:"whitespace-nowrap",children:n.label},n.value))}),m.map(n=>e.jsx(V,{value:n.value,className:"mt-6",children:e.jsx(be,{status:n.value,onViewDetails:i,restaurantId:s.id})},n.value))]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(j,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Carregando dados do restaurante..."})]})})]})};export{Ge as default};
