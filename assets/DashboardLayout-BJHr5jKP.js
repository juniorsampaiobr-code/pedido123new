import{j as e,b as H,u as V}from"./tanstack-D8i8yNxB.js";import{j as L,L as _,r as o,u as U,O as Q}from"./vendor-Dl0Wzy4_.js";import{s as h}from"./client-BmrnLCXS.js";import{L as G}from"./Logo-BJVg-sAD.js";import{c as x,b as K,u as c,F as $,T as A,f as T,B as S,g as E,L as B}from"./index-BvPQlImA.js";import{P as W}from"./package-B_Wl76XO.js";import{S as D}from"./shopping-cart-DJILlmtG.js";import{C as X}from"./clock-SfY_rsmR.js";import{C as J}from"./credit-card-BaAZvW8d.js";import{T as Y}from"./truck-d4DObI1X.js";import{S as Z}from"./settings-T6J6N551.js";import{A as ee,b as ae,c as re,d as oe,e as se,f as te,h as ne}from"./alert-dialog-ZkuSiQ4O.js";import"./supabase-A1WgB1xz.js";import"./index-kIXEvKcz.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=x("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=x("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=x("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=x("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=x("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),ue=[{href:"/dashboard",label:"Dashboard",icon:le},{href:"/products",label:"Produtos",icon:W},{href:"/orders",label:"Pedidos",icon:D},{href:"/cashier",label:"Caixa",icon:ce},{href:"/hours",label:"HorÃ¡rios",icon:X},{href:"/payments",label:"Pagamentos",icon:J},{href:"/delivery",label:"Taxa de Entrega",icon:Y},{href:"/settings",label:"ConfiguraÃ§Ãµes",icon:Z}],he=()=>{const t=L();return e.jsxs("aside",{className:"w-64 flex-shrink-0 border-r bg-card h-screen sticky top-0 flex-col hidden lg:flex",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx(G,{})}),e.jsx("nav",{className:"flex-grow p-4",children:e.jsx("ul",{children:ue.map(d=>e.jsx("li",{children:e.jsxs(_,{to:d.href,className:K("flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors",t.pathname===d.href?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted hover:text-foreground"),children:[e.jsx(d.icon,{className:"h-4 w-4"}),d.label]})},d.href))})})]})},me=({isOpen:t,onEnable:d})=>e.jsx(ee,{open:t,children:e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-6 w-6 text-primary"}),"Ativar NotificaÃ§Ãµes Sonoras?"]}),e.jsxs(se,{children:["Para garantir que vocÃª nÃ£o perca nenhum novo pedido, precisamos da sua permissÃ£o para tocar um som de notificaÃ§Ã£o.",e.jsx("br",{}),e.jsx("br",{}),'Ao clicar em "Ativar", um som de teste serÃ¡ reproduzido.']})]}),e.jsx(te,{children:e.jsx(ne,{onClick:d,className:"w-full",children:"Sim, ativar som"})})]})}),pe="https://cdn.jsdelivr.net/gh/lovable-dev/assets@main/sounds/notification-bell.mp3",I=o.createContext(null),Pe=()=>{const t=o.useContext(I);if(!t)throw new Error("useSound must be used within a DashboardLayout");return t},fe=t=>xe.find(m=>m.href===t)?item.label:"Dashboard",xe=[{href:"/dashboard",label:"Dashboard"},{href:"/products",label:"Produtos"},{href:"/orders",label:"Pedidos"},{href:"/cashier",label:"Caixa"},{href:"/hours",label:"HorÃ¡rios"},{href:"/payments",label:"Pagamentos"},{href:"/delivery",label:"Taxa de Entrega"},{href:"/settings",label:"ConfiguraÃ§Ãµes"}],ge=()=>{const t=U(),d=L(),m=H(),[j,C]=o.useState(null),s=o.useRef(null),[n,k]=o.useState("loading"),[O,w]=o.useState(!1),[p,y]=o.useState(null),[i,f]=o.useState(()=>localStorage.getItem("soundNotificationStatus")||"disabled");o.useEffect(()=>{localStorage.setItem("soundNotificationStatus",i)},[i]);const{data:q,isLoading:M}=V({queryKey:["dashboardRestaurant"],queryFn:async()=>{const{data:a,error:l}=await h.from("restaurants").select("*").limit(1).single();if(l)throw new Error(l.message);return a},enabled:!!j,staleTime:1/0});o.useEffect(()=>{!localStorage.getItem("hasSeenSoundPermissionModal")&&i!=="enabled"&&n==="ready"&&w(!0)},[i,n]),o.useEffect(()=>{(async()=>{const{data:{session:r}}=await h.auth.getSession();r!=null&&r.user?C(r.user):t("/auth")})();const{data:{subscription:l}}=h.auth.onAuthStateChange((r,b)=>{r==="SIGNED_OUT"?t("/"):b!=null&&b.user?C(b.user):t("/auth")});return()=>l.unsubscribe()},[t]);const u=o.useCallback(()=>{s.current&&(s.current.pause(),s.current.loop=!1,y(null))},[]),N=o.useCallback(a=>{if(i==="enabled"&&s.current&&n==="ready"){if(p)return;y(a),s.current.loop=!0,s.current.play().catch(l=>{console.error("Erro na reproduÃ§Ã£o automÃ¡tica de Ã¡udio:",l),y(null),c.warning("NÃ£o foi possÃ­vel tocar o som automaticamente.",{description:"Interaja com a pÃ¡gina para permitir a reproduÃ§Ã£o de som."})})}},[i,n,p]);o.useEffect(()=>{const a=h.channel("new-orders-toast").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders"},l=>{m.invalidateQueries({queryKey:["orders"]});const r=l.new;r.status==="pending"&&r.id&&(c.info("ðŸ”” Novo pedido recebido!",{description:`Pedido #${r.id.slice(-4)} estÃ¡ aguardando confirmaÃ§Ã£o.`,duration:15e3}),N(r.id))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders"},l=>{m.invalidateQueries({queryKey:["orders"]});const r=l.new;r.id===p&&u(),r.status==="pending"&&r.id&&l.old.status==="pending_payment"&&c.success("âœ… Pagamento Confirmado!",{description:`Pedido #${r.id.slice(-4)} foi pago e estÃ¡ pronto para preparo.`,duration:5e3})}).subscribe();return()=>{h.removeChannel(a)}},[m,N,u,p]);const v=o.useCallback(()=>{i==="enabled"&&s.current&&n==="ready"&&(u(),s.current.loop=!1,s.current.currentTime=0,s.current.play().catch(a=>{console.error("Erro na reproduÃ§Ã£o de Ã¡udio de teste:",a)}))},[i,n,u]),F=async()=>{if(n!=="ready"||!s.current){c.error("O arquivo de som ainda nÃ£o estÃ¡ pronto. Tente novamente em um momento.");return}try{s.current.currentTime=0,await s.current.play(),f("enabled"),c.success("NotificaÃ§Ãµes sonoras ativadas!"),localStorage.setItem("hasSeenSoundPermissionModal","true")}catch(a){console.error("Audio activation failed from modal:",a),c.error("Falha ao ativar o som.",{description:"Seu navegador pode ter bloqueado a reproduÃ§Ã£o. Por favor, tente ativar manualmente no Ã­cone do cabeÃ§alho."}),f("error")}finally{w(!1)}},R=async()=>{if(i==="enabled"){u(),f("disabled"),c.info("NotificaÃ§Ãµes sonoras desativadas.");return}if(n!=="ready"||!s.current){c.error("Som de notificaÃ§Ã£o nÃ£o estÃ¡ pronto ou configurado.");return}try{await v(),f("enabled"),c.success("NotificaÃ§Ãµes sonoras ativadas!",{description:"VocÃª ouviu o som de teste."})}catch(a){console.error("Audio activation failed:",a),c.error("Falha ao ativar o som.",{description:"Seu navegador pode ter bloqueado. Clique na pÃ¡gina e tente novamente."}),f("error")}},z=async()=>{await h.auth.signOut()};if(!j||M)return e.jsx($,{});const g=n!=="ready";return e.jsxs(I.Provider,{value:{playSound:v,stopSoundLoop:u,soundStatus:i,loopingOrderId:p},children:[e.jsx(me,{isOpen:O,onEnable:F}),e.jsxs("div",{className:"flex min-h-screen bg-muted/40",children:[e.jsx(he,{}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"border-b bg-background sticky top-0 z-40",children:e.jsxs("div",{className:"container max-w-none mx-auto px-8 h-16 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(D,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-xl font-semibold",children:fe(d.pathname)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{children:[e.jsx(T,{asChild:!0,children:e.jsx(S,{variant:"outline",size:"sm",onClick:v,disabled:g,children:"Testar Som"})}),g&&e.jsx(E,{children:e.jsx("p",{children:"Carregando som..."})})]}),e.jsxs(A,{children:[e.jsx(T,{asChild:!0,children:e.jsxs(S,{variant:"outline",size:"icon",onClick:R,disabled:g,children:[n==="loading"&&e.jsx(B,{className:"h-4 w-4 animate-spin"}),n==="ready"&&i==="enabled"&&e.jsx(P,{className:"h-4 w-4 text-green-500"}),n==="ready"&&i==="disabled"&&e.jsx(de,{className:"h-4 w-4"}),n==="error"&&e.jsx(ie,{className:"h-4 w-4 text-destructive"})]})}),g&&e.jsx(E,{children:e.jsx("p",{children:"Carregando som..."})})]}),e.jsx(S,{variant:"outline",onClick:z,children:"Sair"})]})]})}),e.jsx(Q,{context:{restaurant:q}})]}),e.jsx("audio",{ref:s,src:pe,onCanPlayThrough:()=>k("ready"),onError:a=>{console.error("Audio load error:",a),k("error")},className:"hidden"})]})]})},Ie=o.memo(ge);export{I as SoundContext,Ie as default,Pe as useSound};
