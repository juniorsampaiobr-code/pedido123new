import{a as j,j as e}from"./tanstack-E1juXnZE.js";import{u as w,d as E,e as v,r as m}from"./vendor-nYMJN4lg.js";import{s as h}from"./client-DHSUo4L7.js";import{u as o,L as C}from"./index-Cf_TXpBF.js";import{C as b,a as N,b as R,d as I}from"./card-CkBgMLGH.js";import{C as S}from"./circle-alert-Ck3KL-fX.js";import{C as L}from"./circle-check-big-CXHfle4r.js";import"./supabase-CBMN163Q.js";const $=async r=>{const{data:n,error:s}=await h.from("orders").select("*").eq("id",r).limit(1).single();if(s)throw new Error(`Erro ao buscar pedido: ${s.message}`);if(!n)throw new Error("Pedido não encontrado.");return n},F=()=>{const r=w(),{orderId:n}=E(),[s]=v(),[P,t]=m.useState("Verificando status do pagamento..."),[p,c]=m.useState(!0),[u,d]=m.useState(!1);s.get("status");const y=s.get("external_reference"),a=n||y,{data:f,isLoading:g}=j({queryKey:["paymentRedirectOrder",a],queryFn:()=>$(a),enabled:!!a,staleTime:0});return m.useEffect(()=>{if(!a){t("ID do pedido não encontrado na URL."),d(!0),c(!1),o.error("Erro de redirecionamento: ID do pedido ausente."),r("/menu",{replace:!0});return}if(g)return;if(!f){t("Pedido não encontrado no banco de dados."),d(!0),c(!1),o.error("Erro: Pedido não existe."),r("/menu",{replace:!0});return}(async()=>{c(!0),t("Confirmando pagamento com Mercado Pago...");try{const{data:i,error:x}=await h.functions.invoke("confirm-payment",{body:{orderId:a}});if(x)throw new Error(x.message);const l=i;l.status==="approved"?(t("Pagamento Aprovado! Redirecionando..."),o.success("Pagamento aprovado!"),r(`/order-success/${a}?status=approved`,{replace:!0})):l.status==="pending"?(t("Pagamento Pendente. Aguardando confirmação..."),o.warning("Pagamento pendente. Você será notificado quando for confirmado."),r(`/order-success/${a}?status=pending`,{replace:!0})):(t(`Pagamento Recusado. Status: ${l.status}`),o.error("Pagamento recusado. Tente novamente."),d(!0),r("/checkout",{replace:!0}))}catch(i){console.error("Erro na confirmação de pagamento:",i),t(`Erro ao processar pagamento: ${i.message}`),d(!0),c(!1),o.error("Erro ao processar pagamento. Tente novamente."),r("/checkout",{replace:!0})}})()},[a,g,f,r,s]),e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-muted",children:e.jsxs(b,{className:"w-full max-w-md text-center shadow-xl",children:[e.jsx(N,{children:e.jsxs(R,{className:"text-2xl font-bold flex items-center justify-center gap-2",children:[p?e.jsx(C,{className:"h-6 w-6 animate-spin text-primary"}):u?e.jsx(S,{className:"h-6 w-6 text-destructive"}):e.jsx(L,{className:"h-6 w-6 text-green-500"}),p?"Processando Pagamento":u?"Erro de Pagamento":"Redirecionando..."]})}),e.jsxs(I,{children:[e.jsx("p",{className:"text-muted-foreground mb-6",children:P}),u&&e.jsx("div",{className:"mt-4",children:e.jsx("p",{className:"text-sm text-destructive",children:"Você será redirecionado em breve."})})]})]})})};export{F as default};
