import{a as T,j as e}from"./tanstack-C7aOFagJ.js";import{h as B,i as K,r as n}from"./vendor-DjsPZZVP.js";import{L as _}from"./Logo-CcvLqre1.js";import{s as x,d as H,C as V,e as W,f as $,g as G,b as M,h as d,I as v,P as X,i as Y,B as E,L as Z,j as s}from"./index-ChKyjmAh.js";import{u as ee}from"./use-active-restaurant-id-CZ1GVIdn.js";import"./supabase-BAEEEeUB.js";const q=o=>o.replace(/\D/g,""),U=o=>o.replace(/\D/g,""),ie=()=>{var F;const o=B(),m=K(),y=T(),[S,h]=n.useState(!1),[l,D]=n.useState(!1),[p,k]=n.useState(""),[f,A]=n.useState(""),[j,R]=n.useState(""),[C,z]=n.useState(""),[N,J]=n.useState(""),[ae,b]=n.useState(null),[te,P]=n.useState(null),{data:w,isLoading:c}=ee(),i=(F=m.state)==null?void 0:F.restaurantId,I=(r,t)=>{var g;const a=(g=m.state)==null?void 0:g.from,u=t||w;a==="/checkout"?(console.log("User logged in, redirecting to checkout."),o("/checkout",{replace:!0,state:{restaurantId:i}})):u?(console.log("User logged in, redirecting to specific menu:",u),o(`/menu/${u}`,{replace:!0})):(console.log("User logged in, no active restaurant found, redirecting to index."),o("/",{replace:!0}))};n.useEffect(()=>{if(c)return;const{data:{subscription:r}}=x.auth.onAuthStateChange((t,a)=>{P(a),b((a==null?void 0:a.user)??null),a!=null&&a.user&&I(a.user,i)});return x.auth.getSession().then(({data:{session:t}})=>{P(t),b((t==null?void 0:t.user)??null),t!=null&&t.user&&I(t.user,i)}),()=>r.unsubscribe()},[o,m.state,c,w,i]);const O=()=>{if(!j.trim())return s.error("O Nome Completo é obrigatório."),!1;if(q(C).length!==11)return s.error("O Telefone deve conter 11 dígitos (DDD + 9 dígitos)."),!1;const t=U(N);return t.length!==11&&t.length!==14?(s.error("O CPF deve ter 11 dígitos ou CNPJ 14 dígitos."),!1):p.trim()?f.length<6?(s.error("A Senha deve ter pelo menos 6 caracteres."),!1):!0:(s.error("O Email é obrigatório."),!1)},Q=async r=>{var t;if(r.preventDefault(),h(!0),((t=m.state)==null?void 0:t.from)==="/checkout"&&!i){s.error("Erro: ID do restaurante de origem não encontrado."),h(!1);return}try{if(l){if(!O()){h(!1);return}const a=q(C),u=U(N),{data:g,error:L}=await x.auth.signUp({email:p,password:f,options:{data:{full_name:j,phone:a,cpf_cnpj:u}}});if(L)throw L;g.session?(s.success("Conta criada e login efetuado com sucesso!"),y.invalidateQueries({queryKey:["authStatus"]})):s.success("Conta criada! Verifique seu email para confirmar.")}else{const{error:a}=await x.auth.signInWithPassword({email:p,password:f});if(a)throw a;s.success("Login realizado com sucesso!"),y.invalidateQueries({queryKey:["authStatus"]})}}catch(a){a.message.includes("Email not confirmed")?s.error("Por favor, verifique seu e-mail para confirmar sua conta antes de fazer login."):s.error(a.message||"Erro ao processar autenticação")}finally{h(!1)}};return c?e.jsx(H,{}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(_,{className:"justify-center mb-4"})}),e.jsxs(V,{className:"shadow-xl border-2",children:[e.jsxs(W,{className:"space-y-1",children:[e.jsx($,{className:"text-2xl font-bold text-center",children:l?"Crie sua conta":"Acesse sua conta"}),e.jsx(G,{className:"text-center",children:l?"Preencha os campos para começar":"Utilize seu email e senha para fazer login"})]}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"fullName",children:"Nome Completo *"}),e.jsx(v,{id:"fullName",type:"text",placeholder:"Seu nome completo",value:j,onChange:r=>R(r.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"phone",children:"Telefone *"}),e.jsx(X,{id:"phone",value:C,onChange:r=>z(r.target.value),required:!0,className:"h-12"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formato: (99) 99999-9999"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"cpfCnpj",children:"CPF/CNPJ *"}),e.jsx(Y,{id:"cpfCnpj",value:N,onChange:r=>J(r.target.value),required:!0,className:"h-12"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"CPF (11 dígitos) ou CNPJ (14 dígitos)."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"email",children:"Email *"}),e.jsx(v,{id:"email",type:"email",placeholder:"seu@email.com",value:p,onChange:r=>k(r.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"password",children:"Senha *"}),e.jsx(v,{id:"password",type:"password",placeholder:"••••••••",value:f,onChange:r=>A(r.target.value),required:!0,className:"h-12"})]}),e.jsx(E,{type:"submit",className:"w-full",size:"lg",disabled:S||c,children:S||c?e.jsx(Z,{className:"h-4 w-4 animate-spin mr-2"}):l?"Criar conta":"Entrar"})]}),e.jsx("div",{className:"text-center",children:e.jsx(E,{variant:"link",type:"button",className:"p-0 h-auto",onClick:()=>D(!l),children:l?"Já tem uma conta? Faça login":"Não tem uma conta? Crie uma agora"})})]})]})]})})};export{ie as default};
