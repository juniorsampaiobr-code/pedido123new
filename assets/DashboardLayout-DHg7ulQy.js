import{j as e,b as B,u as W,c as fe}from"./tanstack-BDgcxwLQ.js";import{f as q,L as X,r as t,u as pe,O as xe}from"./vendor-CIxFcw7z.js";import{s as g}from"./client-BskZ_u5h.js";import{L as J}from"./Logo-BDbQNvRu.js";import{c as w,b as Y,u as c,L as Z,v as R,T as D,d as M,e as L}from"./index-BV6QUNwX.js";import{P as ee}from"./package-C9YRuBby.js";import{S as I}from"./shopping-cart-_5xIWdL_.js";import{C as re}from"./clock-DVsla---.js";import{C as ae}from"./credit-card-hGJiTja8.js";import{T as oe}from"./truck-Y0ilxKrM.js";import{S as se}from"./settings-Az5_twQ_.js";import{B as N}from"./button-B07SOXoZ.js";import{A as ge,b as be,c as ye,d as je,e as ve,f as Se,h as Ne}from"./alert-dialog-ygn09Iyn.js";import{V as ne}from"./volume-2-tQCZNobb.js";import{S as we,f as Ce,a as ke}from"./sheet-CtdbqVf-.js";import{S as Pe}from"./use-sound-BQ0dyQJ-.js";import{o as Ee,s as z,u as Ae,t as Te}from"./types-C33Up_9v.js";import{D as De,a as Me,b as Le,c as _e,d as qe,e as Ie}from"./dialog-BD6IhriK.js";import{F as Oe,b as V,c as U,a as H,d as $,e as K}from"./form-BH342c5o.js";import{L as Fe,I as G}from"./label-DFdq7pV8.js";import{P as Re}from"./PhoneInput-Doytazd_.js";import{S as P}from"./skeleton-DtXc_72o.js";import{U as te}from"./user-DK1sC8XQ.js";import{S as ze}from"./save-kNeMuYP1.js";import"./supabase-DGFirUEE.js";import"./index-DwViiQQo.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=w("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=w("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=w("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=w("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=w("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=w("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),$e=[{href:"/dashboard",label:"Dashboard",icon:ie},{href:"/products",label:"Produtos",icon:ee},{href:"/orders",label:"Pedidos",icon:I},{href:"/cashier",label:"Caixa",icon:le},{href:"/hours",label:"Hor√°rios",icon:re},{href:"/payments",label:"Pagamentos",icon:ae},{href:"/delivery",label:"Taxa de Entrega",icon:oe},{href:"/settings",label:"Configura√ß√µes",icon:se}],Ke=()=>{const a=q();return e.jsxs("aside",{className:"w-64 flex-shrink-0 border-r bg-card h-screen sticky top-0 flex-col flex",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx(J,{})}),e.jsx("nav",{className:"flex-grow p-4",children:e.jsx("ul",{children:$e.map(r=>e.jsx("li",{children:e.jsxs(X,{to:r.href,className:Y("flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors",a.pathname===r.href?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted hover:text-foreground"),children:[e.jsx(r.icon,{className:"h-4 w-4"}),r.label]})},r.href))})})]})},Ge=({isOpen:a,onEnable:r})=>e.jsx(ge,{open:a,children:e.jsxs(be,{children:[e.jsxs(ye,{children:[e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-6 w-6 text-primary"}),"Ativar Notifica√ß√µes Sonoras?"]}),e.jsxs(ve,{children:["Para garantir que voc√™ n√£o perca nenhum novo pedido, precisamos da sua permiss√£o para tocar um som de notifica√ß√£o.",e.jsx("br",{}),e.jsx("br",{}),'Ao clicar em "Ativar", um som de teste ser√° reproduzido.']})]}),e.jsx(Se,{children:e.jsx(Ne,{onClick:r,className:"w-full",children:"Sim, ativar som"})})]})}),Qe=[{href:"/dashboard",label:"Dashboard",icon:ie},{href:"/products",label:"Produtos",icon:ee},{href:"/orders",label:"Pedidos",icon:I},{href:"/cashier",label:"Caixa",icon:le},{href:"/hours",label:"Hor√°rios",icon:re},{href:"/payments",label:"Pagamentos",icon:ae},{href:"/delivery",label:"Taxa de Entrega",icon:oe},{href:"/settings",label:"Configura√ß√µes",icon:se}],Be=()=>{const a=q(),[r,o]=t.useState(!1);return e.jsxs(we,{open:r,onOpenChange:o,children:[e.jsx(Ce,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",children:e.jsx(Ue,{className:"h-6 w-6"})})}),e.jsxs(ke,{side:"left",className:"flex flex-col w-64",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx(J,{})}),e.jsx("nav",{className:"flex-grow p-4",children:e.jsx("ul",{children:Qe.map(d=>e.jsx("li",{children:e.jsxs(X,{to:d.href,onClick:()=>o(!1),className:Y("flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors",a.pathname===d.href?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted hover:text-foreground"),children:[e.jsx(d.icon,{className:"h-4 w-4"}),d.label]})},d.href))})})]})]})},_=768;function We(){const[a,r]=t.useState(void 0);return t.useEffect(()=>{const o=window.matchMedia(`(max-width: ${_-1}px)`),d=()=>{r(window.innerWidth<_)};return o.addEventListener("change",d),r(window.innerWidth<_),()=>o.removeEventListener("change",d)},[]),!!a}const Xe=a=>a.replace(/\D/g,""),Je=Ee({full_name:z().min(1,"Nome √© obrigat√≥rio."),phone:z().min(1,"Telefone √© obrigat√≥rio.").transform(Xe).refine(a=>a.length>=10,{message:"O telefone deve ter pelo menos 10 d√≠gitos (incluindo DDD)."})}),Ye=async a=>{const{data:r,error:o}=await g.from("profiles").select("*").eq("id",a).limit(1).single();if(o&&o.code!=="PGRST116")throw new Error(`Erro ao buscar perfil: ${o.message}`);return r||{id:a,full_name:null,phone:null,avatar_url:null,created_at:null,updated_at:null}},Ze=({isOpen:a,onClose:r,userId:o})=>{var E;const d=B(),{data:b,isLoading:p}=W({queryKey:["adminProfile",o],queryFn:()=>Ye(o),enabled:!!o&&a,staleTime:0}),C=(E=g.auth.currentUser)==null?void 0:E.email,s=Ae({resolver:Te(Je),defaultValues:{full_name:"",phone:""}});t.useEffect(()=>{b&&s.reset({full_name:b.full_name||"",phone:b.phone||""})},[b,s]);const i=fe({mutationFn:async u=>{if(!o)throw new Error("ID do usu√°rio n√£o encontrado.");const y={full_name:u.full_name,phone:u.phone},{error:v}=await g.from("profiles").upsert({...y,id:o},{onConflict:"id"});if(v)throw new Error(v.message)},onSuccess:()=>{c.success("Perfil atualizado com sucesso!"),d.invalidateQueries({queryKey:["adminProfile"]}),r()},onError:u=>{c.error(`Erro ao atualizar perfil: ${u.message}`)}}),j=u=>{i.mutate(u)};return e.jsx(De,{open:a,onOpenChange:r,children:e.jsxs(Me,{className:"sm:max-w-[425px]",children:[e.jsxs(Le,{children:[e.jsxs(_e,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-primary"}),"Meu Perfil (Admin)"]}),e.jsx(qe,{children:"Atualize seus dados de contato."})]}),p?e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(P,{className:"h-4 w-1/3"}),e.jsx(P,{className:"h-10 w-full"}),e.jsx(P,{className:"h-4 w-1/3"}),e.jsx(P,{className:"h-10 w-full"}),e.jsx(P,{className:"h-10 w-full mt-6"})]}):e.jsx(Oe,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(j),className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Fe,{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Ve,{className:"h-4 w-4"})," Email"]}),e.jsx(G,{value:C||"N/A",disabled:!0,className:"bg-muted/50"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"O email n√£o pode ser alterado aqui."})]}),e.jsx(V,{control:s.control,name:"full_name",render:({field:u})=>e.jsxs(U,{children:[e.jsx(H,{children:"Nome Completo *"}),e.jsx($,{children:e.jsx(G,{placeholder:"Seu nome",...u})}),e.jsx(K,{})]})}),e.jsx(V,{control:s.control,name:"phone",render:({field:u})=>e.jsxs(U,{children:[e.jsx(H,{children:"Telefone *"}),e.jsx($,{children:e.jsx(Re,{...u})}),e.jsx(K,{})]})}),e.jsx(Ie,{className:"pt-4",children:e.jsxs(N,{type:"submit",disabled:i.isPending,children:[i.isPending?e.jsx(Z,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Salvar Altera√ß√µes"]})})]})})]})})},er=[{href:"/dashboard",label:"Dashboard"},{href:"/products",label:"Produtos"},{href:"/orders",label:"Pedidos"},{href:"/cashier",label:"Caixa"},{href:"/hours",label:"Hor√°rios"},{href:"/payments",label:"Pagamentos"},{href:"/delivery",label:"Taxa de Entrega"},{href:"/settings",label:"Configura√ß√µes"}],rr=a=>{const r=er.find(o=>o.href===a);return r?r.label:"Dashboard"},ar=async a=>{const{data:r,error:o}=await g.from("user_roles").select("role").eq("user_id",a).in("role",["admin","moderator"]).limit(1).single();return o&&o.code!=="PGRST116"?(console.error("Error checking role:",o),null):(r==null?void 0:r.role)||null},or=()=>{const a=pe(),r=q(),o=B(),[d,b]=t.useState(null),[p,C]=t.useState(void 0),s=t.useRef(null),[i,j]=t.useState("loading"),[E,u]=t.useState(!1),[y,v]=t.useState(null);We();const[ce,O]=t.useState(!1),[m,x]=t.useState(()=>localStorage.getItem("soundNotificationStatus")||"disabled");t.useEffect(()=>{localStorage.setItem("soundNotificationStatus",m)},[m]);const{data:h,isLoading:de}=W({queryKey:["dashboardRestaurant"],queryFn:async()=>{const{data:n,error:f}=await g.from("restaurants").select("*").limit(1).single();if(f)throw new Error(f.message);return n},enabled:!!d&&(p==="admin"||p==="moderator"),staleTime:1/0});t.useEffect(()=>{const n=async l=>{if(!(l!=null&&l.user)){b(null),C(null),a("/admin-auth",{replace:!0});return}const k=await ar(l.user.id);b(l.user),C(k),k!=="admin"&&k!=="moderator"&&(c.error("Acesso restrito.",{description:"Voc√™ n√£o tem permiss√£o para acessar o painel. Redirecionando para o login de administrador.",duration:5e3}),a("/admin-auth",{replace:!0}))},{data:{subscription:f}}=g.auth.onAuthStateChange((l,k)=>{l==="SIGNED_OUT"?(b(null),C(null),a("/admin-auth",{replace:!0})):n(k)});return g.auth.getSession().then(({data:{session:l}})=>{n(l)}),()=>f.unsubscribe()},[a]),t.useEffect(()=>{var n;h!=null&&h.notification_sound_url?((n=s.current)==null?void 0:n.src)!==h.notification_sound_url&&j("loading"):j("error")},[h==null?void 0:h.notification_sound_url]),t.useEffect(()=>{!localStorage.getItem("hasSeenSoundPermissionModal")&&m!=="enabled"&&i==="ready"&&u(!0)},[m,i]);const S=t.useCallback(()=>{s.current&&(s.current.pause(),s.current.loop=!1,v(null))},[]),F=t.useCallback(n=>{if(m==="enabled"&&s.current&&i==="ready"){if(y)return;v(n),s.current.loop=!0,s.current.play().catch(f=>{console.error("Erro na reprodu√ß√£o autom√°tica de √°udio:",f),v(null),c.warning("N√£o foi poss√≠vel tocar o som automaticamente.",{description:"Interaja com a p√°gina para permitir a reprodu√ß√£o de som."})})}},[m,i,y]);t.useEffect(()=>{if(p!=="admin"&&p!=="moderator")return;const n=g.channel("new-orders-toast").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders"},f=>{o.invalidateQueries({queryKey:["orders"]});const l=f.new;l.status==="pending"&&l.id&&(c.info("üîî Novo pedido recebido!",{description:`Pedido #${l.id.slice(-4)} est√° aguardando confirma√ß√£o.`,duration:15e3}),F(l.id))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders"},f=>{o.invalidateQueries({queryKey:["orders"]});const l=f.new;l.id===y&&S(),l.status==="pending"&&l.id&&f.old.status==="pending_payment"&&c.success("‚úÖ Pagamento Confirmado!",{description:`Pedido #${l.id.slice(-4)} foi pago e est√° pronto para preparo.`,duration:5e3})}).subscribe();return()=>{g.removeChannel(n)}},[o,F,S,y,p]);const T=t.useCallback(()=>{if(m==="enabled"&&s.current&&i==="ready"){S(),s.current.loop=!1,s.current.currentTime=0;const n=s.current.play();n!==void 0&&n.then(()=>{console.log("Som de teste tocado com sucesso")}).catch(f=>{console.error("Erro ao tocar som de teste:",f),x("error"),c.error("N√£o foi poss√≠vel tocar o som de teste.",{description:"Seu navegador pode ter bloqueado a reprodu√ß√£o. Interaja com a p√°gina e tente novamente."})})}else i==="ready"?(x("enabled"),setTimeout(()=>T(),100)):(c.error("Som de notifica√ß√£o n√£o est√° pronto ou configurado.",{description:"Verifique se a URL do som est√° correta nas Configura√ß√µes."}),x("error"))},[m,i,S]),ue=async()=>{if(i!=="ready"||!s.current){c.error("O arquivo de som ainda n√£o est√° pronto. Tente novamente em um momento.");return}try{s.current.currentTime=0,await s.current.play(),x("enabled"),c.success("Notifica√ß√µes sonoras ativadas!"),localStorage.setItem("hasSeenSoundPermissionModal","true")}catch(n){console.error("Audio activation failed from modal:",n),c.error("Falha ao ativar o som.",{description:"Seu navegador pode ter bloqueado a reprodu√ß√£o. Por favor, tente ativar manualmente no √≠cone do cabe√ßalho."}),x("error")}finally{u(!1)}},me=async()=>{if(m==="enabled"){S(),x("disabled"),c.info("Notifica√ß√µes sonoras desativadas.");return}if(i!=="ready"||!s.current){c.error("Som de notifica√ß√£o n√£o est√° pronto ou configurado."),x("error");return}try{s.current.currentTime=0,await s.current.play(),x("enabled"),c.success("Notifica√ß√µes sonoras ativadas!",{description:"Voc√™ ouviu o som de teste."})}catch(n){console.error("Audio activation failed:",n),c.error("Falha ao ativar o som.",{description:"Seu navegador pode ter bloqueado. Clique na p√°gina e tente novamente."}),x("error")}},he=async()=>{await g.auth.signOut()};if(p===void 0||de)return e.jsx(R,{});if(p!=="admin"&&p!=="moderator")return e.jsx(R,{});if(!h)return e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsxs(Alert,{variant:"destructive",className:"max-w-md",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx(AlertTitle,{children:"Erro Cr√≠tico"}),e.jsx(AlertDescription,{children:"N√£o foi poss√≠vel carregar os dados do restaurante. Verifique as configura√ß√µes ou entre em contato com o suporte."})]})});const A=i!=="ready";return e.jsxs(Pe.Provider,{value:{playSound:T,stopSoundLoop:S,soundStatus:m,loopingOrderId:y},children:[e.jsx(Ge,{isOpen:E,onEnable:ue}),e.jsx(Ze,{isOpen:ce,onClose:()=>O(!1),userId:(d==null?void 0:d.id)||null}),e.jsxs("div",{className:"flex min-h-screen bg-muted/40",children:[e.jsx("div",{className:"hidden lg:flex",children:e.jsx(Ke,{})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"border-b bg-background sticky top-0 z-40",children:e.jsxs("div",{className:"container max-w-none mx-auto px-4 sm:px-8 h-16 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"lg:hidden",children:e.jsx(Be,{})}),e.jsx(I,{className:"h-6 w-6 hidden sm:block"}),e.jsx("h1",{className:"text-xl font-semibold",children:rr(r.pathname)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(D,{children:[e.jsx(M,{asChild:!0,children:e.jsx(N,{variant:"outline",size:"icon",onClick:()=>O(!0),"aria-label":"Meu Perfil",children:e.jsx(te,{className:"h-4 w-4"})})}),e.jsx(L,{children:"Meu Perfil"})]}),e.jsxs(D,{children:[e.jsx(M,{asChild:!0,children:e.jsx(N,{variant:"outline",size:"sm",onClick:T,disabled:A,children:"Testar Som"})}),A&&e.jsx(L,{children:i==="loading"?"Carregando som...":"Som n√£o dispon√≠vel"})]}),e.jsxs(D,{children:[e.jsx(M,{asChild:!0,children:e.jsxs(N,{variant:"outline",size:"icon",onClick:me,disabled:A,"aria-label":m==="enabled"?"Desativar som":"Ativar som",children:[i==="loading"&&e.jsx(Z,{className:"h-4 w-4 animate-spin"}),i==="ready"&&m==="enabled"&&e.jsx(ne,{className:"h-4 w-4 text-green-500"}),i==="ready"&&m==="disabled"&&e.jsx(He,{className:"h-4 w-4"}),i==="error"&&e.jsx(Q,{className:"h-4 w-4 text-destructive"})]})}),A&&e.jsx(L,{children:i==="loading"?"Carregando som...":"Som n√£o dispon√≠vel"})]}),e.jsx(N,{variant:"outline",onClick:he,children:"Sair"})]})]})}),e.jsx(xe,{context:{restaurant:h}})]}),(h==null?void 0:h.notification_sound_url)&&e.jsx("audio",{ref:s,src:h.notification_sound_url,onCanPlayThrough:()=>{j("ready"),console.log("√Åudio carregado e pronto para tocar.")},onError:n=>{console.error("Erro ao carregar o √°udio:",n),c.error("Erro ao carregar o som de notifica√ß√£o.",{description:"Verifique o arquivo em Configura√ß√µes."}),j("error"),x("error")},className:"hidden"})]})]})},Tr=t.memo(or);export{Tr as default};
