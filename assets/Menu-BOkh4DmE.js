import{j as e,u as Fe}from"./tanstack-D8i8yNxB.js";import{s as H}from"./client-BmrnLCXS.js";import{S as B}from"./skeleton-Mwz-Lamp.js";import{A as re,a as te,b as se}from"./alert-BsLYNu-F.js";import{r as c,L as Me}from"./vendor-Dl0Wzy4_.js";import{o as oe,n as ze,u as ne,t as ae,c as He}from"./types-BCrSgEF3.js";import{B as N}from"./button-BoSFPc6a.js";import{D as le,a as ie,b as ce,c as de,d as ue,e as me,B as he,f as We}from"./index-CD1rg0p1.js";import{F as fe,a as xe,b as qe,c as Ve,d as Xe,e as Ye}from"./form-BcdwuO6T.js";import{c as $e,a as F,b as _,T as Ue,d as Qe,e as Ge,f as Ke,g as k,P as M,h as V,i as E,j as R,k as Je,u as Z}from"./index-CPtlsehN.js";import{P as pe}from"./plus-ByR9fKSn.js";import{S as X}from"./shopping-cart-CJlfRD-b.js";import{I as be}from"./label-vmEOzfpA.js";import{C as ge,a as Ze}from"./card-_fhdoebP.js";import{M as er}from"./map-pin-EDAfFmCE.js";import{C as rr,a as tr}from"./circle-x-5My2CCl0.js";import{C as ve}from"./clock-BnEPr3Zy.js";import{S as sr,a as or,b as nr,c as ar,d as lr,e as ir}from"./sheet-CghiMXdB.js";import{S as cr}from"./separator-dxgrrk2t.js";import{u as dr}from"./index-BB_oiUC3.js";import{T as ur}from"./trash-2-DBFaUB92.js";import{T as mr}from"./terminal-A4LgBqaN.js";import"./supabase-A1WgB1xz.js";import"./index-C3tSSVxB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=$e("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),hr=oe({quantity:ze().min(1,"Mínimo 1 item.")}),fr=({product:r,isOpen:o,onClose:t})=>{const{addItem:n}=F(),s=ne({resolver:ae(hr),defaultValues:{quantity:1},values:{quantity:1}}),a=s.watch("quantity"),l=m=>{const u=a+m;u>=1&&s.setValue("quantity",u)},d=m=>{r&&(n({product_id:r.id,name:r.name,price:r.price,quantity:m.quantity,image_url:r.image_url}),t(),s.reset({quantity:1}))};if(!r)return null;const i=r.price*a;return e.jsx(le,{open:o,onOpenChange:t,children:e.jsxs(ie,{className:"sm:max-w-[425px] p-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.image_url||"/placeholder.svg",alt:r.name,className:"w-full h-48 object-cover"}),e.jsxs(ce,{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent p-4 flex flex-col justify-end items-start text-left space-y-0",children:[e.jsx(de,{className:"text-2xl font-bold text-white drop-shadow-md",children:r.name}),e.jsxs(ue,{className:"sr-only",children:["Detalhes e opções de personalização para ",r.name,"."]})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r.description}),e.jsx(fe,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(d),className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-y py-3",children:[e.jsx(xe,{className:"text-base font-semibold",children:"Quantidade"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{type:"button",variant:"outline",size:"icon",onClick:()=>l(-1),disabled:a<=1,children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-8 text-center font-bold text-lg",children:a}),e.jsx(N,{type:"button",variant:"outline",size:"icon",onClick:()=>l(1),children:e.jsx(pe,{className:"h-4 w-4"})})]})]}),e.jsxs(me,{className:_("pt-4","sm:justify-between sm:space-x-0"),children:[e.jsxs("div",{className:"text-xl font-bold text-foreground hidden sm:block",children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i)]}),e.jsxs(N,{type:"submit",className:"w-full sm:w-auto h-12 text-lg",disabled:s.formState.isSubmitting,children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),"Adicionar ao Pedido"]})]})]})})]})]})})},xr=oe({weight_in_grams:He.number({invalid_type_error:"Deve ser um número."}).positive("A quantidade deve ser maior que zero.")}),pr=({product:r,isOpen:o,onClose:t})=>{const{addItem:n}=F(),s=ne({resolver:ae(xr),defaultValues:{weight_in_grams:500}}),a=s.watch("weight_in_grams"),l=c.useMemo(()=>!r||!a||a<=0?0:r.price/1e3*a,[r,a]),d=i=>{r&&(n({product_id:r.id,name:`${r.name} (${i.weight_in_grams}g)`,price:l,quantity:1,image_url:r.image_url,is_price_by_weight:!0}),t(),s.reset({weight_in_grams:500}))};return r?e.jsx(le,{open:o,onOpenChange:t,children:e.jsxs(ie,{className:"sm:max-w-[425px]",children:[e.jsxs(ce,{className:"text-center",children:[e.jsx(de,{className:"text-2xl",children:"Quanto você deseja?"}),e.jsxs(ue,{children:[e.jsx("span",{className:"block text-lg font-semibold mt-2",children:r.name}),e.jsxs("span",{className:"block text-muted-foreground",children:[new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.price)," por kg"]})]})]}),e.jsx(fe,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(d),className:"space-y-6 pt-4",children:[e.jsx(qe,{control:s.control,name:"weight_in_grams",render:({field:i})=>e.jsxs(Ve,{children:[e.jsx(xe,{className:"text-base",children:"Quantidade em gramas"}),e.jsx(Xe,{children:e.jsx(be,{type:"number",placeholder:"Ex: 500",className:"h-12 text-lg text-center",...i,value:i.value===void 0||i.value===null?"":String(i.value),onChange:m=>{const u=m.target.value;i.onChange(u===""?void 0:parseFloat(u))}})}),e.jsx(Ye,{})]})}),e.jsxs(me,{className:"flex-col-reverse sm:flex-row sm:justify-between sm:space-x-2 w-full",children:[e.jsxs("div",{className:"text-xl font-bold text-foreground text-center sm:text-left mb-4 sm:mb-0",children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(l)]}),e.jsxs(N,{type:"submit",className:"w-full sm:w-auto h-12 text-lg",disabled:s.formState.isSubmitting||!s.formState.isValid,children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),"Adicionar"]})]})]})})]})}):null},U=({src:r,alt:o,placeholder:t="/placeholder.svg",className:n="",...s})=>{const[a,l]=c.useState(!0),[d,i]=c.useState(!1),m=c.useRef(null);return c.useEffect(()=>{if(!r){l(!1);return}const u=new Image;u.src=r,u.onload=()=>{l(!1),i(!1)},u.onerror=()=>{l(!1),i(!0)}},[r]),e.jsxs("div",{className:`relative overflow-hidden ${n}`,children:[a&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 animate-pulse"}),e.jsx("img",{ref:m,src:d?t:r,alt:o,className:`${a?"opacity-0":"opacity-100"} transition-opacity duration-300 w-full h-full object-cover`,...s})]})},je=c.memo(({id:r,name:o,description:t,price:n,image_url:s,is_price_by_weight:a,is_available:l,onClick:d})=>{const i=l===!1;return e.jsxs(ge,{className:_("overflow-hidden group transition-shadow duration-300 flex flex-col",i?"cursor-not-allowed":"hover:shadow-xl cursor-pointer"),onClick:d,children:[e.jsxs("div",{className:"relative h-32 sm:h-40",children:[" ",e.jsx(U,{src:s||"/placeholder.svg",alt:o,className:_("w-full h-full object-cover",!i&&"group-hover:scale-105 transition-transform duration-300",i&&"filter grayscale")}),i&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx(he,{variant:"destructive",className:"text-lg",children:"Indisponível"})})]}),e.jsxs(Ze,{className:_("p-3 flex flex-col flex-grow",i&&"opacity-60"),children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-1 truncate",children:o})," ",e.jsxs("p",{className:"text-xs text-muted-foreground mb-2 flex-grow line-clamp-2",children:[" ",t]}),e.jsxs("p",{className:"text-base font-bold text-primary text-right mt-2",children:[" ",a?`${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)} / kg`:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)]})]})]},r)});je.displayName="ProductCard";function br(r,o){const[t,n]=c.useState(r);return c.useEffect(()=>{const s=setTimeout(()=>{n(r)},o);return()=>{clearTimeout(s)}},[r,o]),t}const gr=()=>{const r=new Date,o=String(r.getHours()).padStart(2,"0"),t=String(r.getMinutes()).padStart(2,"0");return`${o}:${t}`},vr=()=>new Date().getDay(),Se=r=>{const o=vr(),t=gr(),n=r.find(i=>i.day_of_week===o);if(!n||!n.is_open)return{isOpen:!1,todayHours:"Fechado hoje"};const s=n.open_time,a=n.close_time;if(!s||!a)return{isOpen:!1,todayHours:"Horário não configurado"};const l=t>=s&&t<=a,d=`${s.substring(0,5)} - ${a.substring(0,5)}`;return{isOpen:l,todayHours:d}},wr=({restaurant:r,hours:o})=>{const{isOpen:t,todayHours:n}=Se(o),s=[r.street,r.number,r.neighborhood,r.city,r.zip_code].filter(Boolean).join(", ");return e.jsxs("div",{className:"space-y-3 text-center",children:[s&&e.jsxs("div",{className:"flex items-center justify-center text-sm text-muted-foreground",children:[e.jsx(er,{className:"h-4 w-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate max-w-full",children:s})]}),e.jsxs("div",{className:"flex items-center justify-center text-sm font-medium",children:[e.jsxs("div",{className:_("flex items-center gap-1 px-3 py-1 rounded-full",t?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"),children:[t?e.jsx(rr,{className:"h-4 w-4"}):e.jsx(tr,{className:"h-4 w-4"}),e.jsx("span",{children:t?"Aberto Agora":"Fechado"})]}),e.jsxs("div",{className:"ml-4 flex items-center text-muted-foreground",children:[e.jsx(ve,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:n})]})]})]})},jr=()=>e.jsxs(re,{variant:"destructive",className:"mb-8",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx(te,{className:"font-bold",children:"Loja Fechada no Momento"}),e.jsx(se,{children:"Não é possível adicionar itens ao carrinho ou fazer pedidos fora do nosso horário de funcionamento."})]}),Sr=({onClick:r})=>{const{totalItems:o,subtotal:t}=F();return o===0?null:e.jsxs(Ue,{children:[e.jsx(Qe,{asChild:!0,children:e.jsxs(N,{size:"lg",className:"relative h-14 w-14 rounded-full shadow-lg",onClick:r,children:[e.jsx(X,{className:"h-6 w-6"}),e.jsx(he,{variant:"destructive",className:"absolute -top-1 -right-1 px-2 py-1 text-xs rounded-full",children:o})]})}),e.jsxs(Ge,{children:[e.jsxs("p",{children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Clique para ver seu carrinho"})]})]})};function yr(r,o){return c.useReducer((t,n)=>o[t][n]??t,r)}var Q="ScrollArea",[ye,dt]=Ke(Q),[Nr,w]=ye(Q),Ne=c.forwardRef((r,o)=>{const{__scopeScrollArea:t,type:n="hover",dir:s,scrollHideDelay:a=600,...l}=r,[d,i]=c.useState(null),[m,u]=c.useState(null),[f,h]=c.useState(null),[x,g]=c.useState(null),[j,T]=c.useState(null),[P,S]=c.useState(0),[O,p]=c.useState(0),[b,A]=c.useState(!1),[L,z]=c.useState(!1),v=k(o,D=>i(D)),y=dr(s);return e.jsx(Nr,{scope:t,type:n,dir:y,scrollHideDelay:a,scrollArea:d,viewport:m,onViewportChange:u,content:f,onContentChange:h,scrollbarX:x,onScrollbarXChange:g,scrollbarXEnabled:b,onScrollbarXEnabledChange:A,scrollbarY:j,onScrollbarYChange:T,scrollbarYEnabled:L,onScrollbarYEnabledChange:z,onCornerWidthChange:S,onCornerHeightChange:p,children:e.jsx(M.div,{dir:y,...l,ref:v,style:{position:"relative","--radix-scroll-area-corner-width":P+"px","--radix-scroll-area-corner-height":O+"px",...r.style}})})});Ne.displayName=Q;var Ce="ScrollAreaViewport",Pe=c.forwardRef((r,o)=>{const{__scopeScrollArea:t,children:n,nonce:s,...a}=r,l=w(Ce,t),d=c.useRef(null),i=k(o,d,l.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),e.jsx(M.div,{"data-radix-scroll-area-viewport":"",...a,ref:i,style:{overflowX:l.scrollbarXEnabled?"scroll":"hidden",overflowY:l.scrollbarYEnabled?"scroll":"hidden",...r.style},children:e.jsx("div",{ref:l.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});Pe.displayName=Ce;var C="ScrollAreaScrollbar",G=c.forwardRef((r,o)=>{const{forceMount:t,...n}=r,s=w(C,r.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:l}=s,d=r.orientation==="horizontal";return c.useEffect(()=>(d?a(!0):l(!0),()=>{d?a(!1):l(!1)}),[d,a,l]),s.type==="hover"?e.jsx(Cr,{...n,ref:o,forceMount:t}):s.type==="scroll"?e.jsx(Pr,{...n,ref:o,forceMount:t}):s.type==="auto"?e.jsx(_e,{...n,ref:o,forceMount:t}):s.type==="always"?e.jsx(K,{...n,ref:o}):null});G.displayName=C;var Cr=c.forwardRef((r,o)=>{const{forceMount:t,...n}=r,s=w(C,r.__scopeScrollArea),[a,l]=c.useState(!1);return c.useEffect(()=>{const d=s.scrollArea;let i=0;if(d){const m=()=>{window.clearTimeout(i),l(!0)},u=()=>{i=window.setTimeout(()=>l(!1),s.scrollHideDelay)};return d.addEventListener("pointerenter",m),d.addEventListener("pointerleave",u),()=>{window.clearTimeout(i),d.removeEventListener("pointerenter",m),d.removeEventListener("pointerleave",u)}}},[s.scrollArea,s.scrollHideDelay]),e.jsx(V,{present:t||a,children:e.jsx(_e,{"data-state":a?"visible":"hidden",...n,ref:o})})}),Pr=c.forwardRef((r,o)=>{const{forceMount:t,...n}=r,s=w(C,r.__scopeScrollArea),a=r.orientation==="horizontal",l=$(()=>i("SCROLL_END"),100),[d,i]=yr("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return c.useEffect(()=>{if(d==="idle"){const m=window.setTimeout(()=>i("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(m)}},[d,s.scrollHideDelay,i]),c.useEffect(()=>{const m=s.viewport,u=a?"scrollLeft":"scrollTop";if(m){let f=m[u];const h=()=>{const x=m[u];f!==x&&(i("SCROLL"),l()),f=x};return m.addEventListener("scroll",h),()=>m.removeEventListener("scroll",h)}},[s.viewport,a,i,l]),e.jsx(V,{present:t||d!=="hidden",children:e.jsx(K,{"data-state":d==="hidden"?"hidden":"visible",...n,ref:o,onPointerEnter:E(r.onPointerEnter,()=>i("POINTER_ENTER")),onPointerLeave:E(r.onPointerLeave,()=>i("POINTER_LEAVE"))})})}),_e=c.forwardRef((r,o)=>{const t=w(C,r.__scopeScrollArea),{forceMount:n,...s}=r,[a,l]=c.useState(!1),d=r.orientation==="horizontal",i=$(()=>{if(t.viewport){const m=t.viewport.offsetWidth<t.viewport.scrollWidth,u=t.viewport.offsetHeight<t.viewport.scrollHeight;l(d?m:u)}},10);return I(t.viewport,i),I(t.content,i),e.jsx(V,{present:n||a,children:e.jsx(K,{"data-state":a?"visible":"hidden",...s,ref:o})})}),K=c.forwardRef((r,o)=>{const{orientation:t="vertical",...n}=r,s=w(C,r.__scopeScrollArea),a=c.useRef(null),l=c.useRef(0),[d,i]=c.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),m=Le(d.viewport,d.content),u={...n,sizes:d,onSizesChange:i,hasThumb:m>0&&m<1,onThumbChange:h=>a.current=h,onThumbPointerUp:()=>l.current=0,onThumbPointerDown:h=>l.current=h};function f(h,x){return Lr(h,l.current,d,x)}return t==="horizontal"?e.jsx(_r,{...u,ref:o,onThumbPositionChange:()=>{if(s.viewport&&a.current){const h=s.viewport.scrollLeft,x=ee(h,d,s.dir);a.current.style.transform=`translate3d(${x}px, 0, 0)`}},onWheelScroll:h=>{s.viewport&&(s.viewport.scrollLeft=h)},onDragScroll:h=>{s.viewport&&(s.viewport.scrollLeft=f(h,s.dir))}}):t==="vertical"?e.jsx(Rr,{...u,ref:o,onThumbPositionChange:()=>{if(s.viewport&&a.current){const h=s.viewport.scrollTop,x=ee(h,d);a.current.style.transform=`translate3d(0, ${x}px, 0)`}},onWheelScroll:h=>{s.viewport&&(s.viewport.scrollTop=h)},onDragScroll:h=>{s.viewport&&(s.viewport.scrollTop=f(h))}}):null}),_r=c.forwardRef((r,o)=>{const{sizes:t,onSizesChange:n,...s}=r,a=w(C,r.__scopeScrollArea),[l,d]=c.useState(),i=c.useRef(null),m=k(o,i,a.onScrollbarXChange);return c.useEffect(()=>{i.current&&d(getComputedStyle(i.current))},[i]),e.jsx(Ee,{"data-orientation":"horizontal",...s,ref:m,sizes:t,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Y(t)+"px",...r.style},onThumbPointerDown:u=>r.onThumbPointerDown(u.x),onDragScroll:u=>r.onDragScroll(u.x),onWheelScroll:(u,f)=>{if(a.viewport){const h=a.viewport.scrollLeft+u.deltaX;r.onWheelScroll(h),Ie(h,f)&&u.preventDefault()}},onResize:()=>{i.current&&a.viewport&&l&&n({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:i.current.clientWidth,paddingStart:q(l.paddingLeft),paddingEnd:q(l.paddingRight)}})}})}),Rr=c.forwardRef((r,o)=>{const{sizes:t,onSizesChange:n,...s}=r,a=w(C,r.__scopeScrollArea),[l,d]=c.useState(),i=c.useRef(null),m=k(o,i,a.onScrollbarYChange);return c.useEffect(()=>{i.current&&d(getComputedStyle(i.current))},[i]),e.jsx(Ee,{"data-orientation":"vertical",...s,ref:m,sizes:t,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Y(t)+"px",...r.style},onThumbPointerDown:u=>r.onThumbPointerDown(u.y),onDragScroll:u=>r.onDragScroll(u.y),onWheelScroll:(u,f)=>{if(a.viewport){const h=a.viewport.scrollTop+u.deltaY;r.onWheelScroll(h),Ie(h,f)&&u.preventDefault()}},onResize:()=>{i.current&&a.viewport&&l&&n({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:i.current.clientHeight,paddingStart:q(l.paddingTop),paddingEnd:q(l.paddingBottom)}})}})}),[Er,Re]=ye(C),Ee=c.forwardRef((r,o)=>{const{__scopeScrollArea:t,sizes:n,hasThumb:s,onThumbChange:a,onThumbPointerUp:l,onThumbPointerDown:d,onThumbPositionChange:i,onDragScroll:m,onWheelScroll:u,onResize:f,...h}=r,x=w(C,t),[g,j]=c.useState(null),T=k(o,v=>j(v)),P=c.useRef(null),S=c.useRef(""),O=x.viewport,p=n.content-n.viewport,b=R(u),A=R(i),L=$(f,10);function z(v){if(P.current){const y=v.clientX-P.current.left,D=v.clientY-P.current.top;m({x:y,y:D})}}return c.useEffect(()=>{const v=y=>{const D=y.target;(g==null?void 0:g.contains(D))&&b(y,p)};return document.addEventListener("wheel",v,{passive:!1}),()=>document.removeEventListener("wheel",v,{passive:!1})},[O,g,p,b]),c.useEffect(A,[n,A]),I(g,L),I(x.content,L),e.jsx(Er,{scope:t,scrollbar:g,hasThumb:s,onThumbChange:R(a),onThumbPointerUp:R(l),onThumbPositionChange:A,onThumbPointerDown:R(d),children:e.jsx(M.div,{...h,ref:T,style:{position:"absolute",...h.style},onPointerDown:E(r.onPointerDown,v=>{v.button===0&&(v.target.setPointerCapture(v.pointerId),P.current=g.getBoundingClientRect(),S.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",x.viewport&&(x.viewport.style.scrollBehavior="auto"),z(v))}),onPointerMove:E(r.onPointerMove,z),onPointerUp:E(r.onPointerUp,v=>{const y=v.target;y.hasPointerCapture(v.pointerId)&&y.releasePointerCapture(v.pointerId),document.body.style.webkitUserSelect=S.current,x.viewport&&(x.viewport.style.scrollBehavior=""),P.current=null})})})}),W="ScrollAreaThumb",Te=c.forwardRef((r,o)=>{const{forceMount:t,...n}=r,s=Re(W,r.__scopeScrollArea);return e.jsx(V,{present:t||s.hasThumb,children:e.jsx(Tr,{ref:o,...n})})}),Tr=c.forwardRef((r,o)=>{const{__scopeScrollArea:t,style:n,...s}=r,a=w(W,t),l=Re(W,t),{onThumbPositionChange:d}=l,i=k(o,f=>l.onThumbChange(f)),m=c.useRef(void 0),u=$(()=>{m.current&&(m.current(),m.current=void 0)},100);return c.useEffect(()=>{const f=a.viewport;if(f){const h=()=>{if(u(),!m.current){const x=Dr(f,d);m.current=x,d()}};return d(),f.addEventListener("scroll",h),()=>f.removeEventListener("scroll",h)}},[a.viewport,u,d]),e.jsx(M.div,{"data-state":l.hasThumb?"visible":"hidden",...s,ref:i,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:E(r.onPointerDownCapture,f=>{const x=f.target.getBoundingClientRect(),g=f.clientX-x.left,j=f.clientY-x.top;l.onThumbPointerDown({x:g,y:j})}),onPointerUp:E(r.onPointerUp,l.onThumbPointerUp)})});Te.displayName=W;var J="ScrollAreaCorner",Ae=c.forwardRef((r,o)=>{const t=w(J,r.__scopeScrollArea),n=!!(t.scrollbarX&&t.scrollbarY);return t.type!=="scroll"&&n?e.jsx(Ar,{...r,ref:o}):null});Ae.displayName=J;var Ar=c.forwardRef((r,o)=>{const{__scopeScrollArea:t,...n}=r,s=w(J,t),[a,l]=c.useState(0),[d,i]=c.useState(0),m=!!(a&&d);return I(s.scrollbarX,()=>{var f;const u=((f=s.scrollbarX)==null?void 0:f.offsetHeight)||0;s.onCornerHeightChange(u),i(u)}),I(s.scrollbarY,()=>{var f;const u=((f=s.scrollbarY)==null?void 0:f.offsetWidth)||0;s.onCornerWidthChange(u),l(u)}),m?e.jsx(M.div,{...n,ref:o,style:{width:a,height:d,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...r.style}}):null});function q(r){return r?parseInt(r,10):0}function Le(r,o){const t=r/o;return isNaN(t)?0:t}function Y(r){const o=Le(r.viewport,r.content),t=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,n=(r.scrollbar.size-t)*o;return Math.max(n,18)}function Lr(r,o,t,n="ltr"){const s=Y(t),a=s/2,l=o||a,d=s-l,i=t.scrollbar.paddingStart+l,m=t.scrollbar.size-t.scrollbar.paddingEnd-d,u=t.content-t.viewport,f=n==="ltr"?[0,u]:[u*-1,0];return De([i,m],f)(r)}function ee(r,o,t="ltr"){const n=Y(o),s=o.scrollbar.paddingStart+o.scrollbar.paddingEnd,a=o.scrollbar.size-s,l=o.content-o.viewport,d=a-n,i=t==="ltr"?[0,l]:[l*-1,0],m=We(r,i);return De([0,l],[0,d])(m)}function De(r,o){return t=>{if(r[0]===r[1]||o[0]===o[1])return o[0];const n=(o[1]-o[0])/(r[1]-r[0]);return o[0]+n*(t-r[0])}}function Ie(r,o){return r>0&&r<o}var Dr=(r,o=()=>{})=>{let t={left:r.scrollLeft,top:r.scrollTop},n=0;return function s(){const a={left:r.scrollLeft,top:r.scrollTop},l=t.left!==a.left,d=t.top!==a.top;(l||d)&&o(),t=a,n=window.requestAnimationFrame(s)}(),()=>window.cancelAnimationFrame(n)};function $(r,o){const t=R(r),n=c.useRef(0);return c.useEffect(()=>()=>window.clearTimeout(n.current),[]),c.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(t,o)},[t,o])}function I(r,o){const t=R(o);Je(()=>{let n=0;if(r){const s=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(t)});return s.observe(r),()=>{window.cancelAnimationFrame(n),s.unobserve(r)}}},[r,t])}var ke=Ne,Ir=Pe,kr=Ae;const Oe=c.forwardRef(({className:r,children:o,...t},n)=>e.jsxs(ke,{ref:n,className:_("relative overflow-hidden",r),...t,children:[e.jsx(Ir,{className:"h-full w-full rounded-[inherit]",children:o}),e.jsx(Be,{}),e.jsx(kr,{})]}));Oe.displayName=ke.displayName;const Be=c.forwardRef(({className:r,orientation:o="vertical",...t},n)=>e.jsx(G,{ref:n,orientation:o,className:_("flex touch-none select-none transition-colors",o==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",o==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...t,children:e.jsx(Te,{className:"relative flex-1 rounded-full bg-border"})}));Be.displayName=G.displayName;const Or=({item:r})=>{const{updateQuantity:o,removeItem:t}=F();return e.jsxs("div",{className:"flex items-center gap-4 py-3",children:[e.jsx(U,{src:r.image_url||"/placeholder.svg",alt:r.name,className:"w-16 h-16 rounded-md object-cover"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-semibold leading-tight",children:r.name}),e.jsx("p",{className:"text-sm text-primary font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.price)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!r.is_price_by_weight&&e.jsxs(e.Fragment,{children:[e.jsx(N,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>o(r.id,r.quantity-1),children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-6 text-center font-bold",children:r.quantity}),e.jsx(N,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>o(r.id,r.quantity+1),children:e.jsx(pe,{className:"h-4 w-4"})})]}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive hover:text-destructive",onClick:()=>t(r.id),children:e.jsx(ur,{className:"h-4 w-4"})})]})]})},Br=({isOpen:r,onOpenChange:o})=>{const{items:t,subtotal:n,total:s,clearCart:a}=F();return e.jsx(sr,{open:r,onOpenChange:o,children:e.jsxs(or,{className:"flex flex-col",children:[e.jsxs(nr,{children:[e.jsx(ar,{className:"text-2xl",children:"Seu Carrinho"}),e.jsx(lr,{className:"sr-only",children:"Lista de itens no seu carrinho e resumo do pedido."})]}),e.jsx(cr,{}),t.length===0?e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-center",children:[e.jsx(X,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Seu carrinho está vazio"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Adicione produtos do cardápio para começar."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"flex-grow -mx-6 px-6",children:e.jsx("div",{className:"divide-y",children:t.map(l=>e.jsx(Or,{item:l},l.id))})}),e.jsxs("div",{className:"border-t pt-4 mt-4 space-y-4",children:[e.jsxs("div",{className:"w-full space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-base",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal:"}),e.jsx("span",{className:"font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s)})]})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(N,{variant:"outline",onClick:a,className:"flex-1",children:"Limpar Carrinho"}),e.jsx(ir,{asChild:!0,children:e.jsx(Me,{to:"/checkout",className:"flex-1",children:e.jsx(N,{className:"w-full",children:"Finalizar Pedido"})})})]})]})]})]})})},Fr=async()=>{const{data:r,error:o}=await H.from("restaurants").select("*").eq("is_active",!0).limit(1).single();if(o)throw new Error(`Erro ao buscar restaurante: ${o.message}`);if(!r)throw new Error("Nenhum restaurante ativo encontrado.");const t=r.id,[n,s,a]=await Promise.all([H.from("categories").select("*").eq("restaurant_id",t).eq("is_active",!0).order("display_order",{ascending:!0}),H.from("products").select("*").eq("restaurant_id",t),H.from("business_hours").select("*").eq("restaurant_id",t)]);if(n.error)throw new Error(`Erro ao buscar categorias: ${n.error.message}`);if(s.error)throw new Error(`Erro ao buscar produtos: ${s.error.message}`);if(a.error)throw new Error(`Erro ao buscar horários: ${a.error.message}`);const l=(n.data||[]).map(d=>({...d,products:(s.data||[]).filter(i=>i.category_id===d.id)})).filter(d=>d.products.length>0);return{restaurant:r,menu:l,hours:a.data}},ut=()=>{const{data:r,isLoading:o,isError:t,error:n}=Fe({queryKey:["menuData"],queryFn:Fr,staleTime:3e5,gcTime:6e5}),[s,a]=c.useState(null),[l,d]=c.useState(!1),[i,m]=c.useState(!1),[u,f]=c.useState(!1),[h,x]=c.useState(""),g=br(h,300),{isOpen:j}=c.useMemo(()=>r!=null&&r.hours?Se(r.hours):{isOpen:!1,todayHours:"Carregando..."},[r==null?void 0:r.hours]),T=c.useMemo(()=>r!=null&&r.menu?g?r.menu.map(p=>({...p,products:p.products.filter(b=>b.name.toLowerCase().includes(g.toLowerCase())||b.description&&b.description.toLowerCase().includes(g.toLowerCase()))})).filter(p=>p.products.length>0):r.menu:[],[r==null?void 0:r.menu,g]),P=c.useCallback(p=>{if(!j){Z.error("A loja está fechada.",{description:"Não é possível adicionar itens ao carrinho no momento."});return}if(!p.is_available){Z.info("Produto indisponível",{description:"Este item não está disponível no momento."});return}a(p),p.is_price_by_weight?m(!0):d(!0)},[j]);if(o)return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-5xl",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx(B,{className:"h-24 w-24 rounded-full mx-auto mb-4"}),e.jsx(B,{className:"h-10 w-1/2 mx-auto mb-2"}),e.jsx(B,{className:"h-6 w-3/4 mx-auto"})]}),e.jsx("div",{className:"space-y-10",children:[...Array(3)].map((p,b)=>e.jsxs("div",{children:[e.jsx(B,{className:"h-9 w-1/3 mb-6"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(3)].map((A,L)=>e.jsx(ge,{className:"p-4",children:e.jsx(B,{className:"h-48 w-full"})},L))})]},b))})]});if(t)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs(re,{variant:"destructive",children:[e.jsx(mr,{className:"h-4 w-4"}),e.jsx(te,{children:"Erro ao carregar o cardápio"}),e.jsx(se,{children:n instanceof Error?n.message:"Ocorreu um erro desconhecido."})]})});const{restaurant:S,hours:O}=r;return e.jsxs(e.Fragment,{children:[e.jsx(fr,{product:s,isOpen:l,onClose:()=>d(!1)}),e.jsx(pr,{product:s,isOpen:i,onClose:()=>m(!1)}),e.jsx(Br,{isOpen:u,onOpenChange:f}),e.jsxs("div",{className:_("container mx-auto px-4 py-8 max-w-5xl"),children:[e.jsxs("header",{className:"text-center mb-8",children:[S.logo_url&&e.jsx("div",{className:"w-20 h-20 mx-auto rounded-full mb-4 overflow-hidden border-4 border-card shadow-lg",children:e.jsx(U,{src:S.logo_url,alt:S.name,className:"w-full h-full object-cover"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight mb-2",children:S.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:S.description}),e.jsx(wr,{restaurant:S,hours:O})]}),!j&&e.jsx(jr,{}),e.jsx("div",{className:"mb-8 sticky top-0 z-30 bg-background pt-4 -mt-4",children:e.jsx(be,{type:"text",placeholder:"Buscar produtos...",className:"w-full p-3 h-10 text-base",value:h,onChange:p=>x(p.target.value)})}),e.jsx("main",{className:_(!j&&"opacity-50 pointer-events-none"),children:T.length===0?e.jsx("div",{className:"text-center py-16",children:e.jsx("p",{className:"text-muted-foreground text-lg",children:g?"Nenhum produto encontrado.":"Nenhum item no cardápio no momento."})}):e.jsx("div",{className:"space-y-10",children:T.map(p=>e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold border-b-2 border-primary pb-2 mb-6",children:p.name}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:p.products.map(b=>e.jsx(je,{id:b.id,name:b.name,description:b.description,price:b.price,image_url:b.image_url,is_price_by_weight:b.is_price_by_weight,is_available:b.is_available,onClick:()=>P(b)},b.id))})]},p.id))})})]}),j&&e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsx(Sr,{onClick:()=>f(!0)})})]})};export{ut as default};
