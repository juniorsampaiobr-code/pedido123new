import{j as e,b as ye,u as ve}from"./tanstack-DXzASLyu.js";import{k as L,L as be,r as t,u as Ae,O as je}from"./vendor-YgypLURK.js";import{s as v}from"./client-lAKPhnc8.js";import{L as Ne}from"./Logo-CYeFf7Ut.js";import{c as j,b as f,g as Se,h as M,j as De,v as Ce,u as p,w as we,T as R,d as _,e as O,L as Ee}from"./index-CMiS2o-F.js";import{P as ke}from"./package-Cix-dYkO.js";import{S as I}from"./shopping-cart-DpzJdGp4.js";import{C as Pe}from"./clock-C1on4qoY.js";import{C as Te}from"./credit-card-C5vQBzjV.js";import{T as Re}from"./truck-nrKctuP4.js";import{S as _e}from"./settings-fMgwzGT5.js";import{b as q,B as T}from"./button-BxQvs-kK.js";import{c as $,d as Oe,O as Le,W as Me,C as Ie,T as qe,D as $e,a as z,P as ze,R as Fe}from"./index-BDB3UOS_.js";import"./supabase-Bm28tI2t.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=j("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=j("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=j("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=j("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=j("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),Qe=[{href:"/dashboard",label:"Dashboard",icon:He},{href:"/products",label:"Produtos",icon:ke},{href:"/orders",label:"Pedidos",icon:I},{href:"/cashier",label:"Caixa",icon:We},{href:"/hours",label:"Horários",icon:Pe},{href:"/payments",label:"Pagamentos",icon:Te},{href:"/delivery",label:"Taxa de Entrega",icon:Re},{href:"/settings",label:"Configurações",icon:_e}],Be=()=>{const a=L();return e.jsxs("aside",{className:"w-64 flex-shrink-0 border-r bg-card h-screen sticky top-0 flex-col hidden lg:flex",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx(Ne,{})}),e.jsx("nav",{className:"flex-grow p-4",children:e.jsx("ul",{children:Qe.map(o=>e.jsx("li",{children:e.jsxs(be,{to:o.href,className:f("flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors",a.pathname===o.href?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted hover:text-foreground"),children:[e.jsx(o.icon,{className:"h-4 w-4"}),o.label]})},o.href))})})]})};var V="AlertDialog",[Ke,wa]=Se(V,[$]),g=$(),H=a=>{const{__scopeAlertDialog:o,...r}=a,s=g(o);return e.jsx(Fe,{...s,...r,modal:!0})};H.displayName=V;var Ue="AlertDialogTrigger",Xe=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,l=g(r);return e.jsx(Oe,{...l,...s,ref:o})});Xe.displayName=Ue;var Ye="AlertDialogPortal",G=a=>{const{__scopeAlertDialog:o,...r}=a,s=g(o);return e.jsx(ze,{...s,...r})};G.displayName=Ye;var Je="AlertDialogOverlay",W=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,l=g(r);return e.jsx(Le,{...l,...s,ref:o})});W.displayName=Je;var b="AlertDialogContent",[Ze,ea]=Ke(b),aa=Ce("AlertDialogContent"),Q=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,children:s,...l}=a,n=g(r),i=t.useRef(null),N=M(o,i),S=t.useRef(null);return e.jsx(Me,{contentName:b,titleName:B,docsSlug:"alert-dialog",children:e.jsx(Ze,{scope:r,cancelRef:S,children:e.jsxs(Ie,{role:"alertdialog",...n,...l,ref:N,onOpenAutoFocus:De(l.onOpenAutoFocus,h=>{var y;h.preventDefault(),(y=S.current)==null||y.focus({preventScroll:!0})}),onPointerDownOutside:h=>h.preventDefault(),onInteractOutside:h=>h.preventDefault(),children:[e.jsx(aa,{children:s}),e.jsx(ra,{contentRef:i})]})})})});Q.displayName=b;var B="AlertDialogTitle",K=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,l=g(r);return e.jsx(qe,{...l,...s,ref:o})});K.displayName=B;var U="AlertDialogDescription",X=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,l=g(r);return e.jsx($e,{...l,...s,ref:o})});X.displayName=U;var oa="AlertDialogAction",Y=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,l=g(r);return e.jsx(z,{...l,...s,ref:o})});Y.displayName=oa;var J="AlertDialogCancel",Z=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,{cancelRef:l}=ea(J,r),n=g(r),i=M(o,l);return e.jsx(z,{...n,...s,ref:i})});Z.displayName=J;var ra=({contentRef:a})=>{const o=`\`${b}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${b}\` by passing a \`${U}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${b}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return t.useEffect(()=>{var s;document.getElementById((s=a.current)==null?void 0:s.getAttribute("aria-describedby"))||console.warn(o)},[o,a]),null},ta=H,sa=G,ee=W,ae=Q,oe=Y,re=Z,te=K,se=X;const na=ta,ia=sa,ne=t.forwardRef(({className:a,...o},r)=>e.jsx(ee,{className:f("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...o,ref:r}));ne.displayName=ee.displayName;const ie=t.forwardRef(({className:a,...o},r)=>e.jsxs(ia,{children:[e.jsx(ne,{}),e.jsx(ae,{ref:r,className:f("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...o})]}));ie.displayName=ae.displayName;const le=({className:a,...o})=>e.jsx("div",{className:f("flex flex-col space-y-2 text-center sm:text-left",a),...o});le.displayName="AlertDialogHeader";const ce=({className:a,...o})=>e.jsx("div",{className:f("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...o});ce.displayName="AlertDialogFooter";const de=t.forwardRef(({className:a,...o},r)=>e.jsx(te,{ref:r,className:f("text-lg font-semibold",a),...o}));de.displayName=te.displayName;const ue=t.forwardRef(({className:a,...o},r)=>e.jsx(se,{ref:r,className:f("text-sm text-muted-foreground",a),...o}));ue.displayName=se.displayName;const pe=t.forwardRef(({className:a,...o},r)=>e.jsx(oe,{ref:r,className:f(q(),a),...o}));pe.displayName=oe.displayName;const la=t.forwardRef(({className:a,...o},r)=>e.jsx(re,{ref:r,className:f(q({variant:"outline"}),"mt-2 sm:mt-0",a),...o}));la.displayName=re.displayName;const ca=({isOpen:a,onEnable:o})=>e.jsx(na,{open:a,children:e.jsxs(ie,{children:[e.jsxs(le,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-6 w-6 text-primary"}),"Ativar Notificações Sonoras?"]}),e.jsxs(ue,{children:["Para garantir que você não perca nenhum novo pedido, precisamos da sua permissão para tocar um som de notificação.",e.jsx("br",{}),e.jsx("br",{}),'Ao clicar em "Ativar", um som de teste será reproduzido.']})]}),e.jsx(ce,{children:e.jsx(pe,{onClick:o,className:"w-full",children:"Sim, ativar som"})})]})}),me=t.createContext(null),Ea=()=>{const a=t.useContext(me);if(!a)throw new Error("useSound must be used within a DashboardLayout");return a},da=a=>{const o=ua.find(r=>r.href===a);return o?o.label:"Dashboard"},ua=[{href:"/dashboard",label:"Dashboard"},{href:"/products",label:"Produtos"},{href:"/orders",label:"Pedidos"},{href:"/cashier",label:"Caixa"},{href:"/hours",label:"Horários"},{href:"/payments",label:"Pagamentos"},{href:"/delivery",label:"Taxa de Entrega"},{href:"/settings",label:"Configurações"}],pa=()=>{const a=Ae(),o=L(),r=ye(),[s,l]=t.useState(null),n=t.useRef(null),[i,N]=t.useState("loading"),[S,h]=t.useState(!1),[y,E]=t.useState(null),[u,x]=t.useState(()=>localStorage.getItem("soundNotificationStatus")||"disabled");t.useEffect(()=>{localStorage.setItem("soundNotificationStatus",u)},[u]);const{data:A,isLoading:fe}=ve({queryKey:["dashboardRestaurant"],queryFn:async()=>{const{data:d,error:m}=await v.from("restaurants").select("*").limit(1).single();if(m)throw new Error(m.message);return d},enabled:!!s,staleTime:1/0});t.useEffect(()=>{!localStorage.getItem("hasSeenSoundPermissionModal")&&u!=="enabled"&&i==="ready"&&h(!0)},[u,i]),t.useEffect(()=>{(async()=>{const{data:{session:c}}=await v.auth.getSession();c!=null&&c.user?l(c.user):a("/auth")})();const{data:{subscription:m}}=v.auth.onAuthStateChange((c,w)=>{c==="SIGNED_OUT"?a("/"):w!=null&&w.user?l(w.user):a("/auth")});return()=>m.unsubscribe()},[a]);const D=t.useCallback(()=>{n.current&&(n.current.pause(),n.current.loop=!1,E(null))},[]),k=t.useCallback(d=>{if(u==="enabled"&&n.current&&i==="ready"){if(y)return;E(d),n.current.loop=!0,n.current.play().catch(m=>{console.error("Erro na reprodução automática de áudio:",m),E(null),p.warning("Não foi possível tocar o som automaticamente.",{description:"Interaja com a página para permitir a reprodução de som."})})}},[u,i,y]);t.useEffect(()=>{const d=v.channel("new-orders-toast").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders"},m=>{r.invalidateQueries({queryKey:["orders"]});const c=m.new;c.status==="pending"&&c.id&&(p.info("🔔 Novo pedido recebido!",{description:`Pedido #${c.id.slice(-4)} está aguardando confirmação.`,duration:15e3}),k(c.id))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders"},m=>{r.invalidateQueries({queryKey:["orders"]});const c=m.new;c.status==="confirmed"&&c.id&&(p.success("✅ Pagamento Confirmado!",{description:`Pedido #${c.id.slice(-4)} foi pago e está pronto para preparo.`,duration:15e3}),k(c.id))}).subscribe();return()=>{v.removeChannel(d)}},[r,k]);const P=t.useCallback(()=>{u==="enabled"&&n.current&&i==="ready"&&(D(),n.current.loop=!1,n.current.currentTime=0,n.current.play().catch(d=>{console.error("Erro na reprodução de áudio de teste:",d)}))},[u,i,D]),ge=async()=>{if(i!=="ready"||!n.current){p.error("O arquivo de som ainda não está pronto. Tente novamente em um momento.");return}try{n.current.currentTime=0,await n.current.play(),x("enabled"),p.success("Notificações sonoras ativadas!"),localStorage.setItem("hasSeenSoundPermissionModal","true")}catch(d){console.error("Audio activation failed from modal:",d),p.error("Falha ao ativar o som.",{description:"Seu navegador pode ter bloqueado a reprodução. Por favor, tente ativar manualmente no ícone do cabeçalho."}),x("error")}finally{h(!1)}},he=async()=>{if(u==="enabled"){D(),x("disabled"),p.info("Notificações sonoras desativadas.");return}if(i!=="ready"||!n.current){p.error("Som de notificação não está pronto ou configurado."),x("error");return}try{await P(),x("enabled"),p.success("Notificações sonoras ativadas!",{description:"Você ouviu o som de teste."})}catch(d){console.error("Audio activation failed:",d),p.error("Falha ao ativar o som.",{description:"Seu navegador pode ter bloqueado. Clique na página e tente novamente."}),x("error")}},xe=async()=>{await v.auth.signOut()};if(!s||fe)return e.jsx(we,{});const C=i!=="ready";return e.jsxs(me.Provider,{value:{playSound:P,stopSoundLoop:D,soundStatus:u,loopingOrderId:y},children:[e.jsx(ca,{isOpen:S,onEnable:ge}),e.jsxs("div",{className:"flex min-h-screen bg-muted/40",children:[e.jsx(Be,{}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"border-b bg-background sticky top-0 z-40",children:e.jsxs("div",{className:"container max-w-none mx-auto px-8 h-16 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(I,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-xl font-semibold",children:da(o.pathname)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(R,{children:[e.jsx(_,{asChild:!0,children:e.jsx(T,{variant:"outline",size:"sm",onClick:P,disabled:C,children:"Testar Som"})}),C&&e.jsx(O,{children:e.jsx("p",{children:"Carregando som..."})})]}),e.jsxs(R,{children:[e.jsx(_,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"icon",onClick:he,disabled:C,children:[i==="loading"&&e.jsx(Ee,{className:"h-4 w-4 animate-spin"}),i==="ready"&&u==="enabled"&&e.jsx(F,{className:"h-4 w-4 text-green-500"}),i==="ready"&&u==="disabled"&&e.jsx(Ge,{className:"h-4 w-4"}),i==="error"&&e.jsx(Ve,{className:"h-4 w-4 text-destructive"})]})}),C&&e.jsx(O,{children:e.jsx("p",{children:"Carregando som..."})})]}),e.jsx(T,{variant:"outline",onClick:xe,children:"Sair"})]})]})}),e.jsx(je,{context:{restaurant:A}})]}),(A==null?void 0:A.notification_sound_url)&&e.jsx("audio",{ref:n,src:A.notification_sound_url,onCanPlayThrough:()=>N("ready"),onError:()=>{p.error("Erro ao carregar o som de notificação.",{description:"Verifique o arquivo em Configurações."}),N("error"),x("error")},className:"hidden"})]})]})},ka=t.memo(pa);export{me as SoundContext,ka as default,Ea as useSound};
