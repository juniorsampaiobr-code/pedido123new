import{a as M,j as e}from"./tanstack-C7aOFagJ.js";import{h as _,i as H,r as n}from"./vendor-DjsPZZVP.js";import{L as W}from"./Logo-D8OMddHV.js";import{s as p,d as $,C as G,e as X,f as Y,g as Z,b as ee,h as u,I as v,B as f,L as R,M as ae,P as re,i as te,j as s}from"./index-B9y75x8T.js";import{u as se}from"./use-active-restaurant-id-BQ2tMmvz.js";import{A as ne}from"./arrow-left-D_kSCnu8.js";import"./supabase-BAEEEeUB.js";const U=o=>o.replace(/\D/g,""),A=o=>o.replace(/\D/g,""),fe=()=>{var q;const o=_(),g=H(),E=M(),[x,c]=n.useState(!1),[i,z]=n.useState(!1),[C,y]=n.useState(!1),[l,w]=n.useState(""),[j,O]=n.useState(""),[b,J]=n.useState(""),[S,T]=n.useState(""),[P,Q]=n.useState(""),[oe,F]=n.useState(null),[ie,I]=n.useState(null),{data:L,isLoading:d}=se(),m=(q=g.state)==null?void 0:q.restaurantId,k=(r,a)=>{var N;const t=(N=g.state)==null?void 0:N.from,h=a||L;t==="/checkout"?(console.log("User logged in, redirecting to checkout."),o("/checkout",{replace:!0,state:{restaurantId:m}})):h?(console.log("User logged in, redirecting to specific menu:",h),o(`/menu/${h}`,{replace:!0})):(console.log("User logged in, no active restaurant found, redirecting to index."),o("/",{replace:!0}))};n.useEffect(()=>{if(d)return;const{data:{subscription:r}}=p.auth.onAuthStateChange((a,t)=>{I(t),F((t==null?void 0:t.user)??null),t!=null&&t.user&&k(t.user,m)});return p.auth.getSession().then(({data:{session:a}})=>{I(a),F((a==null?void 0:a.user)??null),a!=null&&a.user&&k(a.user,m)}),()=>r.unsubscribe()},[o,g.state,d,L,m]);const V=()=>{if(!b.trim())return s.error("O Nome Completo é obrigatório."),!1;if(U(S).length!==11)return s.error("O Telefone deve conter 11 dígitos (DDD + 9 dígitos)."),!1;const a=A(P);return a.length!==11&&a.length!==14?(s.error("O CPF deve ter 11 dígitos ou CNPJ 14 dígitos."),!1):l.trim()?j.length<6?(s.error("A Senha deve ter pelo menos 6 caracteres."),!1):!0:(s.error("O Email é obrigatório."),!1)},B=async r=>{var a;if(r.preventDefault(),c(!0),((a=g.state)==null?void 0:a.from)==="/checkout"&&!m){s.error("Erro: ID do restaurante de origem não encontrado."),c(!1);return}try{if(i){if(!V()){c(!1);return}const t=U(S),h=A(P),{data:N,error:D}=await p.auth.signUp({email:l,password:j,options:{data:{full_name:b,phone:t,cpf_cnpj:h}}});if(D)throw D;N.session?(s.success("Conta criada e login efetuado com sucesso!"),E.invalidateQueries({queryKey:["authStatus"]})):s.success("Conta criada! Verifique seu email para confirmar.")}else{const{error:t}=await p.auth.signInWithPassword({email:l,password:j});if(t)throw t;s.success("Login realizado com sucesso!"),E.invalidateQueries({queryKey:["authStatus"]})}}catch(t){t.message.includes("Email not confirmed")?s.error("Por favor, verifique seu e-mail para confirmar sua conta antes de fazer login."):s.error(t.message||"Erro ao processar autenticação")}finally{c(!1)}},K=async r=>{if(r.preventDefault(),!l.trim()){s.error("O Email é obrigatório para recuperação de senha.");return}c(!0);try{const{error:a}=await p.auth.resetPasswordForEmail(l,{redirectTo:window.location.origin+window.location.pathname+"#/auth"});if(a)throw a;s.success("Email de recuperação enviado!",{description:"Verifique sua caixa de entrada (e spam) para o link de redefinição de senha.",duration:8e3}),y(!1)}catch(a){s.error(a.message||"Erro ao enviar email de recuperação.")}finally{c(!1)}};return d?e.jsx($,{}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(W,{className:"justify-center mb-4"})}),e.jsxs(G,{className:"shadow-xl border-2",children:[e.jsxs(X,{className:"space-y-1",children:[e.jsx(Y,{className:"text-2xl font-bold text-center",children:C?"Recuperar Senha":i?"Crie sua conta":"Acesse sua conta"}),e.jsx(Z,{className:"text-center",children:C?"Digite seu email para receber o link de redefinição.":i?"Preencha os campos para começar":"Utilize seu email e senha para fazer login"})]}),e.jsx(ee,{className:"space-y-4",children:C?e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"email",children:"Email *"}),e.jsx(v,{id:"email",type:"email",placeholder:"seu@email.com",value:l,onChange:r=>w(r.target.value),required:!0,className:"h-12"})]}),e.jsxs(f,{type:"submit",className:"w-full",size:"lg",disabled:x,children:[x?e.jsx(R,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Enviar Link de Recuperação"]}),e.jsx("div",{className:"text-center",children:e.jsxs(f,{variant:"link",type:"button",className:"p-0 h-auto",onClick:()=>{y(!1),w("")},children:[e.jsx(ne,{className:"h-4 w-4 mr-1"})," Voltar para o Login"]})})]}):e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"fullName",children:"Nome Completo *"}),e.jsx(v,{id:"fullName",type:"text",placeholder:"Seu nome completo",value:b,onChange:r=>J(r.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"phone",children:"Telefone *"}),e.jsx(re,{id:"phone",value:S,onChange:r=>T(r.target.value),required:!0,className:"h-12"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formato: (99) 99999-9999"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"cpfCnpj",children:"CPF/CNPJ *"}),e.jsx(te,{id:"cpfCnpj",value:P,onChange:r=>Q(r.target.value),required:!0,className:"h-12"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"CPF (11 dígitos) ou CNPJ (14 dígitos)."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"email",children:"Email *"}),e.jsx(v,{id:"email",type:"email",placeholder:"seu@email.com",value:l,onChange:r=>w(r.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"password",children:"Senha *"}),e.jsx(v,{id:"password",type:"password",placeholder:"••••••••",value:j,onChange:r=>O(r.target.value),required:!0,className:"h-12"})]}),!i&&e.jsx("div",{className:"text-right",children:e.jsx(f,{variant:"link",type:"button",className:"p-0 h-auto text-sm text-muted-foreground hover:text-primary",onClick:()=>y(!0),children:"Esqueci minha senha"})}),e.jsx(f,{type:"submit",className:"w-full",size:"lg",disabled:x||d,children:x||d?e.jsx(R,{className:"h-4 w-4 animate-spin mr-2"}):i?"Criar conta":"Entrar"}),e.jsx("div",{className:"text-center",children:e.jsx(f,{variant:"link",type:"button",className:"p-0 h-auto",onClick:()=>z(!i),children:i?"Já tem uma conta? Faça login":"Não tem uma conta? Crie uma agora"})})]})})]})]})})};export{fe as default};
