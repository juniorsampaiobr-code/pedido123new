import{j as e,u as Y,c as V,b as Me}from"./tanstack-Ch7Ewlpa.js";import{r as m,i as Be}from"./vendor-CCvq-0xx.js";import{s as M}from"./client-3S0ugJ5L.js";import{B as T,b as $e}from"./button-NOJYzBOh.js";import{C as ee,a as se,b as Fe,c as Le}from"./card-C7TVwPgM.js";import{S as Oe,a as qe,b as ze,c as Ge,d as Ve,T as He,e as Ue,f as Ke,g as Qe,B as Xe}from"./select-CiLDsUh5.js";import{S as I}from"./skeleton-Rivzc5i1.js";import{A as te,a as ae,b as ne}from"./alert-CXOXUxsv.js";import{c as K,a as A,d as We,e as re,P as Q,f as Z,g as Je,h as Ze,i as Ye,L as es,u as D}from"./index-Dn4Zi0M3.js";import{D as ss,a as ts,b as as,c as ns,X as rs}from"./dialog-Dp37Vm2F.js";import{p as os}from"./pt-BR-CbDebePx.js";import{T as oe}from"./terminal-UjQU-atM.js";import{U as is}from"./user-ToxN5XMd.js";import{P as ls}from"./phone-mcbTPnn2.js";import{M as cs,R as ie}from"./refresh-cw-DXRC7WHn.js";import{C as ds}from"./credit-card-DZvlCSON.js";import{C as ms}from"./calendar-CdNClwaT.js";import{C as le,T as ce}from"./truck-Dh9Mc277.js";import{P as de}from"./package-CVj-am5K.js";import{C as me}from"./circle-check-big-DxpW0SAr.js";import{C as z}from"./check-l2KQU__y.js";import{C as ue}from"./circle-x-bdKEWcs8.js";import{E as us}from"./euro-BrFc7mvT.js";import{f as ps}from"./format-BeKxgCCE.js";import{A as pe,h as he,a as xe,b as fe,c as ge,d as be,e as ye,f as je,g as ve}from"./alert-dialog-DomOqf2m.js";import{u as hs}from"./index-BMYbFAKC.js";import{S as Ne}from"./shopping-cart-J9WYkdyD.js";import{D as xs}from"./dollar-sign-DYPAU75Z.js";import{P as fs}from"./printer-C5vbOX2w.js";import{T as gs}from"./trash-2-BrWOWw3M.js";import"./supabase-t-NbcSY6.js";import"./index-CTU2QJja.js";import"./index-MFjXM7kG.js";import"./index-BdQq_4o_.js";import"./index-DaEZViLE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=K("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=K("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=K("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),vs={pending:{label:"Pendente",icon:le,color:"bg-yellow-500"},preparing:{label:"Em Preparação",icon:de,color:"bg-orange-500"},ready:{label:"Pronto",icon:me,color:"bg-green-500"},delivering:{label:"Em Entrega",icon:ce,color:"bg-blue-500"},delivered:{label:"Entregue",icon:z,color:"bg-purple-500"},cancelled:{label:"Cancelado",icon:ue,color:"bg-destructive"},pending_payment:{label:"Aguardando Pagamento",icon:us,color:"bg-gray-500"}},Ns=async s=>{const{data:t,error:a}=await M.from("order_items").select("*, products(name, is_price_by_weight)").eq("order_id",s);if(a)throw new Error(a.message);return t},ws=({order:s,isOpen:t,onClose:a})=>{var R,S,O,q;const[h,i]=m.useState([]),[n,c]=m.useState(!1),[u,o]=m.useState(null),[x,d]=m.useState("Carregando...");m.useEffect(()=>{t&&(async()=>{if(s!=null&&s.id){c(!0),o(null);try{const _=await Ns(s.id);i(_)}catch(_){console.error("Failed to fetch order items:",_),o("Falha ao carregar itens do pedido.")}finally{c(!1)}}})()},[s==null?void 0:s.id,t]),m.useEffect(()=>{t&&s&&(async()=>{if(!(s!=null&&s.payment_method_id)){d("Não especificado");return}try{const{data:_,error:l}=await M.from("payment_methods").select("name").eq("id",s.payment_method_id).single();if(l)throw l;d((_==null?void 0:_.name)||"Método não encontrado")}catch(_){console.error("Failed to fetch payment method name:",_),d("Erro ao carregar")}})()},[t,s]),m.useEffect(()=>{s&&console.log("Order prop recebida:",s)},[s]);const f=((R=s==null?void 0:s.customer)==null?void 0:R.name)||"Cliente Desconhecido",j=(S=s==null?void 0:s.customer)==null?void 0:S.phone,C=(O=s==null?void 0:s.customer)==null?void 0:O.email,N=(q=s==null?void 0:s.customer)==null?void 0:q.cpf_cnpj,p=s==null?void 0:s.delivery_address,w=s!=null&&s.status?vs[s.status]:null,y=s!=null&&s.id?s.id.slice(-4):"N/A",g=s!=null&&s.created_at?new Date(s.created_at):null,r=g?ps(g,"dd 'de' MMMM 'de' yyyy 'às' HH:mm",{locale:os}):"Data desconhecida",b=s!=null&&s.change_for?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.change_for):null,v=s!=null&&s.delivery_fee?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.delivery_fee):"Grátis";return e.jsx(ss,{open:t,onOpenChange:a,children:e.jsxs(ts,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(as,{children:e.jsxs(ns,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Detalhes do Pedido #",y]}),w&&e.jsxs("span",{className:A("text-xs font-semibold px-2.5 py-0.5 rounded-full text-white flex items-center",w.color),children:[e.jsx(w.icon,{className:"w-3 h-3 mr-1"}),w.label]})]})}),u&&e.jsxs(te,{variant:"destructive",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx(ae,{children:"Erro"}),e.jsx(ne,{children:u})]}),n?e.jsxs("div",{className:"space-y-4",children:[e.jsx(I,{className:"h-4 w-1/3"}),e.jsx(I,{className:"h-10 w-full"}),e.jsx(I,{className:"h-4 w-1/3"}),e.jsx(I,{className:"h-20 w-full"}),e.jsx(I,{className:"h-4 w-1/3"}),e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((E,_)=>e.jsx(I,{className:"h-12 w-full"},_))}),e.jsx(I,{className:"h-4 w-1/3"}),e.jsx(I,{className:"h-6 w-full"})]}):s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(is,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Cliente"}),e.jsx("p",{children:f}),N&&e.jsxs("p",{className:"text-muted-foreground text-xs",children:["CPF/CNPJ: ",N]})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(ls,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Telefone"}),e.jsx("p",{children:j||"Não informado"}),C&&e.jsx("p",{className:"text-muted-foreground text-xs",children:C})]})]}),e.jsxs("div",{className:"flex items-start md:col-span-2",children:[e.jsx(cs,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Endereço de Entrega"}),e.jsx("p",{children:p||"Retirada no local"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(ds,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Método de Pagamento"}),e.jsx("p",{children:x}),b&&e.jsxs("p",{className:"text-muted-foreground text-xs",children:["Troco para: ",b]})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(ms,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Data do Pedido"}),e.jsx("p",{children:r})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Itens do Pedido"}),e.jsx("div",{className:"space-y-2",children:h.map(E=>{var k,P;const l=((k=E.products)==null?void 0:k.is_price_by_weight)?`${E.quantity} kg`:`${E.quantity} x`;return e.jsxs("div",{className:"flex justify-between items-start p-2 bg-muted/50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((P=E.products)==null?void 0:P.name)||"Produto não encontrado"}),E.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Obs: ",E.notes]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{children:[l," ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(E.unit_price)]}),e.jsx("p",{className:"font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(E.subtotal)})]})]},E.id)})})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount-(s.delivery_fee||0))})]}),e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:v})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]})]}),e.jsx("div",{className:"pt-4",children:s.notes&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Observações do Cliente:"}),e.jsx("p",{className:"bg-muted p-2 rounded",children:s.notes})]})})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(T,{onClick:a,children:"Fechar"})})]})})},we=({className:s,...t})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:A("mx-auto flex w-full justify-center",s),...t});we.displayName="Pagination";const Ce=m.forwardRef(({className:s,...t},a)=>e.jsx("ul",{ref:a,className:A("flex flex-row items-center gap-1",s),...t}));Ce.displayName="PaginationContent";const B=m.forwardRef(({className:s,...t},a)=>e.jsx("li",{ref:a,className:A("",s),...t}));B.displayName="PaginationItem";const L=({className:s,isActive:t,size:a="icon",...h})=>e.jsx("a",{"aria-current":t?"page":void 0,className:A($e({variant:t?"outline":"ghost",size:a}),s),...h});L.displayName="PaginationLink";const ke=({className:s,...t})=>e.jsxs(L,{"aria-label":"Go to previous page",size:"default",className:A("gap-1 pl-2.5",s),...t,children:[e.jsx(bs,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});ke.displayName="PaginationPrevious";const Pe=({className:s,...t})=>e.jsxs(L,{"aria-label":"Go to next page",size:"default",className:A("gap-1 pr-2.5",s),...t,children:[e.jsx("span",{children:"Next"}),e.jsx(ys,{className:"h-4 w-4"})]});Pe.displayName="PaginationNext";const H=({className:s,...t})=>e.jsxs("span",{"aria-hidden":!0,className:A("flex h-9 w-9 items-center justify-center",s),...t,children:[e.jsx(js,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]});H.displayName="PaginationEllipsis";const Cs=({currentPage:s,totalPages:t,onPageChange:a})=>{if(t<=1)return null;const i=(()=>{const n=[],u=Math.max(1,s-Math.floor(2.5)),o=Math.min(t,u+5-1);if(o-u+1<5){const x=Math.max(1,o-5+1);for(let d=x;d<=o;d++)n.push(d)}else for(let x=u;x<=o;x++)n.push(x);return n})();return e.jsx(we,{children:e.jsxs(Ce,{children:[e.jsx(B,{children:e.jsx(ke,{onClick:()=>a(s-1),className:A(s===1&&"pointer-events-none opacity-50")})}),i[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx(B,{children:e.jsx(L,{onClick:()=>a(1),children:"1"})}),i[0]>2&&e.jsx(B,{children:e.jsx(H,{})})]}),i.map(n=>e.jsx(B,{children:e.jsx(L,{isActive:n===s,onClick:()=>a(n),children:n})},n)),i[i.length-1]<t&&e.jsxs(e.Fragment,{children:[i[i.length-1]<t-1&&e.jsx(B,{children:e.jsx(H,{})}),e.jsx(B,{children:e.jsx(L,{onClick:()=>a(t),children:t})})]}),e.jsx(B,{children:e.jsx(Pe,{onClick:()=>a(s+1),className:A(s===t&&"pointer-events-none opacity-50")})})]})})};var G="Checkbox",[ks,ft]=We(G),[Ps,X]=ks(G);function Es(s){const{__scopeCheckbox:t,checked:a,children:h,defaultChecked:i,disabled:n,form:c,name:u,onCheckedChange:o,required:x,value:d="on",internal_do_not_use_render:f}=s,[j,C]=Ye({prop:a,defaultProp:i??!1,onChange:o,caller:G}),[N,p]=m.useState(null),[w,y]=m.useState(null),g=m.useRef(!1),r=N?!!c||!!N.closest("form"):!0,b={checked:j,disabled:n,setChecked:C,control:N,setControl:p,name:u,form:c,value:d,hasConsumerStoppedPropagationRef:g,required:x,defaultChecked:$(i)?!1:i,isFormControl:r,bubbleInput:w,setBubbleInput:y};return e.jsx(Ps,{scope:t,...b,children:_s(f)?f(b):h})}var Ee="CheckboxTrigger",_e=m.forwardRef(({__scopeCheckbox:s,onKeyDown:t,onClick:a,...h},i)=>{const{control:n,value:c,disabled:u,checked:o,required:x,setControl:d,setChecked:f,hasConsumerStoppedPropagationRef:j,isFormControl:C,bubbleInput:N}=X(Ee,s),p=re(i,d),w=m.useRef(o);return m.useEffect(()=>{const y=n==null?void 0:n.form;if(y){const g=()=>f(w.current);return y.addEventListener("reset",g),()=>y.removeEventListener("reset",g)}},[n,f]),e.jsx(Q.button,{type:"button",role:"checkbox","aria-checked":$(o)?"mixed":o,"aria-required":x,"data-state":De(o),"data-disabled":u?"":void 0,disabled:u,value:c,...h,ref:p,onKeyDown:Z(t,y=>{y.key==="Enter"&&y.preventDefault()}),onClick:Z(a,y=>{f(g=>$(g)?!0:!g),N&&C&&(j.current=y.isPropagationStopped(),j.current||y.stopPropagation())})})});_e.displayName=Ee;var W=m.forwardRef((s,t)=>{const{__scopeCheckbox:a,name:h,checked:i,defaultChecked:n,required:c,disabled:u,value:o,onCheckedChange:x,form:d,...f}=s;return e.jsx(Es,{__scopeCheckbox:a,checked:i,defaultChecked:n,disabled:u,required:c,onCheckedChange:x,name:h,form:d,value:o,internal_do_not_use_render:({isFormControl:j})=>e.jsxs(e.Fragment,{children:[e.jsx(_e,{...f,ref:t,__scopeCheckbox:a}),j&&e.jsx(Ie,{__scopeCheckbox:a})]})})});W.displayName=G;var Ae="CheckboxIndicator",Re=m.forwardRef((s,t)=>{const{__scopeCheckbox:a,forceMount:h,...i}=s,n=X(Ae,a);return e.jsx(Je,{present:h||$(n.checked)||n.checked===!0,children:e.jsx(Q.span,{"data-state":De(n.checked),"data-disabled":n.disabled?"":void 0,...i,ref:t,style:{pointerEvents:"none",...s.style}})})});Re.displayName=Ae;var Se="CheckboxBubbleInput",Ie=m.forwardRef(({__scopeCheckbox:s,...t},a)=>{const{control:h,hasConsumerStoppedPropagationRef:i,checked:n,defaultChecked:c,required:u,disabled:o,name:x,value:d,form:f,bubbleInput:j,setBubbleInput:C}=X(Se,s),N=re(a,C),p=hs(n),w=Ze(h);m.useEffect(()=>{const g=j;if(!g)return;const r=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(r,"checked").set,R=!i.current;if(p!==n&&v){const S=new Event("click",{bubbles:R});g.indeterminate=$(n),v.call(g,$(n)?!1:n),g.dispatchEvent(S)}},[j,p,n,i]);const y=m.useRef($(n)?!1:n);return e.jsx(Q.input,{type:"checkbox","aria-hidden":!0,defaultChecked:c??y.current,required:u,disabled:o,name:x,value:d,form:f,...t,tabIndex:-1,ref:N,style:{...t.style,...w,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Ie.displayName=Se;function _s(s){return typeof s=="function"}function $(s){return s==="indeterminate"}function De(s){return $(s)?"indeterminate":s?"checked":"unchecked"}const J=m.forwardRef(({className:s,...t},a)=>e.jsx(W,{ref:a,className:A("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Re,{className:A("flex items-center justify-center text-current"),children:e.jsx(z,{className:"h-4 w-4"})})}));J.displayName=W.displayName;const Te={pending:{label:"Pendente",icon:le,color:"bg-yellow-500 hover:bg-yellow-600"},preparing:{label:"Em Preparação",icon:de,color:"bg-orange-500 hover:bg-orange-600"},ready:{label:"Pronto",icon:me,color:"bg-green-500 hover:bg-green-600"},delivering:{label:"Em Entrega",icon:ce,color:"bg-indigo-500 hover:bg-indigo-600"},delivered:{label:"Entregue",icon:z,color:"bg-primary hover:bg-primary/90"},cancelled:{label:"Cancelado",icon:ue,color:"bg-destructive hover:bg-destructive/90"},pending_payment:{label:"Aguardando Pag.",icon:xs,color:"bg-gray-500 hover:bg-gray-600"}},As=[{value:"pending",label:"Mudar para Pendente"},{value:"preparing",label:"Mudar para Em Preparação"},{value:"ready",label:"Mudar para Pronto"},{value:"delivering",label:"Mudar para Em Entrega"},{value:"delivered",label:"Mudar para Entregue"},{value:"cancelled",label:"Mudar para Cancelado"},{value:"pending_payment",label:"Mudar para Aguardando Pag."},{value:"delete",label:"Excluir Permanentemente"}],U=12,Rs=async(s,t,a)=>{const h=a*U,i=h+U-1;let n=M.from("orders").select("*, customer:customers(name, phone)",{count:"exact"}).eq("restaurant_id",s);t!=="all"&&(n=n.eq("status",t));const{data:c,error:u,count:o}=await n.order("created_at",{ascending:!1}).range(h,i);if(u)throw new Error(`Erro ao buscar pedidos: ${u.message}`);return{orders:c,count:o||0}},Ss=async s=>{const{data:t,error:a}=await M.from("payment_methods").select("name").eq("id",s).single();return a?(console.error("Erro ao buscar nome do método de pagamento:",a),"Método Desconhecido"):(t==null?void 0:t.name)||"Método Desconhecido"},Is=(s,t,a)=>{var C,N;const h=s.id?s.id.slice(-4):"N/A",i=((C=s.customer)==null?void 0:C.name)||"Cliente Desconhecido",n=((N=s.customer)==null?void 0:N.phone)||"Não informado",c=s.delivery_address||"Retirada no local",u=s.created_at?new Date(s.created_at).toLocaleString("pt-BR"):"Data desconhecida",o=s.change_for?`Troco para: ${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.change_for)}`:"",x=s.delivery_fee?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.delivery_fee):"Grátis",d=s.total_amount-(s.delivery_fee||0);let f="";a.toLowerCase().includes("online")&&s.status!=="cancelled"&&s.status!=="pending_payment"?f='<div style="margin-top: 10px; padding: 5px; border: 1px solid #000; text-align: center; font-weight: bold; background-color: #ccffcc;">PAGO ONLINE - NÃO COBRAR</div>':s.status==="pending_payment"&&(f='<div style="margin-top: 10px; padding: 5px; border: 1px solid #000; text-align: center; font-weight: bold; background-color: #ffffcc;">AGUARDANDO PAGAMENTO</div>');let j="";return t.forEach(p=>{var w;j+=`
      <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
        <span>${p.quantity}x ${((w=p.products)==null?void 0:w.name)||"Produto não encontrado"}</span>
        <span>${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(p.subtotal)}</span>
      </div>
      ${p.notes?`<div style="font-size: 12px; color: #666; margin-bottom: 10px;">Obs: ${p.notes}</div>`:""}
    `}),`
    <div style="font-family: Arial, sans-serif; max-width: 300px; margin: 0 auto; padding: 20px;">
      <div style="text-align: center; border-bottom: 1px dashed #000; padding-bottom: 10px; margin-bottom: 10px;">
        <h2 style="margin: 0;">PEDIDO #${h}</h2>
        <p style="margin: 5px 0;">${u}</p>
      </div>
      
      <div style="margin-bottom: 15px;">
        <h3 style="margin: 0 0 5px 0;">Cliente</h3>
        <p style="margin: 0;">${i}</p>
        <p style="margin: 0;">${n}</p>
      </div>
      
      <div style="margin-bottom: 15px;">
        <h3 style="margin: 0 0 5px 0;">Entrega</h3>
        <p style="margin: 0;">${c}</p>
      </div>
      
      <div style="margin-bottom: 15px;">
        <h3 style="margin: 0 0 5px 0;">Itens</h3>
        ${j}
      </div>
      
      <div style="border-top: 1px dashed #000; padding-top: 10px; margin-bottom: 15px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <span>Subtotal:</span>
          <span>${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d)}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <span>Taxa de Entrega:</span>
          <span>${x}</span>
        </div>
        <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 16px; margin-top: 10px;">
          <span>Total:</span>
          <span>${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)}</span>
        </div>
      </div>
      
      <div style="margin-bottom: 15px;">
        <h3 style="margin: 0 0 5px 0;">Pagamento</h3>
        <p style="margin: 0;">${a}</p>
        ${o?`<p style="margin: 0;">${o}</p>`:""}
        ${f}
      </div>
      
      ${s.notes?`
        <div style="margin-bottom: 15px;">
          <h3 style="margin: 0 0 5px 0;">Observações</h3>
          <p style="margin: 0;">${s.notes}</p>
        </div>
      `:""}
      
      <div style="text-align: center; margin-top: 20px;">
        <p style="font-size: 12px;">Obrigado pela preferência!</p>
      </div>
    </div>
  `},Ds=({order:s,onViewDetails:t,onAccept:a,onDecline:h,onDelete:i,isSelected:n,onSelect:c,onPrint:u})=>{var f;const o=Te[s.status||"pending"],x=((f=s.customer)==null?void 0:f.name)||"Cliente Desconhecido",d=s.id?s.id.slice(-4):"N/A";return e.jsxs(ee,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col relative",children:[e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx(J,{checked:n,onCheckedChange:j=>c(s.id,!!j),className:"h-5 w-5"})}),e.jsxs(Fe,{className:"flex flex-row items-center justify-between space-y-0 pb-2 pl-12",children:[e.jsxs(Le,{className:"text-lg font-bold flex items-center gap-2",children:["Pedido #",d]}),e.jsxs(Xe,{className:A("text-white",o.color),children:[e.jsx(o.icon,{className:"h-3 w-3 mr-1"}),o.label]})]}),e.jsxs(se,{className:"space-y-2 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",x]}),e.jsx("p",{className:"text-2xl font-extrabold text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]}),e.jsxs("div",{className:"flex justify-end pt-2 border-t gap-2",children:[(s.status==="pending"||s.status==="pending_payment")&&e.jsxs(e.Fragment,{children:[e.jsxs(T,{variant:"destructive",size:"sm",onClick:()=>h(s.id),children:[e.jsx(rs,{className:"h-4 w-4 mr-1"})," Recusar"]}),e.jsxs(T,{variant:"default",size:"sm",onClick:()=>a(s.id),children:[e.jsx(z,{className:"h-4 w-4 mr-1"})," Aceitar"]})]}),e.jsx(T,{variant:"outline",size:"sm",onClick:()=>t(s),children:"Detalhes"}),e.jsx(T,{variant:"outline",size:"icon",onClick:()=>u(s),children:e.jsx(fs,{className:"h-4 w-4"})}),e.jsxs(pe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",children:e.jsx(gs,{className:"h-4 w-4"})})}),e.jsxs(xe,{children:[e.jsxs(fe,{children:[e.jsx(ge,{children:"Tem certeza que deseja excluir?"}),e.jsxs(be,{children:["Esta ação é permanente. O pedido #",d," será excluído permanentemente do sistema, incluindo todos os itens associados."]})]}),e.jsxs(ye,{children:[e.jsx(je,{children:"Cancelar"}),e.jsx(ve,{onClick:()=>i(s.id),className:"bg-destructive hover:bg-destructive/90",children:"Excluir Permanentemente"})]})]})]})]})]})]})},Ts=({status:s,onViewDetails:t,restaurantId:a,selectedOrders:h,setSelectedOrders:i,totalOrdersInView:n,onPrint:c})=>{const u=Y(),[o,x]=m.useState(1),{data:d,isLoading:f,isError:j,error:C,refetch:N}=Me({queryKey:["orders",s,a,o],queryFn:()=>Rs(a,s,o-1),enabled:!!a}),p=(d==null?void 0:d.orders)||[],w=(d==null?void 0:d.count)||0,y=Math.ceil(w/U),g=V({mutationFn:async({orderId:l,newStatus:k})=>{const P=k==="pending"?"preparing":k,{error:F}=await M.from("orders").update({status:P}).eq("id",l);if(F)throw new Error(F.message);return P},onSuccess:l=>{D.success(`Pedido ${l==="preparing"?"aceito":"recusado"} com sucesso!`),u.invalidateQueries({queryKey:["orders"]})},onError:l=>D.error(`Erro ao atualizar pedido: ${l.message}`)}),r=V({mutationFn:async l=>{const{error:k}=await M.from("orders").delete().eq("id",l);if(k)throw new Error(k.message)},onSuccess:()=>{D.success("Pedido excluído permanentemente."),u.invalidateQueries({queryKey:["orders"]})},onError:l=>D.error(`Erro ao excluir pedido: ${l.message}`)}),b=l=>{g.mutate({orderId:l,newStatus:"preparing"})},v=l=>{g.mutate({orderId:l,newStatus:"cancelled"})},R=l=>{t(l)},S=l=>{r.mutate(l)},O=m.useCallback(l=>{x(l)},[]),q=m.useCallback((l,k)=>{i(P=>k?[...P,l]:P.filter(F=>F!==l))},[i]),E=m.useCallback(l=>{if(l){const k=p.map(P=>P.id);i(P=>[...new Set([...P,...k])])}else{const k=new Set(p.map(P=>P.id));i(P=>P.filter(F=>!k.has(F)))}},[p,i]),_=p.length>0&&p.every(l=>h.includes(l.id));return f?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((l,k)=>e.jsx(ee,{children:e.jsx(se,{className:"p-4 space-y-3",children:e.jsx(I,{className:"h-32 w-full"})})},k))}):j?e.jsxs(te,{variant:"destructive",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx(ae,{children:"Erro ao carregar pedidos"}),e.jsx(ne,{children:C instanceof Error?C.message:"Ocorreu um erro desconhecido."}),e.jsxs(T,{onClick:()=>N(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]}):!p||p.length===0?e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg border",children:[e.jsx(Ne,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifique o status selecionado ou aguarde novos pedidos."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg bg-muted/50",children:[e.jsx(J,{checked:_,onCheckedChange:E,className:"h-5 w-5"}),e.jsxs("span",{className:"text-sm font-medium",children:["Selecionar todos (",p.length,") nesta página."]}),n>0&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-auto",children:[n," pedidos selecionados no total."]})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:p.map(l=>e.jsx(Ds,{order:l,onViewDetails:R,onAccept:b,onDecline:v,onDelete:S,isSelected:h.includes(l.id),onSelect:q,onPrint:c},l.id))}),y>1&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(Cs,{currentPage:o,totalPages:y,onPageChange:O})})]})},gt=()=>{const{userRestaurantId:s}=Be(),t=Y(),[a,h]=m.useState(null),[i,n]=m.useState(!1),[c,u]=m.useState([]),[o,x]=m.useState(""),d=r=>{h(r),n(!0)},f=()=>{n(!1),h(null)},j=()=>{t.invalidateQueries({queryKey:["orders",s]}),D.info("Atualizando pedidos...",{description:"Buscando novos dados no servidor."})},C=async r=>{const{data:b,error:v}=await M.from("order_items").select("*, products(name)").eq("order_id",r);if(v)throw new Error(`Erro ao buscar itens do pedido: ${v.message}`);return b},N=async r=>{try{const b=await C(r.id);let v="Não especificado";r.payment_method_id&&(v=await Ss(r.payment_method_id));const R=Is(r,b,v),S=window.open("","_blank");S?(S.document.write(`
          <html>
            <head>
              <title>Pedido #${r.id?r.id.slice(-4):"N/A"}</title>
              <style>
                @media print {
                  body { margin: 0; }
                  /* Estilo para garantir que a linha tracejada apareça */
                  .dashed-line { border-top: 1px dashed #000; }
                }
              </style>
            </head>
            <body>
              ${R}
              <script>
                window.onload = function() {
                  window.print();
                  window.onafterprint = function() {
                    window.close();
                  }
                }
              <\/script>
            </body>
          </html>
        `),S.document.close()):D.error("Não foi possível abrir a janela de impressão. Verifique as permissões do navegador.")}catch(b){console.error("Erro ao preparar impressão do pedido:",b),D.error("Erro ao preparar impressão do pedido.")}},p=V({mutationFn:async({orderIds:r,action:b})=>{if(b==="delete"){const{error:v}=await M.from("orders").delete().in("id",r);if(v)throw new Error(v.message);return"deleted"}else{const v=b==="pending"?"preparing":b,{error:R}=await M.from("orders").update({status:v}).in("id",r);if(R)throw new Error(R.message);return"updated"}},onSuccess:(r,b)=>{if(r==="deleted")D.success(`${b.orderIds.length} pedidos excluídos permanentemente.`);else{const v=Te[b.action].label;D.success(`${b.orderIds.length} pedidos atualizados para "${v}".`)}u([]),x(""),t.invalidateQueries({queryKey:["orders",s]})},onError:r=>{D.error(`Erro na ação em massa: ${r.message}`)}}),w=()=>{var r;!o||c.length===0||(o==="delete"?(r=document.getElementById("mass-delete-trigger"))==null||r.click():p.mutate({orderIds:c,action:o}))},y=[{value:"pending_payment",label:"Aguardando Pag."},{value:"pending",label:"Pendentes"},{value:"preparing",label:"Em Preparação"},{value:"ready",label:"Prontos"},{value:"delivering",label:"Em Entrega"},{value:"delivered",label:"Entregues"},{value:"cancelled",label:"Cancelados"},{value:"all",label:"Todos"}],g=p.isPending;return s?e.jsxs(e.Fragment,{children:[e.jsx(ws,{order:a,isOpen:i,onClose:f}),e.jsxs(pe,{children:[e.jsx(he,{asChild:!0,children:e.jsx("button",{id:"mass-delete-trigger",className:"hidden"})}),e.jsxs(xe,{children:[e.jsxs(fe,{children:[e.jsxs(ge,{children:["Tem certeza que deseja excluir ",c.length," pedidos?"]}),e.jsxs(be,{children:["Esta ação é permanente. ",c.length," pedidos serão excluídos permanentemente do sistema."]})]}),e.jsxs(ye,{children:[e.jsx(je,{children:"Cancelar"}),e.jsx(ve,{onClick:()=>p.mutate({orderIds:c,action:"delete"}),className:"bg-destructive hover:bg-destructive/90",disabled:g,children:g?"Excluindo...":"Excluir Permanentemente"})]})]})]}),e.jsxs("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(T,{variant:"outline",onClick:j,children:[e.jsx(ie,{className:"h-4 w-4 mr-2"})," Atualizar Dados"]})}),c.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-lg bg-card shadow-lg animate-fade-in",children:[e.jsx(Ne,{className:"h-5 w-5 text-primary mr-2"}),e.jsxs("span",{className:"text-sm font-medium mr-4",children:[c.length," selecionado(s)"]}),e.jsxs(Oe,{value:o,onValueChange:r=>x(r),children:[e.jsx(qe,{className:"w-[200px]",children:e.jsx(ze,{placeholder:"Ação em Massa"})}),e.jsx(Ge,{children:As.map(r=>e.jsx(Ve,{value:r.value,children:r.label},r.value))})]}),e.jsx(T,{onClick:w,disabled:!o||g,children:g?e.jsx(es,{className:"h-4 w-4 animate-spin"}):"Aplicar"})]})]}),s?e.jsxs(He,{defaultValue:"pending",children:[e.jsx(Ue,{className:"w-full overflow-x-auto justify-start",children:y.map(r=>e.jsx(Ke,{value:r.value,className:"whitespace-nowrap",children:r.label},r.value))}),y.map(r=>e.jsx(Qe,{value:r.value,className:"mt-6",children:e.jsx(Ts,{status:r.value,onViewDetails:d,restaurantId:s,selectedOrders:c,setSelectedOrders:u,totalOrdersInView:c.length,onPrint:N})},r.value))]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(I,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Carregando dados do restaurante..."})]})]})]}):e.jsx("div",{className:"flex h-screen items-center justify-center",children:"Carregando..."})};export{gt as default};
