import{c as S,b as y,j as e,d as Q,r as g,L as $}from"./index-zkuE9Bm6.js";import{u as z}from"./useQuery-Bop5DQT3.js";import{s as j}from"./client-g0uDe16g.js";import{C as _,c as V,d as G}from"./card-B1F0wEox.js";import{S as h}from"./skeleton-CBZEqJVS.js";import{A as W,T as H,a as K,b as J}from"./alert-B4s-E96m.js";import{o as I,n as U,s as X,u as q,t as D,c as Y}from"./types-BjVHfDxe.js";import{B as p}from"./button-3xZnEy7f.js";import{D as F,a as R,b as C,c as M,d as k,e as Z}from"./dialog-CNrbAfnQ.js";import{F as B,a as b,b as E,c as P,d as A,e as T}from"./form-gGgYvqwv.js";import{T as ee}from"./textarea-DhevHx2f.js";import{P as se}from"./plus-Ce2zFMKs.js";import{S as N}from"./shopping-cart-eMCEywpz.js";import{I as re}from"./label-CD9lqJez.js";import"./index-BRDkXO0b.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=S("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=S("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),ne=I({quantity:U().min(1,"Mínimo 1 item."),notes:X().max(255,"Máximo de 255 caracteres.").optional()}),ie=({product:s,isOpen:c,onClose:i})=>{const{addItem:l}=y(),r=q({resolver:D(ne),defaultValues:{quantity:1,notes:""},values:{quantity:1,notes:""}}),a=r.watch("quantity"),t=o=>{const f=a+o;f>=1&&r.setValue("quantity",f)},d=o=>{s&&(l({product_id:s.id,name:s.name,price:s.price,quantity:o.quantity,notes:o.notes||void 0,image_url:s.image_url}),i(),r.reset({quantity:1,notes:""}))};if(!s)return null;const m=s.price*a;return e.jsx(F,{open:c,onOpenChange:i,children:e.jsxs(R,{className:"sm:max-w-[425px] p-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.image_url||"/placeholder.svg",alt:s.name,className:"w-full h-48 object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent p-4 flex items-end",children:[e.jsx(C,{className:"text-2xl font-bold text-white drop-shadow-md",children:s.name}),e.jsxs(M,{className:"sr-only",children:["Detalhes e opções de personalização para ",s.name,"."]})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsx(B,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(d),className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-y py-3",children:[e.jsx(b,{className:"text-base font-semibold",children:"Quantidade"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{type:"button",variant:"outline",size:"icon",onClick:()=>t(-1),disabled:a<=1,children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-8 text-center font-bold text-lg",children:a}),e.jsx(p,{type:"button",variant:"outline",size:"icon",onClick:()=>t(1),children:e.jsx(se,{className:"h-4 w-4"})})]})]}),e.jsx(E,{control:r.control,name:"notes",render:({field:o})=>e.jsxs(P,{children:[e.jsx(b,{children:"Observações (Ex: Sem cebola)"}),e.jsx(A,{children:e.jsx(ee,{placeholder:"Adicione notas sobre o pedido...",...o,rows:2})}),e.jsx(T,{})]})}),e.jsxs(k,{className:Q("pt-4","sm:justify-between sm:space-x-0"),children:[e.jsxs("div",{className:"text-xl font-bold text-foreground hidden sm:block",children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(m)]}),e.jsxs(p,{type:"submit",className:"w-full sm:w-auto h-12 text-lg",disabled:r.formState.isSubmitting,children:[e.jsx(N,{className:"h-5 w-5 mr-2"}),"Adicionar ao Pedido"]})]})]})})]})]})})},le=I({weight_in_grams:Y.number({invalid_type_error:"Deve ser um número."}).positive("A quantidade deve ser maior que zero.")}),oe=({product:s,isOpen:c,onClose:i})=>{const{addItem:l}=y(),r=q({resolver:D(le),defaultValues:{weight_in_grams:500}}),a=r.watch("weight_in_grams"),t=g.useMemo(()=>!s||!a||a<=0?0:s.price/1e3*a,[s,a]),d=m=>{s&&(l({product_id:s.id,name:`${s.name} (${m.weight_in_grams}g)`,price:t,quantity:1,image_url:s.image_url,is_price_by_weight:!0}),i(),r.reset({weight_in_grams:500}))};return s?e.jsx(F,{open:c,onOpenChange:i,children:e.jsxs(R,{className:"sm:max-w-[425px]",children:[e.jsxs(Z,{className:"text-center",children:[e.jsx(C,{className:"text-2xl",children:"Quanto você deseja?"}),e.jsxs(M,{children:[e.jsx("p",{className:"text-lg font-semibold mt-2",children:s.name}),e.jsxs("p",{className:"text-muted-foreground",children:[new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.price)," por kg"]})]})]}),e.jsx(B,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(d),className:"space-y-6 pt-4",children:[e.jsx(E,{control:r.control,name:"weight_in_grams",render:({field:m})=>e.jsxs(P,{children:[e.jsx(b,{className:"text-base",children:"Quantidade em gramas"}),e.jsx(A,{children:e.jsx(re,{type:"number",placeholder:"Ex: 500",className:"h-12 text-lg text-center",...m})}),e.jsx(T,{})]})}),e.jsxs(k,{className:"flex-col-reverse sm:flex-row sm:justify-between sm:space-x-2 w-full",children:[e.jsxs("div",{className:"text-xl font-bold text-foreground text-center sm:text-left mb-4 sm:mb-0",children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)]}),e.jsxs(p,{type:"submit",className:"w-full sm:w-auto h-12 text-lg",disabled:r.formState.isSubmitting||!r.formState.isValid,children:[e.jsx(N,{className:"h-5 w-5 mr-2"}),"Adicionar"]})]})]})})]})}):null},ce=async()=>{const{data:s,error:c}=await j.from("restaurants").select("*").eq("is_active",!0).limit(1).single();if(c)throw new Error(`Erro ao buscar restaurante: ${c.message}`);if(!s)throw new Error("Nenhum restaurante ativo encontrado.");const i=s.id,[l,r]=await Promise.all([j.from("categories").select("*").eq("restaurant_id",i).eq("is_active",!0).order("display_order",{ascending:!0}),j.from("products").select("*").eq("restaurant_id",i).eq("is_available",!0)]);if(l.error)throw new Error(`Erro ao buscar categorias: ${l.error.message}`);if(r.error)throw new Error(`Erro ao buscar produtos: ${r.error.message}`);const a=(l.data||[]).map(t=>({...t,products:(r.data||[]).filter(d=>d.category_id===t.id)})).filter(t=>t.products.length>0);return{restaurant:s,menu:a}},Ie=()=>{const{data:s,isLoading:c,isError:i,error:l}=z({queryKey:["menuData"],queryFn:ce}),{totalItems:r,subtotal:a}=y(),[t,d]=g.useState(null),[m,o]=g.useState(!1),[f,w]=g.useState(!1),L=x=>{d(x),x.is_price_by_weight?w(!0):o(!0)};if(c)return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-5xl",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx(h,{className:"h-24 w-24 rounded-full mx-auto mb-4"}),e.jsx(h,{className:"h-10 w-1/2 mx-auto mb-2"}),e.jsx(h,{className:"h-6 w-3/4 mx-auto"})]}),e.jsx("div",{className:"space-y-10",children:[...Array(3)].map((x,n)=>e.jsxs("div",{children:[e.jsx(h,{className:"h-9 w-1/3 mb-6"}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(3)].map((me,O)=>e.jsx(_,{className:"p-4",children:e.jsx(h,{className:"h-48 w-full"})},O))})]},n))})]});if(i)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs(W,{variant:"destructive",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx(K,{children:"Erro ao carregar o cardápio"}),e.jsx(J,{children:l instanceof Error?l.message:"Ocorreu um erro desconhecido."})]})});const{restaurant:u,menu:v}=s;return e.jsxs(e.Fragment,{children:[e.jsx(ie,{product:t,isOpen:m,onClose:()=>o(!1)}),e.jsx(oe,{product:t,isOpen:f,onClose:()=>w(!1)}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-5xl mb-20",children:[e.jsxs("header",{className:"text-center mb-12",children:[u.logo_url&&e.jsx("img",{src:u.logo_url,alt:u.name,className:"w-24 h-24 mx-auto rounded-full mb-4 object-cover border-4 border-card shadow-lg"}),e.jsx("h1",{className:"text-4xl font-bold tracking-tight",children:u.name}),e.jsx("p",{className:"text-muted-foreground mt-2",children:u.description})]}),e.jsx("main",{children:v.length===0?e.jsx("div",{className:"text-center py-16",children:e.jsx("p",{className:"text-muted-foreground text-lg",children:"Nenhum item no cardápio no momento."})}):e.jsx("div",{className:"space-y-10",children:v.map(x=>e.jsxs("section",{children:[e.jsx("h2",{className:"text-3xl font-bold border-b-2 border-primary pb-2 mb-6",children:x.name}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.products.map(n=>e.jsxs(_,{className:"overflow-hidden group hover:shadow-xl transition-shadow duration-300 flex flex-col cursor-pointer",onClick:()=>L(n),children:[e.jsx("img",{src:n.image_url||"/placeholder.svg",alt:n.name,className:"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"}),e.jsxs("div",{className:"p-4 flex flex-col flex-grow",children:[e.jsx(V,{className:"text-xl mb-1",children:n.name}),e.jsx(G,{className:"text-sm mb-3 flex-grow",children:n.description}),e.jsx("p",{className:"text-lg font-bold text-primary text-right mt-2",children:n.is_price_by_weight?`${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n.price)} / kg`:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n.price)})]})]},n.id))})]},x.id))})})]}),r>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 p-4 bg-card shadow-2xl border-t",children:e.jsx($,{to:"/checkout",children:e.jsxs(p,{className:"w-full h-14 text-lg font-bold flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5"}),r," ",r===1?"Item":"Itens"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a),e.jsx(ae,{className:"h-5 w-5 ml-2"})]})]})})})]})};export{Ie as default};
