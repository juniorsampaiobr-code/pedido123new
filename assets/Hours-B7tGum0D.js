import{j as e,b as F,u as $,c as T}from"./tanstack-DXzASLyu.js";import{o as S,s as x,n as q,b as D,a as M,u as A,d as I,t as Q}from"./types-CUwlEUMq.js";import{s as g}from"./client-lAKPhnc8.js";import{B}from"./button-BxQvs-kK.js";import{C as R,b as K,c as L,a as O}from"./card-ADX1xhjW.js";import{S as P}from"./switch-tvwGrofy.js";import{b as W,u as k}from"./index-CMiS2o-F.js";import{F as Y,b,c as y,d as j,a as w,e as C}from"./form-Bk-97d-3.js";import{R as z,f as G,r as J}from"./vendor-YgypLURK.js";import{I as U}from"./label-Dw_GSlgs.js";import{C as V}from"./clock-C1on4qoY.js";import{S as d}from"./skeleton-CdJp0rkt.js";import{S as X}from"./separator-Clsguzeh.js";import"./supabase-Bm28tI2t.js";import"./index-CUvv1sQ9.js";const v=z.forwardRef(({className:r,value:i,onChange:l,...f},p)=>e.jsxs("div",{className:W("relative w-32",r),children:[e.jsx(U,{ref:p,type:"time",value:i,onChange:l,className:"w-full pr-8 text-center font-medium",...f}),e.jsx(V,{className:"absolute right-2 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none"})]}));v.displayName="TimeInput";const u=[{day_of_week:0,label:"Domingo"},{day_of_week:1,label:"Segunda-feira"},{day_of_week:2,label:"Terça-feira"},{day_of_week:3,label:"Quarta-feira"},{day_of_week:4,label:"Quinta-feira"},{day_of_week:5,label:"Sexta-feira"},{day_of_week:6,label:"Sábado"}],Z=S({id:x().optional(),day_of_week:q().min(0).max(6),is_open:D().default(!0),open_time:x().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Formato de hora inválido (HH:MM)").optional().nullable(),close_time:x().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Formato de hora inválido (HH:MM)").optional().nullable()}),ee=S({hours:M(Z).refine(r=>r.every(i=>!i.is_open||i.open_time&&i.close_time),{message:"Horário de abertura e fechamento são obrigatórios para dias abertos.",path:["hours"]})}),se=async r=>{const{data:i,error:l}=await g.from("business_hours").select("*").eq("restaurant_id",r).order("day_of_week",{ascending:!0});if(l)throw new Error(`Erro ao buscar horários: ${l.message}`);return i},xe=()=>{const{restaurant:r}=G(),i=F(),{data:l,isLoading:f,isError:p,error:h}=$({queryKey:["businessHours",r.id],queryFn:()=>se(r.id),enabled:!!r.id}),a=A({resolver:Q(ee),mode:"onBlur"}),{fields:N}=I({control:a.control,name:"hours"});J.useEffect(()=>{if(l){const o=[...l.length>0?l:u.map(t=>({id:void 0,day_of_week:t.day_of_week,is_open:!0,open_time:"09:00",close_time:"18:00"}))].sort((t,s)=>t.day_of_week-s.day_of_week),m=u.map(t=>{const s=o.find(c=>c.day_of_week===t.day_of_week);return{id:s==null?void 0:s.id,day_of_week:t.day_of_week,is_open:(s==null?void 0:s.is_open)??!0,open_time:s!=null&&s.open_time?s.open_time.substring(0,5):"09:00",close_time:s!=null&&s.close_time?s.close_time.substring(0,5):"18:00"}});a.reset({hours:m})}},[l,a.reset]);const _=T({mutationFn:async n=>{if(!r.id)throw new Error("ID do restaurante não disponível.");const{error:o}=await g.from("business_hours").delete().eq("restaurant_id",r.id);if(o)throw new Error(`Erro ao limpar horários antigos: ${o.message}`);const m=n.hours.map(s=>({restaurant_id:r.id,day_of_week:s.day_of_week,is_open:s.is_open,open_time:s.is_open?s.open_time:null,close_time:s.is_open?s.close_time:null})),{error:t}=await g.from("business_hours").insert(m);if(t)throw new Error(`Erro ao inserir novos horários: ${t.message}`)},onSuccess:()=>{k.success("Horários de funcionamento salvos com sucesso!"),i.invalidateQueries({queryKey:["businessHours"]})},onError:n=>{k.error(`Erro ao salvar horários: ${n.message}`)}}),E=n=>{_.mutate(n)},H=f||N.length===0;return e.jsx("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:e.jsxs(R,{className:"max-w-3xl mx-auto",children:[e.jsxs(K,{children:[e.jsx(L,{className:"text-2xl font-bold",children:"Horário de Funcionamento"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure os horários de abertura e fechamento para cada dia da semana"})]}),e.jsx(O,{children:H?e.jsxs("div",{className:"space-y-4",children:[[...Array(7)].map((n,o)=>e.jsxs("div",{className:"flex items-center justify-between py-3 border-b last:border-b-0",children:[e.jsx(d,{className:"h-5 w-24"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{className:"h-8 w-12"}),e.jsx(d,{className:"h-10 w-32"}),e.jsx(d,{className:"h-10 w-32"})]})]},o)),e.jsx(d,{className:"h-12 w-full mt-6"})]}):p?e.jsxs("div",{className:"text-destructive",children:["Erro ao carregar horários: ",(h==null?void 0:h.message)||"Erro desconhecido"]}):e.jsx(Y,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(E),className:"space-y-6",children:[N.map((n,o)=>{const m=u.find(s=>s.day_of_week===n.day_of_week),t=!a.watch(`hours.${o}.is_open`);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("div",{className:"w-32 font-medium flex-shrink-0",children:m==null?void 0:m.label}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(b,{control:a.control,name:`hours.${o}.is_open`,render:({field:s})=>e.jsxs(y,{className:"flex items-center space-x-2",children:[e.jsx(j,{children:e.jsx(P,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx(w,{className:"text-sm font-normal w-16 text-left",children:s.value?"Aberto":"Fechado"})]})}),e.jsxs("div",{className:t?"opacity-50 pointer-events-none flex gap-4":"flex gap-4",children:[e.jsx(b,{control:a.control,name:`hours.${o}.open_time`,render:({field:s})=>e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"text-sm",children:"Abre:"}),e.jsx(j,{children:e.jsx(v,{...s,value:s.value||"",onChange:c=>s.onChange(c.target.value)})}),e.jsx(C,{})]})}),e.jsx(b,{control:a.control,name:`hours.${o}.close_time`,render:({field:s})=>e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"text-sm",children:"Fecha:"}),e.jsx(j,{children:e.jsx(v,{...s,value:s.value||"",onChange:c=>s.onChange(c.target.value)})}),e.jsx(C,{})]})})]})]})]}),o<u.length-1&&e.jsx(X,{})]},n.id)}),e.jsx(B,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground h-12 text-lg mt-6",disabled:_.isPending,children:_.isPending?"Salvando...":"Salvar Horários"}),a.formState.errors.hours&&e.jsx("p",{className:"text-destructive text-sm mt-2",children:a.formState.errors.hours.message})]})})})]})})};export{xe as default};
