import{b as _,u as O,c as D,j as e}from"./tanstack-DS1wz2fm.js";import{r as f,f as W}from"./vendor-DPb28zz8.js";import{s as C}from"./client-BP8r4skJ.js";import{B as g,b as Y}from"./button-6GY0ME8k.js";import{C as L,a as z,b as ee,c as se}from"./card-Bdt_oCcm.js";import{S as ae,a as te,b as re,c as ne,d as le,T as ie,e as oe,f as ce,g as de,C as N}from"./select-Dwy3uH4w.js";import{D as me,a as ue,b as xe,c as he,d as pe,e as ge,B as je}from"./index-CT0XEryq.js";import{S}from"./skeleton-CWqZ-kZJ.js";import{A as fe,a as ve,b as ye}from"./alert-DY6Vd4mA.js";import{c as E,u as y,b as p,X as F}from"./index-COSunLaq.js";import{S as A}from"./separator-DPfQJox0.js";import{P as be}from"./printer-crW50-_h.js";import{u as Ne,A as we,a as Ce,b as Pe,c as Se,d as Ee,e as Ae,f as De,g as Te,h as ke}from"./DashboardLayout-CpeqAjj8.js";import{T as _e}from"./terminal-BGbWTRWV.js";import{S as I}from"./shopping-cart-DfWL1GEc.js";import{T as qe}from"./trash-2-DFLRVpJi.js";import{D as Re}from"./dollar-sign-CKayfDV_.js";import"./supabase-BT-vd-uw.js";import"./index-C-zR_1pX.js";import"./index-Dm27xrF8.js";import"./index-CECDHB4X.js";import"./index-CJmVBZLB.js";import"./Logo-Dv6gEEYG.js";import"./package-DcqRugYs.js";import"./clock-CdrVdXmb.js";import"./credit-card-CV0EWO0T.js";import"./truck-CCKK4Bqj.js";import"./settings-BirM6n5Y.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=E("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=E("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=E("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=E("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),M={pending:{label:"Pendente"},confirmed:{label:"Confirmado"},preparing:{label:"Em Preparação"},ready:{label:"Pronto"},delivering:{label:"Em Entrega"},delivered:{label:"Entregue"},cancelled:{label:"Cancelado"},pending_payment:{label:"Aguardando Pagamento"}},ze=async s=>{const{data:a,error:t}=await C.from("order_items").select("*, products(name)").eq("order_id",s);if(t)throw new Error(t.message);return a},Fe=({order:s,isOpen:a,onClose:t})=>{var P,b;const m=_(),[l,r]=f.useState("pending");f.useEffect(()=>{s!=null&&s.status&&r(s.status)},[s]);const{data:u,isLoading:i}=O({queryKey:["orderItems",s==null?void 0:s.id],queryFn:()=>ze(s.id),enabled:!!s&&a}),d=D({mutationFn:async c=>{if(!s)throw new Error("Pedido não encontrado.");const{error:h}=await C.from("orders").update({status:c}).eq("id",s.id);if(h)throw new Error(h.message)},onSuccess:(c,h)=>{y.success(`Status do pedido atualizado para "${M[h].label}"`),m.invalidateQueries({queryKey:["orders"]}),t()},onError:c=>{y.error(`Erro ao atualizar status: ${c.message}`)}}),x=()=>{window.print()};if(!s)return null;const o=s.created_at?new Date(s.created_at).getTime().toString().slice(-4):"N/A";return e.jsx(me,{open:a,onOpenChange:t,children:e.jsxs(ue,{className:"sm:max-w-lg",children:[e.jsxs(xe,{children:[e.jsxs(he,{children:["Detalhes do Pedido #",o]}),e.jsx(pe,{children:"Gerencie os detalhes e o status deste pedido."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold",children:"Cliente"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nome: ",((P=s.customer)==null?void 0:P.name)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Telefone: ",((b=s.customer)==null?void 0:b.phone)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Endereço: ",s.delivery_address||"N/A"]})]}),e.jsx(A,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Itens do Pedido"}),i?e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{className:"h-8 w-full"}),e.jsx(S,{className:"h-8 w-full"})]}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto pr-2",children:u==null?void 0:u.map(c=>{var h;return e.jsxs("div",{className:"flex justify-between items-start text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[c.quantity,"x ",((h=c.products)==null?void 0:h.name)||"Produto desconhecido"]}),c.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground italic",children:["Obs: ",c.notes]})]}),e.jsx("span",{className:"text-muted-foreground",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c.subtotal)})]},c.id)})})]}),e.jsx(A,{}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsx("span",{className:"font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.delivery_fee||0)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-base",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]})]}),e.jsx(A,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Atualizar Status"}),e.jsxs(ae,{value:l,onValueChange:c=>r(c),children:[e.jsx(te,{children:e.jsx(re,{placeholder:"Selecione um status"})}),e.jsx(ne,{children:Object.entries(M).map(([c,{label:h}])=>e.jsx(le,{value:c,children:h},c))})]})]})]}),e.jsxs(ge,{className:"flex-col sm:flex-row sm:justify-between sm:space-x-2",children:[e.jsxs(g,{variant:"outline",onClick:x,className:"w-full sm:w-auto mb-2 sm:mb-0",children:[e.jsx(be,{className:"h-4 w-4 mr-2"})," Imprimir Pedido"]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(g,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(g,{onClick:()=>d.mutate(l),disabled:d.isPending||l===s.status,children:d.isPending?"Salvando...":"Salvar Alterações"})]})]})]})})},V=({className:s,...a})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:p("mx-auto flex w-full justify-center",s),...a});V.displayName="Pagination";const $=f.forwardRef(({className:s,...a},t)=>e.jsx("ul",{ref:t,className:p("flex flex-row items-center gap-1",s),...a}));$.displayName="PaginationContent";const j=f.forwardRef(({className:s,...a},t)=>e.jsx("li",{ref:t,className:p("",s),...a}));j.displayName="PaginationItem";const w=({className:s,isActive:a,size:t="icon",...m})=>e.jsx("a",{"aria-current":a?"page":void 0,className:p(Y({variant:a?"outline":"ghost",size:t}),s),...m});w.displayName="PaginationLink";const K=({className:s,...a})=>e.jsxs(w,{"aria-label":"Go to previous page",size:"default",className:p("gap-1 pl-2.5",s),...a,children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});K.displayName="PaginationPrevious";const Q=({className:s,...a})=>e.jsxs(w,{"aria-label":"Go to next page",size:"default",className:p("gap-1 pr-2.5",s),...a,children:[e.jsx("span",{children:"Next"}),e.jsx(Oe,{className:"h-4 w-4"})]});Q.displayName="PaginationNext";const T=({className:s,...a})=>e.jsxs("span",{"aria-hidden":!0,className:p("flex h-9 w-9 items-center justify-center",s),...a,children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]});T.displayName="PaginationEllipsis";const Ie=({currentPage:s,totalPages:a,onPageChange:t})=>{if(a<=1)return null;const l=(()=>{const r=[],i=Math.max(1,s-Math.floor(2.5)),d=Math.min(a,i+5-1);if(d-i+1<5){const x=Math.max(1,d-5+1);for(let o=x;o<=d;o++)r.push(o)}else for(let x=i;x<=d;x++)r.push(x);return r})();return e.jsx(V,{children:e.jsxs($,{children:[e.jsx(j,{children:e.jsx(K,{onClick:()=>t(s-1),className:p(s===1&&"pointer-events-none opacity-50")})}),l[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx(j,{children:e.jsx(w,{onClick:()=>t(1),children:"1"})}),l[0]>2&&e.jsx(j,{children:e.jsx(T,{})})]}),l.map(r=>e.jsx(j,{children:e.jsx(w,{isActive:r===s,onClick:()=>t(r),children:r})},r)),l[l.length-1]<a&&e.jsxs(e.Fragment,{children:[l[l.length-1]<a-1&&e.jsx(j,{children:e.jsx(T,{})}),e.jsx(j,{children:e.jsx(w,{onClick:()=>t(a),children:a})})]}),e.jsx(j,{children:e.jsx(Q,{onClick:()=>t(s+1),className:p(s===a&&"pointer-events-none opacity-50")})})]})})},Be={pending:{label:"Pendente",icon:I,color:"bg-yellow-500 hover:bg-yellow-600"},confirmed:{label:"Confirmado",icon:N,color:"bg-blue-500 hover:bg-blue-600"},preparing:{label:"Em Preparação",icon:N,color:"bg-orange-500 hover:bg-orange-600"},ready:{label:"Pronto",icon:N,color:"bg-green-500 hover:bg-green-600"},delivering:{label:"Em Entrega",icon:N,color:"bg-indigo-500 hover:bg-indigo-600"},delivered:{label:"Entregue",icon:N,color:"bg-primary hover:bg-primary/90"},cancelled:{label:"Cancelado",icon:F,color:"bg-destructive hover:bg-destructive/90"},pending_payment:{label:"Aguardando Pag.",icon:Re,color:"bg-gray-500 hover:bg-gray-600"}},k=12,Ve=async(s,a,t)=>{const m=t*k,l=m+k-1;let r=C.from("orders").select("*, customer:customers(name, phone)",{count:"exact"}).eq("restaurant_id",s);a!=="all"&&(r=r.eq("status",a));const{data:u,error:i,count:d}=await r.order("created_at",{ascending:!1}).range(m,l);if(i)throw new Error(`Erro ao buscar pedidos: ${i.message}`);return{orders:u,count:d||0}},$e=({order:s,onViewDetails:a,onAccept:t,onDecline:m,onDelete:l})=>{var d;const r=Be[s.status||"pending"],u=((d=s.customer)==null?void 0:d.name)||"Cliente Desconhecido",i=s.created_at?new Date(s.created_at).getTime().toString().slice(-4):"N/A";return e.jsxs(L,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col",children:[e.jsxs(ee,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs(se,{className:"text-lg font-bold flex items-center gap-2",children:["Pedido #",i]}),e.jsxs(je,{className:p("text-white",r.color),children:[e.jsx(r.icon,{className:"h-3 w-3 mr-1"}),r.label]})]}),e.jsxs(z,{className:"space-y-2 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",u]}),e.jsx("p",{className:"text-2xl font-extrabold text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]}),e.jsxs("div",{className:"flex justify-end pt-2 border-t gap-2",children:[(s.status==="pending"||s.status==="pending_payment")&&e.jsxs(e.Fragment,{children:[e.jsxs(g,{variant:"destructive",size:"sm",onClick:()=>m(s.id),children:[e.jsx(F,{className:"h-4 w-4 mr-1"})," Recusar"]}),e.jsxs(g,{variant:"default",size:"sm",onClick:()=>t(s.id),children:[e.jsx(N,{className:"h-4 w-4 mr-1"})," Aceitar"]})]}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>a(s),children:"Detalhes"}),e.jsxs(we,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",children:e.jsx(qe,{className:"h-4 w-4"})})}),e.jsxs(Pe,{children:[e.jsxs(Se,{children:[e.jsx(Ee,{children:"Tem certeza que deseja excluir?"}),e.jsxs(Ae,{children:["Esta ação é permanente. O pedido #",i," será excluído permanentemente do sistema, incluindo todos os itens associados."]})]}),e.jsxs(De,{children:[e.jsx(Te,{children:"Cancelar"}),e.jsx(ke,{onClick:()=>l(s.id),className:"bg-destructive hover:bg-destructive/90",children:"Excluir Permanentemente"})]})]})]})]})]})]})},Ke=({status:s,onViewDetails:a,restaurantId:t})=>{const m=_(),{stopSoundLoop:l}=Ne(),[r,u]=f.useState(0),{data:i,isLoading:d,isError:x,error:o,refetch:P}=O({queryKey:["orders",s,t,r],queryFn:()=>Ve(t,s,r),enabled:!!t}),b=(i==null?void 0:i.orders)||[],c=(i==null?void 0:i.count)||0,h=Math.ceil(c/k),q=D({mutationFn:async({orderId:n,newStatus:v})=>{const{error:R}=await C.from("orders").update({status:v}).eq("id",n);if(R)throw new Error(R.message);return v},onSuccess:n=>{y.success(`Pedido ${n==="confirmed"?"aceito":"recusado"} com sucesso!`),m.invalidateQueries({queryKey:["orders"]})},onError:n=>y.error(`Erro ao atualizar pedido: ${n.message}`)}),G=D({mutationFn:async n=>{const{error:v}=await C.from("orders").delete().eq("id",n);if(v)throw new Error(v.message)},onSuccess:()=>{y.success("Pedido excluído permanentemente."),m.invalidateQueries({queryKey:["orders"]})},onError:n=>y.error(`Erro ao excluir pedido: ${n.message}`)}),H=n=>{l(),q.mutate({orderId:n,newStatus:"confirmed"})},U=n=>{l(),q.mutate({orderId:n,newStatus:"cancelled"})},X=n=>{l(),a(n)},Z=n=>{G.mutate(n)},J=f.useCallback(n=>{u(n-1)},[]);return d?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((n,v)=>e.jsx(L,{children:e.jsx(z,{className:"p-4 space-y-3",children:e.jsx(S,{className:"h-32 w-full"})})},v))}):x?e.jsxs(fe,{variant:"destructive",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx(ve,{children:"Erro ao carregar pedidos"}),e.jsx(ye,{children:o instanceof Error?o.message:"Ocorreu um erro desconhecido."}),e.jsxs(g,{onClick:()=>P(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(B,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]}):!b||b.length===0?e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg border",children:[e.jsx(I,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifique o status selecionado ou aguarde novos pedidos."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:b.map(n=>e.jsx($e,{order:n,onViewDetails:X,onAccept:H,onDecline:U,onDelete:Z},n.id))}),h>1&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(Ie,{currentPage:r+1,totalPages:h,onPageChange:J})})]})},vs=()=>{const{restaurant:s}=W(),a=_(),[t,m]=f.useState(null),[l,r]=f.useState(!1),u=o=>{m(o),r(!0)},i=()=>{r(!1),m(null)},d=()=>{a.invalidateQueries({queryKey:["orders"]}),y.info("Atualizando pedidos...",{description:"Buscando novos dados no servidor."})},x=[{value:"pending_payment",label:"Aguardando Pag."},{value:"pending",label:"Pendentes"},{value:"confirmed",label:"Confirmados"},{value:"preparing",label:"Em Preparação"},{value:"ready",label:"Prontos"},{value:"delivering",label:"Em Entrega"},{value:"delivered",label:"Entregues"},{value:"cancelled",label:"Cancelados"},{value:"all",label:"Todos"}];return e.jsxs(e.Fragment,{children:[e.jsx(Fe,{order:t,isOpen:l,onClose:i}),e.jsxs("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(g,{variant:"outline",onClick:d,children:[e.jsx(B,{className:"h-4 w-4 mr-2"})," Atualizar Pedidos"]})}),s!=null&&s.id?e.jsxs(ie,{defaultValue:"pending_payment",children:[e.jsx(oe,{className:"w-full overflow-x-auto justify-start",children:x.map(o=>e.jsx(ce,{value:o.value,className:"whitespace-nowrap",children:o.label},o.value))}),x.map(o=>e.jsx(de,{value:o.value,className:"mt-6",children:e.jsx(Ke,{status:o.value,onViewDetails:u,restaurantId:s.id})},o.value))]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Carregando dados do restaurante..."})]})]})]})};export{vs as default};
