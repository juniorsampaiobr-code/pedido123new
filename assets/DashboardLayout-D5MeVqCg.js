import{j as e,b as z,u as H}from"./tanstack-DS1wz2fm.js";import{k as D,L as F,r,u as Q,O as U}from"./vendor-DPb28zz8.js";import{s as f}from"./client-BP8r4skJ.js";import{L as $}from"./Logo-xQTS0caG.js";import{c as x,b as G,u as d,v as K,T,d as L,e as P,L as B}from"./index-p3p5sqlo.js";import{P as W}from"./package-CQxFB7bd.js";import{S as q}from"./shopping-cart-DRJDPt_a.js";import{C as X}from"./clock-4vlHAycE.js";import{C as J}from"./credit-card-BkbqP-9A.js";import{T as Y}from"./truck-DNso2mf_.js";import{S as Z}from"./settings-BTfrvu_V.js";import{B as C}from"./button-BwjQ7RYn.js";import{A as ee,b as oe,c as ae,d as re,e as te,f as se,h as ne}from"./alert-dialog-Dd631lV2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=x("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=x("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=x("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=x("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=x("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),ue=[{href:"/dashboard",label:"Dashboard",icon:le},{href:"/products",label:"Produtos",icon:W},{href:"/orders",label:"Pedidos",icon:q},{href:"/cashier",label:"Caixa",icon:ce},{href:"/hours",label:"Hor√°rios",icon:X},{href:"/payments",label:"Pagamentos",icon:J},{href:"/delivery",label:"Taxa de Entrega",icon:Y},{href:"/settings",label:"Configura√ß√µes",icon:Z}],me=()=>{const n=D();return e.jsxs("aside",{className:"w-64 flex-shrink-0 border-r bg-card h-screen sticky top-0 flex-col hidden lg:flex",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx($,{})}),e.jsx("nav",{className:"flex-grow p-4",children:e.jsx("ul",{children:ue.map(c=>e.jsx("li",{children:e.jsxs(F,{to:c.href,className:G("flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors",n.pathname===c.href?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted hover:text-foreground"),children:[e.jsx(c.icon,{className:"h-4 w-4"}),c.label]})},c.href))})})]})},he=({isOpen:n,onEnable:c})=>e.jsx(ee,{open:n,children:e.jsxs(oe,{children:[e.jsxs(ae,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-6 w-6 text-primary"}),"Ativar Notifica√ß√µes Sonoras?"]}),e.jsxs(te,{children:["Para garantir que voc√™ n√£o perca nenhum novo pedido, precisamos da sua permiss√£o para tocar um som de notifica√ß√£o.",e.jsx("br",{}),e.jsx("br",{}),'Ao clicar em "Ativar", um som de teste ser√° reproduzido.']})]}),e.jsx(se,{children:e.jsx(ne,{onClick:c,className:"w-full",children:"Sim, ativar som"})})]})}),k=r.createContext(null),fe=()=>{const n=r.useContext(k);if(!n)throw new Error("useSound must be used within a DashboardLayout");return n},pe=n=>{const c=ge.find(p=>p.href===n);return c?c.label:"Dashboard"},ge=[{href:"/dashboard",label:"Dashboard"},{href:"/products",label:"Produtos"},{href:"/orders",label:"Pedidos"},{href:"/cashier",label:"Caixa"},{href:"/hours",label:"Hor√°rios"},{href:"/payments",label:"Pagamentos"},{href:"/delivery",label:"Taxa de Entrega"},{href:"/settings",label:"Configura√ß√µes"}],xe=()=>{const n=Q(),c=D(),p=z(),[w,N]=r.useState(null),a=r.useRef(null),[t,b]=r.useState("loading"),[I,A]=r.useState(!1),[g,S]=r.useState(null),[i,m]=r.useState(()=>localStorage.getItem("soundNotificationStatus")||"disabled");r.useEffect(()=>{localStorage.setItem("soundNotificationStatus",i)},[i]);const{data:u,isLoading:M}=H({queryKey:["dashboardRestaurant"],queryFn:async()=>{const{data:o,error:l}=await f.from("restaurants").select("*").limit(1).single();if(l)throw new Error(l.message);return o},enabled:!!w,staleTime:1/0});r.useEffect(()=>{var o;u!=null&&u.notification_sound_url?((o=a.current)==null?void 0:o.src)!==u.notification_sound_url&&b("loading"):b("error")},[u==null?void 0:u.notification_sound_url]),r.useEffect(()=>{!localStorage.getItem("hasSeenSoundPermissionModal")&&i!=="enabled"&&t==="ready"&&A(!0)},[i,t]),r.useEffect(()=>{(async()=>{const{data:{session:s}}=await f.auth.getSession();s!=null&&s.user?N(s.user):n("/auth")})();const{data:{subscription:l}}=f.auth.onAuthStateChange((s,v)=>{s==="SIGNED_OUT"?n("/"):v!=null&&v.user?N(v.user):n("/auth")});return()=>l.unsubscribe()},[n]);const h=r.useCallback(()=>{a.current&&(a.current.pause(),a.current.loop=!1,S(null))},[]),E=r.useCallback(o=>{if(i==="enabled"&&a.current&&t==="ready"){if(g)return;S(o),a.current.loop=!0,a.current.play().catch(l=>{console.error("Erro na reprodu√ß√£o autom√°tica de √°udio:",l),S(null),d.warning("N√£o foi poss√≠vel tocar o som automaticamente.",{description:"Interaja com a p√°gina para permitir a reprodu√ß√£o de som."})})}},[i,t,g]);r.useEffect(()=>{const o=f.channel("new-orders-toast").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders"},l=>{p.invalidateQueries({queryKey:["orders"]});const s=l.new;s.status==="pending"&&s.id&&(d.info("üîî Novo pedido recebido!",{description:`Pedido #${s.id.slice(-4)} est√° aguardando confirma√ß√£o.`,duration:15e3}),E(s.id))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders"},l=>{p.invalidateQueries({queryKey:["orders"]});const s=l.new;s.id===g&&h(),s.status==="pending"&&s.id&&l.old.status==="pending_payment"&&d.success("‚úÖ Pagamento Confirmado!",{description:`Pedido #${s.id.slice(-4)} foi pago e est√° pronto para preparo.`,duration:5e3})}).subscribe();return()=>{f.removeChannel(o)}},[p,E,h,g]);const j=r.useCallback(()=>{if(i==="enabled"&&a.current&&t==="ready"){h(),a.current.loop=!1,a.current.currentTime=0;const o=a.current.play();o!==void 0&&o.then(()=>{console.log("Som de teste tocado com sucesso")}).catch(l=>{console.error("Erro ao tocar som de teste:",l),d.error("N√£o foi poss√≠vel tocar o som de teste.",{description:"Seu navegador pode ter bloqueado a reprodu√ß√£o. Interaja com a p√°gina e tente novamente."})})}else t==="ready"?(m("enabled"),setTimeout(()=>j(),100)):(d.error("Som de notifica√ß√£o n√£o est√° pronto ou configurado.",{description:"Verifique se a URL do som est√° correta nas Configura√ß√µes."}),m("error"))},[i,t,h]),O=async()=>{if(t!=="ready"||!a.current){d.error("O arquivo de som ainda n√£o est√° pronto. Tente novamente em um momento.");return}try{a.current.currentTime=0,await a.current.play(),m("enabled"),d.success("Notifica√ß√µes sonoras ativadas!"),localStorage.setItem("hasSeenSoundPermissionModal","true")}catch(o){console.error("Audio activation failed from modal:",o),d.error("Falha ao ativar o som.",{description:"Seu navegador pode ter bloqueado a reprodu√ß√£o. Por favor, tente ativar manualmente no √≠cone do cabe√ßalho."}),m("error")}finally{A(!1)}},R=async()=>{if(i==="enabled"){h(),m("disabled"),d.info("Notifica√ß√µes sonoras desativadas.");return}if(t!=="ready"||!a.current){d.error("Som de notifica√ß√£o n√£o est√° pronto ou configurado."),m("error");return}try{a.current.currentTime=0,await a.current.play(),m("enabled"),d.success("Notifica√ß√µes sonoras ativadas!",{description:"Voc√™ ouviu o som de teste."})}catch(o){console.error("Audio activation failed:",o),d.error("Falha ao ativar o som.",{description:"Seu navegador pode ter bloqueado. Clique na p√°gina e tente novamente."}),m("error")}},V=async()=>{await f.auth.signOut()};if(!w||M)return e.jsx(K,{});const y=t!=="ready";return e.jsxs(k.Provider,{value:{playSound:j,stopSoundLoop:h,soundStatus:i,loopingOrderId:g},children:[e.jsx(he,{isOpen:I,onEnable:O}),e.jsxs("div",{className:"flex min-h-screen bg-muted/40",children:[e.jsx(me,{}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"border-b bg-background sticky top-0 z-40",children:e.jsxs("div",{className:"container max-w-none mx-auto px-8 h-16 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(q,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-xl font-semibold",children:pe(c.pathname)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(T,{children:[e.jsx(L,{asChild:!0,children:e.jsx(C,{variant:"outline",size:"sm",onClick:j,disabled:y,children:"Testar Som"})}),y&&e.jsx(P,{children:t==="loading"?"Carregando som...":"Som n√£o dispon√≠vel"})]}),e.jsxs(T,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(C,{variant:"outline",size:"icon",onClick:R,disabled:y,"aria-label":i==="enabled"?"Desativar som":"Ativar som",children:[t==="loading"&&e.jsx(B,{className:"h-4 w-4 animate-spin"}),t==="ready"&&i==="enabled"&&e.jsx(_,{className:"h-4 w-4 text-green-500"}),t==="ready"&&i==="disabled"&&e.jsx(de,{className:"h-4 w-4"}),t==="error"&&e.jsx(ie,{className:"h-4 w-4 text-destructive"})]})}),y&&e.jsx(P,{children:t==="loading"?"Carregando som...":"Som n√£o dispon√≠vel"})]}),e.jsx(C,{variant:"outline",onClick:V,children:"Sair"})]})]})}),e.jsx(U,{context:{restaurant:u}})]}),(u==null?void 0:u.notification_sound_url)&&e.jsx("audio",{ref:a,src:u.notification_sound_url,onCanPlayThrough:()=>{b("ready"),console.log("√Åudio carregado e pronto para tocar.")},onError:o=>{console.error("Erro ao carregar o √°udio:",o),d.error("Erro ao carregar o som de notifica√ß√£o.",{description:"Verifique o arquivo em Configura√ß√µes."}),b("error"),m("error")},className:"hidden"})]})]})},be=r.memo(xe),De=Object.freeze(Object.defineProperty({__proto__:null,SoundContext:k,default:be,useSound:fe},Symbol.toStringTag,{value:"Module"}));export{De as D,_ as V,fe as u};
