import{c as N,Q as M,j as e,L as xe,d as m,f as ye,r as t,o as I,i as ve,T as be,u as Ne,e as je,a as p,U as _,W as R,Y as O,x as Ae,Z as Se}from"./index-zkuE9Bm6.js";import{u as De}from"./useQuery-Bop5DQT3.js";import{s as v}from"./client-g0uDe16g.js";import{L as Ce}from"./Logo-Dpd43AUV.js";import{P as we}from"./package-BjiMSLe_.js";import{S as L}from"./shopping-cart-eMCEywpz.js";import{C as Ee}from"./clock-8B-vU318.js";import{C as ke}from"./credit-card-CwfrA48D.js";import{T as Pe}from"./truck-Dx6yc9rA.js";import{S as Te}from"./settings-CtP3JrMo.js";import{b as q,B as P}from"./button-3xZnEy7f.js";import{c as $,d as _e,O as Re,W as Oe,C as Me,T as Ie,D as Le,a as z,P as qe,b as $e}from"./index-BRDkXO0b.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=N("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=N("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=N("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=N("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=N("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),Ge=[{href:"/dashboard",label:"Dashboard",icon:Fe},{href:"/products",label:"Produtos",icon:we},{href:"/orders",label:"Pedidos",icon:L},{href:"/cashier",label:"Caixa",icon:He},{href:"/hours",label:"Hor√°rios",icon:Ee},{href:"/payments",label:"Pagamentos",icon:ke},{href:"/delivery",label:"Taxa de Entrega",icon:Pe},{href:"/settings",label:"Configura√ß√µes",icon:Te}],We=()=>{const a=M();return e.jsxs("aside",{className:"w-64 flex-shrink-0 border-r bg-card h-screen sticky top-0 flex-col hidden lg:flex",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx(Ce,{})}),e.jsx("nav",{className:"flex-grow p-4",children:e.jsx("ul",{children:Ge.map(o=>e.jsx("li",{children:e.jsxs(xe,{to:o.href,className:m("flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors",a.pathname===o.href?"bg-primary/10 text-primary":"text-muted-foreground hover:bg-muted hover:text-foreground"),children:[e.jsx(o.icon,{className:"h-4 w-4"}),o.label]})},o.href))})})]})};var V="AlertDialog",[Qe,ja]=ye(V,[$]),f=$(),H=a=>{const{__scopeAlertDialog:o,...r}=a,s=f(o);return e.jsx($e,{...s,...r,modal:!0})};H.displayName=V;var Be="AlertDialogTrigger",Ue=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,l=f(r);return e.jsx(_e,{...l,...s,ref:o})});Ue.displayName=Be;var Ye="AlertDialogPortal",G=a=>{const{__scopeAlertDialog:o,...r}=a,s=f(o);return e.jsx(qe,{...s,...r})};G.displayName=Ye;var Ke="AlertDialogOverlay",W=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,l=f(r);return e.jsx(Re,{...l,...s,ref:o})});W.displayName=Ke;var b="AlertDialogContent",[Xe,Ze]=Qe(b),Je=be("AlertDialogContent"),Q=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,children:s,...l}=a,n=f(r),i=t.useRef(null),j=I(o,i),A=t.useRef(null);return e.jsx(Oe,{contentName:b,titleName:B,docsSlug:"alert-dialog",children:e.jsx(Xe,{scope:r,cancelRef:A,children:e.jsxs(Me,{role:"alertdialog",...n,...l,ref:j,onOpenAutoFocus:ve(l.onOpenAutoFocus,h=>{var y;h.preventDefault(),(y=A.current)==null||y.focus({preventScroll:!0})}),onPointerDownOutside:h=>h.preventDefault(),onInteractOutside:h=>h.preventDefault(),children:[e.jsx(Je,{children:s}),e.jsx(aa,{contentRef:i})]})})})});Q.displayName=b;var B="AlertDialogTitle",U=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,l=f(r);return e.jsx(Ie,{...l,...s,ref:o})});U.displayName=B;var Y="AlertDialogDescription",K=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,l=f(r);return e.jsx(Le,{...l,...s,ref:o})});K.displayName=Y;var ea="AlertDialogAction",X=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,l=f(r);return e.jsx(z,{...l,...s,ref:o})});X.displayName=ea;var Z="AlertDialogCancel",J=t.forwardRef((a,o)=>{const{__scopeAlertDialog:r,...s}=a,{cancelRef:l}=Ze(Z,r),n=f(r),i=I(o,l);return e.jsx(z,{...n,...s,ref:i})});J.displayName=Z;var aa=({contentRef:a})=>{const o=`\`${b}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${b}\` by passing a \`${Y}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${b}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return t.useEffect(()=>{var s;document.getElementById((s=a.current)==null?void 0:s.getAttribute("aria-describedby"))||console.warn(o)},[o,a]),null},oa=H,ra=G,ee=W,ae=Q,oe=X,re=J,te=U,se=K;const ta=oa,sa=ra,ne=t.forwardRef(({className:a,...o},r)=>e.jsx(ee,{className:m("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...o,ref:r}));ne.displayName=ee.displayName;const ie=t.forwardRef(({className:a,...o},r)=>e.jsxs(sa,{children:[e.jsx(ne,{}),e.jsx(ae,{ref:r,className:m("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...o})]}));ie.displayName=ae.displayName;const le=({className:a,...o})=>e.jsx("div",{className:m("flex flex-col space-y-2 text-center sm:text-left",a),...o});le.displayName="AlertDialogHeader";const ce=({className:a,...o})=>e.jsx("div",{className:m("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...o});ce.displayName="AlertDialogFooter";const de=t.forwardRef(({className:a,...o},r)=>e.jsx(te,{ref:r,className:m("text-lg font-semibold",a),...o}));de.displayName=te.displayName;const ue=t.forwardRef(({className:a,...o},r)=>e.jsx(se,{ref:r,className:m("text-sm text-muted-foreground",a),...o}));ue.displayName=se.displayName;const pe=t.forwardRef(({className:a,...o},r)=>e.jsx(oe,{ref:r,className:m(q(),a),...o}));pe.displayName=oe.displayName;const na=t.forwardRef(({className:a,...o},r)=>e.jsx(re,{ref:r,className:m(q({variant:"outline"}),"mt-2 sm:mt-0",a),...o}));na.displayName=re.displayName;const ia=({isOpen:a,onEnable:o})=>e.jsx(ta,{open:a,children:e.jsxs(ie,{children:[e.jsxs(le,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-6 w-6 text-primary"}),"Ativar Notifica√ß√µes Sonoras?"]}),e.jsxs(ue,{children:["Para garantir que voc√™ n√£o perca nenhum novo pedido, precisamos da sua permiss√£o para tocar um som de notifica√ß√£o.",e.jsx("br",{}),e.jsx("br",{}),'Ao clicar em "Ativar", um som de teste ser√° reproduzido.']})]}),e.jsx(ce,{children:e.jsx(pe,{onClick:o,className:"w-full",children:"Sim, ativar som"})})]})}),me=t.createContext(null),Aa=()=>{const a=t.useContext(me);if(!a)throw new Error("useSound must be used within a DashboardLayout");return a},la=a=>{const o=ca.find(r=>r.href===a);return o?o.label:"Dashboard"},ca=[{href:"/dashboard",label:"Dashboard"},{href:"/products",label:"Produtos"},{href:"/orders",label:"Pedidos"},{href:"/cashier",label:"Caixa"},{href:"/hours",label:"Hor√°rios"},{href:"/payments",label:"Pagamentos"},{href:"/delivery",label:"Taxa de Entrega"},{href:"/settings",label:"Configura√ß√µes"}],Sa=()=>{const a=Ne(),o=M(),r=je(),[s,l]=t.useState(null),n=t.useRef(null),[i,j]=t.useState("loading"),[A,h]=t.useState(!1),[y,E]=t.useState(null),[d,x]=t.useState(()=>localStorage.getItem("soundNotificationStatus")||"disabled");t.useEffect(()=>{localStorage.setItem("soundNotificationStatus",d)},[d]);const{data:S}=De({queryKey:["restaurantForLayout"],queryFn:async()=>{const{data:c,error:g}=await v.from("restaurants").select("id, notification_sound_url").limit(1).single();if(g)throw new Error(g.message);return c},enabled:!!s});t.useEffect(()=>{!localStorage.getItem("hasSeenSoundPermissionModal")&&d!=="enabled"&&i==="ready"&&h(!0)},[d,i]),t.useEffect(()=>{(async()=>{const{data:{session:u}}=await v.auth.getSession();u!=null&&u.user?l(u.user):a("/auth")})();const{data:{subscription:g}}=v.auth.onAuthStateChange((u,w)=>{u==="SIGNED_OUT"?a("/"):w!=null&&w.user?l(w.user):a("/auth")});return()=>g.unsubscribe()},[a]);const D=t.useCallback(()=>{n.current&&(n.current.pause(),n.current.loop=!1,E(null))},[]),T=t.useCallback(c=>{if(d==="enabled"&&n.current&&i==="ready"){if(y)return;E(c),n.current.loop=!0,n.current.play().catch(g=>{console.error("Erro na reprodu√ß√£o autom√°tica de √°udio:",g),E(null),p.warning("N√£o foi poss√≠vel tocar o som automaticamente.",{description:"Interaja com a p√°gina para permitir a reprodu√ß√£o de som."})})}},[d,i,y]);t.useEffect(()=>{const c=v.channel("new-orders-toast").on("postgres_changes",{event:"INSERT",schema:"public",table:"orders"},g=>{r.invalidateQueries({queryKey:["orders"]});const u=g.new;p.info("üîî Novo pedido recebido!",{description:`Pedido #${u.id.slice(-4)} est√° aguardando confirma√ß√£o.`,duration:15e3}),u.id&&T(u.id)}).subscribe();return()=>{v.removeChannel(c)}},[r,T]);const k=t.useCallback(()=>{d==="enabled"&&n.current&&i==="ready"&&(D(),n.current.loop=!1,n.current.currentTime=0,n.current.play().catch(c=>{console.error("Erro na reprodu√ß√£o de √°udio de teste:",c)}))},[d,i,D]),fe=async()=>{if(i!=="ready"||!n.current){p.error("O arquivo de som ainda n√£o est√° pronto. Tente novamente em um momento.");return}try{n.current.currentTime=0,await n.current.play(),x("enabled"),p.success("Notifica√ß√µes sonoras ativadas!"),localStorage.setItem("hasSeenSoundPermissionModal","true")}catch(c){console.error("Audio activation failed from modal:",c),p.error("Falha ao ativar o som.",{description:"Seu navegador pode ter bloqueado a reprodu√ß√£o. Por favor, tente ativar manualmente no √≠cone do cabe√ßalho."}),x("error")}finally{h(!1)}},he=async()=>{if(d==="enabled"){D(),x("disabled"),p.info("Notifica√ß√µes sonoras desativadas.");return}if(i!=="ready"||!n.current){p.error("Som de notifica√ß√£o n√£o est√° pronto ou configurado."),x("error");return}try{await k(),x("enabled"),p.success("Notifica√ß√µes sonoras ativadas!",{description:"Voc√™ ouviu o som de teste."})}catch(c){console.error("Audio activation failed:",c),p.error("Falha ao ativar o som.",{description:"Seu navegador pode ter bloqueado. Clique na p√°gina e tente novamente."}),x("error")}},ge=async()=>{await v.auth.signOut()};if(!s)return e.jsx("div",{className:"flex h-screen items-center justify-center",children:"Carregando..."});const C=i!=="ready";return e.jsxs(me.Provider,{value:{playSound:k,stopSoundLoop:D,soundStatus:d,loopingOrderId:y},children:[e.jsx(ia,{isOpen:A,onEnable:fe}),e.jsxs("div",{className:"flex min-h-screen bg-muted/40",children:[e.jsx(We,{}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"border-b bg-background sticky top-0 z-40",children:e.jsxs("div",{className:"container max-w-none mx-auto px-8 h-16 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(L,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-xl font-semibold",children:la(o.pathname)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_,{children:[e.jsx(R,{asChild:!0,children:e.jsx(P,{variant:"outline",size:"sm",onClick:k,disabled:C,children:"Testar Som"})}),C&&e.jsx(O,{children:e.jsx("p",{children:"Carregando som..."})})]}),e.jsxs(_,{children:[e.jsx(R,{asChild:!0,children:e.jsxs(P,{variant:"outline",size:"icon",onClick:he,disabled:C,children:[i==="loading"&&e.jsx(Ae,{className:"h-4 w-4 animate-spin"}),i==="ready"&&d==="enabled"&&e.jsx(F,{className:"h-4 w-4 text-green-500"}),i==="ready"&&d==="disabled"&&e.jsx(Ve,{className:"h-4 w-4"}),i==="error"&&e.jsx(ze,{className:"h-4 w-4 text-destructive"})]})}),C&&e.jsx(O,{children:e.jsx("p",{children:"Carregando som..."})})]}),e.jsx(P,{variant:"outline",onClick:ge,children:"Sair"})]})]})}),e.jsx(Se,{})]}),(S==null?void 0:S.notification_sound_url)&&e.jsx("audio",{ref:n,src:S.notification_sound_url,onCanPlayThrough:()=>j("ready"),onError:()=>{p.error("Erro ao carregar o som de notifica√ß√£o.",{description:"Verifique o arquivo em Configura√ß√µes."}),j("error"),x("error")},className:"hidden"})]})]})};export{me as SoundContext,Sa as default,Aa as useSound};
