import{b as M,u as q,c as L,j as e}from"./tanstack-DXzASLyu.js";import{r as f,f as X}from"./vendor-YgypLURK.js";import{s as S}from"./client-lAKPhnc8.js";import{B as j,b as Z}from"./button-BNFJL9F0.js";import{C as O,a as I,b as J,c as W}from"./card-kO8gc-l0.js";import{S as Y,a as ee,b as se,c as ae,d as te,T as ne,e as re,f as le,g as ie,C as y}from"./select-CZyD7dTI.js";import{D as oe,a as ce,b as de,c as me,d as ue,e as xe,B as he}from"./index-DVooXRAn.js";import{S as C}from"./skeleton-EgI8HOYM.js";import{A as pe,a as ge,b as fe}from"./alert-C4RAa8oH.js";import{c as E,u as P,b as x,X as F}from"./index-9b8Yj9sn.js";import{S as T}from"./separator-B5sGP6dZ.js";import{P as je}from"./printer-DUipCYrx.js";import{useSound as be}from"./DashboardLayout-C79d9gok.js";import{T as ye}from"./terminal-B5LoMAum.js";import{S as B}from"./shopping-cart-B4ANo03H.js";import{D as Ne}from"./dollar-sign-DAMojFFR.js";import"./supabase-Bm28tI2t.js";import"./index-B5kyZAzS.js";import"./index-DvUVZ62n.js";import"./index-DF3YflBu.js";import"./index-CUvv1sQ9.js";import"./Logo-BSaf29Tq.js";import"./package-CLSyEr88.js";import"./clock-Ck7zkzpe.js";import"./credit-card-Nu3xJfjE.js";import"./truck-BPr_puRB.js";import"./settings-CG0Ec5Hg.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=E("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=E("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=E("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=E("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),R={pending:{label:"Pendente"},confirmed:{label:"Confirmado"},preparing:{label:"Em Preparação"},ready:{label:"Pronto"},delivering:{label:"Em Entrega"},delivered:{label:"Entregue"},cancelled:{label:"Cancelado"},pending_payment:{label:"Aguardando Pagamento"}},Se=async s=>{const{data:a,error:t}=await S.from("order_items").select("*, products(name)").eq("order_id",s);if(t)throw new Error(t.message);return a},Ee=({order:s,isOpen:a,onClose:t})=>{var v,b;const d=M(),[n,r]=f.useState("pending");f.useEffect(()=>{s!=null&&s.status&&r(s.status)},[s]);const{data:m,isLoading:i}=q({queryKey:["orderItems",s==null?void 0:s.id],queryFn:()=>Se(s.id),enabled:!!s&&a}),l=L({mutationFn:async o=>{if(!s)throw new Error("Pedido não encontrado.");const{error:u}=await S.from("orders").update({status:o}).eq("id",s.id);if(u)throw new Error(u.message)},onSuccess:(o,u)=>{P.success(`Status do pedido atualizado para "${R[u].label}"`),d.invalidateQueries({queryKey:["orders"]}),t()},onError:o=>{P.error(`Erro ao atualizar status: ${o.message}`)}}),h=()=>{window.print()};if(!s)return null;const p=s.created_at?new Date(s.created_at).getTime().toString().slice(-4):"N/A";return e.jsx(oe,{open:a,onOpenChange:t,children:e.jsxs(ce,{className:"sm:max-w-lg",children:[e.jsxs(de,{children:[e.jsxs(me,{children:["Detalhes do Pedido #",p]}),e.jsx(ue,{children:"Gerencie os detalhes e o status deste pedido."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold",children:"Cliente"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nome: ",((v=s.customer)==null?void 0:v.name)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Telefone: ",((b=s.customer)==null?void 0:b.phone)||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Endereço: ",s.delivery_address||"N/A"]})]}),e.jsx(T,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Itens do Pedido"}),i?e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{className:"h-8 w-full"}),e.jsx(C,{className:"h-8 w-full"})]}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto pr-2",children:m==null?void 0:m.map(o=>{var u;return e.jsxs("div",{className:"flex justify-between items-start text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[o.quantity,"x ",((u=o.products)==null?void 0:u.name)||"Produto desconhecido"]}),o.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground italic",children:["Obs: ",o.notes]})]}),e.jsx("span",{className:"text-muted-foreground",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o.subtotal)})]},o.id)})})]}),e.jsx(T,{}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Taxa de Entrega:"}),e.jsx("span",{className:"font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.delivery_fee||0)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-base",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]})]}),e.jsx(T,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Atualizar Status"}),e.jsxs(Y,{value:n,onValueChange:o=>r(o),children:[e.jsx(ee,{children:e.jsx(se,{placeholder:"Selecione um status"})}),e.jsx(ae,{children:Object.entries(R).map(([o,{label:u}])=>e.jsx(te,{value:o,children:u},o))})]})]})]}),e.jsxs(xe,{className:"flex-col sm:flex-row sm:justify-between sm:space-x-2",children:[e.jsxs(j,{variant:"outline",onClick:h,className:"w-full sm:w-auto mb-2 sm:mb-0",children:[e.jsx(je,{className:"h-4 w-4 mr-2"})," Imprimir Pedido"]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(j,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(j,{onClick:()=>l.mutate(n),disabled:l.isPending||n===s.status,children:l.isPending?"Salvando...":"Salvar Alterações"})]})]})]})})},z=({className:s,...a})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:x("mx-auto flex w-full justify-center",s),...a});z.displayName="Pagination";const V=f.forwardRef(({className:s,...a},t)=>e.jsx("ul",{ref:t,className:x("flex flex-row items-center gap-1",s),...a}));V.displayName="PaginationContent";const g=f.forwardRef(({className:s,...a},t)=>e.jsx("li",{ref:t,className:x("",s),...a}));g.displayName="PaginationItem";const N=({className:s,isActive:a,size:t="icon",...d})=>e.jsx("a",{"aria-current":a?"page":void 0,className:x(Z({variant:a?"outline":"ghost",size:t}),s),...d});N.displayName="PaginationLink";const $=({className:s,...a})=>e.jsxs(N,{"aria-label":"Go to previous page",size:"default",className:x("gap-1 pl-2.5",s),...a,children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});$.displayName="PaginationPrevious";const G=({className:s,...a})=>e.jsxs(N,{"aria-label":"Go to next page",size:"default",className:x("gap-1 pr-2.5",s),...a,children:[e.jsx("span",{children:"Next"}),e.jsx(we,{className:"h-4 w-4"})]});G.displayName="PaginationNext";const k=({className:s,...a})=>e.jsxs("span",{"aria-hidden":!0,className:x("flex h-9 w-9 items-center justify-center",s),...a,children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]});k.displayName="PaginationEllipsis";const Te=({currentPage:s,totalPages:a,onPageChange:t})=>{if(a<=1)return null;const n=(()=>{const r=[],i=Math.max(1,s-Math.floor(2.5)),l=Math.min(a,i+5-1);if(l-i+1<5){const h=Math.max(1,l-5+1);for(let p=h;p<=l;p++)r.push(p)}else for(let h=i;h<=l;h++)r.push(h);return r})();return e.jsx(z,{children:e.jsxs(V,{children:[e.jsx(g,{children:e.jsx($,{onClick:()=>t(s-1),className:x(s===1&&"pointer-events-none opacity-50")})}),n[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsx(N,{onClick:()=>t(1),children:"1"})}),n[0]>2&&e.jsx(g,{children:e.jsx(k,{})})]}),n.map(r=>e.jsx(g,{children:e.jsx(N,{isActive:r===s,onClick:()=>t(r),children:r})},r)),n[n.length-1]<a&&e.jsxs(e.Fragment,{children:[n[n.length-1]<a-1&&e.jsx(g,{children:e.jsx(k,{})}),e.jsx(g,{children:e.jsx(N,{onClick:()=>t(a),children:a})})]}),e.jsx(g,{children:e.jsx(G,{onClick:()=>t(s+1),className:x(s===a&&"pointer-events-none opacity-50")})})]})})},ke={pending:{label:"Pendente",icon:B,color:"bg-yellow-500 hover:bg-yellow-600"},confirmed:{label:"Confirmado",icon:y,color:"bg-blue-500 hover:bg-blue-600"},preparing:{label:"Em Preparação",icon:y,color:"bg-orange-500 hover:bg-orange-600"},ready:{label:"Pronto",icon:y,color:"bg-green-500 hover:bg-green-600"},delivering:{label:"Em Entrega",icon:y,color:"bg-indigo-500 hover:bg-indigo-600"},delivered:{label:"Entregue",icon:y,color:"bg-primary hover:bg-primary/90"},cancelled:{label:"Cancelado",icon:F,color:"bg-destructive hover:bg-destructive/90"},pending_payment:{label:"Aguardando Pag.",icon:Ne,color:"bg-gray-500 hover:bg-gray-600"}},D=12,De=async(s,a,t)=>{const d=t*D,n=d+D-1;let r=S.from("orders").select("*, customer:customers(name, phone)",{count:"exact"}).eq("restaurant_id",s);a!=="all"&&(r=r.eq("status",a));const{data:m,error:i,count:l}=await r.order("created_at",{ascending:!1}).range(d,n);if(i)throw new Error(`Erro ao buscar pedidos: ${i.message}`);return{orders:m,count:l||0}},_e=({order:s,onViewDetails:a,onAccept:t,onDecline:d})=>{var i;const n=ke[s.status||"pending"],r=((i=s.customer)==null?void 0:i.name)||"Cliente Desconhecido",m=s.created_at?new Date(s.created_at).getTime().toString().slice(-4):"N/A";return e.jsxs(O,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col",children:[e.jsxs(J,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs(W,{className:"text-lg font-bold flex items-center gap-2",children:["Pedido #",m]}),e.jsxs(he,{className:x("text-white",n.color),children:[e.jsx(n.icon,{className:"h-3 w-3 mr-1"}),n.label]})]}),e.jsxs(I,{className:"space-y-2 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",r]}),e.jsx("p",{className:"text-2xl font-extrabold text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]}),e.jsxs("div",{className:"flex justify-end pt-2 border-t gap-2",children:[(s.status==="pending"||s.status==="pending_payment")&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{variant:"destructive",size:"sm",onClick:()=>d(s.id),children:[e.jsx(F,{className:"h-4 w-4 mr-1"})," Recusar"]}),e.jsxs(j,{variant:"default",size:"sm",onClick:()=>t(s.id),children:[e.jsx(y,{className:"h-4 w-4 mr-1"})," Aceitar"]})]}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>a(s),children:"Detalhes"})]})]})]})},Ae=({status:s,onViewDetails:a,restaurantId:t})=>{const d=M(),{stopSoundLoop:n}=be(),[r,m]=f.useState(0),{data:i,isLoading:l,isError:h,error:p,refetch:v}=q({queryKey:["orders",s,t,r],queryFn:()=>De(t,s,r),enabled:!!t}),b=(i==null?void 0:i.orders)||[],o=(i==null?void 0:i.count)||0,u=Math.ceil(o/D),_=L({mutationFn:async({orderId:c,newStatus:w})=>{const{error:A}=await S.from("orders").update({status:w}).eq("id",c);if(A)throw new Error(A.message);return w},onSuccess:c=>{P.success(`Pedido ${c==="confirmed"?"aceito":"recusado"} com sucesso!`),d.invalidateQueries({queryKey:["orders"]})},onError:c=>P.error(`Erro ao atualizar pedido: ${c.message}`)}),K=c=>{n(),_.mutate({orderId:c,newStatus:"confirmed"})},Q=c=>{n(),_.mutate({orderId:c,newStatus:"cancelled"})},H=c=>{n(),a(c)},U=f.useCallback(c=>{m(c-1)},[]);return l?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((c,w)=>e.jsx(O,{children:e.jsx(I,{className:"p-4 space-y-3",children:e.jsx(C,{className:"h-32 w-full"})})},w))}):h?e.jsxs(pe,{variant:"destructive",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx(ge,{children:"Erro ao carregar pedidos"}),e.jsx(fe,{children:p instanceof Error?p.message:"Ocorreu um erro desconhecido."}),e.jsxs(j,{onClick:()=>v(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]}):!b||b.length===0?e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg border",children:[e.jsx(B,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifique o status selecionado ou aguarde novos pedidos."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:b.map(c=>e.jsx(_e,{order:c,onViewDetails:H,onAccept:K,onDecline:Q},c.id))}),u>1&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(Te,{currentPage:r+1,totalPages:u,onPageChange:U})})]})},ls=()=>{const{restaurant:s}=X(),[a,t]=f.useState(null),[d,n]=f.useState(!1),r=l=>{t(l),n(!0)},m=()=>{n(!1),t(null)},i=[{value:"pending_payment",label:"Aguardando Pag."},{value:"pending",label:"Pendentes"},{value:"confirmed",label:"Confirmados"},{value:"preparing",label:"Em Preparação"},{value:"ready",label:"Prontos"},{value:"delivering",label:"Em Entrega"},{value:"delivered",label:"Entregues"},{value:"cancelled",label:"Cancelados"},{value:"all",label:"Todos"}];return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{order:a,isOpen:d,onClose:m}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:s!=null&&s.id?e.jsxs(ne,{defaultValue:"pending_payment",children:[e.jsx(re,{className:"w-full overflow-x-auto justify-start",children:i.map(l=>e.jsx(le,{value:l.value,className:"whitespace-nowrap",children:l.label},l.value))}),i.map(l=>e.jsx(ie,{value:l.value,className:"mt-6",children:e.jsx(Ae,{status:l.value,onViewDetails:r,restaurantId:s.id})},l.value))]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Carregando dados do restaurante..."})]})})]})};export{ls as default};
