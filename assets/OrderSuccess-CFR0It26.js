import{u as y,j as e,b as v,c as C}from"./tanstack-DS1wz2fm.js";import{j as S,h as E,r as P,L as p}from"./vendor-DPb28zz8.js";import{B as x}from"./button-Cu3hB-bv.js";import{C as n,b as f,c as h,a as c}from"./card-C21rN-Dn.js";import{s as b}from"./client-BP8r4skJ.js";import{S as j}from"./skeleton-Dqa_iqtg.js";import{A as k,a as A,b as T}from"./alert-gBtguY9I.js";import{c as L,L as w,b as D,a as I,u as m}from"./index-BUwp1co6.js";import{T as _}from"./terminal-Cx6cJUcj.js";import{C as q}from"./clock-FSpyK0b5.js";import{C as N,a as B}from"./circle-x-b-oPNYvL.js";import{P as M}from"./package-D5wEYY4n.js";import{T as R}from"./truck-FKltdYp5.js";import{D as F}from"./dollar-sign-D9V2lA0x.js";import{A as O}from"./arrow-left-gXDpOjmK.js";import"./supabase-BT-vd-uw.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=L("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]]),K={pending:{label:"Pendente",icon:q,color:"bg-yellow-500",description:"Aguardando a confirmação do restaurante."},confirmed:{label:"Confirmado",icon:N,color:"bg-blue-500",description:"Seu pedido foi confirmado e será preparado em breve."},preparing:{label:"Em Preparação",icon:V,color:"bg-orange-500",description:"O restaurante está preparando seus itens."},ready:{label:"Pronto",icon:M,color:"bg-green-500",description:"Seu pedido está pronto para retirada ou entrega."},delivering:{label:"Em Entrega",icon:R,color:"bg-indigo-500",description:"Seu pedido saiu para entrega e está a caminho."},delivered:{label:"Entregue",icon:N,color:"bg-primary",description:"Seu pedido foi entregue com sucesso!"},cancelled:{label:"Cancelado",icon:B,color:"bg-destructive",description:"Seu pedido foi cancelado. Entre em contato com o restaurante se houver dúvidas."},pending_payment:{label:"Aguardando Pagamento",icon:F,color:"bg-gray-500",description:"Aguardando a confirmação do pagamento online."}},Q=async a=>{const{data:r,error:t}=await b.from("orders").select("*, customer:customers(name, phone)").eq("id",a).limit(1).single();if(t)throw new Error(`Erro ao buscar detalhes do pedido: ${t.message}`);if(!r)throw new Error("Pedido não encontrado.");return r},U=({orderId:a})=>{var g;const{data:r,isLoading:t,isError:i,error:o}=y({queryKey:["orderStatus",a],queryFn:()=>Q(a),refetchInterval:1e4});if(t)return e.jsxs(n,{className:"w-full max-w-md text-center shadow-xl",children:[e.jsxs(f,{className:"space-y-4",children:[e.jsx(w,{className:"h-16 w-16 text-primary mx-auto animate-spin"}),e.jsx(h,{className:"text-2xl font-bold",children:"Carregando Status..."})]}),e.jsxs(c,{children:[e.jsx(j,{className:"h-4 w-3/4 mx-auto mb-2"}),e.jsx(j,{className:"h-4 w-1/2 mx-auto"})]})]});if(i)return e.jsxs(k,{variant:"destructive",className:"w-full max-w-md mx-auto",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx(A,{children:"Erro ao rastrear pedido"}),e.jsx(T,{children:o instanceof Error?o.message:"Não foi possível carregar o status do pedido."})]});if(!r)return null;const d=r.status||"pending",s=K[d],u=r.created_at?new Date(r.created_at).getTime().toString().slice(-4):a.slice(-4),l=s.icon;return e.jsxs(n,{className:"w-full max-w-md text-center shadow-xl",children:[e.jsxs(f,{className:"space-y-4",children:[e.jsx("div",{className:D("h-16 w-16 rounded-full mx-auto flex items-center justify-center text-white",s.color),children:e.jsx(l,{className:"h-8 w-8"})}),e.jsxs(h,{className:"text-3xl font-bold",children:["Pedido #",u]}),e.jsxs("p",{className:"text-lg font-semibold text-foreground",children:["Status: ",s.label]})]}),e.jsxs(c,{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsxs("div",{className:"text-left border-t pt-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Detalhes:"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Cliente: ",((g=r.customer)==null?void 0:g.name)||"N/A"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.total_amount)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Endereço: ",r.delivery_address||"Retirada no Local"]})]})]})]})},ce=()=>{const{orderId:a}=S(),[r]=E(),t=v(),{clearCart:i}=I(),o=r.get("status"),d=C({mutationFn:async s=>{const{data:u,error:l}=await b.functions.invoke("confirm-payment",{body:{orderId:s}});if(l)throw new Error(l.message);return u},onSuccess:s=>{(s==null?void 0:s.status)==="approved"?m.success("Pagamento confirmado com sucesso!"):(s==null?void 0:s.status)==="pending"?m.info("Pagamento ainda pendente de confirmação.",{description:"Aguardando a compensação do Pix/Boleto."}):m.warning("Status de pagamento não aprovado.",{description:"Se você já pagou, aguarde alguns minutos ou entre em contato com o restaurante."}),t.invalidateQueries({queryKey:["orderStatus",a]})},onError:s=>{m.error(`Falha na confirmação do pagamento: ${s.message}`)}});return P.useEffect(()=>{a&&(i(),(o==="approved"||o==="pending")&&d.mutate(a))},[a,o,i]),a?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center p-4",children:[e.jsx("div",{className:"w-full max-w-md mb-6",children:e.jsx(p,{to:"/menu",children:e.jsxs(x,{variant:"ghost",className:"mb-4",children:[e.jsx(O,{className:"h-4 w-4 mr-2"})," Voltar ao Cardápio"]})})}),d.isPending&&(o==="approved"||o==="pending")&&e.jsx(n,{className:"w-full max-w-md text-center shadow-xl mb-6",children:e.jsxs(c,{className:"p-6 flex items-center justify-center",children:[e.jsx(w,{className:"h-5 w-5 mr-3 animate-spin"}),e.jsx("p",{className:"font-semibold",children:"Confirmando pagamento, por favor aguarde..."})]})}),e.jsx(U,{orderId:a}),e.jsx("div",{className:"w-full max-w-md mt-6",children:e.jsx(n,{className:"shadow-xl",children:e.jsxs(c,{className:"p-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Você pode acompanhar o status do seu pedido nesta página."}),e.jsx(p,{to:"/menu",children:e.jsx(x,{className:"w-full",children:"Fazer Novo Pedido"})})]})})})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs(n,{className:"w-full max-w-md text-center shadow-xl",children:[e.jsx(f,{children:e.jsx(h,{className:"text-2xl font-bold text-destructive",children:"Erro"})}),e.jsxs(c,{children:[e.jsx("p",{className:"text-muted-foreground",children:"ID do pedido não encontrado."}),e.jsx(p,{to:"/menu",children:e.jsx(x,{className:"mt-4",children:"Voltar ao Cardápio"})})]})]})})};export{ce as default};
