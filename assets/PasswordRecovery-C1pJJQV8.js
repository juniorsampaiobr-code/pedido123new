import{j as e}from"./tanstack-C7aOFagJ.js";import{h as b,r as n}from"./vendor-DjsPZZVP.js";import{s as h,j as t,L as w,C,e as P,f as L,g as T,b as A,h as j,I as g,B as v,a3 as D}from"./index-_mGbyA3Z.js";import{L as E}from"./Logo-dTy14Op_.js";import{L as I}from"./lock-D49LbrVD.js";import{A as R}from"./arrow-left-DrtMxSTQ.js";import"./supabase-BAEEEeUB.js";const U=a=>{const i=a.substring(1).split("#"),c=i.length>1?i[1]:i[0],o=new URLSearchParams(c);return{accessToken:o.get("access_token"),refreshToken:o.get("refresh_token"),type:o.get("type")}},O=()=>{const a=b(),[i,c]=n.useState(!0),[o,u]=n.useState(!1),[l,N]=n.useState(""),[p,y]=n.useState(""),[f,x]=n.useState(!1);n.useEffect(()=>{const{accessToken:s,refreshToken:r,type:k}=U(window.location.hash);s&&r&&k==="recovery"?(async()=>{try{const{error:m}=await h.auth.setSession({access_token:s,refresh_token:r});if(m)throw m;u(!0),t.success("Sessão de recuperação ativada. Defina sua nova senha."),a("/password-recovery",{replace:!0})}catch(m){console.error("Erro ao definir sessão:",m),t.error("Link de recuperação inválido ou expirado."),a("/admin-auth",{replace:!0})}finally{c(!1)}})():h.auth.getSession().then(({data:{session:d}})=>{d!=null&&d.user&&(u(!0),t.info("Você já está logado. Defina sua nova senha abaixo.")),c(!1)})},[a]);const S=async s=>{if(s.preventDefault(),l.length<6){t.error("A nova senha deve ter pelo menos 6 caracteres.");return}if(l!==p){t.error("As senhas não coincidem.");return}x(!0);try{const{error:r}=await h.auth.updateUser({password:l});if(r)throw r;t.success("Senha redefinida com sucesso! Redirecionando para o login."),await h.auth.signOut(),a("/admin-auth",{replace:!0})}catch(r){t.error(r.message||"Erro ao redefinir a senha."),x(!1)}};return i?e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4",children:[e.jsx(w,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-3 text-muted-foreground",children:"Verificando link de recuperação..."})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(E,{className:"justify-center mb-4"})}),e.jsxs(C,{className:"shadow-xl border-2",children:[e.jsxs(P,{className:"space-y-1",children:[e.jsxs(L,{className:"text-2xl font-bold text-center flex items-center justify-center gap-2",children:[e.jsx(I,{className:"h-6 w-6 text-primary"}),"Redefinir Senha"]}),e.jsx(T,{className:"text-center",children:o?"Digite e confirme sua nova senha.":"Link inválido ou expirado. Tente novamente."})]}),e.jsx(A,{className:"space-y-4",children:o?e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"newPassword",children:"Nova Senha *"}),e.jsx(g,{id:"newPassword",type:"password",placeholder:"••••••••",value:l,onChange:s=>N(s.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"confirmPassword",children:"Confirmar Nova Senha *"}),e.jsx(g,{id:"confirmPassword",type:"password",placeholder:"••••••••",value:p,onChange:s=>y(s.target.value),required:!0,className:"h-12"})]}),e.jsxs(v,{type:"submit",className:"w-full",size:"lg",disabled:f,children:[f?e.jsx(w,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(D,{className:"h-4 w-4 mr-2"}),"Atualizar Senha"]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-destructive mb-4",children:"Não foi possível ativar a sessão de recuperação."}),e.jsxs(v,{variant:"outline",onClick:()=>a("/admin-auth",{replace:!0}),children:[e.jsx(R,{className:"h-4 w-4 mr-1"})," Voltar para o Login"]})]})})]})]})})};export{O as default};
