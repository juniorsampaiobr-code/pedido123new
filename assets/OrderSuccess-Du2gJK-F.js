import{j as e,x as N,d as y,F as v,G as C,e as S,b as E,r as P,L as m,a as h}from"./index-zkuE9Bm6.js";import{B as u}from"./button-3xZnEy7f.js";import{C as n,b as x,c as p,a as c}from"./card-B1F0wEox.js";import{u as A}from"./useQuery-Bop5DQT3.js";import{s as b}from"./client-g0uDe16g.js";import{S as g}from"./skeleton-CBZEqJVS.js";import{A as T,T as k,a as D,b as L}from"./alert-B4s-E96m.js";import{C as _}from"./clock-8B-vU318.js";import{C as j,U as F,a as I}from"./utensils-C3TXi82r.js";import{P as R}from"./package-BjiMSLe_.js";import{T as q}from"./truck-Dx6yc9rA.js";import{D as B}from"./dollar-sign-MxpQT_7w.js";import{u as O}from"./useMutation-DTwKCpeC.js";import{A as K}from"./arrow-left-BDosrADm.js";const M={pending:{label:"Pendente",icon:_,color:"bg-yellow-500",description:"Aguardando a confirmação do restaurante."},confirmed:{label:"Confirmado",icon:j,color:"bg-blue-500",description:"Seu pedido foi confirmado e será preparado em breve."},preparing:{label:"Em Preparação",icon:F,color:"bg-orange-500",description:"O restaurante está preparando seus itens."},ready:{label:"Pronto",icon:R,color:"bg-green-500",description:"Seu pedido está pronto para retirada ou entrega."},delivering:{label:"Em Entrega",icon:q,color:"bg-indigo-500",description:"Seu pedido saiu para entrega e está a caminho."},delivered:{label:"Entregue",icon:j,color:"bg-primary",description:"Seu pedido foi entregue com sucesso!"},cancelled:{label:"Cancelado",icon:I,color:"bg-destructive",description:"Seu pedido foi cancelado. Entre em contato com o restaurante se houver dúvidas."},pending_payment:{label:"Aguardando Pagamento",icon:B,color:"bg-gray-500",description:"Aguardando a confirmação do pagamento online."}},Q=async s=>{const{data:a,error:t}=await b.from("orders").select("*, customer:customers(name, phone)").eq("id",s).limit(1).single();if(t)throw new Error(`Erro ao buscar detalhes do pedido: ${t.message}`);if(!a)throw new Error("Pedido não encontrado.");return a},U=({orderId:s})=>{var f;const{data:a,isLoading:t,isError:i,error:o}=A({queryKey:["orderStatus",s],queryFn:()=>Q(s),refetchInterval:1e4});if(t)return e.jsxs(n,{className:"w-full max-w-md text-center shadow-xl",children:[e.jsxs(x,{className:"space-y-4",children:[e.jsx(N,{className:"h-16 w-16 text-primary mx-auto animate-spin"}),e.jsx(p,{className:"text-2xl font-bold",children:"Carregando Status..."})]}),e.jsxs(c,{children:[e.jsx(g,{className:"h-4 w-3/4 mx-auto mb-2"}),e.jsx(g,{className:"h-4 w-1/2 mx-auto"})]})]});if(i)return e.jsxs(T,{variant:"destructive",className:"w-full max-w-md mx-auto",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx(D,{children:"Erro ao rastrear pedido"}),e.jsx(L,{children:o instanceof Error?o.message:"Não foi possível carregar o status do pedido."})]});if(!a)return null;const l=a.status||"pending",r=M[l],d=a.created_at?new Date(a.created_at).getTime().toString().slice(-4):s.slice(-4),w=r.icon;return e.jsxs(n,{className:"w-full max-w-md text-center shadow-xl",children:[e.jsxs(x,{className:"space-y-4",children:[e.jsx("div",{className:y("h-16 w-16 rounded-full mx-auto flex items-center justify-center text-white",r.color),children:e.jsx(w,{className:"h-8 w-8"})}),e.jsxs(p,{className:"text-3xl font-bold",children:["Pedido #",d]}),e.jsxs("p",{className:"text-lg font-semibold text-foreground",children:["Status: ",r.label]})]}),e.jsxs(c,{className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r.description}),e.jsxs("div",{className:"text-left border-t pt-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Detalhes:"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Cliente: ",((f=a.customer)==null?void 0:f.name)||"N/A"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.total_amount)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Endereço: ",a.delivery_address||"Retirada no Local"]})]})]})]})},te=()=>{const{orderId:s}=v(),[a]=C(),t=S(),{clearCart:i}=E(),o=a.get("status"),l=O({mutationFn:async r=>{const{error:d}=await b.functions.invoke("confirm-payment",{body:{orderId:r}});if(d)throw new Error(d.message)},onSuccess:()=>{h.success("Pagamento confirmado com sucesso!"),t.invalidateQueries({queryKey:["orderStatus",s]})},onError:r=>{h.error(`Falha na confirmação do pagamento: ${r.message}`)}});return P.useEffect(()=>{s&&(i(),o==="approved"&&l.mutate(s))},[s,o,i]),s?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center p-4",children:[e.jsx("div",{className:"w-full max-w-md mb-6",children:e.jsx(m,{to:"/menu",children:e.jsxs(u,{variant:"ghost",className:"mb-4",children:[e.jsx(K,{className:"h-4 w-4 mr-2"})," Voltar ao Cardápio"]})})}),l.isPending&&e.jsx(n,{className:"w-full max-w-md text-center shadow-xl mb-6",children:e.jsxs(c,{className:"p-6 flex items-center justify-center",children:[e.jsx(N,{className:"h-5 w-5 mr-3 animate-spin"}),e.jsx("p",{className:"font-semibold",children:"Confirmando pagamento, por favor aguarde..."})]})}),e.jsx(U,{orderId:s}),e.jsx("div",{className:"w-full max-w-md mt-6",children:e.jsx(n,{className:"shadow-xl",children:e.jsxs(c,{className:"p-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Você pode acompanhar o status do seu pedido nesta página."}),e.jsx(m,{to:"/menu",children:e.jsx(u,{className:"w-full",children:"Fazer Novo Pedido"})})]})})})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs(n,{className:"w-full max-w-md text-center shadow-xl",children:[e.jsx(x,{children:e.jsx(p,{className:"text-2xl font-bold text-destructive",children:"Erro"})}),e.jsxs(c,{children:[e.jsx("p",{className:"text-muted-foreground",children:"ID do pedido não encontrado."}),e.jsx(m,{to:"/menu",children:e.jsx(u,{className:"mt-4",children:"Voltar ao Cardápio"})})]})]})})};export{te as default};
