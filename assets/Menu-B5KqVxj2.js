import{j as e,u as Z}from"./tanstack-BDgcxwLQ.js";import{s as O}from"./client-BskZ_u5h.js";import{S as z}from"./skeleton-5_qm602t.js";import{A as te,a as se,b as oe}from"./alert-yoAP6yzG.js";import{r as i,L as ze}from"./vendor-CIxFcw7z.js";import{o as ne,n as Fe,u as ae,t as le,c as He}from"./types-C33Up_9v.js";import{B as S}from"./button-Z6fjjtmF.js";import{D as ie,a as ce,b as de,c as ue,d as me,e as he,u as We}from"./index-BHmbt24u.js";import{F as fe,a as xe,b as qe,c as Ve,d as Ue,e as Xe}from"./form-DPmxjXN2.js";import{c as Ye,a as F,b as P,T as $e,d as Qe,e as Ge,f as Ke,g as B,P as H,h as V,i as D,j as L,k as Je,u as ee}from"./index-CX2OK0JH.js";import{P as pe}from"./plus-LoOfWAQ3.js";import{S as U}from"./shopping-cart-B5Q5IpmR.js";import{I as be}from"./label-46rUugP1.js";import{C as ge,a as Ze}from"./card-C6w8oa5_.js";import{B as ve,c as er}from"./index-XOoR1lLc.js";import{M as rr}from"./map-pin-jOdfVwf4.js";import{C as tr,a as sr}from"./circle-x-8MBkL8Ug.js";import{C as we}from"./clock-DWMYD_yw.js";import{S as or,a as nr,b as ar,c as lr,d as ir,e as cr}from"./sheet-ukAnL0-8.js";import{S as dr}from"./separator-DiKS2Fxk.js";import{T as ur}from"./trash-2-Ctvvdg6Q.js";import{C as mr}from"./CustomerProfileModal-rcC1w0er.js";import{T as hr}from"./terminal-CjsM0-oa.js";import{U as fr}from"./user-CSB5B5gX.js";import"./supabase-DGFirUEE.js";import"./index-Ci9Xvaqd.js";import"./PhoneInput-BZv1PJO-.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=Ye("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),xr=ne({quantity:Fe().min(1,"Mínimo 1 item.")}),pr=({product:r,isOpen:o,onClose:t})=>{const{addItem:n}=F(),s=ae({resolver:le(xr),defaultValues:{quantity:1},values:{quantity:1}}),a=s.watch("quantity"),l=m=>{const u=a+m;u>=1&&s.setValue("quantity",u)},d=m=>{r&&(n({product_id:r.id,name:r.name,price:r.price,quantity:m.quantity,image_url:r.image_url}),t(),s.reset({quantity:1}))};if(!r)return null;const c=r.price*a;return e.jsx(ie,{open:o,onOpenChange:t,children:e.jsxs(ce,{className:"sm:max-w-[425px] p-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.image_url||"/placeholder.svg",alt:r.name,className:"w-full h-48 object-cover"}),e.jsxs(de,{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent p-4 flex flex-col justify-end items-start text-left space-y-0",children:[e.jsx(ue,{className:"text-2xl font-bold text-white drop-shadow-md",children:r.name}),e.jsxs(me,{className:"sr-only",children:["Detalhes e opções de personalização para ",r.name,"."]})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r.description}),e.jsx(fe,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(d),className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-y py-3",children:[e.jsx(xe,{className:"text-base font-semibold",children:"Quantidade"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{type:"button",variant:"outline",size:"icon",onClick:()=>l(-1),disabled:a<=1,children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-8 text-center font-bold text-lg",children:a}),e.jsx(S,{type:"button",variant:"outline",size:"icon",onClick:()=>l(1),children:e.jsx(pe,{className:"h-4 w-4"})})]})]}),e.jsxs(he,{className:P("pt-4","sm:justify-between sm:space-x-0"),children:[e.jsxs("div",{className:"text-xl font-bold text-foreground hidden sm:block",children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c)]}),e.jsxs(S,{type:"submit",className:"w-full sm:w-auto h-12 text-lg",disabled:s.formState.isSubmitting,children:[e.jsx(U,{className:"h-5 w-5 mr-2"}),"Adicionar ao Pedido"]})]})]})})]})]})})},br=ne({weight_in_grams:He.number({invalid_type_error:"Deve ser um número."}).positive("A quantidade deve ser maior que zero.")}),gr=({product:r,isOpen:o,onClose:t})=>{const{addItem:n}=F(),s=ae({resolver:le(br),defaultValues:{weight_in_grams:500}}),a=s.watch("weight_in_grams"),l=i.useMemo(()=>!r||!a||a<=0?0:r.price/1e3*a,[r,a]),d=c=>{r&&(n({product_id:r.id,name:`${r.name} (${c.weight_in_grams}g)`,price:l,quantity:1,image_url:r.image_url,is_price_by_weight:!0}),t(),s.reset({weight_in_grams:500}))};return r?e.jsx(ie,{open:o,onOpenChange:t,children:e.jsxs(ce,{className:"sm:max-w-[425px]",children:[e.jsxs(de,{className:"text-center",children:[e.jsx(ue,{className:"text-2xl",children:"Quanto você deseja?"}),e.jsxs(me,{children:[e.jsx("span",{className:"block text-lg font-semibold mt-2",children:r.name}),e.jsxs("span",{className:"block text-muted-foreground",children:[new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.price)," por kg"]})]})]}),e.jsx(fe,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(d),className:"space-y-6 pt-4",children:[e.jsx(qe,{control:s.control,name:"weight_in_grams",render:({field:c})=>e.jsxs(Ve,{children:[e.jsx(xe,{className:"text-base",children:"Quantidade em gramas"}),e.jsx(Ue,{children:e.jsx(be,{type:"number",placeholder:"Ex: 500",className:"h-12 text-lg text-center",...c,value:c.value===void 0||c.value===null?"":String(c.value),onChange:m=>{const u=m.target.value;c.onChange(u===""?void 0:parseFloat(u))}})}),e.jsx(Xe,{})]})}),e.jsxs(he,{className:"flex-col-reverse sm:flex-row sm:justify-between sm:space-x-2 w-full",children:[e.jsxs("div",{className:"text-xl font-bold text-foreground text-center sm:text-left mb-4 sm:mb-0",children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(l)]}),e.jsxs(S,{type:"submit",className:"w-full sm:w-auto h-12 text-lg",disabled:s.formState.isSubmitting||!s.formState.isValid,children:[e.jsx(U,{className:"h-5 w-5 mr-2"}),"Adicionar"]})]})]})})]})}):null},$=({src:r,alt:o,placeholder:t="/placeholder.svg",className:n="",...s})=>{const[a,l]=i.useState(!0),[d,c]=i.useState(!1),m=i.useRef(null);return i.useEffect(()=>{if(!r){l(!1);return}const u=new Image;u.src=r,u.onload=()=>{l(!1),c(!1)},u.onerror=()=>{l(!1),c(!0)}},[r]),e.jsxs("div",{className:`relative overflow-hidden ${n}`,children:[a&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 animate-pulse"}),e.jsx("img",{ref:m,src:d?t:r,alt:o,className:`${a?"opacity-0":"opacity-100"} transition-opacity duration-300 w-full h-full object-cover`,...s})]})},Se=i.memo(({id:r,name:o,description:t,price:n,image_url:s,is_price_by_weight:a,is_available:l,onClick:d})=>{const c=l===!1;return e.jsxs(ge,{className:P("overflow-hidden group transition-shadow duration-300 flex flex-col",c?"cursor-not-allowed":"hover:shadow-xl cursor-pointer"),onClick:d,children:[e.jsxs("div",{className:"relative h-32 sm:h-40",children:[" ",e.jsx($,{src:s||"/placeholder.svg",alt:o,className:P("w-full h-full object-cover",!c&&"group-hover:scale-105 transition-transform duration-300",c&&"filter grayscale")}),c&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx(ve,{variant:"destructive",className:"text-lg",children:"Indisponível"})})]}),e.jsxs(Ze,{className:P("p-3 flex flex-col flex-grow",c&&"opacity-60"),children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-1 truncate",children:o})," ",e.jsxs("p",{className:"text-xs text-muted-foreground mb-2 flex-grow line-clamp-2",children:[" ",t]}),e.jsxs("p",{className:"text-base font-bold text-primary text-right mt-2",children:[" ",a?`${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)} / kg`:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)]})]})]},r)});Se.displayName="ProductCard";function vr(r,o){const[t,n]=i.useState(r);return i.useEffect(()=>{const s=setTimeout(()=>{n(r)},o);return()=>{clearTimeout(s)}},[r,o]),t}const wr=()=>{const r=new Date,o=String(r.getHours()).padStart(2,"0"),t=String(r.getMinutes()).padStart(2,"0");return`${o}:${t}`},jr=()=>new Date().getDay(),ye=r=>{const o=jr(),t=wr(),n=r.find(c=>c.day_of_week===o);if(!n||!n.is_open)return{isOpen:!1,todayHours:"Fechado hoje"};const s=n.open_time,a=n.close_time;if(!s||!a)return{isOpen:!1,todayHours:"Horário não configurado"};const l=t>=s&&t<=a,d=`${s.substring(0,5)} - ${a.substring(0,5)}`;return{isOpen:l,todayHours:d}},Sr=({restaurant:r,hours:o})=>{const{isOpen:t,todayHours:n}=ye(o),s=[r.street,r.number,r.neighborhood,r.city,r.zip_code].filter(Boolean).join(", ");return e.jsxs("div",{className:"space-y-3 text-center",children:[s&&e.jsxs("div",{className:"flex items-center justify-center text-sm text-muted-foreground",children:[e.jsx(rr,{className:"h-4 w-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate max-w-full",children:s})]}),e.jsxs("div",{className:"flex items-center justify-center text-sm font-medium",children:[e.jsxs("div",{className:P("flex items-center gap-1 px-3 py-1 rounded-full",t?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"),children:[t?e.jsx(tr,{className:"h-4 w-4"}):e.jsx(sr,{className:"h-4 w-4"}),e.jsx("span",{children:t?"Aberto Agora":"Fechado"})]}),e.jsxs("div",{className:"ml-4 flex items-center text-muted-foreground",children:[e.jsx(we,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:n})]})]})]})},yr=()=>e.jsxs(te,{variant:"destructive",className:"mb-8",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(se,{className:"font-bold",children:"Loja Fechada no Momento"}),e.jsx(oe,{children:"Não é possível adicionar itens ao carrinho ou fazer pedidos fora do nosso horário de funcionamento."})]}),Nr=({onClick:r})=>{const{totalItems:o,subtotal:t}=F();return o===0?null:e.jsxs($e,{children:[e.jsx(Qe,{asChild:!0,children:e.jsxs(S,{size:"lg",className:"relative h-14 w-14 rounded-full shadow-lg",onClick:r,children:[e.jsx(U,{className:"h-6 w-6"}),e.jsx(ve,{variant:"destructive",className:"absolute -top-1 -right-1 px-2 py-1 text-xs rounded-full",children:o})]})}),e.jsxs(Ge,{children:[e.jsxs("p",{children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Clique para ver seu carrinho"})]})]})};function Cr(r,o){return i.useReducer((t,n)=>o[t][n]??t,r)}var Q="ScrollArea",[Ne,pt]=Ke(Q),[_r,j]=Ne(Q),Ce=i.forwardRef((r,o)=>{const{__scopeScrollArea:t,type:n="hover",dir:s,scrollHideDelay:a=600,...l}=r,[d,c]=i.useState(null),[m,u]=i.useState(null),[f,h]=i.useState(null),[p,g]=i.useState(null),[E,N]=i.useState(null),[C,T]=i.useState(0),[_,A]=i.useState(0),[I,v]=i.useState(!1),[k,b]=i.useState(!1),x=B(o,R=>c(R)),w=We(s);return e.jsx(_r,{scope:t,type:n,dir:w,scrollHideDelay:a,scrollArea:d,viewport:m,onViewportChange:u,content:f,onContentChange:h,scrollbarX:p,onScrollbarXChange:g,scrollbarXEnabled:I,onScrollbarXEnabledChange:v,scrollbarY:E,onScrollbarYChange:N,scrollbarYEnabled:k,onScrollbarYEnabledChange:b,onCornerWidthChange:T,onCornerHeightChange:A,children:e.jsx(H.div,{dir:w,...l,ref:x,style:{position:"relative","--radix-scroll-area-corner-width":C+"px","--radix-scroll-area-corner-height":_+"px",...r.style}})})});Ce.displayName=Q;var _e="ScrollAreaViewport",Pe=i.forwardRef((r,o)=>{const{__scopeScrollArea:t,children:n,nonce:s,...a}=r,l=j(_e,t),d=i.useRef(null),c=B(o,d,l.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),e.jsx(H.div,{"data-radix-scroll-area-viewport":"",...a,ref:c,style:{overflowX:l.scrollbarXEnabled?"scroll":"hidden",overflowY:l.scrollbarYEnabled?"scroll":"hidden",...r.style},children:e.jsx("div",{ref:l.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});Pe.displayName=_e;var y="ScrollAreaScrollbar",G=i.forwardRef((r,o)=>{const{forceMount:t,...n}=r,s=j(y,r.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:l}=s,d=r.orientation==="horizontal";return i.useEffect(()=>(d?a(!0):l(!0),()=>{d?a(!1):l(!1)}),[d,a,l]),s.type==="hover"?e.jsx(Pr,{...n,ref:o,forceMount:t}):s.type==="scroll"?e.jsx(Rr,{...n,ref:o,forceMount:t}):s.type==="auto"?e.jsx(Re,{...n,ref:o,forceMount:t}):s.type==="always"?e.jsx(K,{...n,ref:o}):null});G.displayName=y;var Pr=i.forwardRef((r,o)=>{const{forceMount:t,...n}=r,s=j(y,r.__scopeScrollArea),[a,l]=i.useState(!1);return i.useEffect(()=>{const d=s.scrollArea;let c=0;if(d){const m=()=>{window.clearTimeout(c),l(!0)},u=()=>{c=window.setTimeout(()=>l(!1),s.scrollHideDelay)};return d.addEventListener("pointerenter",m),d.addEventListener("pointerleave",u),()=>{window.clearTimeout(c),d.removeEventListener("pointerenter",m),d.removeEventListener("pointerleave",u)}}},[s.scrollArea,s.scrollHideDelay]),e.jsx(V,{present:t||a,children:e.jsx(Re,{"data-state":a?"visible":"hidden",...n,ref:o})})}),Rr=i.forwardRef((r,o)=>{const{forceMount:t,...n}=r,s=j(y,r.__scopeScrollArea),a=r.orientation==="horizontal",l=Y(()=>c("SCROLL_END"),100),[d,c]=Cr("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return i.useEffect(()=>{if(d==="idle"){const m=window.setTimeout(()=>c("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(m)}},[d,s.scrollHideDelay,c]),i.useEffect(()=>{const m=s.viewport,u=a?"scrollLeft":"scrollTop";if(m){let f=m[u];const h=()=>{const p=m[u];f!==p&&(c("SCROLL"),l()),f=p};return m.addEventListener("scroll",h),()=>m.removeEventListener("scroll",h)}},[s.viewport,a,c,l]),e.jsx(V,{present:t||d!=="hidden",children:e.jsx(K,{"data-state":d==="hidden"?"hidden":"visible",...n,ref:o,onPointerEnter:D(r.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:D(r.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),Re=i.forwardRef((r,o)=>{const t=j(y,r.__scopeScrollArea),{forceMount:n,...s}=r,[a,l]=i.useState(!1),d=r.orientation==="horizontal",c=Y(()=>{if(t.viewport){const m=t.viewport.offsetWidth<t.viewport.scrollWidth,u=t.viewport.offsetHeight<t.viewport.scrollHeight;l(d?m:u)}},10);return M(t.viewport,c),M(t.content,c),e.jsx(V,{present:n||a,children:e.jsx(K,{"data-state":a?"visible":"hidden",...s,ref:o})})}),K=i.forwardRef((r,o)=>{const{orientation:t="vertical",...n}=r,s=j(y,r.__scopeScrollArea),a=i.useRef(null),l=i.useRef(0),[d,c]=i.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),m=De(d.viewport,d.content),u={...n,sizes:d,onSizesChange:c,hasThumb:m>0&&m<1,onThumbChange:h=>a.current=h,onThumbPointerUp:()=>l.current=0,onThumbPointerDown:h=>l.current=h};function f(h,p){return Ir(h,l.current,d,p)}return t==="horizontal"?e.jsx(Er,{...u,ref:o,onThumbPositionChange:()=>{if(s.viewport&&a.current){const h=s.viewport.scrollLeft,p=re(h,d,s.dir);a.current.style.transform=`translate3d(${p}px, 0, 0)`}},onWheelScroll:h=>{s.viewport&&(s.viewport.scrollLeft=h)},onDragScroll:h=>{s.viewport&&(s.viewport.scrollLeft=f(h,s.dir))}}):t==="vertical"?e.jsx(Tr,{...u,ref:o,onThumbPositionChange:()=>{if(s.viewport&&a.current){const h=s.viewport.scrollTop,p=re(h,d);a.current.style.transform=`translate3d(0, ${p}px, 0)`}},onWheelScroll:h=>{s.viewport&&(s.viewport.scrollTop=h)},onDragScroll:h=>{s.viewport&&(s.viewport.scrollTop=f(h))}}):null}),Er=i.forwardRef((r,o)=>{const{sizes:t,onSizesChange:n,...s}=r,a=j(y,r.__scopeScrollArea),[l,d]=i.useState(),c=i.useRef(null),m=B(o,c,a.onScrollbarXChange);return i.useEffect(()=>{c.current&&d(getComputedStyle(c.current))},[c]),e.jsx(Te,{"data-orientation":"horizontal",...s,ref:m,sizes:t,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":X(t)+"px",...r.style},onThumbPointerDown:u=>r.onThumbPointerDown(u.x),onDragScroll:u=>r.onDragScroll(u.x),onWheelScroll:(u,f)=>{if(a.viewport){const h=a.viewport.scrollLeft+u.deltaX;r.onWheelScroll(h),ke(h,f)&&u.preventDefault()}},onResize:()=>{c.current&&a.viewport&&l&&n({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:q(l.paddingLeft),paddingEnd:q(l.paddingRight)}})}})}),Tr=i.forwardRef((r,o)=>{const{sizes:t,onSizesChange:n,...s}=r,a=j(y,r.__scopeScrollArea),[l,d]=i.useState(),c=i.useRef(null),m=B(o,c,a.onScrollbarYChange);return i.useEffect(()=>{c.current&&d(getComputedStyle(c.current))},[c]),e.jsx(Te,{"data-orientation":"vertical",...s,ref:m,sizes:t,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":X(t)+"px",...r.style},onThumbPointerDown:u=>r.onThumbPointerDown(u.y),onDragScroll:u=>r.onDragScroll(u.y),onWheelScroll:(u,f)=>{if(a.viewport){const h=a.viewport.scrollTop+u.deltaY;r.onWheelScroll(h),ke(h,f)&&u.preventDefault()}},onResize:()=>{c.current&&a.viewport&&l&&n({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:q(l.paddingTop),paddingEnd:q(l.paddingBottom)}})}})}),[Ar,Ee]=Ne(y),Te=i.forwardRef((r,o)=>{const{__scopeScrollArea:t,sizes:n,hasThumb:s,onThumbChange:a,onThumbPointerUp:l,onThumbPointerDown:d,onThumbPositionChange:c,onDragScroll:m,onWheelScroll:u,onResize:f,...h}=r,p=j(y,t),[g,E]=i.useState(null),N=B(o,x=>E(x)),C=i.useRef(null),T=i.useRef(""),_=p.viewport,A=n.content-n.viewport,I=L(u),v=L(c),k=Y(f,10);function b(x){if(C.current){const w=x.clientX-C.current.left,R=x.clientY-C.current.top;m({x:w,y:R})}}return i.useEffect(()=>{const x=w=>{const R=w.target;(g==null?void 0:g.contains(R))&&I(w,A)};return document.addEventListener("wheel",x,{passive:!1}),()=>document.removeEventListener("wheel",x,{passive:!1})},[_,g,A,I]),i.useEffect(v,[n,v]),M(g,k),M(p.content,k),e.jsx(Ar,{scope:t,scrollbar:g,hasThumb:s,onThumbChange:L(a),onThumbPointerUp:L(l),onThumbPositionChange:v,onThumbPointerDown:L(d),children:e.jsx(H.div,{...h,ref:N,style:{position:"absolute",...h.style},onPointerDown:D(r.onPointerDown,x=>{x.button===0&&(x.target.setPointerCapture(x.pointerId),C.current=g.getBoundingClientRect(),T.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),b(x))}),onPointerMove:D(r.onPointerMove,b),onPointerUp:D(r.onPointerUp,x=>{const w=x.target;w.hasPointerCapture(x.pointerId)&&w.releasePointerCapture(x.pointerId),document.body.style.webkitUserSelect=T.current,p.viewport&&(p.viewport.style.scrollBehavior=""),C.current=null})})})}),W="ScrollAreaThumb",Ae=i.forwardRef((r,o)=>{const{forceMount:t,...n}=r,s=Ee(W,r.__scopeScrollArea);return e.jsx(V,{present:t||s.hasThumb,children:e.jsx(Lr,{ref:o,...n})})}),Lr=i.forwardRef((r,o)=>{const{__scopeScrollArea:t,style:n,...s}=r,a=j(W,t),l=Ee(W,t),{onThumbPositionChange:d}=l,c=B(o,f=>l.onThumbChange(f)),m=i.useRef(void 0),u=Y(()=>{m.current&&(m.current(),m.current=void 0)},100);return i.useEffect(()=>{const f=a.viewport;if(f){const h=()=>{if(u(),!m.current){const p=kr(f,d);m.current=p,d()}};return d(),f.addEventListener("scroll",h),()=>f.removeEventListener("scroll",h)}},[a.viewport,u,d]),e.jsx(H.div,{"data-state":l.hasThumb?"visible":"hidden",...s,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:D(r.onPointerDownCapture,f=>{const p=f.target.getBoundingClientRect(),g=f.clientX-p.left,E=f.clientY-p.top;l.onThumbPointerDown({x:g,y:E})}),onPointerUp:D(r.onPointerUp,l.onThumbPointerUp)})});Ae.displayName=W;var J="ScrollAreaCorner",Le=i.forwardRef((r,o)=>{const t=j(J,r.__scopeScrollArea),n=!!(t.scrollbarX&&t.scrollbarY);return t.type!=="scroll"&&n?e.jsx(Dr,{...r,ref:o}):null});Le.displayName=J;var Dr=i.forwardRef((r,o)=>{const{__scopeScrollArea:t,...n}=r,s=j(J,t),[a,l]=i.useState(0),[d,c]=i.useState(0),m=!!(a&&d);return M(s.scrollbarX,()=>{var f;const u=((f=s.scrollbarX)==null?void 0:f.offsetHeight)||0;s.onCornerHeightChange(u),c(u)}),M(s.scrollbarY,()=>{var f;const u=((f=s.scrollbarY)==null?void 0:f.offsetWidth)||0;s.onCornerWidthChange(u),l(u)}),m?e.jsx(H.div,{...n,ref:o,style:{width:a,height:d,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...r.style}}):null});function q(r){return r?parseInt(r,10):0}function De(r,o){const t=r/o;return isNaN(t)?0:t}function X(r){const o=De(r.viewport,r.content),t=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,n=(r.scrollbar.size-t)*o;return Math.max(n,18)}function Ir(r,o,t,n="ltr"){const s=X(t),a=s/2,l=o||a,d=s-l,c=t.scrollbar.paddingStart+l,m=t.scrollbar.size-t.scrollbar.paddingEnd-d,u=t.content-t.viewport,f=n==="ltr"?[0,u]:[u*-1,0];return Ie([c,m],f)(r)}function re(r,o,t="ltr"){const n=X(o),s=o.scrollbar.paddingStart+o.scrollbar.paddingEnd,a=o.scrollbar.size-s,l=o.content-o.viewport,d=a-n,c=t==="ltr"?[0,l]:[l*-1,0],m=er(r,c);return Ie([0,l],[0,d])(m)}function Ie(r,o){return t=>{if(r[0]===r[1]||o[0]===o[1])return o[0];const n=(o[1]-o[0])/(r[1]-r[0]);return o[0]+n*(t-r[0])}}function ke(r,o){return r>0&&r<o}var kr=(r,o=()=>{})=>{let t={left:r.scrollLeft,top:r.scrollTop},n=0;return function s(){const a={left:r.scrollLeft,top:r.scrollTop},l=t.left!==a.left,d=t.top!==a.top;(l||d)&&o(),t=a,n=window.requestAnimationFrame(s)}(),()=>window.cancelAnimationFrame(n)};function Y(r,o){const t=L(r),n=i.useRef(0);return i.useEffect(()=>()=>window.clearTimeout(n.current),[]),i.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(t,o)},[t,o])}function M(r,o){const t=L(o);Je(()=>{let n=0;if(r){const s=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(t)});return s.observe(r),()=>{window.cancelAnimationFrame(n),s.unobserve(r)}}},[r,t])}var Oe=Ce,Or=Pe,Mr=Le;const Me=i.forwardRef(({className:r,children:o,...t},n)=>e.jsxs(Oe,{ref:n,className:P("relative overflow-hidden",r),...t,children:[e.jsx(Or,{className:"h-full w-full rounded-[inherit]",children:o}),e.jsx(Be,{}),e.jsx(Mr,{})]}));Me.displayName=Oe.displayName;const Be=i.forwardRef(({className:r,orientation:o="vertical",...t},n)=>e.jsx(G,{ref:n,orientation:o,className:P("flex touch-none select-none transition-colors",o==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",o==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...t,children:e.jsx(Ae,{className:"relative flex-1 rounded-full bg-border"})}));Be.displayName=G.displayName;const Br=({item:r})=>{const{updateQuantity:o,removeItem:t}=F();return e.jsxs("div",{className:"flex items-center gap-4 py-3",children:[e.jsx($,{src:r.image_url||"/placeholder.svg",alt:r.name,className:"w-16 h-16 rounded-md object-cover"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-semibold leading-tight",children:r.name}),e.jsx("p",{className:"text-sm text-primary font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.price)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!r.is_price_by_weight&&e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>o(r.id,r.quantity-1),children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-6 text-center font-bold",children:r.quantity}),e.jsx(S,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>o(r.id,r.quantity+1),children:e.jsx(pe,{className:"h-4 w-4"})})]}),e.jsx(S,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive hover:text-destructive",onClick:()=>t(r.id),children:e.jsx(ur,{className:"h-4 w-4"})})]})]})},zr=({isOpen:r,onOpenChange:o})=>{const{items:t,subtotal:n,total:s,clearCart:a}=F();return e.jsx(or,{open:r,onOpenChange:o,children:e.jsxs(nr,{className:"flex flex-col",children:[e.jsxs(ar,{children:[e.jsx(lr,{className:"text-2xl",children:"Seu Carrinho"}),e.jsx(ir,{className:"sr-only",children:"Lista de itens no seu carrinho e resumo do pedido."})]}),e.jsx(dr,{}),t.length===0?e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-center",children:[e.jsx(U,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Seu carrinho está vazio"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Adicione produtos do cardápio para começar."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"flex-grow -mx-6 px-6",children:e.jsx("div",{className:"divide-y",children:t.map(l=>e.jsx(Br,{item:l},l.id))})}),e.jsxs("div",{className:"border-t pt-4 mt-4 space-y-4",children:[e.jsxs("div",{className:"w-full space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-base",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal:"}),e.jsx("span",{className:"font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s)})]})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(S,{variant:"outline",onClick:a,className:"flex-1",children:"Limpar Carrinho"}),e.jsx(cr,{asChild:!0,children:e.jsx(ze,{to:"/pre-checkout",className:"flex-1",children:e.jsx(S,{className:"w-full",children:"Finalizar Pedido"})})})]})]})]})]})})},Fr=async()=>{const{data:r,error:o}=await O.from("restaurants").select("*").eq("is_active",!0).limit(1).single();if(o)throw new Error(`Erro ao buscar restaurante: ${o.message}`);if(!r)throw new Error("Nenhum restaurante ativo encontrado.");const t=r.id,[n,s,a]=await Promise.all([O.from("categories").select("*").eq("restaurant_id",t).eq("is_active",!0).order("display_order",{ascending:!0}),O.from("products").select("*").eq("restaurant_id",t),O.from("business_hours").select("*").eq("restaurant_id",t)]);if(n.error)throw new Error(`Erro ao buscar categorias: ${n.error.message}`);if(s.error)throw new Error(`Erro ao buscar produtos: ${s.error.message}`);if(a.error)throw new Error(`Erro ao buscar horários: ${a.error.message}`);const l=(n.data||[]).map(d=>({...d,products:(s.data||[]).filter(c=>c.category_id===d.id)})).filter(d=>d.products.length>0);return{restaurant:r,menu:l,hours:a.data}},Hr=async()=>{const{data:{user:r}}=await O.auth.getUser();if(!r)return null;const{data:o,error:t}=await O.from("customers").select("*").eq("user_id",r.id).limit(1).single();if(t&&t.code!=="PGRST116")return console.warn("Erro ao buscar dados do cliente (pode ser normal se o cliente for novo):",t.message),null;if(o)return o;const n=r.user_metadata;return{id:r.id,user_id:r.id,name:n.full_name||"",phone:n.phone||"",email:r.email||"",address:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),latitude:null,longitude:null,cpf_cnpj:null}},bt=()=>{const{data:r,isLoading:o,isError:t,error:n}=Z({queryKey:["menuData"],queryFn:Fr,staleTime:3e5,gcTime:6e5}),{data:s,isLoading:a}=Z({queryKey:["menuCustomerData"],queryFn:Hr,staleTime:0}),[l,d]=i.useState(null),[c,m]=i.useState(!1),[u,f]=i.useState(!1),[h,p]=i.useState(!1),[g,E]=i.useState(""),N=vr(g,300),[C,T]=i.useState(!1),{isOpen:_}=i.useMemo(()=>r!=null&&r.hours?ye(r.hours):{isOpen:!1,todayHours:"Carregando..."},[r==null?void 0:r.hours]),A=i.useMemo(()=>r!=null&&r.menu?N?r.menu.map(b=>({...b,products:b.products.filter(x=>x.name.toLowerCase().includes(N.toLowerCase())||x.description&&x.description.toLowerCase().includes(N.toLowerCase()))})).filter(b=>b.products.length>0):r.menu:[],[r==null?void 0:r.menu,N]),I=i.useCallback(b=>{if(!_){ee.error("A loja está fechada.",{description:"Não é possível adicionar itens ao carrinho no momento."});return}if(!b.is_available){ee.info("Produto indisponível",{description:"Este item não está disponível no momento."});return}d(b),b.is_price_by_weight?f(!0):m(!0)},[_]);if(o)return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-5xl",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx(z,{className:"h-24 w-24 rounded-full mx-auto mb-4"}),e.jsx(z,{className:"h-10 w-1/2 mx-auto mb-2"}),e.jsx(z,{className:"h-6 w-3/4 mx-auto"})]}),e.jsx("div",{className:"space-y-10",children:[...Array(3)].map((b,x)=>e.jsxs("div",{children:[e.jsx(z,{className:"h-9 w-1/3 mb-6"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(3)].map((w,R)=>e.jsx(ge,{className:"p-4",children:e.jsx(z,{className:"h-48 w-full"})},R))})]},x))})]});if(t)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs(te,{variant:"destructive",children:[e.jsx(hr,{className:"h-4 w-4"}),e.jsx(se,{children:"Erro ao carregar o cardápio"}),e.jsx(oe,{children:n instanceof Error?n.message:"Ocorreu um erro desconhecido."})]})});const{restaurant:v,hours:k}=r;return e.jsxs(e.Fragment,{children:[e.jsx(pr,{product:l,isOpen:c,onClose:()=>m(!1)}),e.jsx(gr,{product:l,isOpen:u,onClose:()=>f(!1)}),e.jsx(zr,{isOpen:h,onOpenChange:p}),e.jsx(mr,{isOpen:C,onClose:()=>T(!1),customer:s}),e.jsxs("div",{className:P("container mx-auto px-4 py-8 max-w-5xl"),children:[e.jsxs("header",{className:"text-center mb-8 relative",children:[v.logo_url&&e.jsx("div",{className:"w-20 h-20 mx-auto rounded-full mb-4 overflow-hidden border-4 border-card shadow-lg",children:e.jsx($,{src:v.logo_url,alt:v.name,className:"w-full h-full object-cover"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight mb-2",children:v.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:v.description}),e.jsx(Sr,{restaurant:v,hours:k})]}),!_&&e.jsx(yr,{}),e.jsx("div",{className:"mb-8 sticky top-0 z-30 bg-background pt-4 -mt-4",children:e.jsx(be,{type:"text",placeholder:"Buscar produtos...",className:"w-full p-3 h-10 text-base",value:g,onChange:b=>E(b.target.value)})}),e.jsx("main",{className:P(!_&&"opacity-50 pointer-events-none"),children:A.length===0?e.jsx("div",{className:"text-center py-16",children:e.jsx("p",{className:"text-muted-foreground text-lg",children:N?"Nenhum produto encontrado.":"Nenhum item no cardápio no momento."})}):e.jsx("div",{className:"space-y-10",children:A.map(b=>e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold border-b-2 border-primary pb-2 mb-6",children:b.name}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:b.products.map(x=>e.jsx(Se,{id:x.id,name:x.name,description:x.description,price:x.price,image_url:x.image_url,is_price_by_weight:x.is_price_by_weight,is_available:x.is_available,onClick:()=>I(x)},x.id))})]},b.id))})})]}),s&&e.jsx("div",{className:"fixed top-4 left-4 z-50",children:e.jsx(S,{variant:"outline",size:"icon",onClick:()=>T(!0),"aria-label":"Editar Perfil",className:"h-14 w-14 rounded-full shadow-lg bg-card",children:e.jsx(fr,{className:"h-6 w-6"})})}),_&&e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsx(Nr,{onClick:()=>p(!0)})})]})};export{bt as default};
