const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./MapComponent-MvrEqYBi.js","./tanstack-C7aOFagJ.js","./vendor-DjsPZZVP.js","./index-CxvVwsK_.js","./supabase-BAEEEeUB.js","./index-B6Dhhr1U.css"])))=>i.map(i=>d[i]);
import{j as e,a as se,u as oe,b as ae}from"./tanstack-C7aOFagJ.js";import{c as re,d as te,j as t,C as P,e as q,f as A,W as ne,b as B,B as M,L as U,a6 as le,o as ie,l as x,K as $,n as ce,J as k,m as D,p as de,F as ue,x as i,y as c,z as d,A as u,I as p,E as m,T as me,h as he,t as pe,s as K}from"./index-CxvVwsK_.js";import{S as xe}from"./switch-DVWUEpK8.js";import{S as je}from"./skeleton-CPKtuGSQ.js";import{r as n,j as ge}from"./vendor-DjsPZZVP.js";import{Z as I}from"./ZipCodeInput-CXlnupx8.js";import{_ as fe}from"./supabase-BAEEEeUB.js";import"./index-C3WaO5Hu.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=re("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),ve=n.lazy(()=>fe(()=>import("./MapComponent-MvrEqYBi.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(l=>({default:l.default}))),ye=l=>e.jsx(n.Suspense,{fallback:e.jsx(te,{}),children:e.jsx(ve,{...l})}),Ne=({mapKey:l,markerPosition:r,onLocationChange:g,updateAddressFields:N,restaurant:h})=>{const[C,w]=n.useState(!1),S=n.useCallback(async()=>{w(!0);const V=t.loading("Buscando endereço a partir do mapa..."),[a,_]=r;try{const v=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${a}&lon=${_}&zoom=18&addressdetails=1`,z=await fetch(v);if(!z.ok)throw new Error("Falha na geocodificação reversa.");const o=await z.json();o.address?(N(o.address),t.success("Endereço atualizado com base na localização do mapa!")):t.warning("Não foi possível encontrar um endereço detalhado para esta localização.")}catch(v){t.error(`Erro na busca reversa: ${v.message}`)}finally{w(!1),t.dismiss(V)}},[r,N]),F=n.useMemo(()=>[h.street,h.number,h.neighborhood,h.city,h.zip_code].filter(Boolean).join(", "),[h]);return e.jsxs(P,{className:"mt-6",children:[e.jsx(q,{children:e.jsxs(A,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ne,{className:"h-5 w-5 text-primary"}),"Localização no Mapa"]})}),e.jsxs(B,{className:"space-y-4",children:[e.jsx("div",{className:"h-80 w-full rounded-lg overflow-hidden border",children:e.jsx(ye,{center:r,markerPosition:r,onMarkerDragEnd:g,zoom:15},l)}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-muted-foreground max-w-[70%] truncate",children:["Endereço atual: ",F||"N/A"]}),e.jsxs(M,{type:"button",variant:"outline",onClick:S,disabled:C,children:[C?e.jsx(U,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(le,{className:"h-4 w-4 mr-2"}),"Atualizar Endereço"]})]})]})]})},Ce=n.memo(Ne),we=ie({name:x().min(1,"O nome do restaurante é obrigatório."),description:x().optional(),logo_url:x().url("URL do logo inválida.").optional().or($("")),street:x().optional(),number:x().optional(),neighborhood:x().optional(),city:x().optional(),zip_code:x().optional(),phone:x().optional(),email:x().email("Email inválido.").optional().or($("")),is_active:ce().default(!0),latitude:k(l=>String(l).replace(",","."),D.number({invalid_type_error:"Latitude deve ser um número."}).optional().nullable()),longitude:k(l=>String(l).replace(",","."),D.number({invalid_type_error:"Longitude deve ser um número."}).optional().nullable())}),_e=async l=>{const{data:r,error:g}=await K.from("restaurants").select("*").eq("id",l).single();if(g)throw new Error(`Erro ao buscar dados do restaurante: ${g.message}`);if(!r)throw new Error("Nenhum restaurante encontrado.");return r},$e=()=>{const l=se(),{userRestaurantId:r}=ge(),[g,N]=n.useState(""),[h,C]=n.useState(""),[w,S]=n.useState(!1),[F,V]=n.useState(!1),{data:a,isLoading:_,isError:v,error:z}=oe({queryKey:["restaurantSettings",r],queryFn:()=>_e(r),enabled:!!r,staleTime:1e3*60*5}),o=de({resolver:pe(we),defaultValues:{name:"",description:"",logo_url:"",street:"",number:"",neighborhood:"",city:"",zip_code:"",phone:"",email:"",is_active:!0,latitude:null,longitude:null},mode:"onBlur"});n.useEffect(()=>{a&&(o.reset({name:a.name||"",description:a.description||"",logo_url:a.logo_url||"",street:a.street||"",number:a.number||"",neighborhood:a.neighborhood||"",city:a.city||"",zip_code:a.zip_code||"",phone:a.phone||"",email:a.email||"",is_active:a.is_active??!0,latitude:a.latitude??null,longitude:a.longitude??null}),a.latitude&&a.longitude&&V(!0))},[a,o.reset]);const f=o.watch("latitude"),b=o.watch("longitude"),G=[-23.55052,-46.633308],O=n.useMemo(()=>typeof f=="number"&&typeof b=="number"&&!isNaN(f)&&!isNaN(b)?[f,b]:G,[f,b]),Q=n.useCallback(s=>{o.setValue("street",s.road||s.logradouro||"",{shouldValidate:!0}),o.setValue("number",s.house_number||"",{shouldValidate:!0}),o.setValue("neighborhood",s.suburb||s.bairro||"",{shouldValidate:!0}),o.setValue("city",s.city||s.localidade||"",{shouldValidate:!0}),o.setValue("zip_code",s.postcode||s.cep||"",{shouldValidate:!0}),N((s.postcode||s.cep||"").replace(/\D/g,"")),C(s.house_number||"")},[o]),Z=async()=>{const s=o.getValues();s.street,s.number,s.neighborhood,s.city,s.zip_code;const y=g.replace(/\D/g,"");if(y.length!==8||!h){t.warning("Por favor, digite um CEP válido e o número da casa.");return}S(!0);const E=t.loading("Buscando endereço e coordenadas...");try{const L=await fetch(`https://viacep.com.br/ws/${y}/json/`);if(!L.ok)throw new Error("Falha na busca do CEP.");const j=await L.json();if(j.erro){t.error("CEP não encontrado.");return}o.setValue("street",j.logradouro,{shouldValidate:!0}),o.setValue("number",h,{shouldValidate:!0}),o.setValue("neighborhood",j.bairro,{shouldValidate:!0}),o.setValue("city",j.localidade,{shouldValidate:!0}),o.setValue("zip_code",j.cep,{shouldValidate:!0});const W=`${j.logradouro}, ${h}, ${j.localidade}, ${j.uf}`,X=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(W)}`,T=await(await fetch(X)).json();if(T.length>0){const{lat:Y,lon:ee}=T[0];o.setValue("latitude",parseFloat(Y),{shouldValidate:!0}),o.setValue("longitude",parseFloat(ee),{shouldValidate:!0}),V(!0),t.success("Endereço e mapa atualizados com sucesso!")}else t.warning("Endereço encontrado, mas não foi possível obter as coordenadas exatas. Ajuste o pino no mapa manualmente.")}catch(L){t.dismiss(E),t.error(`Erro na busca: ${L.message}`)}finally{S(!1),t.dismiss(E)}},H=n.useCallback((s,y)=>{o.setValue("latitude",s,{shouldValidate:!0}),o.setValue("longitude",y,{shouldValidate:!0})},[o]),R=ae({mutationFn:async s=>{if(!r)throw new Error("ID do restaurante não disponível.");const y={name:s.name,description:s.description,logo_url:s.logo_url,street:s.street,number:s.number,neighborhood:s.neighborhood,city:s.city,zip_code:s.zip_code,phone:s.phone,email:s.email,is_active:s.is_active,latitude:s.latitude,longitude:s.longitude},{error:E}=await K.from("restaurants").update(y).eq("id",r);if(E)throw E},onSuccess:()=>{t.success("Configurações salvas com sucesso!"),l.invalidateQueries({queryKey:["restaurantSettings",r]})},onError:s=>t.error(`Erro ao salvar configurações: ${s.message}`)}),J=n.useMemo(()=>f===null||b===null?"map-settings-null":`map-settings-${f.toFixed(6)}-${b.toFixed(6)}`,[f,b]);return e.jsx("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:e.jsx("div",{className:"max-w-3xl mx-auto space-y-6",children:e.jsxs(P,{children:[e.jsx(q,{children:e.jsx(A,{className:"text-2xl font-bold",children:"Configurações do Restaurante"})}),e.jsxs(B,{children:[_&&e.jsx(je,{className:"h-96 w-full"}),v&&e.jsxs("p",{className:"text-destructive",children:["Erro ao carregar dados: ",z.message]}),!r&&!_&&e.jsx("p",{className:"text-destructive",children:"Erro: ID do restaurante não encontrado."}),a&&!v&&!_&&e.jsx(ue,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(s=>R.mutate(s)),className:"space-y-6",children:[e.jsx(i,{control:o.control,name:"name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Nome do Restaurante *"}),e.jsx(u,{children:e.jsx(p,{...s})}),e.jsx(m,{})]})}),e.jsx(i,{control:o.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Descrição"}),e.jsx(u,{children:e.jsx(me,{...s,rows:3})}),e.jsx(m,{})]})}),e.jsx(i,{control:o.control,name:"logo_url",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"URL do Logo"}),e.jsx(u,{children:e.jsx(p,{...s})}),e.jsx(m,{})]})}),e.jsx("div",{className:"pt-4 border-t mt-6",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Endereço e Localização"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(he,{children:"Buscar Endereço por CEP e Número *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{placeholder:"Digite o CEP",value:g,onChange:s=>N(s.target.value)}),e.jsx(p,{placeholder:"Número",value:h,onChange:s=>C(s.target.value)}),e.jsx(M,{type:"button",onClick:Z,disabled:w,children:w?e.jsx(U,{className:"h-4 w-4 animate-spin"}):e.jsx(be,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Coloque o CEP e nº do estabelecimento e para melhor precisão mova o alfinete no mapa e salve as configurações"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(i,{control:o.control,name:"street",render:({field:s})=>e.jsxs(c,{className:"md:col-span-2",children:[e.jsx(d,{children:"Rua"}),e.jsx(u,{children:e.jsx(p,{...s,disabled:!0})}),e.jsx(m,{})]})}),e.jsx(i,{control:o.control,name:"number",render:({field:s})=>e.jsxs(c,{className:"md:col-span-1",children:[e.jsx(d,{children:"Número"}),e.jsx(u,{children:e.jsx(p,{...s,disabled:!0})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:o.control,name:"neighborhood",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Bairro"}),e.jsx(u,{children:e.jsx(p,{...s,disabled:!0})}),e.jsx(m,{})]})}),e.jsx(i,{control:o.control,name:"city",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Cidade"}),e.jsx(u,{children:e.jsx(p,{...s,disabled:!0})}),e.jsx(m,{})]})})]}),e.jsx(i,{control:o.control,name:"zip_code",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"CEP"}),e.jsx(u,{children:e.jsx(I,{...s,disabled:!0})}),e.jsx(m,{})]})}),e.jsx("div",{className:"pt-4 border-t",children:F&&e.jsx(Ce,{mapKey:J,markerPosition:O,onLocationChange:H,updateAddressFields:Q,restaurant:a})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:o.control,name:"latitude",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Latitude"}),e.jsx(u,{children:e.jsx(p,{...s,placeholder:"-22.7627908",value:s.value??""})}),e.jsx(m,{})]})}),e.jsx(i,{control:o.control,name:"longitude",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Longitude"}),e.jsx(u,{children:e.jsx(p,{...s,placeholder:"-47.408315",value:s.value??""})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:o.control,name:"phone",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Telefone"}),e.jsx(u,{children:e.jsx(p,{...s})}),e.jsx(m,{})]})}),e.jsx(i,{control:o.control,name:"email",render:({field:s})=>e.jsxs(c,{children:[e.jsx(d,{children:"Email"}),e.jsx(u,{children:e.jsx(p,{...s})}),e.jsx(m,{})]})})]}),e.jsx(i,{control:o.control,name:"is_active",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(d,{className:"font-normal",children:"Restaurante Ativo"}),e.jsx(u,{children:e.jsx(xe,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(M,{type:"submit",className:"w-full h-12 text-lg",disabled:R.isPending||!r,children:R.isPending?"Salvando...":"Salvar Configurações"})]})})]})]})})})};export{$e as default};
