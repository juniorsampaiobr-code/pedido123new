import{a as T,j as e}from"./tanstack-C7aOFagJ.js";import{h as B,i as K,r as n}from"./vendor-DjsPZZVP.js";import{L as _}from"./Logo-DaDZdV0w.js";import{s as x,d as H,C as J,e as V,f as W,g as $,b as G,h as u,I as N,P as M,i as X,B as E,L as Y,j as s}from"./index-CgbsAOIZ.js";import{u as Z}from"./use-active-restaurant-id-BF5JFF_D.js";import"./supabase-BAEEEeUB.js";const q=o=>o.replace(/\D/g,""),U=o=>o.replace(/\D/g,""),ie=()=>{var F;const o=B(),d=K(),v=T(),[y,m]=n.useState(!1),[c,D]=n.useState(!1),[p,k]=n.useState(""),[h,A]=n.useState(""),[j,R]=n.useState(""),[S,ee]=n.useState(""),[C,z]=n.useState(""),[ae,b]=n.useState(null),[te,w]=n.useState(null),{data:I,isLoading:l}=Z(),f=(F=d.state)==null?void 0:F.restaurantId,P=(t,r)=>{var g;const a=(g=d.state)==null?void 0:g.from,i=r||I;a==="/checkout"?(console.log("User logged in, redirecting to checkout."),o("/checkout",{replace:!0})):i?(console.log("User logged in, redirecting to specific menu:",i),o(`/menu/${i}`,{replace:!0})):(console.log("User logged in, no active restaurant found, redirecting to index."),o("/",{replace:!0}))};n.useEffect(()=>{if(l)return;const{data:{subscription:t}}=x.auth.onAuthStateChange((r,a)=>{w(a),b((a==null?void 0:a.user)??null),a!=null&&a.user&&P(a.user,f)});return x.auth.getSession().then(({data:{session:r}})=>{w(r),b((r==null?void 0:r.user)??null),r!=null&&r.user&&P(r.user,f)}),()=>t.unsubscribe()},[o,d.state,l,I,f]);const O=()=>j.trim()?q(S).length!==11?(s.error("O Telefone deve conter 11 dígitos (DDD + 9 dígitos)."),!1):U(C).length!==11?(s.error("O CPF é obrigatório e deve conter 11 dígitos."),!1):p.trim()?h.length<6?(s.error("A Senha deve ter pelo menos 6 caracteres."),!1):!0:(s.error("O Email é obrigatório."),!1):(s.error("O Nome Completo é obrigatório."),!1),Q=async t=>{var r;if(t.preventDefault(),m(!0),((r=d.state)==null?void 0:r.from)==="/checkout"&&!f){s.error("Erro: ID do restaurante de origem não encontrado."),m(!1);return}try{if(c){if(!O()){m(!1);return}const a=q(S),i=U(C),{data:g,error:L}=await x.auth.signUp({email:p,password:h,options:{data:{full_name:j,phone:a,cpf_cnpj:i}}});if(L)throw L;g.session?(s.success("Conta criada e login efetuado com sucesso!"),v.invalidateQueries({queryKey:["authStatus"]})):s.success("Conta criada! Verifique seu email para confirmar.")}else{const{error:a}=await x.auth.signInWithPassword({email:p,password:h});if(a)throw a;s.success("Login realizado com sucesso!"),v.invalidateQueries({queryKey:["authStatus"]})}}catch(a){a.message.includes("Email not confirmed")?s.error("Por favor, verifique seu e-mail para confirmar sua conta antes de fazer login."):s.error(a.message||"Erro ao processar autenticação")}finally{m(!1)}};return l?e.jsx(H,{}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(_,{className:"justify-center mb-4"})}),e.jsxs(J,{className:"shadow-xl border-2",children:[e.jsxs(V,{className:"space-y-1",children:[e.jsx(W,{className:"text-2xl font-bold text-center",children:c?"Crie sua conta":"Acesse sua conta"}),e.jsx($,{className:"text-center",children:c?"Preencha os campos para começar":"Utilize seu email e senha para fazer login"})]}),e.jsxs(G,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"fullName",children:"Nome Completo *"}),e.jsx(N,{id:"fullName",type:"text",placeholder:"Seu nome completo",value:j,onChange:t=>R(t.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"phone",children:"Telefone *"}),e.jsx(Controller,{name:"phone",control:form.control,render:({field:t})=>e.jsx(M,{id:"phone",...t})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formato: (99) 99999-9999"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"cpfCnpj",children:"CPF *"}),e.jsx(X,{id:"cpfCnpj",value:C,onChange:t=>z(t.target.value),required:!0,className:"h-12"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Apenas CPF (11 dígitos) é obrigatório no cadastro."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"email",children:"Email *"}),e.jsx(N,{id:"email",type:"email",placeholder:"seu@email.com",value:p,onChange:t=>k(t.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"password",children:"Senha *"}),e.jsx(N,{id:"password",type:"password",placeholder:"••••••••",value:h,onChange:t=>A(t.target.value),required:!0,className:"h-12"})]}),e.jsx(E,{type:"submit",className:"w-full",size:"lg",disabled:y||l,children:y||l?e.jsx(Y,{className:"h-4 w-4 animate-spin mr-2"}):c?"Criar conta":"Entrar"})]}),e.jsx("div",{className:"text-center",children:e.jsx(E,{variant:"link",type:"button",className:"p-0 h-auto",onClick:()=>D(!c),children:c?"Já tem uma conta? Faça login":"Não tem uma conta? Crie uma agora"})})]})]})]})})};export{ie as default};
