import{j as e,b as F,u as $,c as T}from"./tanstack-BMR5QDBT.js";import{o as H,s as y,n as M,b as D,a as q,u as I,d as A,t as Q}from"./types-tCkPXq4V.js";import{I as R,a as B,C as L,d as K,e as O,b as P,B as V,s as N,u as E}from"./index-CXkxE4U2.js";import{S as W}from"./switch-Dwald8Ak.js";import{F as Y,a as j,b as g,d as w,c as v,e as S}from"./form-DX60Du-8.js";import{R as z,j as G,r as J}from"./vendor-DjsPZZVP.js";import{S as h}from"./skeleton-B0VIoBpm.js";import{S as U}from"./separator-D-8Kn7JI.js";import"./supabase-BAEEEeUB.js";import"./index-C3WaO5Hu.js";import"./label-DwI0hIrK.js";const X=r=>{let a=r.replace(/\D/g,"");return a.length>4&&(a=a.slice(0,4)),a.length>2&&(a=`${a.slice(0,2)}:${a.slice(2)}`),a},k=z.forwardRef(({className:r,value:a,onChange:i,...x},f)=>{const m=o=>{const p=o.target.value,d=X(p),b={...o,target:{...o.target,value:d}};i(b)};return e.jsx(R,{ref:f,type:"tel",className:B("w-24 text-center",r),placeholder:"HH:MM",value:a,onChange:m,maxLength:5,...x})});k.displayName="TimeInput";const _=[{day_of_week:0,label:"Domingo"},{day_of_week:1,label:"Segunda-feira"},{day_of_week:2,label:"Terça-feira"},{day_of_week:3,label:"Quarta-feira"},{day_of_week:4,label:"Quinta-feira"},{day_of_week:5,label:"Sexta-feira"},{day_of_week:6,label:"Sábado"}],Z=H({id:y().optional(),day_of_week:M().min(0).max(6),is_open:D().default(!0),open_time:y().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Formato de hora inválido (HH:MM)").optional().nullable(),close_time:y().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Formato de hora inválido (HH:MM)").optional().nullable()}),ee=H({hours:q(Z).refine(r=>r.every(a=>!a.is_open||a.open_time&&a.close_time),{message:"Horário de abertura e fechamento são obrigatórios para dias abertos.",path:["hours"]})}),se=async r=>{const{data:a,error:i}=await N.from("business_hours").select("*").eq("restaurant_id",r).order("day_of_week",{ascending:!0});if(i)throw new Error(`Erro ao buscar horários: ${i.message}`);return a},he=()=>{const{userRestaurantId:r}=G(),a=F(),{data:i,isLoading:x,isError:f,error:m}=$({queryKey:["businessHours",r],queryFn:()=>se(r),enabled:!!r}),o=I({resolver:Q(ee),mode:"onBlur"}),{fields:p}=A({control:o.control,name:"hours"});J.useEffect(()=>{if(i){const n=[...i.length>0?i:_.map(t=>({id:void 0,day_of_week:t.day_of_week,is_open:!0,open_time:"09:00",close_time:"18:00"}))].sort((t,s)=>t.day_of_week-s.day_of_week),c=_.map(t=>{const s=n.find(u=>u.day_of_week===t.day_of_week);return{id:s==null?void 0:s.id,day_of_week:t.day_of_week,is_open:(s==null?void 0:s.is_open)??!0,open_time:s!=null&&s.open_time?s.open_time.substring(0,5):"09:00",close_time:s!=null&&s.close_time?s.close_time.substring(0,5):"18:00"}});o.reset({hours:c})}},[i,o.reset]);const d=T({mutationFn:async l=>{if(!r)throw new Error("ID do restaurante não disponível.");const{error:n}=await N.from("business_hours").delete().eq("restaurant_id",r);if(n)throw new Error(`Erro ao limpar horários antigos: ${n.message}`);const c=l.hours.map(s=>({restaurant_id:r,day_of_week:s.day_of_week,is_open:s.is_open,open_time:s.is_open?s.open_time:null,close_time:s.is_open?s.close_time:null})),{error:t}=await N.from("business_hours").insert(c);if(t)throw new Error(`Erro ao inserir novos horários: ${t.message}`)},onSuccess:()=>{E.success("Horários de funcionamento salvos com sucesso!"),a.invalidateQueries({queryKey:["businessHours",r]})},onError:l=>{E.error(`Erro ao salvar horários: ${l.message}`)}}),b=l=>{d.mutate(l)},C=x||p.length===0;return e.jsx("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:e.jsxs(L,{className:"max-w-3xl mx-auto",children:[e.jsxs(K,{children:[e.jsx(O,{className:"text-2xl font-bold",children:"Horário de Funcionamento"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure os horários de abertura e fechamento para cada dia da semana"})]}),e.jsxs(P,{children:[C&&e.jsxs("div",{className:"space-y-4",children:[[...Array(7)].map((l,n)=>e.jsxs("div",{className:"flex items-center justify-between py-3 border-b last:border-b-0",children:[e.jsx(h,{className:"h-5 w-24"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(h,{className:"h-8 w-12"}),e.jsx(h,{className:"h-10 w-32"}),e.jsx(h,{className:"h-10 w-32"})]})]},n)),e.jsx(h,{className:"h-12 w-full mt-6"})]}),f&&e.jsxs("div",{className:"text-destructive",children:["Erro ao carregar horários: ",(m==null?void 0:m.message)||"Erro desconhecido"]}),!C&&!f&&e.jsx(Y,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(b),className:"space-y-6",children:[p.map((l,n)=>{const c=_.find(s=>s.day_of_week===l.day_of_week),t=!o.watch(`hours.${n}.is_open`);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("div",{className:"w-32 font-medium flex-shrink-0",children:c==null?void 0:c.label}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(j,{control:o.control,name:`hours.${n}.is_open`,render:({field:s})=>e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(w,{children:e.jsx(W,{checked:s.value,onCheckedChange:s.onChange,disabled:!r})}),e.jsx(v,{className:"text-sm font-normal w-16 text-left",children:s.value?"Aberto":"Fechado"})]})}),e.jsxs("div",{className:t?"opacity-50 pointer-events-none flex gap-4":"flex gap-4",children:[e.jsx(j,{control:o.control,name:`hours.${n}.open_time`,render:({field:s})=>e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"text-sm",children:"Abre:"}),e.jsx(w,{children:e.jsx(k,{...s,value:s.value||"",onChange:u=>s.onChange(u.target.value),disabled:!r||t})}),e.jsx(S,{})]})}),e.jsx(j,{control:o.control,name:`hours.${n}.close_time`,render:({field:s})=>e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"text-sm",children:"Fecha:"}),e.jsx(w,{children:e.jsx(k,{...s,value:s.value||"",onChange:u=>s.onChange(u.target.value),disabled:!r||t})}),e.jsx(S,{})]})})]})]})]}),n<_.length-1&&e.jsx(U,{})]},l.id)}),e.jsx(V,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground h-12 text-lg mt-6",disabled:d.isPending||!r,children:d.isPending?"Salvando...":"Salvar Horários"}),o.formState.errors.hours&&e.jsx("p",{className:"text-destructive text-sm mt-2",children:o.formState.errors.hours.message})]})})]})]})})};export{he as default};
