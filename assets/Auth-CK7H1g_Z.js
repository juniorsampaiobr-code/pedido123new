import{j as e}from"./tanstack-C7aOFagJ.js";import{h as R,i as z,r as s,L as O}from"./vendor-DjsPZZVP.js";import{L as T}from"./Logo-BdLJnnS5.js";import{s as p,C as B,d as $,e as H,f as J,b as V,L as g,I as N,P as W,B as w,g as _,u as o}from"./index-CV42jepX.js";import{S as G}from"./separator-CFvWQo-D.js";import"./supabase-BAEEEeUB.js";const L=n=>n.replace(/\D/g,""),re=()=>{var b;const n=R(),c=z(),[v,m]=s.useState(!1),[i,k]=s.useState(!1),[h,E]=s.useState(""),[f,P]=s.useState(""),[x,F]=s.useState(""),[j,U]=s.useState(""),[K,y]=s.useState(null),[M,S]=s.useState(null),D=(b=c.state)==null?void 0:b.restaurantId,[C,Q]=s.useState(!1);s.useEffect(()=>{const{data:{subscription:t}}=p.auth.onAuthStateChange((r,a)=>{var u,l;if(S(a),y((a==null?void 0:a.user)??null),a!=null&&a.user){const d=(u=c.state)==null?void 0:u.from,I=(l=c.state)==null?void 0:l.restaurantId;d==="/checkout"?(console.log("Redirecting customer to checkout after login."),n("/checkout",{replace:!0})):I?(console.log("Redirecting customer to specific menu after login."),n(`/menu/${I}`,{replace:!0})):(console.log("Redirecting customer to index after login."),n("/",{replace:!0}))}});return p.auth.getSession().then(({data:{session:r}})=>{var a,u;if(S(r),y((r==null?void 0:r.user)??null),r!=null&&r.user){const l=(a=c.state)==null?void 0:a.from,d=(u=c.state)==null?void 0:u.restaurantId;l==="/checkout"?(console.log("User already logged in, redirecting to checkout:",l),n("/checkout",{replace:!0})):d?(console.log("User already logged in, redirecting to specific menu:",d),n(`/menu/${d}`,{replace:!0})):(console.log("User already logged in, redirecting to index."),n("/",{replace:!0}))}}),()=>t.unsubscribe()},[n,c.state]);const q=()=>x.trim()?L(j).length!==11?(o.error("O Telefone deve conter 11 dígitos (DDD + 9 dígitos)."),!1):h.trim()?f.length<6?(o.error("A Senha deve ter pelo menos 6 caracteres."),!1):!0:(o.error("O Email é obrigatório."),!1):(o.error("O Nome Completo é obrigatório."),!1),A=async t=>{var r;if(t.preventDefault(),m(!0),((r=c.state)==null?void 0:r.from)==="/checkout"&&!D){o.error("Erro: ID do restaurante de origem não encontrado."),m(!1);return}try{if(i){if(!q()){m(!1);return}const a=L(j),{data:u,error:l}=await p.auth.signUp({email:h,password:f,options:{data:{full_name:x,phone:a}}});if(l)throw l;u.session?o.success("Conta criada e login efetuado com sucesso!"):o.success("Conta criada! Verifique seu email para confirmar.")}else{const{error:a}=await p.auth.signInWithPassword({email:h,password:f});if(a)throw a;o.success("Login realizado com sucesso!")}}catch(a){a.message.includes("Email not confirmed")?o.error("Por favor, verifique seu e-mail para confirmar sua conta antes de fazer login."):o.error(a.message||"Erro ao processar autenticação")}finally{m(!1)}};return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(T,{className:"justify-center mb-4"})}),e.jsxs(B,{className:"shadow-xl border-2",children:[e.jsxs($,{className:"space-y-1",children:[e.jsx(H,{className:"text-2xl font-bold text-center",children:i?"Crie sua conta":"Acesse sua conta"}),e.jsx(J,{className:"text-center",children:i?"Preencha os campos para começar":"Utilize seu email e senha para fazer login"})]}),e.jsxs(V,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"fullName",children:"Nome Completo *"}),e.jsx(N,{id:"fullName",type:"text",placeholder:"Seu nome completo",value:x,onChange:t=>F(t.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"phone",children:"Telefone *"}),e.jsx(W,{id:"phone",value:j,onChange:t=>U(t.target.value),required:!0,className:"h-12"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formato: (99) 99999-9999"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"email",children:"Email *"}),e.jsx(N,{id:"email",type:"email",placeholder:"seu@email.com",value:h,onChange:t=>E(t.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"password",children:"Senha *"}),e.jsx(N,{id:"password",type:"password",placeholder:"••••••••",value:f,onChange:t=>P(t.target.value),required:!0,className:"h-12"})]}),e.jsx(w,{type:"submit",className:"w-full",size:"lg",disabled:v||C,children:v||C?e.jsx(_,{className:"h-4 w-4 animate-spin mr-2"}):i?"Criar conta":"Entrar"})]}),e.jsx("div",{className:"text-center",children:e.jsx(w,{variant:"link",type:"button",className:"p-0 h-auto",onClick:()=>k(!i),children:i?"Já tem uma conta? Faça login":"Não tem uma conta? Crie uma agora"})}),e.jsx(G,{className:"my-4"}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["É o dono de uma loja? ",e.jsx(O,{to:"/admin-auth",className:"text-primary hover:underline",children:"Acesse o painel de administração"})]})]})]})]})})};export{re as default};
