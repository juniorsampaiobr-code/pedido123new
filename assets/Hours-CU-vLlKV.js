import{j as e,u as F,b as $,c as T}from"./tanstack-Ch7Ewlpa.js";import{o as H,s as b,n as M,b as D,a as q,u as I,d as Q,t as A}from"./types-CtpoKdVi.js";import{s as N}from"./client-3S0ugJ5L.js";import{B as R}from"./button-B6l0tlRQ.js";import{C as B,b as K,c as L,a as O}from"./card-QYtp1-wu.js";import{S as P}from"./switch-CrITdoif.js";import{a as V,u as E}from"./index-BuEqCHDh.js";import{F as W,a as g,b as j,d as w,c as v,e as S}from"./form-ojYWqk4v.js";import{R as Y,i as z,r as G}from"./vendor-CCvq-0xx.js";import{I as J}from"./label-C0dmFbzX.js";import{S as f}from"./skeleton-7KL_7oYv.js";import{S as U}from"./separator-BMq4OZ5C.js";import"./supabase-t-NbcSY6.js";import"./index-BMYbFAKC.js";const X=r=>{let a=r.replace(/\D/g,"");return a.length>4&&(a=a.slice(0,4)),a.length>2&&(a=`${a.slice(0,2)}:${a.slice(2)}`),a},k=Y.forwardRef(({className:r,value:a,onChange:l,...x},h)=>{const m=o=>{const p=o.target.value,d=X(p),y={...o,target:{...o.target,value:d}};l(y)};return e.jsx(J,{ref:h,type:"tel",className:V("w-24 text-center",r),placeholder:"HH:MM",value:a,onChange:m,maxLength:5,...x})});k.displayName="TimeInput";const _=[{day_of_week:0,label:"Domingo"},{day_of_week:1,label:"Segunda-feira"},{day_of_week:2,label:"Terça-feira"},{day_of_week:3,label:"Quarta-feira"},{day_of_week:4,label:"Quinta-feira"},{day_of_week:5,label:"Sexta-feira"},{day_of_week:6,label:"Sábado"}],Z=H({id:b().optional(),day_of_week:M().min(0).max(6),is_open:D().default(!0),open_time:b().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Formato de hora inválido (HH:MM)").optional().nullable(),close_time:b().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Formato de hora inválido (HH:MM)").optional().nullable()}),ee=H({hours:q(Z).refine(r=>r.every(a=>!a.is_open||a.open_time&&a.close_time),{message:"Horário de abertura e fechamento são obrigatórios para dias abertos.",path:["hours"]})}),se=async r=>{const{data:a,error:l}=await N.from("business_hours").select("*").eq("restaurant_id",r).order("day_of_week",{ascending:!0});if(l)throw new Error(`Erro ao buscar horários: ${l.message}`);return a},_e=()=>{const{userRestaurantId:r}=z(),a=F(),{data:l,isLoading:x,isError:h,error:m}=$({queryKey:["businessHours",r],queryFn:()=>se(r),enabled:!!r}),o=I({resolver:A(ee),mode:"onBlur"}),{fields:p}=Q({control:o.control,name:"hours"});G.useEffect(()=>{if(l){const n=[...l.length>0?l:_.map(t=>({id:void 0,day_of_week:t.day_of_week,is_open:!0,open_time:"09:00",close_time:"18:00"}))].sort((t,s)=>t.day_of_week-s.day_of_week),c=_.map(t=>{const s=n.find(u=>u.day_of_week===t.day_of_week);return{id:s==null?void 0:s.id,day_of_week:t.day_of_week,is_open:(s==null?void 0:s.is_open)??!0,open_time:s!=null&&s.open_time?s.open_time.substring(0,5):"09:00",close_time:s!=null&&s.close_time?s.close_time.substring(0,5):"18:00"}});o.reset({hours:c})}},[l,o.reset]);const d=T({mutationFn:async i=>{if(!r)throw new Error("ID do restaurante não disponível.");const{error:n}=await N.from("business_hours").delete().eq("restaurant_id",r);if(n)throw new Error(`Erro ao limpar horários antigos: ${n.message}`);const c=i.hours.map(s=>({restaurant_id:r,day_of_week:s.day_of_week,is_open:s.is_open,open_time:s.is_open?s.open_time:null,close_time:s.is_open?s.close_time:null})),{error:t}=await N.from("business_hours").insert(c);if(t)throw new Error(`Erro ao inserir novos horários: ${t.message}`)},onSuccess:()=>{E.success("Horários de funcionamento salvos com sucesso!"),a.invalidateQueries({queryKey:["businessHours",r]}),a.invalidateQueries({queryKey:["menuData"]})},onError:i=>{E.error(`Erro ao salvar horários: ${i.message}`)}}),y=i=>{d.mutate(i)},C=x||p.length===0;return e.jsx("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:e.jsxs(B,{className:"max-w-3xl mx-auto",children:[e.jsxs(K,{children:[e.jsx(L,{className:"text-2xl font-bold",children:"Horário de Funcionamento"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure os horários de abertura e fechamento para cada dia da semana"})]}),e.jsxs(O,{children:[C&&e.jsxs("div",{className:"space-y-4",children:[[...Array(7)].map((i,n)=>e.jsxs("div",{className:"flex items-center justify-between py-3 border-b last:border-b-0",children:[e.jsx(f,{className:"h-5 w-24"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(f,{className:"h-8 w-12"}),e.jsx(f,{className:"h-10 w-32"}),e.jsx(f,{className:"h-10 w-32"})]})]},n)),e.jsx(f,{className:"h-12 w-full mt-6"})]}),h&&e.jsxs("div",{className:"text-destructive",children:["Erro ao carregar horários: ",(m==null?void 0:m.message)||"Erro desconhecido"]}),!C&&!h&&e.jsx(W,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(y),className:"space-y-6",children:[p.map((i,n)=>{const c=_.find(s=>s.day_of_week===i.day_of_week),t=!o.watch(`hours.${n}.is_open`);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("div",{className:"w-32 font-medium flex-shrink-0",children:c==null?void 0:c.label}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(g,{control:o.control,name:`hours.${n}.is_open`,render:({field:s})=>e.jsxs(j,{className:"flex items-center space-x-2",children:[e.jsx(w,{children:e.jsx(P,{checked:s.value,onCheckedChange:s.onChange,disabled:!r})}),e.jsx(v,{className:"text-sm font-normal w-16 text-left",children:s.value?"Aberto":"Fechado"})]})}),e.jsxs("div",{className:t?"opacity-50 pointer-events-none flex gap-4":"flex gap-4",children:[e.jsx(g,{control:o.control,name:`hours.${n}.open_time`,render:({field:s})=>e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"text-sm",children:"Abre:"}),e.jsx(w,{children:e.jsx(k,{...s,value:s.value||"",onChange:u=>s.onChange(u.target.value),disabled:!r||t})}),e.jsx(S,{})]})}),e.jsx(g,{control:o.control,name:`hours.${n}.close_time`,render:({field:s})=>e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"text-sm",children:"Fecha:"}),e.jsx(w,{children:e.jsx(k,{...s,value:s.value||"",onChange:u=>s.onChange(u.target.value),disabled:!r||t})}),e.jsx(S,{})]})})]})]})]}),n<_.length-1&&e.jsx(U,{})]},i.id)}),e.jsx(R,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground h-12 text-lg mt-6",disabled:d.isPending||!r,children:d.isPending?"Salvando...":"Salvar Horários"}),o.formState.errors.hours&&e.jsx("p",{className:"text-destructive text-sm mt-2",children:o.formState.errors.hours.message})]})})]})]})})};export{_e as default};
