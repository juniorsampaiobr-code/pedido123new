import{j as e,u as oe,c as X,b as Ge}from"./tanstack-d4AvmB45.js";import{r as u,i as Ve}from"./vendor-CnEXr6gt.js";import{s as B}from"./client-D5i5GwB9.js";import{B as M,b as He}from"./button-PBERaK-4.js";import{C as ie,a as le,b as Ue,c as Ke}from"./card-DklvXcBj.js";import{S as Qe,a as Xe,b as We,c as Ze,d as Je,T as Ye,e as es,f as ss,g as ts,B as ne}from"./select-LZN_MBNh.js";import{S as T}from"./skeleton-Dd8J7Jk8.js";import{A as ce,a as de,b as me}from"./alert-BeNAUDY4.js";import{c as J,a as A,d as as,e as ue,P as Y,f as re,g as ns,h as rs,i as os,L as is,u as R}from"./index-DgUv2cns.js";import{D as ls,a as cs,b as ds,c as ms,X as us}from"./dialog-CnmmLv1P.js";import{p as ps,R as pe}from"./pt-BR-oxCn-tQO.js";import{T as he}from"./terminal-lFlkS6I7.js";import{U as hs}from"./user-BEBQqdX_.js";import{P as xs}from"./phone-CvXcCrVd.js";import{M as fs}from"./map-pin-BKnNxWAI.js";import{C as gs}from"./credit-card-C62OOss-.js";import{C as bs}from"./calendar-DstD7jg1.js";import{C as xe,T as fe}from"./truck-DAcOmt03.js";import{P as ge}from"./package-Dkfztigw.js";import{C as be}from"./circle-check-big-B4ZkuYzm.js";import{C as V}from"./check-CktBKoPp.js";import{C as ye}from"./circle-x-zc79uihY.js";import{E as ys}from"./euro-DgbiBp0Q.js";import{f as js}from"./format-BeKxgCCE.js";import{A as je,h as ve,a as Ne,b as we,c as Ce,d as Pe,e as ke,f as Ee,g as _e}from"./alert-dialog-CaSJpFZO.js";import{u as vs}from"./index-KNP7Yozt.js";import{S as Ae}from"./shopping-cart-DuYrI2as.js";import{D as Ns}from"./dollar-sign-Q4rLy7S5.js";import{P as ws}from"./printer-D9T0GJNZ.js";import{T as Cs}from"./trash-2-DY44-ocS.js";import"./supabase-BZV_3FV3.js";import"./index-D2aOIBmJ.js";import"./index-DrlxvCXN.js";import"./index-BdQq_4o_.js";import"./index-Bzb1k1gc.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=J("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=J("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=J("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),_s={pending:{label:"Pendente",icon:xe,color:"bg-yellow-500"},preparing:{label:"Em Preparação",icon:ge,color:"bg-orange-500"},ready:{label:"Pronto",icon:be,color:"bg-green-500"},delivering:{label:"Em Entrega",icon:fe,color:"bg-blue-500"},delivered:{label:"Entregue",icon:V,color:"bg-purple-500"},cancelled:{label:"Cancelado",icon:ye,color:"bg-destructive"},pending_payment:{label:"Aguardando Pagamento",icon:ys,color:"bg-gray-500"}},As=async s=>{const{data:t,error:a}=await B.from("order_items").select("*, products(name, is_price_by_weight)").eq("order_id",s);if(a)throw new Error(a.message);return t},Rs=({order:s,isOpen:t,onClose:a})=>{var S,D,q,z;const[h,l]=u.useState([]),[n,c]=u.useState(!1),[p,i]=u.useState(null),[f,m]=u.useState("Carregando...");u.useEffect(()=>{t&&(async()=>{if(s!=null&&s.id){c(!0),i(null);try{const _=await As(s.id);l(_)}catch(_){console.error("Failed to fetch order items:",_),i("Falha ao carregar itens do pedido.")}finally{c(!1)}}})()},[s==null?void 0:s.id,t]),u.useEffect(()=>{t&&s&&(async()=>{if(!(s!=null&&s.payment_method_id)){m("Não especificado");return}try{const{data:_,error:o}=await B.from("payment_methods").select("name").eq("id",s.payment_method_id).single();if(o)throw o;m((_==null?void 0:_.name)||"Método não encontrado")}catch(_){console.error("Failed to fetch payment method name:",_),m("Erro ao carregar")}})()},[t,s]),u.useEffect(()=>{s&&console.log("Order prop recebida:",s)},[s]);const g=((S=s==null?void 0:s.customer)==null?void 0:S.name)||"Cliente Desconhecido",v=(D=s==null?void 0:s.customer)==null?void 0:D.phone,C=(q=s==null?void 0:s.customer)==null?void 0:q.email,k=(z=s==null?void 0:s.customer)==null?void 0:z.cpf_cnpj,d=useMemo(()=>{if(!(s!=null&&s.customer))return null;const{street:P,number:_,neighborhood:o,city:x,state:y,zip_code:I,complement:ae}=s.customer;if(!P)return null;const G=[];P&&G.push(P),_&&G.push(_),o&&G.push(o);let ze=G.join(", ");const U=[];x&&U.push(x),y&&U.push(y);let O=U.join(" - ");const K=(I==null?void 0:I.replace(/\D/g,""))||"";let Q="";return K.length===8&&(Q=`${K.slice(0,5)}-${K.slice(5)}`),Q&&(O+=(O?", CEP: ":"CEP: ")+Q),ae&&(O+=(O?", ":"")+`(Comp: ${ae})`),[ze,O].filter(Boolean).join(", ")||null},[s==null?void 0:s.customer]),E=s!=null&&s.status?_s[s.status]:null,N=s!=null&&s.id?s.id.slice(-4):"N/A",b=s!=null&&s.created_at?new Date(s.created_at):null,r=b?js(b,"dd 'de' MMMM 'de' yyyy 'às' HH:mm",{locale:ps}):"Data desconhecida",j=s!=null&&s.change_for?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.change_for):null,w=s!=null&&s.delivery_fee?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.delivery_fee):"Grátis";return e.jsx(ls,{open:t,onOpenChange:a,children:e.jsxs(cs,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ds,{children:e.jsxs(ms,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Detalhes do Pedido #",N]}),E&&e.jsxs("span",{className:A("text-xs font-semibold px-2.5 py-0.5 rounded-full text-white flex items-center",E.color),children:[e.jsx(E.icon,{className:"w-3 h-3 mr-1"}),E.label]})]})}),p&&e.jsxs(ce,{variant:"destructive",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(de,{children:"Erro"}),e.jsx(me,{children:p})]}),n?e.jsxs("div",{className:"space-y-4",children:[e.jsx(T,{className:"h-4 w-1/3"}),e.jsx(T,{className:"h-10 w-full"}),e.jsx(T,{className:"h-4 w-1/3"}),e.jsx(T,{className:"h-20 w-full"}),e.jsx(T,{className:"h-4 w-1/3"}),e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((P,_)=>e.jsx(T,{className:"h-12 w-full"},_))}),e.jsx(T,{className:"h-4 w-1/3"}),e.jsx(T,{className:"h-6 w-full"})]}):s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(hs,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Cliente"}),e.jsx("p",{children:g}),k&&e.jsxs("p",{className:"text-muted-foreground text-xs",children:["CPF/CNPJ: ",k]})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(xs,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Telefone"}),e.jsx("p",{children:v||"Não informado"}),C&&e.jsx("p",{className:"text-muted-foreground text-xs",children:C})]})]}),e.jsxs("div",{className:"flex items-start md:col-span-2",children:[e.jsx(fs,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Endereço de Entrega"}),e.jsx("p",{children:d||"Retirada no local"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(gs,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Método de Pagamento"}),e.jsx("p",{children:f}),j&&e.jsxs("p",{className:"text-muted-foreground text-xs",children:["Troco para: ",j]})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(bs,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Data do Pedido"}),e.jsx("p",{children:r})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Itens do Pedido"}),e.jsx("div",{className:"space-y-2",children:h.map(P=>{var x,y;const o=((x=P.products)==null?void 0:x.is_price_by_weight)?`${P.quantity} kg`:`${P.quantity} x`;return e.jsxs("div",{className:"flex justify-between items-start p-2 bg-muted/50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((y=P.products)==null?void 0:y.name)||"Produto não encontrado"}),P.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Obs: ",P.notes]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{children:[o," ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(P.unit_price)]}),e.jsx("p",{className:"font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(P.subtotal)})]})]},P.id)})})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount-(s.delivery_fee||0))})]}),e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:w})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]})]}),e.jsx("div",{className:"pt-4",children:s.notes&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Observações do Cliente:"}),e.jsx("p",{className:"bg-muted p-2 rounded",children:s.notes})]})})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(M,{onClick:a,children:"Fechar"})})]})})},Re=({className:s,...t})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:A("mx-auto flex w-full justify-center",s),...t});Re.displayName="Pagination";const Se=u.forwardRef(({className:s,...t},a)=>e.jsx("ul",{ref:a,className:A("flex flex-row items-center gap-1",s),...t}));Se.displayName="PaginationContent";const $=u.forwardRef(({className:s,...t},a)=>e.jsx("li",{ref:a,className:A("",s),...t}));$.displayName="PaginationItem";const L=({className:s,isActive:t,size:a="icon",...h})=>e.jsx("a",{"aria-current":t?"page":void 0,className:A(He({variant:t?"outline":"ghost",size:a}),s),...h});L.displayName="PaginationLink";const De=({className:s,...t})=>e.jsxs(L,{"aria-label":"Go to previous page",size:"default",className:A("gap-1 pl-2.5",s),...t,children:[e.jsx(Ps,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});De.displayName="PaginationPrevious";const Ie=({className:s,...t})=>e.jsxs(L,{"aria-label":"Go to next page",size:"default",className:A("gap-1 pr-2.5",s),...t,children:[e.jsx("span",{children:"Next"}),e.jsx(ks,{className:"h-4 w-4"})]});Ie.displayName="PaginationNext";const W=({className:s,...t})=>e.jsxs("span",{"aria-hidden":!0,className:A("flex h-9 w-9 items-center justify-center",s),...t,children:[e.jsx(Es,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]});W.displayName="PaginationEllipsis";const Ss=({currentPage:s,totalPages:t,onPageChange:a})=>{if(t<=1)return null;const l=(()=>{const n=[],p=Math.max(1,s-Math.floor(2.5)),i=Math.min(t,p+5-1);if(i-p+1<5){const f=Math.max(1,i-5+1);for(let m=f;m<=i;m++)n.push(m)}else for(let f=p;f<=i;f++)n.push(f);return n})();return e.jsx(Re,{children:e.jsxs(Se,{children:[e.jsx($,{children:e.jsx(De,{onClick:()=>a(s-1),className:A(s===1&&"pointer-events-none opacity-50")})}),l[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx($,{children:e.jsx(L,{onClick:()=>a(1),children:"1"})}),l[0]>2&&e.jsx($,{children:e.jsx(W,{})})]}),l.map(n=>e.jsx($,{children:e.jsx(L,{isActive:n===s,onClick:()=>a(n),children:n})},n)),l[l.length-1]<t&&e.jsxs(e.Fragment,{children:[l[l.length-1]<t-1&&e.jsx($,{children:e.jsx(W,{})}),e.jsx($,{children:e.jsx(L,{onClick:()=>a(t),children:t})})]}),e.jsx($,{children:e.jsx(Ie,{onClick:()=>a(s+1),className:A(s===t&&"pointer-events-none opacity-50")})})]})})};var H="Checkbox",[Ds,Ct]=as(H),[Is,ee]=Ds(H);function Ts(s){const{__scopeCheckbox:t,checked:a,children:h,defaultChecked:l,disabled:n,form:c,name:p,onCheckedChange:i,required:f,value:m="on",internal_do_not_use_render:g}=s,[v,C]=os({prop:a,defaultProp:l??!1,onChange:i,caller:H}),[k,d]=u.useState(null),[E,N]=u.useState(null),b=u.useRef(!1),r=k?!!c||!!k.closest("form"):!0,j={checked:v,disabled:n,setChecked:C,control:k,setControl:d,name:p,form:c,value:m,hasConsumerStoppedPropagationRef:b,required:f,defaultChecked:F(l)?!1:l,isFormControl:r,bubbleInput:E,setBubbleInput:N};return e.jsx(Is,{scope:t,...j,children:Ms(g)?g(j):h})}var Te="CheckboxTrigger",Me=u.forwardRef(({__scopeCheckbox:s,onKeyDown:t,onClick:a,...h},l)=>{const{control:n,value:c,disabled:p,checked:i,required:f,setControl:m,setChecked:g,hasConsumerStoppedPropagationRef:v,isFormControl:C,bubbleInput:k}=ee(Te,s),d=ue(l,m),E=u.useRef(i);return u.useEffect(()=>{const N=n==null?void 0:n.form;if(N){const b=()=>g(E.current);return N.addEventListener("reset",b),()=>N.removeEventListener("reset",b)}},[n,g]),e.jsx(Y.button,{type:"button",role:"checkbox","aria-checked":F(i)?"mixed":i,"aria-required":f,"data-state":Oe(i),"data-disabled":p?"":void 0,disabled:p,value:c,...h,ref:d,onKeyDown:re(t,N=>{N.key==="Enter"&&N.preventDefault()}),onClick:re(a,N=>{g(b=>F(b)?!0:!b),k&&C&&(v.current=N.isPropagationStopped(),v.current||N.stopPropagation())})})});Me.displayName=Te;var se=u.forwardRef((s,t)=>{const{__scopeCheckbox:a,name:h,checked:l,defaultChecked:n,required:c,disabled:p,value:i,onCheckedChange:f,form:m,...g}=s;return e.jsx(Ts,{__scopeCheckbox:a,checked:l,defaultChecked:n,disabled:p,required:c,onCheckedChange:f,name:h,form:m,value:i,internal_do_not_use_render:({isFormControl:v})=>e.jsxs(e.Fragment,{children:[e.jsx(Me,{...g,ref:t,__scopeCheckbox:a}),v&&e.jsx(Le,{__scopeCheckbox:a})]})})});se.displayName=H;var Be="CheckboxIndicator",$e=u.forwardRef((s,t)=>{const{__scopeCheckbox:a,forceMount:h,...l}=s,n=ee(Be,a);return e.jsx(ns,{present:h||F(n.checked)||n.checked===!0,children:e.jsx(Y.span,{"data-state":Oe(n.checked),"data-disabled":n.disabled?"":void 0,...l,ref:t,style:{pointerEvents:"none",...s.style}})})});$e.displayName=Be;var Fe="CheckboxBubbleInput",Le=u.forwardRef(({__scopeCheckbox:s,...t},a)=>{const{control:h,hasConsumerStoppedPropagationRef:l,checked:n,defaultChecked:c,required:p,disabled:i,name:f,value:m,form:g,bubbleInput:v,setBubbleInput:C}=ee(Fe,s),k=ue(a,C),d=vs(n),E=rs(h);u.useEffect(()=>{const b=v;if(!b)return;const r=window.HTMLInputElement.prototype,w=Object.getOwnPropertyDescriptor(r,"checked").set,S=!l.current;if(d!==n&&w){const D=new Event("click",{bubbles:S});b.indeterminate=F(n),w.call(b,F(n)?!1:n),b.dispatchEvent(D)}},[v,d,n,l]);const N=u.useRef(F(n)?!1:n);return e.jsx(Y.input,{type:"checkbox","aria-hidden":!0,defaultChecked:c??N.current,required:p,disabled:i,name:f,value:m,form:g,...t,tabIndex:-1,ref:k,style:{...t.style,...E,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Le.displayName=Fe;function Ms(s){return typeof s=="function"}function F(s){return s==="indeterminate"}function Oe(s){return F(s)?"indeterminate":s?"checked":"unchecked"}const te=u.forwardRef(({className:s,...t},a)=>e.jsx(se,{ref:a,className:A("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx($e,{className:A("flex items-center justify-center text-current"),children:e.jsx(V,{className:"h-4 w-4"})})}));te.displayName=se.displayName;const qe={pending:{label:"Pendente",icon:xe,color:"bg-yellow-500 hover:bg-yellow-600"},preparing:{label:"Em Preparação",icon:ge,color:"bg-orange-500 hover:bg-orange-600"},ready:{label:"Pronto",icon:be,color:"bg-green-500 hover:bg-green-600"},delivering:{label:"Em Entrega",icon:fe,color:"bg-indigo-500 hover:bg-indigo-600"},delivered:{label:"Entregue",icon:V,color:"bg-primary hover:bg-primary/90"},cancelled:{label:"Cancelado",icon:ye,color:"bg-destructive hover:bg-destructive/90"},pending_payment:{label:"Aguardando Pag.",icon:Ns,color:"bg-gray-500 hover:bg-gray-600"}},Bs=[{value:"pending",label:"Mudar para Pendente"},{value:"preparing",label:"Mudar para Em Preparação"},{value:"ready",label:"Mudar para Pronto"},{value:"delivering",label:"Mudar para Em Entrega"},{value:"delivered",label:"Mudar para Entregue"},{value:"cancelled",label:"Mudar para Cancelado"},{value:"pending_payment",label:"Mudar para Aguardando Pag."},{value:"delete",label:"Excluir Permanentemente"}],Z=12,$s=async(s,t,a)=>{const h=a*Z,l=h+Z-1;let n=B.from("orders").select("*, customer:customers(name, phone)",{count:"exact"}).eq("restaurant_id",s);t!=="all"&&(n=n.eq("status",t));const{data:c,error:p,count:i}=await n.order("created_at",{ascending:!1}).range(h,l);if(p)throw new Error(`Erro ao buscar pedidos: ${p.message}`);return{orders:c,count:i||0}},Fs=async s=>{const{data:t,error:a}=await B.from("payment_methods").select("name").eq("id",s).single();return a?(console.error("Erro ao buscar nome do método de pagamento:",a),"Método Desconhecido"):(t==null?void 0:t.name)||"Método Desconhecido"},Ls=(s,t,a)=>{var C,k;const h=s.id?s.id.slice(-4):"N/A",l=((C=s.customer)==null?void 0:C.name)||"Cliente Desconhecido",n=((k=s.customer)==null?void 0:k.phone)||"Não informado",c=s.delivery_address||"Retirada no local",p=s.created_at?new Date(s.created_at).toLocaleString("pt-BR"):"Data desconhecida",i=s.change_for?`Troco para: ${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.change_for)}`:"",f=s.delivery_fee?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.delivery_fee):"Grátis",m=s.total_amount-(s.delivery_fee||0);let g="";a.toLowerCase().includes("online")&&s.status!=="cancelled"&&s.status!=="pending_payment"?g='<div style="margin-top: 10px; padding: 5px; border: 1px solid #000; text-align: center; font-weight: bold; background-color: #ccffcc;">PAGO ONLINE - NÃO COBRAR</div>':s.status==="pending_payment"&&(g='<div style="margin-top: 10px; padding: 5px; border: 1px solid #000; text-align: center; font-weight: bold; background-color: #ffffcc;">AGUARDANDO PAGAMENTO</div>');let v="";return t.forEach(d=>{var E;v+=`
      <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
        <span>${d.quantity}x ${((E=d.products)==null?void 0:E.name)||"Produto não encontrado"}</span>
        <span>${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d.subtotal)}</span>
      </div>
      ${d.notes?`<div style="font-size: 12px; color: #666; margin-bottom: 10px;">Obs: ${d.notes}</div>`:""}
    `}),`
    <div style="font-family: Arial, sans-serif; max-width: 300px; margin: 0 auto; padding: 20px;">
      <div style="text-align: center; border-bottom: 1px dashed #000; padding-bottom: 10px; margin-bottom: 10px;">
        <h2 style="margin: 0;">PEDIDO #${h}</h2>
        <p style="margin: 5px 0;">${p}</p>
      </div>
      
      <div style="margin-bottom: 15px;">
        <h3 style="margin: 0 0 5px 0;">Cliente</h3>
        <p style="margin: 0;">${l}</p>
        <p style="margin: 0;">${n}</p>
      </div>
      
      <div style="margin-bottom: 15px;">
        <h3 style="margin: 0 0 5px 0;">Entrega</h3>
        <p style="margin: 0;">${c}</p>
      </div>
      
      <div style="margin-bottom: 15px;">
        <h3 style="margin: 0 0 5px 0;">Itens</h3>
        ${v}
      </div>
      
      <div style="border-top: 1px dashed #000; padding-top: 10px; margin-bottom: 15px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <span>Subtotal:</span>
          <span>${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(m)}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <span>Taxa de Entrega:</span>
          <span>${f}</span>
        </div>
        <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 16px; margin-top: 10px;">
          <span>Total:</span>
          <span>${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)}</span>
        </div>
      </div>
      
      <div style="margin-bottom: 15px;">
        <h3 style="margin: 0 0 5px 0;">Pagamento</h3>
        <p style="margin: 0;">${a}</p>
        ${i?`<p style="margin: 0;">${i}</p>`:""}
        ${g}
      </div>
      
      ${s.notes?`
        <div style="margin-bottom: 15px;">
          <h3 style="margin: 0 0 5px 0;">Observações</h3>
          <p style="margin: 0;">${s.notes}</p>
        </div>
      `:""}
      
      <div style="text-align: center; margin-top: 20px;">
        <p style="font-size: 12px;">Obrigado pela preferência!</p>
      </div>
    </div>
  `},Os=({order:s,onViewDetails:t,onAccept:a,onDecline:h,onDelete:l,isSelected:n,onSelect:c,onPrint:p})=>{var v;const i=qe[s.status||"pending"],f=((v=s.customer)==null?void 0:v.name)||"Cliente Desconhecido",m=s.id?s.id.slice(-4):"N/A",g=s.status==="pending_payment";return e.jsxs(ie,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col relative",children:[e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx(te,{checked:n,onCheckedChange:C=>c(s.id,!!C),className:"h-5 w-5"})}),e.jsxs(Ue,{className:"flex flex-row items-center justify-between space-y-0 pb-2 pl-12",children:[e.jsxs(Ke,{className:"text-lg font-bold flex items-center gap-2",children:["Pedido #",m]}),e.jsxs(ne,{className:A("text-white",i.color),children:[e.jsx(i.icon,{className:"h-3 w-3 mr-1"}),i.label]})]}),e.jsxs(le,{className:"space-y-2 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",f]}),e.jsx("p",{className:"text-2xl font-extrabold text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)})]}),e.jsxs("div",{className:"flex justify-end pt-2 border-t gap-2",children:[s.status==="pending"&&!g&&e.jsxs(e.Fragment,{children:[e.jsxs(M,{variant:"destructive",size:"sm",onClick:()=>h(s.id),children:[e.jsx(us,{className:"h-4 w-4 mr-1"})," Recusar"]}),e.jsxs(M,{variant:"default",size:"sm",onClick:()=>a(s.id),children:[e.jsx(V,{className:"h-4 w-4 mr-1"})," Aceitar"]})]}),g&&e.jsx(ne,{variant:"secondary",className:"bg-gray-100 text-gray-600",children:"Aguardando Pagamento"}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>t(s),children:"Detalhes"}),e.jsx(M,{variant:"outline",size:"icon",onClick:()=>p(s),children:e.jsx(ws,{className:"h-4 w-4"})}),e.jsxs(je,{children:[e.jsx(ve,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",children:e.jsx(Cs,{className:"h-4 w-4"})})}),e.jsxs(Ne,{children:[e.jsxs(we,{children:[e.jsx(Ce,{children:"Tem certeza que deseja excluir?"}),e.jsxs(Pe,{children:["Esta ação é permanente. O pedido #",m," será excluído permanentemente do sistema, incluindo todos os itens associados."]})]}),e.jsxs(ke,{children:[e.jsx(Ee,{children:"Cancelar"}),e.jsx(_e,{onClick:()=>l(s.id),className:"bg-destructive hover:bg-destructive/90",children:"Excluir Permanentemente"})]})]})]})]})]})]})},qs=({status:s,onViewDetails:t,restaurantId:a,selectedOrders:h,setSelectedOrders:l,totalOrdersInView:n,onPrint:c})=>{const p=oe(),[i,f]=u.useState(1),{data:m,isLoading:g,isError:v,error:C,refetch:k}=Ge({queryKey:["orders",s,a,i],queryFn:()=>$s(a,s,i-1),enabled:!!a}),d=(m==null?void 0:m.orders)||[],E=(m==null?void 0:m.count)||0,N=Math.ceil(E/Z),b=X({mutationFn:async({orderId:o,newStatus:x})=>{const y=x==="pending"?"preparing":x,{error:I}=await B.from("orders").update({status:y}).eq("id",o);if(I)throw new Error(I.message);return y},onSuccess:o=>{R.success(`Pedido ${o==="preparing"?"aceito":"recusado"} com sucesso!`),p.invalidateQueries({queryKey:["orders"]})},onError:o=>R.error(`Erro ao atualizar pedido: ${o.message}`)}),r=X({mutationFn:async o=>{const{error:x}=await B.from("orders").delete().eq("id",o);if(x)throw new Error(x.message)},onSuccess:()=>{R.success("Pedido excluído permanentemente."),p.invalidateQueries({queryKey:["orders"]})},onError:o=>R.error(`Erro ao excluir pedido: ${o.message}`)}),j=o=>{const x=d.find(y=>y.id===o);x&&x.status==="pending"?b.mutate({orderId:o,newStatus:"preparing"}):R.error("Ação inválida. O pedido não está no status Pendente.")},w=o=>{const x=d.find(y=>y.id===o);x&&x.status==="pending"?b.mutate({orderId:o,newStatus:"cancelled"}):R.error("Ação inválida. O pedido não está no status Pendente.")},S=o=>{t(o)},D=o=>{r.mutate(o)},q=u.useCallback(o=>{f(o)},[]),z=u.useCallback((o,x)=>{l(y=>x?[...y,o]:y.filter(I=>I!==o))},[l]),P=u.useCallback(o=>{if(o){const x=d.map(y=>y.id);l(y=>[...new Set([...y,...x])])}else{const x=new Set(d.map(y=>y.id));l(y=>y.filter(I=>!x.has(I)))}},[d,l]),_=d.length>0&&d.every(o=>h.includes(o.id));return g?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((o,x)=>e.jsx(ie,{children:e.jsx(le,{className:"p-4 space-y-3",children:e.jsx(T,{className:"h-32 w-full"})})},x))}):v?e.jsxs(ce,{variant:"destructive",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(de,{children:"Erro ao carregar pedidos"}),e.jsx(me,{children:C instanceof Error?C.message:"Ocorreu um erro desconhecido."}),e.jsxs(M,{onClick:()=>k(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]}):!d||d.length===0?e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg border",children:[e.jsx(Ae,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifique o status selecionado ou aguarde novos pedidos."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg bg-muted/50",children:[e.jsx(te,{checked:_,onCheckedChange:P,className:"h-5 w-5"}),e.jsxs("span",{className:"text-sm font-medium",children:["Selecionar todos (",d.length,") nesta página."]}),n>0&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-auto",children:[n," pedidos selecionados no total."]})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:d.map(o=>e.jsx(Os,{order:o,onViewDetails:S,onAccept:j,onDecline:w,onDelete:D,isSelected:h.includes(o.id),onSelect:z,onPrint:c},o.id))}),N>1&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(Ss,{currentPage:i,totalPages:N,onPageChange:q})})]})},Pt=()=>{const{userRestaurantId:s}=Ve(),t=oe(),[a,h]=u.useState(null),[l,n]=u.useState(!1),[c,p]=u.useState([]),[i,f]=u.useState(""),m=r=>{h(r),n(!0)},g=()=>{n(!1),h(null)},v=()=>{t.invalidateQueries({queryKey:["orders",s]}),R.info("Atualizando pedidos...",{description:"Buscando novos dados no servidor."})},C=async r=>{const{data:j,error:w}=await B.from("order_items").select("*, products(name)").eq("order_id",r);if(w)throw new Error(`Erro ao buscar itens do pedido: ${w.message}`);return j},k=async r=>{try{const j=await C(r.id);let w="Não especificado";r.payment_method_id&&(w=await Fs(r.payment_method_id));const S=Ls(r,j,w),D=window.open("","_blank");D?(D.document.write(`
          <html>
            <head>
              <title>Pedido #${r.id?r.id.slice(-4):"N/A"}</title>
              <style>
                @media print {
                  body { margin: 0; }
                  /* Estilo para garantir que a linha tracejada apareça */
                  .dashed-line { border-top: 1px dashed #000; }
                }
              </style>
            </head>
            <body>
              ${S}
              <script>
                window.onload = function() {
                  window.print();
                  window.onafterprint = function() {
                    window.close();
                  }
                }
              <\/script>
            </body>
          </html>
        `),D.document.close()):R.error("Não foi possível abrir a janela de impressão. Verifique as permissões do navegador.")}catch(j){console.error("Erro ao preparar impressão do pedido:",j),R.error("Erro ao preparar impressão do pedido.")}},d=X({mutationFn:async({orderIds:r,action:j})=>{if(j==="delete"){const{error:w}=await B.from("orders").delete().in("id",r);if(w)throw new Error(w.message);return"deleted"}else{const w=j==="pending"?"preparing":j,{error:S}=await B.from("orders").update({status:w}).in("id",r);if(S)throw new Error(S.message);return"updated"}},onSuccess:(r,j)=>{if(r==="deleted")R.success(`${j.orderIds.length} pedidos excluídos permanentemente.`);else{const w=qe[j.action].label;R.success(`${j.orderIds.length} pedidos atualizados para "${w}".`)}p([]),f(""),t.invalidateQueries({queryKey:["orders",s]})},onError:r=>{R.error(`Erro na ação em massa: ${r.message}`)}}),E=()=>{var r;!i||c.length===0||(i==="delete"?(r=document.getElementById("mass-delete-trigger"))==null||r.click():d.mutate({orderIds:c,action:i}))},N=[{value:"pending_payment",label:"Aguardando Pag."},{value:"pending",label:"Pendentes"},{value:"preparing",label:"Em Preparação"},{value:"ready",label:"Prontos"},{value:"delivering",label:"Em Entrega"},{value:"delivered",label:"Entregues"},{value:"cancelled",label:"Cancelados"},{value:"all",label:"Todos"}],b=d.isPending;return s?e.jsxs(e.Fragment,{children:[e.jsx(Rs,{order:a,isOpen:l,onClose:g}),e.jsxs(je,{children:[e.jsx(ve,{asChild:!0,children:e.jsx("button",{id:"mass-delete-trigger",className:"hidden"})}),e.jsxs(Ne,{children:[e.jsxs(we,{children:[e.jsxs(Ce,{children:["Tem certeza que deseja excluir ",c.length," pedidos?"]}),e.jsxs(Pe,{children:["Esta ação é permanente. ",c.length," pedidos serão excluídos permanentemente do sistema."]})]}),e.jsxs(ke,{children:[e.jsx(Ee,{children:"Cancelar"}),e.jsx(_e,{onClick:()=>d.mutate({orderIds:c,action:"delete"}),className:"bg-destructive hover:bg-destructive/90",disabled:b,children:b?"Excluindo...":"Excluir Permanentemente"})]})]})]}),e.jsxs("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(M,{variant:"outline",onClick:v,children:[e.jsx(pe,{className:"h-4 w-4 mr-2"})," Atualizar Dados"]})}),c.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-lg bg-card shadow-lg animate-fade-in",children:[e.jsx(Ae,{className:"h-5 w-5 text-primary mr-2"}),e.jsxs("span",{className:"text-sm font-medium mr-4",children:[c.length," selecionado(s)"]}),e.jsxs(Qe,{value:i,onValueChange:r=>f(r),children:[e.jsx(Xe,{className:"w-[200px]",children:e.jsx(We,{placeholder:"Ação em Massa"})}),e.jsx(Ze,{children:Bs.map(r=>e.jsx(Je,{value:r.value,children:r.label},r.value))})]}),e.jsx(M,{onClick:E,disabled:!i||b,children:b?e.jsx(is,{className:"h-4 w-4 animate-spin"}):"Aplicar"})]})]}),s?e.jsxs(Ye,{defaultValue:"pending",children:[e.jsx(es,{className:"w-full overflow-x-auto justify-start",children:N.map(r=>e.jsx(ss,{value:r.value,className:"whitespace-nowrap",children:r.label},r.value))}),N.map(r=>e.jsx(ts,{value:r.value,className:"mt-6",children:e.jsx(qs,{status:r.value,onViewDetails:m,restaurantId:s,selectedOrders:c,setSelectedOrders:p,totalOrdersInView:c.length,onPrint:k})},r.value))]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Carregando dados do restaurante..."})]})]})]}):e.jsx("div",{className:"flex h-screen items-center justify-center",children:"Carregando..."})};export{Pt as default};
