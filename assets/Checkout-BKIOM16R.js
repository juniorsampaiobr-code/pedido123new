import{b as xe,j as e,u as cs,c as Oe}from"./tanstack-d4AvmB45.js";import{r as o,u as ls,h as ds,j as ms,L as Le}from"./vendor-CnEXr6gt.js";import{s as A}from"./client-D5i5GwB9.js";import{c as us,d as bt,e as Ge,P as Se,f as ze,g as ps,h as fs,i as hs,a as we,u as P,L as ye,p as xs,b as ct}from"./index-DqIQx1Xt.js";import{L as gs,g as lt,c as dt}from"./location-DLv6_WTX.js";import{u as ys}from"./use-auth-status-b07NBuTX.js";import{o as _t,s as V,e as ws,u as mt,C as Ce,t as ut}from"./types-DKlirIXB.js";import{B as Z}from"./button-DCsNxu4w.js";import{C as X,b as Q,c as W,a as H}from"./card-B0AOuQVJ.js";import{I as Re,L as q}from"./label-Du-yG0AS.js";import{T as js}from"./textarea-1YQHaUKl.js";import{c as Nt,R as vs,I as bs}from"./index-BfJfR8TW.js";import{u as _s}from"./index-DrlxvCXN.js";import{u as Ns}from"./index-KNP7Yozt.js";import{S as pt}from"./separator-CvOjO1JK.js";import{A as ee,a as ie,b as ce}from"./alert-BfR_uOV2.js";import{P as Cs,M as Es}from"./PhoneInput-D7z6_dGD.js";import{S as Rs,C as Ps,L as Ss}from"./CustomerProfileModal-BEnwC1Ah.js";import{D as ft,a as ht,b as $s,c as As,d as Is}from"./dialog-D7yo1EqN.js";import{C as Ct}from"./credit-card-Dl56H7Fl.js";import{C as ks}from"./CpfCnpjInput-DcQV_hUM.js";import{M as qe}from"./map-pin-B0XVtzw6.js";import{A as Ds,a as Ms,b as Vs,c as Fs,d as Os,e as Ls,g as Ts}from"./alert-dialog-DieCiIm7.js";import{C as ge}from"./circle-alert-BcGISYg1.js";import{F as xt}from"./form-Bpx2Fgn2.js";import{T as gt}from"./terminal-BIOBUBbL.js";import{R as zs}from"./pt-BR-DWEd0_et.js";import{A as qs}from"./arrow-left-DHo1KBW6.js";import{U as yt}from"./user-iDUOhtEc.js";import{T as Te}from"./truck-Bt4rVSgl.js";import{C as Bs}from"./circle-check-big-CqcxwWSS.js";import{S as Gs}from"./save-Dg-rqvA7.js";import{D as Ks}from"./dollar-sign-BkufDnFj.js";import"./supabase-BZV_3FV3.js";import"./skeleton-DDEjblHg.js";import"./store-L_kEjBZ5.js";import"./package-BNgOhWU5.js";import"./check-CYI81mTN.js";import"./circle-x-DdYgGC-f.js";import"./euro-uxbzEb0W.js";import"./format-BeKxgCCE.js";import"./index-6SKZetih.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=us("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Zs=async r=>{const{data:t,error:n}=await A.from("payment_settings").select("mercado_pago_public_key").eq("restaurant_id",r).limit(1).single();if(n&&n.code!=="PGRST116")throw new Error(`Error fetching payment settings: ${n.message}`);return(t==null?void 0:t.mercado_pago_public_key)||null},Et=r=>xe({queryKey:["mercadoPagoPublicKey",r],queryFn:()=>Zs(r),enabled:!!r,staleTime:1e3*60*60*24});var Ke="Radio",[Xs,Rt]=bt(Ke),[Qs,Ws]=Xs(Ke),Pt=o.forwardRef((r,t)=>{const{__scopeRadio:n,name:m,checked:y=!1,required:x,disabled:f,value:d="on",onCheck:I,form:k,...S}=r,[i,v]=o.useState(null),b=Ge(t,F=>v(F)),_=o.useRef(!1),M=i?k||!!i.closest("form"):!0;return e.jsxs(Qs,{scope:n,checked:y,disabled:f,children:[e.jsx(Se.button,{type:"button",role:"radio","aria-checked":y,"data-state":It(y),"data-disabled":f?"":void 0,disabled:f,value:d,...S,ref:b,onClick:ze(r.onClick,F=>{y||I==null||I(),M&&(_.current=F.isPropagationStopped(),_.current||F.stopPropagation())})}),M&&e.jsx(At,{control:i,bubbles:!_.current,name:m,value:d,checked:y,required:x,disabled:f,form:k,style:{transform:"translateX(-100%)"}})]})});Pt.displayName=Ke;var St="RadioIndicator",$t=o.forwardRef((r,t)=>{const{__scopeRadio:n,forceMount:m,...y}=r,x=Ws(St,n);return e.jsx(ps,{present:m||x.checked,children:e.jsx(Se.span,{"data-state":It(x.checked),"data-disabled":x.disabled?"":void 0,...y,ref:t})})});$t.displayName=St;var Hs="RadioBubbleInput",At=o.forwardRef(({__scopeRadio:r,control:t,checked:n,bubbles:m=!0,...y},x)=>{const f=o.useRef(null),d=Ge(f,x),I=Ns(n),k=fs(t);return o.useEffect(()=>{const S=f.current;if(!S)return;const i=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(i,"checked").set;if(I!==n&&b){const _=new Event("click",{bubbles:m});b.call(S,n),S.dispatchEvent(_)}},[I,n,m]),e.jsx(Se.input,{type:"radio","aria-hidden":!0,defaultChecked:n,...y,tabIndex:-1,ref:d,style:{...y.style,...k,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});At.displayName=Hs;function It(r){return r?"checked":"unchecked"}var Js=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],$e="RadioGroup",[Ys,fn]=bt($e,[Nt,Rt]),kt=Nt(),Dt=Rt(),[er,tr]=Ys($e),Mt=o.forwardRef((r,t)=>{const{__scopeRadioGroup:n,name:m,defaultValue:y,value:x,required:f=!1,disabled:d=!1,orientation:I,dir:k,loop:S=!0,onValueChange:i,...v}=r,b=kt(n),_=_s(k),[M,F]=hs({prop:x,defaultProp:y??null,onChange:i,caller:$e});return e.jsx(er,{scope:n,name:m,required:f,disabled:d,value:M,onValueChange:F,children:e.jsx(vs,{asChild:!0,...b,orientation:I,dir:_,loop:S,children:e.jsx(Se.div,{role:"radiogroup","aria-required":f,"aria-orientation":I,"data-disabled":d?"":void 0,dir:_,...v,ref:t})})})});Mt.displayName=$e;var Vt="RadioGroupItem",Ft=o.forwardRef((r,t)=>{const{__scopeRadioGroup:n,disabled:m,...y}=r,x=tr(Vt,n),f=x.disabled||m,d=kt(n),I=Dt(n),k=o.useRef(null),S=Ge(t,k),i=x.value===y.value,v=o.useRef(!1);return o.useEffect(()=>{const b=M=>{Js.includes(M.key)&&(v.current=!0)},_=()=>v.current=!1;return document.addEventListener("keydown",b),document.addEventListener("keyup",_),()=>{document.removeEventListener("keydown",b),document.removeEventListener("keyup",_)}},[]),e.jsx(bs,{asChild:!0,...d,focusable:!f,active:i,children:e.jsx(Pt,{disabled:f,required:x.required,checked:i,...I,...y,name:x.name,ref:S,onCheck:()=>x.onValueChange(y.value),onKeyDown:ze(b=>{b.key==="Enter"&&b.preventDefault()}),onFocus:ze(y.onFocus,()=>{var b;v.current&&((b=k.current)==null||b.click())})})})});Ft.displayName=Vt;var sr="RadioGroupIndicator",Ot=o.forwardRef((r,t)=>{const{__scopeRadioGroup:n,...m}=r,y=Dt(n);return e.jsx($t,{...y,...m,ref:t})});Ot.displayName=sr;var Lt=Mt,Tt=Ft,rr=Ot;const Be=o.forwardRef(({className:r,...t},n)=>e.jsx(Lt,{className:we("grid gap-2",r),...t,ref:n}));Be.displayName=Lt.displayName;const Pe=o.forwardRef(({className:r,...t},n)=>e.jsx(Tt,{ref:n,className:we("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...t,children:e.jsx(rr,{className:"flex items-center justify-center",children:e.jsx(Us,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Pe.displayName=Tt.displayName;var Ue={};Object.defineProperty(Ue,"__esModule",{value:!0});var zt=Ue.loadMercadoPago=void 0;const qt="https://sdk.mercadopago.com/js/v2",nr=/^https:\/\/sdk\.mercadopago\.com\/js\/v2\/?(\?.*)?$/,wt="MercadoPago has already been initialized in your window, please remove the duplicate import",ar="MercadoPago.js not available",or="Failed to load MercadoPago.js",ir=()=>{for(var r=document.querySelectorAll(`script[src^="${qt}"`),t=0;t<r.length;t++){var n=r[t];if(nr.test(n.src))return n}return null},cr=()=>{const r=document.createElement("script");r.src=qt;const t=document.head||document.body;if(!t)throw new Error("Expected document.body or document.head not to be null. MercadoPago requires a <body> or a <head> element, please add on your project.");return t.appendChild(r),r};let Ee=null;const lr=()=>(Ee!==null||(Ee=new Promise((r,t)=>{if(typeof window>"u"){r(null);return}if(window.MercadoPago){console.warn(wt),r(window.MercadoPago);return}try{let n=ir();n?console.warn(wt):n||(n=cr()),n.addEventListener("load",()=>{window.MercadoPago?r(window.MercadoPago):t(new Error(ar))}),n.addEventListener("error",()=>{t(new Error(or))})}catch(n){t(n);return}})),Ee);zt=Ue.loadMercadoPago=lr;var dr=function(r,t,n,m){function y(x){return x instanceof n?x:new n(function(f){f(x)})}return new(n||(n=Promise))(function(x,f){function d(S){try{k(m.next(S))}catch(i){f(i)}}function I(S){try{k(m.throw(S))}catch(i){f(i)}}function k(S){S.done?x(S.value):y(S.value).then(d,I)}k((m=m.apply(r,t||[])).next())})};class K{static getInstance(){return dr(this,void 0,void 0,function*(){if(this.publicKey)return this.loadedInstanceMercadoPago||(yield zt(),this.loadedInstanceMercadoPago=!0),this.instanceMercadoPago||(this.instanceMercadoPago=new window.MercadoPago(this.publicKey,this.options)),this.instanceMercadoPago;console.error("Expected the PUBLIC_KEY to render the MercadoPago SDK React")})}}K.publicKey=null;K.options={};K.instanceMercadoPago=void 0;K.loadedInstanceMercadoPago=!1;function mr(r,t){return Object.keys(r).length===Object.keys(t).length&&Object.keys(r).every(m=>Object.prototype.hasOwnProperty.call(t,m)&&r[m]===t[m])}const ur=(r,t)=>{const n=Object.assign(Object.assign({},t),{frontEndStack:"react"}),m=!mr(K.options,n);(r!==K.publicKey||m)&&(K.publicKey=r,K.options=n,K.instanceMercadoPago=void 0)},pr=({preferenceId:r,initPoint:t,onClose:n})=>{const{data:m,isLoading:y}=Et();return o.useEffect(()=>{if(m)try{ur(m,{locale:"pt-BR"})}catch(x){console.error("Erro ao inicializar Mercado Pago:",x),P.error("Erro ao carregar o SDK do Mercado Pago."),n();return}t&&(console.log("Redirecionando para o Mercado Pago:",t),window.location.href=t)},[m,n,t]),y||!m?e.jsx(ft,{open:!0,onOpenChange:n,children:e.jsx(ht,{className:"sm:max-w-[425px]",children:e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsx(ye,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{children:"Carregando configurações de pagamento..."})]})})}):e.jsx(ft,{open:!0,onOpenChange:n,children:e.jsxs(ht,{className:"sm:max-w-[425px]",children:[e.jsxs($s,{children:[e.jsxs(As,{className:"flex items-center gap-2",children:[e.jsx(Ct,{className:"h-5 w-5 text-primary"}),"Redirecionando para Pagamento"]}),e.jsx(Is,{children:"Você está sendo redirecionado para o checkout seguro do Mercado Pago."})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(ye,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aguarde..."})]}),e.jsx(Z,{variant:"outline",onClick:n,children:"Cancelar e Voltar"})]})})},fr=({latitude:r,longitude:t,address:n,className:m})=>{const y=o.useMemo(()=>[r,t],[r,t]),x=o.useMemo(()=>[r,t],[r,t]);return e.jsxs(X,{className:we("w-full",m),children:[e.jsxs(Q,{children:[e.jsxs(W,{className:"text-lg flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5 text-primary"}),"Sua Localização"]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:n})]}),e.jsx(H,{className:"p-0",children:e.jsx("div",{className:"h-64 w-full rounded-b-lg overflow-hidden",children:e.jsx(gs,{center:x,markerPosition:y,onMarkerDragEnd:()=>{},zoom:16})})})]})},hr=({isOpen:r,onConfirm:t})=>e.jsx(Ds,{open:r,children:e.jsxs(Ms,{children:[e.jsxs(Vs,{children:[e.jsxs(Fs,{className:"flex items-center gap-2 text-primary",children:[e.jsx(ge,{className:"h-6 w-6"}),"Atenção ao Pagamento Online!"]}),e.jsxs(Os,{children:["Você escolheu o pagamento online (Pix ou Cartão).",e.jsx("br",{}),e.jsx("br",{}),"Ao prosseguir, você será redirecionado para o checkout seguro do Mercado Pago.",e.jsx("br",{}),e.jsx("br",{}),'**IMPORTANTE:** Se você escolher **PIX**, após o pagamento, você pode precisar clicar no botão **"Voltar ao site"** na tela do Mercado Pago para que seu pedido seja finalizado e rastreado corretamente.']})]}),e.jsx(Ls,{children:e.jsx(Ts,{onClick:t,className:"w-full",children:"Entendi e Continuar"})})]})}),xr=({onAddressSelect:r,defaultValue:t,disabled:n})=>{const m=o.useRef(null),y=o.useRef(null);return o.useEffect(()=>{!m.current||!window.google||!window.google.maps||!window.google.maps.places||(y.current=new window.google.maps.places.Autocomplete(m.current,{componentRestrictions:{country:"br"},fields:["address_components","geometry","formatted_address"],types:["address"]}),y.current.addListener("place_changed",()=>{var I,k,S;const x=(I=y.current)==null?void 0:I.getPlace();if(!x||!x.address_components||!x.geometry)return;const f={street:"",number:"",neighborhood:"",city:"",state:"",zip_code:"",latitude:((k=x.geometry.location)==null?void 0:k.lat())||0,longitude:((S=x.geometry.location)==null?void 0:S.lng())||0},d=["sublocality_level_1","neighborhood","sublocality","sublocality_level_2","sublocality_level_3"];if(x.address_components.forEach(i=>{const v=i.types;v.includes("route")&&(f.street=i.long_name),v.includes("street_number")&&(f.number=i.long_name);for(const b of d)if(v.includes(b)&&!f.neighborhood){f.neighborhood=i.long_name;break}(v.includes("administrative_area_level_2")||v.includes("locality"))&&(f.city=i.long_name),v.includes("administrative_area_level_1")&&(f.state=i.short_name),v.includes("postal_code")&&(f.zip_code=i.long_name.replace(/\D/g,""))}),!f.neighborhood||f.neighborhood===f.street){const i=x.formatted_address||"";console.log("[AddressAutocomplete] Iniciando extração forçada de bairro do texto:",i);const v=i.split(","),b=v.findIndex(_=>_.includes(f.street));if(b!==-1&&v.length>b+1){let _=v[b+1].trim();_.includes(f.number)&&v.length>b+2&&(_=v[b+2].trim());const M=/^\d{5}-\d{3}$/.test(_)||/^\d{8}$/.test(_),F=/^[A-Z]{2}$/.test(_),te=/^\d+$/.test(_);!M&&!F&&!te&&_.length>2&&(f.neighborhood=_)}f.neighborhood===f.street&&(f.neighborhood=""),console.log("[AddressAutocomplete] Resultado final da extração de bairro:",f.neighborhood)}r(f)}))},[r]),e.jsxs("div",{className:"relative",children:[e.jsx(Rs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Re,{ref:m,placeholder:"Busque seu endereço (Rua, Número...)",defaultValue:t,className:"pl-10 h-12",disabled:n})]})},jt=r=>{if(!r)return"";let t=r.replace(/\D/g,"");return t.length>11&&(t=t.slice(0,11)),t.length>0&&(t=`(${t}`),t.length>3&&(t=`${t.slice(0,3)}) ${t.slice(3)}`),t.length>10&&(t=`${t.slice(0,10)}-${t.slice(10)}`),t},vt=r=>{if(!r)return"";let t=r.replace(/\D/g,"");return t.length>14&&(t=t.slice(0,14)),t.length<=11?(t.length>9&&(t=`${t.slice(0,9)}-${t.slice(9)}`),t.length>6&&(t=`${t.slice(0,6)}.${t.slice(6)}`),t.length>3&&(t=`${t.slice(0,3)}.${t.slice(3)}`)):(t.length>12&&(t=`${t.slice(0,12)}-${t.slice(12)}`),t.length>8&&(t=`${t.slice(0,8)}/${t.slice(8)}`),t.length>5&&(t=`${t.slice(0,5)}.${t.slice(5)}`),t.length>2&&(t=`${t.slice(0,2)}.${t.slice(2)}`)),t},gr=_t({zip_code:V().min(1,"CEP é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length===8,{message:"O CEP deve ter 8 dígitos."}),street:V().min(1,"Rua é obrigatória."),number:V().optional(),complement:V().optional(),neighborhood:V().min(1,"Bairro é obrigatório."),city:V().min(1,"Cidade é obrigatória."),state:V().min(1,"Estado é obrigatória.")}),yr=_t({name:V().min(1,"Nome é obrigatório."),phone:V().min(1,"Telefone é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length>=10,{message:"O telefone deve ter pelo menos 10 dígitos."}),cpf_cnpj:V().min(1,"CPF/CNPJ é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length===11||r.length===14,{message:"CPF deve ter 11 dígitos ou CNPJ 14 dígitos."}),delivery_option:ws(["delivery","pickup"],{required_error:"Selecione uma opção de entrega."}),notes:V().optional(),payment_method_id:V().min(1,"Selecione um método de pagamento."),change_for:V().optional()}),wr=async r=>{const{data:t,error:n}=await A.from("restaurants").select("id, name, address, phone, email, street, number, neighborhood, city, zip_code, latitude, longitude, delivery_enabled").eq("id",r).eq("is_active",!0).limit(1).single();if(n)throw new Error(`Erro ao buscar restaurante: ${n.message}`);if(!t)throw new Error("Restaurante não encontrado ou inativo.");return t},jr=async r=>{const{data:t,error:n}=await A.from("delivery_zones").select("*").eq("restaurant_id",r).eq("is_active",!0).order("max_distance_km",{ascending:!0});if(n)throw new Error(`Erro ao buscar zonas de entrega: ${n.message}`);return t},vr=async r=>{const{data:t,error:n}=await A.from("payment_methods").select("*").eq("restaurant_id",r).eq("is_active",!0).order("name",{ascending:!0});if(n)throw new Error(`Erro ao buscar métodos de pagamento: ${n.message}`);return t},br=async r=>{const{data:t,error:n}=await A.from("customers").select("*, complement, state").eq("user_id",r).limit(1).single();if(n&&n.code!=="PGRST116")throw new Error(n.message);return t||null},hn=()=>{var st,rt,nt,at,ot;const r=ls(),t=ds(),[n]=ms(),m=cs(),{items:y,totalAmount:x,clearCart:f}=xs(),{data:d,isLoading:I}=ys(),[k]=o.useState((st=t.state)==null?void 0:st.restaurantId),S=n.get("restaurantId"),i=k||S,{data:v}=Et(i),[b,_]=o.useState(!1),[M,F]=o.useState(!1),[te,se]=o.useState(0),[le,re]=o.useState(null),[Ae,J]=o.useState(!0),[Y,de]=o.useState(null),[Bt,Ie]=o.useState(!1),[Gt,Kt]=o.useState(null),[Ze,Ut]=o.useState(null),[U,ne]=o.useState(!1),[Zt,Xe]=o.useState(!1),[Qe,ke]=o.useState(null),[De,me]=o.useState(null),[Xt,ue]=o.useState(!1),ae=o.useRef(null),{data:w,isLoading:Qt,isError:Wt,error:We,refetch:Ht}=xe({queryKey:["checkoutRestaurantData",i],queryFn:()=>wr(i),enabled:!!i,staleTime:1e3*60*5}),{data:B,isLoading:Jt}=xe({queryKey:["checkoutDeliveryZones",i],queryFn:()=>jr(w.id),enabled:!!w,staleTime:1e3*60*5}),{data:G,isLoading:Yt}=xe({queryKey:["checkoutPaymentMethods",i],queryFn:()=>vr(w.id),enabled:!!w,staleTime:1/0}),{data:l,isLoading:He,refetch:_r}=xe({queryKey:["checkoutCustomerData",d==null?void 0:d.id],queryFn:()=>br(d.id),enabled:!!d,staleTime:0}),pe=o.useMemo(()=>w!=null&&w.latitude&&(w!=null&&w.longitude)?[w.latitude,w.longitude]:null,[w]);o.useEffect(()=>{const s=async()=>{document.hidden?(console.log("Página oculta. Iniciando timer de expiração de 20 minutos..."),ae.current=setTimeout(async()=>{console.log("Timer expirado. Deslogando usuário..."),await A.auth.signOut(),P.error("Sessão expirada.",{description:"Você ficou fora da página de checkout por mais de 20 minutos. Por favor, identifique-se novamente.",duration:6e3}),r("/auth",{state:{from:"/checkout",restaurantId:i},replace:!0})},12e5)):(console.log("Página visível. Cancelando timer de expiração."),ae.current&&(clearTimeout(ae.current),ae.current=null))};return document.addEventListener("visibilitychange",s),()=>{document.removeEventListener("visibilitychange",s),ae.current&&clearTimeout(ae.current)}},[r,i]);const Me=o.useCallback(async(s,a,u,c,h,g,R,$)=>{const D=[30,45];if(w&&w.delivery_enabled===!1){const E=`${a}, ${u}, ${h}, ${c}, ${g}, ${s}`;let C=null;if(R&&$?C={lat:R,lng:$}:C=await lt(E),!C)return{coords:null,fee:0,time:null,isValid:!1};if(B&&B.length>0&&pe){const T=dt([C.lat,C.lng],pe,B);if(T)return{coords:C,fee:0,time:[T.minTime,T.maxTime],isValid:!0}}return{coords:C,fee:0,time:D,isValid:!0}}if(!w||!pe)return{coords:null,fee:0,time:D,isValid:!0};const L=`${a}, ${u}, ${h}, ${c}, ${g}, ${s}`;let N=null;if(R&&$?N={lat:R,lng:$}:N=await lt(L),!N)return{coords:null,fee:0,time:null,isValid:!1};if(B&&B.length>0){const E=dt([N.lat,N.lng],pe,B);return E?{coords:N,fee:E.fee,time:[E.minTime,E.maxTime],isValid:!0}:{coords:N,fee:0,time:null,isValid:!1}}else return{coords:N,fee:0,time:D,isValid:!0}},[w,pe,B]),p=mt({resolver:ut(yr),defaultValues:{name:"",phone:"",cpf_cnpj:"",delivery_option:"delivery",notes:"",payment_method_id:"",change_for:""},mode:"onBlur"}),j=mt({resolver:ut(gr),defaultValues:{zip_code:"",street:"",number:"",complement:"",neighborhood:"",city:"",state:""},mode:"onBlur"});o.useEffect(()=>{j.reset({zip_code:"",street:"",number:"",complement:"",neighborhood:"",city:"",state:""}),ne(!1),de(null),me(null),se(0),re(null),J(!0),ue(!1)},[]);const O=p.watch("delivery_option"),es=p.watch("payment_method_id"),oe=G==null?void 0:G.find(s=>s.id===es),Ve=(rt=oe==null?void 0:oe.name)==null?void 0:rt.includes("online"),fe=(nt=oe==null?void 0:oe.name)==null?void 0:nt.includes("Dinheiro"),z=x+te,je=j.watch(["zip_code","street","number","city","neighborhood","complement","state"]),Je=o.useMemo(()=>{const[s,a,u,c,h,g,R]=je;return`${a}|${u||""}|${g||""}|${h}|${c}|${s}|${R}`},[je]);o.useEffect(()=>{if(!i)return;const s=A.channel("delivery-zones-changes").on("postgres_changes",{event:"*",schema:"public",table:"delivery_zones",filter:`restaurant_id=eq.${i}`},()=>{console.log("[Realtime] Zonas de entrega atualizadas. Invalidando query..."),m.invalidateQueries({queryKey:["checkoutDeliveryZones",i]}),P.info("As taxas de entrega foram atualizadas.",{duration:3e3})}).subscribe(),a=A.channel("restaurant-settings-changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"restaurants",filter:`id=eq.${i}`},()=>{console.log("[Realtime] Configurações do restaurante atualizadas. Invalidando query..."),m.invalidateQueries({queryKey:["checkoutRestaurantData",i]}),P.info("As configurações da loja foram atualizadas.",{duration:3e3})}).subscribe();return()=>{A.removeChannel(s),A.removeChannel(a)}},[i,m]),o.useEffect(()=>{(async()=>{if(l){if(p.reset({...p.getValues(),name:l.name||"",phone:jt(l.phone||""),cpf_cnpj:vt(l.cpf_cnpj||""),change_for:""}),l.street&&l.zip_code&&(j.reset({zip_code:l.zip_code,street:l.street,number:l.number||"",complement:l.complement||"",neighborhood:l.neighborhood||"",city:l.city||"",state:l.state||""}),l.latitude&&l.longitude)){de([Number(l.latitude),Number(l.longitude)]),ne(!0);const a=`${l.street}|${l.number||""}|${l.complement||""}|${l.neighborhood}|${l.city}|${l.zip_code}|${l.state}`;if(me(a),w&&B)try{const u=await Me(l.zip_code,l.street,l.number||"",l.city||"",l.neighborhood||"",l.state||"",Number(l.latitude),Number(l.longitude));se(u.fee),re(u.time),J(u.isValid),u.isValid||P.warning("Seu endereço salvo está fora da área de entrega. Por favor, verifique ou selecione Retirada no Local.")}catch(u){console.error("Erro ao calcular taxa de endereço salvo:",u),P.error("Erro ao calcular taxa de entrega para endereço salvo."),J(!1),se(0),re(null)}}}else if(d&&!He){const a=d.user_metadata;p.reset({...p.getValues(),name:a.full_name||"",phone:jt(a.phone||""),cpf_cnpj:vt(a.cpf_cnpj||""),change_for:""})}})()},[l,d,He,p,j,Me,w,B]),o.useEffect(()=>{O==="delivery"&&De!==null&&Je!==De&&(ne(!1),se(0),re(null),J(!0),de(null),me(null),ue(!1))},[Je,De,O]);const ve=p.watch("change_for");o.useEffect(()=>{if(fe&&ve&&ve.trim()!==""){const s=ve.replace(",","."),a=parseFloat(s);isNaN(a)?p.setError("change_for",{message:"O troco deve ser um número válido."}):a<z?p.setError("change_for",{message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z)}).`}):p.clearErrors("change_for")}else p.clearErrors("change_for")},[fe,ve,z,p]);const be=Oe({mutationFn:async s=>{var it;F(!0);const a=s.number||"";if(O==="delivery"&&!a)throw F(!1),new Error("O número da residência é obrigatório para a entrega. Por favor, inclua o número na busca (Ex: Rua X, 123) e clique em Salvar.");const u=`${s.street}, ${a}${s.complement?` - ${s.complement}`:""}, ${s.neighborhood}, ${s.city}, ${s.state}, ${s.zip_code}`,c=await Me(s.zip_code,s.street,a,s.city,s.neighborhood,s.state);if(F(!1),!c.isValid)throw new Error((w==null?void 0:w.delivery_enabled)===!1?"O endereço está errado ou incompleto, revise todos os campos.":"Endereço fora da área de entrega.");if(!c.coords)throw new Error("Não foi possível obter as coordenadas para salvar o endereço.");const h=p.getValues("name"),g=p.getValues("phone"),R=p.getValues("cpf_cnpj"),$=g.replace(/\D/g,""),D=R.replace(/\D/g,"")||null;if(!h||$.length<10||!D||D.length!==11&&D.length!==14)throw new Error("Preencha Nome, Telefone (10+ dígitos) e CPF/CNPJ (11 ou 14 dígitos) nos Seus Dados antes de salvar o endereço.");const N=(it=(await A.auth.getUser()).data.user)==null?void 0:it.id;if(!(l!=null&&l.id)&&!N)return{customer:{id:"anonymous",user_id:null,name:h,phone:$,email:null,address:u,created_at:"",updated_at:"",latitude:c.coords.lat,longitude:c.coords.lng,cpf_cnpj:D,street:s.street,number:a,neighborhood:s.neighborhood,city:s.city,zip_code:s.zip_code,complement:s.complement||null,state:s.state},feeResult:c};const E={name:h,phone:$,cpf_cnpj:D},C={user_id:(d==null?void 0:d.id)||null,...E,email:(d==null?void 0:d.email)||null,address:u,latitude:c.coords.lat,longitude:c.coords.lng,street:s.street,number:a,neighborhood:s.neighborhood,city:s.city,zip_code:s.zip_code,complement:s.complement||null,state:s.state},T="*, street, number, neighborhood, city, zip_code, complement, state";let Fe;if(l!=null&&l.id){const{data:Ne,error:he}=await A.from("customers").update(C).eq("id",l.id).select(T).single();if(he)throw he;Fe=Ne}else if(N){const{data:Ne,error:he}=await A.from("customers").insert(C).select(T).single();if(he)throw he;Fe=Ne}else throw new Error("Não foi possível identificar o cliente para salvar.");return{customer:Fe,feeResult:c}},onSuccess:(s,a)=>{const{customer:u,feeResult:c}=s;(u==null?void 0:u.id)!=="anonymous"&&m.invalidateQueries({queryKey:["checkoutCustomerData"]}),se(c.fee),re(c.time),J(c.isValid),ne(!0),de([c.coords.lat,c.coords.lng]);const h=a.number||"",g=`${a.street}|${h}|${a.complement||""}|${a.neighborhood}|${a.city}|${a.zip_code}|${a.state}`;me(g),ue(!1),P.success("Endereço salvo e taxa de entrega calculada!")},onError:s=>{P.error(`Erro ao salvar endereço: ${s.message}`),J(!1),ne(!1)}}),ts=s=>{be.mutate(s)},Ye=Oe({mutationFn:async s=>{var D,L;if(!w)throw new Error("Dados do restaurante não disponíveis.");(D=(await A.auth.getUser()).data.user)==null||D.id;const u=s.phone.replace(/\D/g,""),c=((L=s.cpf_cnpj)==null?void 0:L.replace(/\D/g,""))||null;if(!s.name||u.length<10||c&&c.length!==11&&c.length!==14)throw new Error("Dados de contato incompletos ou inválidos.");const h=j.getValues(),g=O==="delivery"?`${h.street}, ${h.number||""}${h.complement?` - ${h.complement}`:""}, ${h.neighborhood}, ${h.city}, ${h.state}, ${h.zip_code}`:null,R={user_id:(d==null?void 0:d.id)||null,name:s.name,phone:u,email:(d==null?void 0:d.email)||null,cpf_cnpj:c,address:g,latitude:Y?Y[0]:null,longitude:Y?Y[1]:null,street:j.getValues("street")||null,number:j.getValues("number")||null,neighborhood:j.getValues("neighborhood")||null,city:j.getValues("city")||null,zip_code:j.getValues("zip_code")||null,complement:j.getValues("complement")||null,state:j.getValues("state")||null};d||(R.email=null);const $="*, street, number, neighborhood, city, zip_code, complement, state";if(d)if(l){const{data:N,error:E}=await A.from("customers").update(R).eq("id",l.id).select($).single();if(E)throw E;return N}else{const{data:N,error:E}=await A.from("customers").insert(R).select($).single();if(E)throw E;return N}else{const{data:N,error:E}=await A.from("customers").insert(R).select($).single();if(E)throw E;return N}},onSuccess:()=>{m.invalidateQueries({queryKey:["checkoutCustomerData"]})},onError:s=>{P.error(`Erro ao salvar dados do cliente: ${s.message}`)}}),et=Oe({mutationFn:async({customerId:s,data:a})=>{if(!w)throw new Error("Dados do restaurante não disponíveis.");let u=null;if(fe&&a.change_for&&a.change_for.trim()!==""){const C=a.change_for.replace(",","."),T=parseFloat(C);!isNaN(T)&&T>z&&(u=T)}let[c,h]=le||[null,null];if((O==="delivery"||O==="pickup")&&(!c||!h)){const C=O==="pickup"?[15,30]:[30,45];c=C[0],h=C[1]}const g=j.getValues(),R=O==="delivery"?`${g.street}, ${g.number||""}${g.complement?` - ${g.complement}`:""}, ${g.neighborhood}, ${g.city}, ${g.state}, ${g.zip_code}`:null,$={restaurant_id:w.id,customer_id:s,status:Ve?"pending_payment":"pending",total_amount:z,delivery_fee:te,delivery_address:R,notes:a.notes,payment_method_id:a.payment_method_id,change_for:u,min_delivery_time_minutes:c,max_delivery_time_minutes:h},{data:D,error:L}=await A.from("orders").insert($).select("id").single();if(L)throw L;const N=y.map(C=>({order_id:D.id,product_id:C.product.id,quantity:parseFloat(C.quantity.toFixed(3)),unit_price:parseFloat(C.product.price.toFixed(2)),subtotal:parseFloat(C.subtotal.toFixed(2)),notes:C.notes})),{error:E}=await A.from("order_items").insert(N);if(E)throw E;return D.id},onSuccess:s=>{m.invalidateQueries({queryKey:["orders"]})},onError:s=>{P.error(`Erro ao criar pedido: ${s.message}`)}}),ss=async s=>{if(fe&&s.change_for&&s.change_for.trim()!==""){const c=s.change_for.replace(",","."),h=parseFloat(c);if(isNaN(h)){P.error("O troco deve ser um número válido.");return}if(h<z){p.setError("change_for",{type:"manual",message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z)}).`});return}}if(y.length===0){P.error("Seu carrinho está vazio."),r(`/menu/${i}`);return}if(O==="delivery"){if(!U){P.error("Você deve salvar e validar o endereço de entrega antes de finalizar o pedido.");return}if(!Ae){P.error("O endereço de entrega está fora da área de cobertura.");return}}let a;try{a=(await Ye.mutateAsync(s)).id}catch(c){P.error(`Falha ao salvar cliente: ${c.message}`);return}let u;try{u=await et.mutateAsync({customerId:a,data:s})}catch(c){P.error(`Falha ao criar pedido: ${c.message}`);return}Ve?await rs(u,s):(f(),r(`/order-success/${u}`,{replace:!0}))},rs=async(s,a)=>{if(!w)return;const u=window.location.origin+window.location.pathname,c=y.map(g=>({name:g.product.name,price:g.product.price,quantity:g.quantity})),h=P.loading("Preparando pagamento online...");try{const{data:g,error:R}=await A.functions.invoke("create-payment-preference",{body:{orderId:s,items:c,totalAmount:z,restaurantName:w.name,clientUrl:u,customerEmail:(d==null?void 0:d.email)||"cliente@anonimo.com",customerCpfCnpj:a.cpf_cnpj}});if(R)throw R;const{init_point:$}=g;Kt(s),Ut($),Ie(!0),P.dismiss(h)}catch(g){P.dismiss(h),P.error(`Erro no pagamento online: ${g.message}`),Ie(!1)}},ns=async()=>{await A.auth.signOut(),P.success("Você saiu da sua conta."),r("/auth",{replace:!0})},as=(s,a,u)=>{a&&u?(ke(s),Xe(!0)):(p.setValue("payment_method_id",s,{shouldValidate:!0}),ke(null))},os=()=>{Qe&&p.setValue("payment_method_id",Qe,{shouldValidate:!0}),Xe(!1),ke(null)},is=o.useCallback(s=>{j.setValue("zip_code",s.zip_code,{shouldValidate:!0}),j.setValue("street",s.street,{shouldValidate:!0}),j.setValue("neighborhood",s.neighborhood,{shouldValidate:!0}),j.setValue("city",s.city,{shouldValidate:!0}),j.setValue("state",s.state,{shouldValidate:!0}),j.setValue("number",s.number,{shouldValidate:!0}),j.setValue("complement","",{shouldValidate:!0}),s.number?(ue(!1),P.info("Endereço encontrado! Verifique o complemento e clique em Salvar.")):(ue(!0),P.warning("Endereço encontrado, mas o número está faltando. Por favor, inclua o número na busca (Ex: Rua X, 123) e clique em Salvar.")),ne(!1),se(0),re(null),J(!0),de(null),me(null)},[j]),_e=o.useMemo(()=>{const[s,a,u,c,h,g,R]=je;if(!a)return"";const $=[];a&&$.push(a),u&&$.push(u),h&&$.push(h);let D=$.join(", ");const L=[];c&&L.push(c),R&&L.push(R);let N=L.join(" - ");const E=s.replace(/\D/g,"");let C="";return E.length===8&&(C=`${E.slice(0,5)}-${E.slice(5)}`),C&&(N+=(N?", CEP: ":"CEP: ")+C),g&&(N+=(N?", ":"")+`(Comp: ${g})`),[D,N].filter(Boolean).join(", ")},[je]);if(!i)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(ee,{variant:"destructive",className:"max-w-lg",children:[e.jsx(gt,{className:"h-4 w-4"}),e.jsx(ie,{children:"Erro de Rastreamento"}),e.jsx(ce,{children:"Não foi possível identificar o restaurante para o qual o pedido está sendo feito. Por favor, volte ao menu."}),e.jsx(Le,{to:"/",children:e.jsx(Z,{className:"mt-3",variant:"secondary",size:"sm",children:"Voltar"})})]})});if(y.length===0)return o.useEffect(()=>{r(`/menu/${i}`)},[r,i]),e.jsx(ct,{});if(Qt||Jt||Yt||I)return e.jsx(ct,{});if(Wt||!w)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(ee,{variant:"destructive",className:"max-w-lg",children:[e.jsx(gt,{className:"h-4 w-4"}),e.jsx(ie,{children:"Erro Crítico"}),e.jsx(ce,{children:We instanceof Error?We.message:"Não foi possível carregar os dados do restaurante."}),e.jsxs(Z,{onClick:()=>Ht(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(zs,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]})});const tt=Ye.isPending||et.isPending||be.isPending||M||O==="delivery"&&!U;return e.jsx("div",{className:"min-h-screen bg-background w-full overflow-x-hidden",children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-6 py-4 sm:py-8 max-w-5xl space-y-6 sm:space-y-8",children:[e.jsx(Ps,{isOpen:b,onClose:()=>_(!1),customer:l}),e.jsx(hr,{isOpen:Zt,onConfirm:os}),Bt&&Ze&&e.jsx(pr,{preferenceId:Gt,initPoint:Ze,onClose:()=>Ie(!1)}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto",children:[e.jsx(Le,{to:`/menu/${i}`,children:e.jsx(Z,{variant:"ghost",size:"icon","aria-label":"Voltar ao Menu",children:e.jsx(qs,{className:"h-6 w-6"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg sm:text-3xl font-bold text-foreground",children:"Finalizar Pedido"}),e.jsx("p",{className:"text-xs sm:text-lg text-muted-foreground font-medium truncate max-w-full",children:w.name})]})]}),d&&e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto justify-end",children:[e.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>_(!0),"aria-label":"Meu Perfil e Pedidos",className:"flex-1 sm:flex-none text-xs sm:text-sm h-8 sm:h-9",children:[e.jsx(yt,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"truncate",children:"Perfil / Pedidos"})]}),e.jsxs(Z,{variant:"outline",size:"sm",onClick:ns,className:"flex-shrink-0 text-xs sm:text-sm h-8 sm:h-9",children:[e.jsx(Ss,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"})," Sair"]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 sm:gap-8 w-full",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6 min-w-0",children:[e.jsxs(X,{className:"w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(W,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(yt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Seus Dados"]})}),e.jsxs(H,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx("div",{className:"flex justify-between items-center mb-3 sm:mb-4",children:e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:d?`Logado como ${d.email}`:"Pedido anônimo"})}),e.jsx(xt,{...p,children:e.jsx("form",{onSubmit:p.handleSubmit(ss),id:"checkout-form",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(q,{htmlFor:"name",className:"text-xs sm:text-sm",children:"Nome Completo *"}),e.jsx(Re,{id:"name",...p.register("name"),className:"h-9 sm:h-12 text-sm w-full"}),p.formState.errors.name&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:p.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(q,{htmlFor:"phone",className:"text-xs sm:text-sm",children:"Telefone *"}),e.jsx(Ce,{name:"phone",control:p.control,render:({field:s})=>e.jsx(Cs,{id:"phone",...s,className:"h-9 sm:h-12 text-sm w-full"})}),p.formState.errors.phone&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:p.formState.errors.phone.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(q,{htmlFor:"cpf_cnpj",className:"text-xs sm:text-sm",children:"CPF/CNPJ *"}),e.jsx(Ce,{name:"cpf_cnpj",control:p.control,render:({field:s})=>e.jsx(ks,{id:"cpf_cnpj",...s,className:"h-9 sm:h-12 text-sm w-full"})}),p.formState.errors.cpf_cnpj&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:p.formState.errors.cpf_cnpj.message})]})]})})})]})]}),e.jsxs(X,{className:"w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(W,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Opção de Entrega"]})}),e.jsx(H,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsx(Ce,{name:"delivery_option",control:p.control,render:({field:s})=>e.jsxs(Be,{onValueChange:s.onChange,value:s.value,className:"grid grid-cols-2 gap-2 sm:gap-4 min-w-0 w-full",children:[e.jsxs(q,{htmlFor:"delivery",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-2 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer text-center w-full max-w-full",children:[e.jsx(Pe,{value:"delivery",id:"delivery",className:"sr-only"}),e.jsx(Te,{className:"mb-1.5 sm:mb-3 h-4 w-4 sm:h-6 sm:w-6 flex-shrink-0"}),e.jsx("span",{translate:"no",className:"text-xs sm:text-base break-words w-full",children:"Entrega"})]}),e.jsxs(q,{htmlFor:"pickup",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-2 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer text-center w-full max-w-full",children:[e.jsx(Pe,{value:"pickup",id:"pickup",className:"sr-only"}),e.jsx(qe,{className:"mb-1.5 sm:mb-3 h-4 w-4 sm:h-6 sm:w-6 flex-shrink-0"}),e.jsx("span",{translate:"no",className:"text-xs sm:text-base break-words w-full",children:"Retirada no Local"})]})]})})})]}),O==="delivery"&&e.jsxs(X,{className:we("w-full overflow-hidden",!U&&"border-destructive ring-2 ring-destructive/50"),children:[e.jsxs(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:[e.jsxs(W,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Endereço de Entrega",U&&e.jsx(Bs,{className:"h-4 w-4 sm:h-5 sm:w-5 text-green-500 ml-2 flex-shrink-0"}),!U&&e.jsx(ge,{className:"h-4 w-4 sm:h-5 sm:w-5 text-destructive ml-2 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Preencha e salve para calcular a taxa."})]}),e.jsxs(H,{className:"space-y-3 sm:space-y-4 px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx(xt,{...j,children:e.jsxs("form",{onSubmit:j.handleSubmit(ts),id:"address-form-inner",className:"space-y-3 sm:space-y-4",autoComplete:"off",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(q,{htmlFor:"address-search",className:"text-xs sm:text-sm",children:"Buscar Endereço (Rua, Nº, Bairro) *"}),e.jsx(xr,{onAddressSelect:is,disabled:M})]}),Xt&&e.jsxs(ee,{variant:"destructive",className:"p-2 sm:p-4",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx(ie,{className:"text-sm",children:"Número da Residência Ausente"}),e.jsx(ce,{className:"text-xs",children:"Por favor, inclua o **número** na sua busca (Ex: Rua X, 123) e clique em Salvar."})]}),e.jsx("input",{type:"hidden",...j.register("zip_code")}),e.jsx("input",{type:"hidden",...j.register("street")}),e.jsx("input",{type:"hidden",...j.register("neighborhood")}),e.jsx("input",{type:"hidden",...j.register("city")}),e.jsx("input",{type:"hidden",...j.register("state")}),e.jsx("input",{type:"hidden",...j.register("number")}),e.jsx("div",{className:"grid grid-cols-1 gap-3 sm:gap-4 min-w-0",children:e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(q,{htmlFor:"complement",className:"text-xs sm:text-sm",children:"Complemento"}),e.jsx(Re,{id:"complement",...j.register("complement"),placeholder:"Apto, Bloco...",className:"h-9 sm:h-12 text-sm",autoComplete:"off"})]})}),_e&&e.jsxs("div",{className:"bg-muted p-2 sm:p-3 rounded text-xs sm:text-sm break-words overflow-hidden",children:[e.jsx("p",{children:e.jsx("strong",{children:"Endereço:"})}),e.jsx("p",{className:"text-sm text-foreground",children:_e})]}),e.jsxs(Z,{type:"submit",className:"w-full h-auto py-2 text-xs sm:text-base mt-2 whitespace-normal",disabled:be.isPending||M,children:[be.isPending||M?e.jsx(ye,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin mr-2"}):e.jsx(Gs,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2"})," Salvar e Calcular"]})]})}),M&&e.jsxs(ee,{className:"flex items-center gap-2 p-2 sm:p-4",children:[e.jsx(ye,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin"}),e.jsx(ie,{className:"text-xs sm:text-sm",children:"Calculando..."})]}),U&&!M&&e.jsxs(e.Fragment,{children:[w.delivery_enabled!==!1&&!Ae&&e.jsxs(ee,{variant:"destructive",className:"p-2 sm:p-4",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx(ie,{className:"text-sm",children:"Fora da Área"}),e.jsx(ce,{className:"text-xs",children:"Endereço fora da área de cobertura."})]}),(w.delivery_enabled===!1||Ae&&le)&&e.jsxs(ee,{variant:"default",className:"bg-green-50 dark:bg-green-900/20 border-green-200 text-green-700 p-2 sm:p-4",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx(ie,{className:"text-sm",children:"Entrega Disponível"}),e.jsxs(ce,{className:"text-xs",children:["Taxa: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(te),". Tempo: ",le?`${le[0]}-${le[1]}`:"30-45"," min."]})]})]}),U&&Y&&_e&&e.jsx("div",{className:"mt-4 w-full overflow-hidden rounded-md border",children:e.jsx(fr,{latitude:Y[0],longitude:Y[1],address:_e,className:"w-full"})})]})]}),e.jsxs(X,{className:"w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(W,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(Ct,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Pagamento *"]})}),e.jsxs(H,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx(Ce,{name:"payment_method_id",control:p.control,render:({field:s})=>e.jsx(Be,{onValueChange:a=>{var g;const u=G==null?void 0:G.find(R=>R.id===a),c=(g=u==null?void 0:u.name)==null?void 0:g.includes("online"),h=!!v&&v.trim()!=="";as(a,!!c,h)},value:s.value,className:"space-y-2 sm:space-y-3 w-full",children:G==null?void 0:G.map(a=>{var g;const u=(g=a.name)==null?void 0:g.includes("online"),c=!!v&&v.trim()!=="",h=u&&!c;return e.jsx(q,{htmlFor:a.id,className:we("flex items-center justify-between rounded-md border-2 border-muted bg-popover p-2.5 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer w-full max-w-full",h&&"opacity-50 cursor-not-allowed"),children:e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 overflow-hidden min-w-0 w-full",children:[e.jsx(Pe,{value:a.id,id:a.id,disabled:h,className:"flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-xs sm:text-base break-words w-full leading-tight whitespace-normal",translate:"no",children:a.name}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground truncate",children:a.description}),h&&e.jsx("p",{className:"text-[10px] text-destructive mt-0.5",children:"Indisponível no momento."})]})]})},a.id)})})}),p.formState.errors.payment_method_id&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm mt-2",children:p.formState.errors.payment_method_id.message})]})]}),fe&&e.jsxs(X,{className:"w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(W,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(Ks,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Troco"]})}),e.jsx(H,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(q,{htmlFor:"change_for",className:"text-xs sm:text-sm",children:"Precisa de troco para quanto?"}),e.jsx(Re,{id:"change_for",type:"number",step:"0.01",placeholder:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z),...p.register("change_for"),className:"h-9 sm:h-12 text-sm w-full"}),((at=p.formState.errors.change_for)==null?void 0:at.message)&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:p.formState.errors.change_for.message}),((ot=p.formState.errors.change_for)==null?void 0:ot.type)==="manual"&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:p.formState.errors.change_for.message})]})})]}),e.jsxs(X,{className:"w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(W,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(Es,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Observações"]})}),e.jsx(H,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(q,{htmlFor:"notes",className:"text-xs sm:text-sm",children:"Notas para o restaurante"}),e.jsx(js,{id:"notes",...p.register("notes"),rows:3,placeholder:"Ex: Entregar na portaria, sem pimenta...",className:"text-sm w-full"})]})})]})]}),e.jsx("div",{className:"lg:col-span-1 space-y-6 sticky top-4 self-start min-w-0",children:e.jsxs(X,{className:"shadow-lg w-full overflow-hidden",children:[e.jsx(Q,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsx(W,{className:"text-lg sm:text-2xl",children:"Resumo"})}),e.jsxs(H,{className:"space-y-3 sm:space-y-4 px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:y.map(s=>e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsxs("span",{className:"truncate max-w-[70%]",children:[s.quantity,"x ",s.product.name]}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.subtotal)})]},s.product.id))}),e.jsx(pt,{}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm text-muted-foreground",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x)})]}),e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm text-muted-foreground",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(te)})]})]}),e.jsx(pt,{}),e.jsxs("div",{className:"flex justify-between font-bold text-base sm:text-xl",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z)})]}),e.jsx(Z,{type:"submit",form:"checkout-form",className:"w-full h-10 sm:h-12 text-sm sm:text-lg",disabled:tt,children:tt?e.jsx(ye,{className:"h-4 w-4 sm:h-5 sm:w-5 animate-spin mr-2"}):Ve?"Pagar e Finalizar":"Confirmar Pedido"}),O==="delivery"&&!U&&e.jsxs(ee,{variant:"destructive",className:"mt-3 p-2 sm:p-4",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx(ce,{className:"text-xs",children:"Salve o endereço acima para continuar."})]}),e.jsx(Le,{to:`/menu/${w.id}`,className:"block text-center text-xs sm:text-sm text-muted-foreground hover:underline mt-2",children:"Voltar ao Cardápio"})]})]})})]})]})})};export{hn as default};
