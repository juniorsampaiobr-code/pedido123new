import{j as e,u as se,b as K,a as ze}from"./tanstack-DVJTcRV8.js";import{r as u,b as Le}from"./vendor-C5yldPn0.js";import{s as L}from"./client-DM5R7jeC.js";import{B as D,b as Be}from"./button-DTCXS7fQ.js";import{C as te,d as ne,a as Oe,b as We}from"./card-C-Qkmx7q.js";import{C as X,S as He,a as Ve,b as Xe,c as Qe,d as $e,T as Ke,e as Ue,f as Ge,g as Ye,B as Je}from"./select-lloEywwG.js";import{S}from"./skeleton-nPSQtvcz.js";import{A as re,a as oe,b as ie}from"./alert-BBnBj9bn.js";import{c as W,a as P,e as Ze,f as le,P as Y,h as ae,n as ea,i as aa,g as sa,L as ta,u as T}from"./index-Q2vd15TQ.js";import{D as na,a as ra,b as oa,c as ia,A as ce,t as de,g as me,h as ue,i as he,j as xe,k as pe,l as fe,m as ge,X as la}from"./alert-dialog-wazbPMIU.js";import{T as je}from"./terminal-nd2V-RKH.js";import{U as ca}from"./user-DnlUIioq.js";import{M as da,R as be}from"./refresh-cw-pwMGQGFN.js";import{C as ma}from"./credit-card-Cl2tiXLk.js";import{C as ua}from"./calendar-BoiwiZ-K.js";import{C as ve,T as ye}from"./truck-D32vKcWy.js";import{P as Ne}from"./package-DiMm3hMx.js";import{C as we,a as Ce}from"./circle-x-BVn8cFcw.js";import{b as $,a as B,c as ha,d as O,f as xa}from"./format-BeKxgCCE.js";import{u as pa}from"./use-sound-BZ_EAx1q.js";import{u as fa}from"./index-B4cp2llV.js";import{S as Pe}from"./shopping-cart-KQLA8Sp0.js";import{D as ga}from"./dollar-sign-CkCtT9xb.js";import{T as ja}from"./trash-2-VbK_ba56.js";import"./supabase-SdGmRSUE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=W("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=W("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=W("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=W("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=W("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),Ca={lessThanXSeconds:{one:"menos de um segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"meio minuto",lessThanXMinutes:{one:"menos de um minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"cerca de 1 hora",other:"cerca de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 dia",other:"{{count}} dias"},aboutXWeeks:{one:"cerca de 1 semana",other:"cerca de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"cerca de 1 mês",other:"cerca de {{count}} meses"},xMonths:{one:"1 mês",other:"{{count}} meses"},aboutXYears:{one:"cerca de 1 ano",other:"cerca de {{count}} anos"},xYears:{one:"1 ano",other:"{{count}} anos"},overXYears:{one:"mais de 1 ano",other:"mais de {{count}} anos"},almostXYears:{one:"quase 1 ano",other:"quase {{count}} anos"}},Pa=(a,s,t)=>{let i;const o=Ca[a];return typeof o=="string"?i=o:s===1?i=o.one:i=o.other.replace("{{count}}",String(s)),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"em "+i:"há "+i:i},ka={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/yyyy"},Ea={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},Ma={full:"{{date}} 'às' {{time}}",long:"{{date}} 'às' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Sa={date:$({formats:ka,defaultWidth:"full"}),time:$({formats:Ea,defaultWidth:"full"}),dateTime:$({formats:Ma,defaultWidth:"full"})},Aa={lastWeek:a=>{const s=a.getDay();return"'"+(s===0||s===6?"último":"última")+"' eeee 'às' p"},yesterday:"'ontem às' p",today:"'hoje às' p",tomorrow:"'amanhã às' p",nextWeek:"eeee 'às' p",other:"P"},Da=(a,s,t,i)=>{const o=Aa[a];return typeof o=="function"?o(s):o},Ta={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","depois de cristo"]},_a={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1º trimestre","2º trimestre","3º trimestre","4º trimestre"]},Ra={narrow:["j","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"],wide:["janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"]},Ia={narrow:["D","S","T","Q","Q","S","S"],short:["dom","seg","ter","qua","qui","sex","sab"],abbreviated:["domingo","segunda","terça","quarta","quinta","sexta","sábado"],wide:["domingo","segunda-feira","terça-feira","quarta-feira","quinta-feira","sexta-feira","sábado"]},qa={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"manhã",afternoon:"tarde",evening:"tarde",night:"noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"manhã",afternoon:"tarde",evening:"tarde",night:"noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"manhã",afternoon:"tarde",evening:"tarde",night:"noite"}},Fa={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"da manhã",afternoon:"da tarde",evening:"da tarde",night:"da noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"da manhã",afternoon:"da tarde",evening:"da tarde",night:"da noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"da manhã",afternoon:"da tarde",evening:"da tarde",night:"da noite"}},za=(a,s)=>{const t=Number(a);return(s==null?void 0:s.unit)==="week"?t+"ª":t+"º"},La={ordinalNumber:za,era:B({values:Ta,defaultWidth:"wide"}),quarter:B({values:_a,defaultWidth:"wide",argumentCallback:a=>a-1}),month:B({values:Ra,defaultWidth:"wide"}),day:B({values:Ia,defaultWidth:"wide"}),dayPeriod:B({values:qa,defaultWidth:"wide",formattingValues:Fa,defaultFormattingWidth:"wide"})},Ba=/^(\d+)[ºªo]?/i,Oa=/\d+/i,Wa={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|d\.?\s?c\.?)/i,wide:/^(antes de cristo|depois de cristo)/i},Ha={any:[/^ac/i,/^dc/i],wide:[/^antes de cristo/i,/^depois de cristo/i]},Va={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234](º)? trimestre/i},Xa={any:[/1/i,/2/i,/3/i,/4/i]},Qa={narrow:/^[jfmajsond]/i,abbreviated:/^(jan|fev|mar|abr|mai|jun|jul|ago|set|out|nov|dez)/i,wide:/^(janeiro|fevereiro|março|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)/i},$a={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^fev/i,/^mar/i,/^abr/i,/^mai/i,/^jun/i,/^jul/i,/^ago/i,/^set/i,/^out/i,/^nov/i,/^dez/i]},Ka={narrow:/^(dom|[23456]ª?|s[aá]b)/i,short:/^(dom|[23456]ª?|s[aá]b)/i,abbreviated:/^(dom|seg|ter|qua|qui|sex|s[aá]b)/i,wide:/^(domingo|(segunda|ter[cç]a|quarta|quinta|sexta)([- ]feira)?|s[aá]bado)/i},Ua={short:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[aá]/i],narrow:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[aá]/i],any:[/^d/i,/^seg/i,/^t/i,/^qua/i,/^qui/i,/^sex/i,/^s[aá]b/i]},Ga={narrow:/^(a|p|mn|md|(da) (manhã|tarde|noite))/i,any:/^([ap]\.?\s?m\.?|meia[-\s]noite|meio[-\s]dia|(da) (manhã|tarde|noite))/i},Ya={any:{am:/^a/i,pm:/^p/i,midnight:/^mn|^meia[-\s]noite/i,noon:/^md|^meio[-\s]dia/i,morning:/manhã/i,afternoon:/tarde/i,evening:/tarde/i,night:/noite/i}},Ja={ordinalNumber:ha({matchPattern:Ba,parsePattern:Oa,valueCallback:a=>parseInt(a,10)}),era:O({matchPatterns:Wa,defaultMatchWidth:"wide",parsePatterns:Ha,defaultParseWidth:"any"}),quarter:O({matchPatterns:Va,defaultMatchWidth:"wide",parsePatterns:Xa,defaultParseWidth:"any",valueCallback:a=>a+1}),month:O({matchPatterns:Qa,defaultMatchWidth:"wide",parsePatterns:$a,defaultParseWidth:"any"}),day:O({matchPatterns:Ka,defaultMatchWidth:"wide",parsePatterns:Ua,defaultParseWidth:"any"}),dayPeriod:O({matchPatterns:Ga,defaultMatchWidth:"any",parsePatterns:Ya,defaultParseWidth:"any"})},Za={code:"pt-BR",formatDistance:Pa,formatLong:Sa,formatRelative:Da,localize:La,match:Ja,options:{weekStartsOn:0,firstWeekContainsDate:1}},es={pending:{label:"Pendente",icon:ve,color:"bg-yellow-500"},preparing:{label:"Em Preparação",icon:Ne,color:"bg-orange-500"},ready:{label:"Pronto",icon:we,color:"bg-green-500"},delivering:{label:"Em Entrega",icon:ye,color:"bg-blue-500"},delivered:{label:"Entregue",icon:X,color:"bg-purple-500"},cancelled:{label:"Cancelado",icon:Ce,color:"bg-destructive"},pending_payment:{label:"Aguardando Pagamento",icon:Na,color:"bg-gray-500"}},as=async a=>{const{data:s,error:t}=await L.from("order_items").select("*, products(name)").eq("order_id",a);if(t)throw new Error(t.message);return s},ss=({order:a,isOpen:s,onClose:t})=>{var R,I,q,H,V;const[i,o]=u.useState([]),[n,d]=u.useState(!1),[m,l]=u.useState(null);u.useEffect(()=>{s&&(async()=>{if(a!=null&&a.id){d(!0),l(null);try{const M=await as(a.id);o(M)}catch(M){console.error("Failed to fetch order items:",M),l("Falha ao carregar itens do pedido.")}finally{d(!1)}}})()},[a==null?void 0:a.id,s]);const f=((R=a==null?void 0:a.customer)==null?void 0:R.name)||"Cliente Desconhecido",h=(I=a==null?void 0:a.customer)==null?void 0:I.phone,g=(q=a==null?void 0:a.customer)==null?void 0:q.email,j=(H=a==null?void 0:a.customer)==null?void 0:H.cpf_cnpj,v=a==null?void 0:a.delivery_address,N=((V=a==null?void 0:a.payment_methods)==null?void 0:V.name)||"Não especificado",p=a!=null&&a.status?es[a.status]:null,y=a!=null&&a.id?a.id.slice(-4):"N/A",r=a!=null&&a.created_at?new Date(a.created_at):null,x=r?xa(r,"dd 'de' MMMM 'de' yyyy 'às' HH:mm",{locale:Za}):"Data desconhecida",b=a!=null&&a.change_for?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.change_for):null,E=a!=null&&a.delivery_fee?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.delivery_fee):"Grátis";return e.jsx(na,{open:s,onOpenChange:t,children:e.jsxs(ra,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(oa,{children:e.jsxs(ia,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Detalhes do Pedido #",y]}),p&&e.jsxs("span",{className:P("text-xs font-semibold px-2.5 py-0.5 rounded-full text-white flex items-center",p.color),children:[e.jsx(p.icon,{className:"w-3 h-3 mr-1"}),p.label]})]})}),m&&e.jsxs(re,{variant:"destructive",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx(oe,{children:"Erro"}),e.jsx(ie,{children:m})]}),n?e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{className:"h-4 w-1/3"}),e.jsx(S,{className:"h-10 w-full"}),e.jsx(S,{className:"h-4 w-1/3"}),e.jsx(S,{className:"h-20 w-full"}),e.jsx(S,{className:"h-4 w-1/3"}),e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((k,M)=>e.jsx(S,{className:"h-12 w-full"},M))}),e.jsx(S,{className:"h-4 w-1/3"}),e.jsx(S,{className:"h-6 w-full"})]}):a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(ca,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Cliente"}),e.jsx("p",{children:f}),j&&e.jsxs("p",{className:"text-muted-foreground text-xs",children:["CPF/CNPJ: ",j]})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(wa,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Telefone"}),e.jsx("p",{children:h||"Não informado"}),g&&e.jsx("p",{className:"text-muted-foreground text-xs",children:g})]})]}),e.jsxs("div",{className:"flex items-start md:col-span-2",children:[e.jsx(da,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Endereço de Entrega"}),e.jsx("p",{children:v||"Não informado"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(ma,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Método de Pagamento"}),e.jsx("p",{children:N}),b&&e.jsxs("p",{className:"text-muted-foreground text-xs",children:["Troco para: ",b]})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(ua,{className:"h-4 w-4 mt-0.5 mr-2 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Data do Pedido"}),e.jsx("p",{children:x})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Itens do Pedido"}),e.jsx("div",{className:"space-y-2",children:i.map(k=>{var M;return e.jsxs("div",{className:"flex justify-between items-start p-2 bg-muted/50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((M=k.products)==null?void 0:M.name)||"Produto não encontrado"}),k.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Obs: ",k.notes]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{children:[k.quantity," x ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(k.unit_price)]}),e.jsx("p",{className:"font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(k.subtotal)})]})]},k.id)})})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.total_amount-(a.delivery_fee||0))})]}),e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:E})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.total_amount)})]})]}),e.jsx("div",{className:"pt-4",children:a.notes&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Observações do Cliente:"}),e.jsx("p",{className:"bg-muted p-2 rounded",children:a.notes})]})})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(D,{onClick:t,children:"Fechar"})})]})})},ke=({className:a,...s})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:P("mx-auto flex w-full justify-center",a),...s});ke.displayName="Pagination";const Ee=u.forwardRef(({className:a,...s},t)=>e.jsx("ul",{ref:t,className:P("flex flex-row items-center gap-1",a),...s}));Ee.displayName="PaginationContent";const A=u.forwardRef(({className:a,...s},t)=>e.jsx("li",{ref:t,className:P("",a),...s}));A.displayName="PaginationItem";const z=({className:a,isActive:s,size:t="icon",...i})=>e.jsx("a",{"aria-current":s?"page":void 0,className:P(Be({variant:s?"outline":"ghost",size:t}),a),...i});z.displayName="PaginationLink";const Me=({className:a,...s})=>e.jsxs(z,{"aria-label":"Go to previous page",size:"default",className:P("gap-1 pl-2.5",a),...s,children:[e.jsx(ba,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});Me.displayName="PaginationPrevious";const Se=({className:a,...s})=>e.jsxs(z,{"aria-label":"Go to next page",size:"default",className:P("gap-1 pr-2.5",a),...s,children:[e.jsx("span",{children:"Next"}),e.jsx(va,{className:"h-4 w-4"})]});Se.displayName="PaginationNext";const U=({className:a,...s})=>e.jsxs("span",{"aria-hidden":!0,className:P("flex h-9 w-9 items-center justify-center",a),...s,children:[e.jsx(ya,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]});U.displayName="PaginationEllipsis";const ts=({currentPage:a,totalPages:s,onPageChange:t})=>{if(s<=1)return null;const o=(()=>{const n=[],m=Math.max(1,a-Math.floor(2.5)),l=Math.min(s,m+5-1);if(l-m+1<5){const f=Math.max(1,l-5+1);for(let h=f;h<=l;h++)n.push(h)}else for(let f=m;f<=l;f++)n.push(f);return n})();return e.jsx(ke,{children:e.jsxs(Ee,{children:[e.jsx(A,{children:e.jsx(Me,{onClick:()=>t(a-1),className:P(a===1&&"pointer-events-none opacity-50")})}),o[0]>1&&e.jsxs(e.Fragment,{children:[e.jsx(A,{children:e.jsx(z,{onClick:()=>t(1),children:"1"})}),o[0]>2&&e.jsx(A,{children:e.jsx(U,{})})]}),o.map(n=>e.jsx(A,{children:e.jsx(z,{isActive:n===a,onClick:()=>t(n),children:n})},n)),o[o.length-1]<s&&e.jsxs(e.Fragment,{children:[o[o.length-1]<s-1&&e.jsx(A,{children:e.jsx(U,{})}),e.jsx(A,{children:e.jsx(z,{onClick:()=>t(s),children:s})})]}),e.jsx(A,{children:e.jsx(Se,{onClick:()=>t(a+1),className:P(a===s&&"pointer-events-none opacity-50")})})]})})};var Q="Checkbox",[ns,Fs]=Ze(Q),[rs,J]=ns(Q);function os(a){const{__scopeCheckbox:s,checked:t,children:i,defaultChecked:o,disabled:n,form:d,name:m,onCheckedChange:l,required:f,value:h="on",internal_do_not_use_render:g}=a,[j,v]=sa({prop:t,defaultProp:o??!1,onChange:l,caller:Q}),[N,p]=u.useState(null),[y,r]=u.useState(null),x=u.useRef(!1),b=N?!!d||!!N.closest("form"):!0,E={checked:j,disabled:n,setChecked:v,control:N,setControl:p,name:m,form:d,value:h,hasConsumerStoppedPropagationRef:x,required:f,defaultChecked:_(o)?!1:o,isFormControl:b,bubbleInput:y,setBubbleInput:r};return e.jsx(rs,{scope:s,...E,children:is(g)?g(E):i})}var Ae="CheckboxTrigger",De=u.forwardRef(({__scopeCheckbox:a,onKeyDown:s,onClick:t,...i},o)=>{const{control:n,value:d,disabled:m,checked:l,required:f,setControl:h,setChecked:g,hasConsumerStoppedPropagationRef:j,isFormControl:v,bubbleInput:N}=J(Ae,a),p=le(o,h),y=u.useRef(l);return u.useEffect(()=>{const r=n==null?void 0:n.form;if(r){const x=()=>g(y.current);return r.addEventListener("reset",x),()=>r.removeEventListener("reset",x)}},[n,g]),e.jsx(Y.button,{type:"button",role:"checkbox","aria-checked":_(l)?"mixed":l,"aria-required":f,"data-state":qe(l),"data-disabled":m?"":void 0,disabled:m,value:d,...i,ref:p,onKeyDown:ae(s,r=>{r.key==="Enter"&&r.preventDefault()}),onClick:ae(t,r=>{g(x=>_(x)?!0:!x),N&&v&&(j.current=r.isPropagationStopped(),j.current||r.stopPropagation())})})});De.displayName=Ae;var Z=u.forwardRef((a,s)=>{const{__scopeCheckbox:t,name:i,checked:o,defaultChecked:n,required:d,disabled:m,value:l,onCheckedChange:f,form:h,...g}=a;return e.jsx(os,{__scopeCheckbox:t,checked:o,defaultChecked:n,disabled:m,required:d,onCheckedChange:f,name:i,form:h,value:l,internal_do_not_use_render:({isFormControl:j})=>e.jsxs(e.Fragment,{children:[e.jsx(De,{...g,ref:s,__scopeCheckbox:t}),j&&e.jsx(Ie,{__scopeCheckbox:t})]})})});Z.displayName=Q;var Te="CheckboxIndicator",_e=u.forwardRef((a,s)=>{const{__scopeCheckbox:t,forceMount:i,...o}=a,n=J(Te,t);return e.jsx(ea,{present:i||_(n.checked)||n.checked===!0,children:e.jsx(Y.span,{"data-state":qe(n.checked),"data-disabled":n.disabled?"":void 0,...o,ref:s,style:{pointerEvents:"none",...a.style}})})});_e.displayName=Te;var Re="CheckboxBubbleInput",Ie=u.forwardRef(({__scopeCheckbox:a,...s},t)=>{const{control:i,hasConsumerStoppedPropagationRef:o,checked:n,defaultChecked:d,required:m,disabled:l,name:f,value:h,form:g,bubbleInput:j,setBubbleInput:v}=J(Re,a),N=le(t,v),p=fa(n),y=aa(i);u.useEffect(()=>{const x=j;if(!x)return;const b=window.HTMLInputElement.prototype,R=Object.getOwnPropertyDescriptor(b,"checked").set,I=!o.current;if(p!==n&&R){const q=new Event("click",{bubbles:I});x.indeterminate=_(n),R.call(x,_(n)?!1:n),x.dispatchEvent(q)}},[j,p,n,o]);const r=u.useRef(_(n)?!1:n);return e.jsx(Y.input,{type:"checkbox","aria-hidden":!0,defaultChecked:d??r.current,required:m,disabled:l,name:f,value:h,form:g,...s,tabIndex:-1,ref:N,style:{...s.style,...y,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Ie.displayName=Re;function is(a){return typeof a=="function"}function _(a){return a==="indeterminate"}function qe(a){return _(a)?"indeterminate":a?"checked":"unchecked"}const ee=u.forwardRef(({className:a,...s},t)=>e.jsx(Z,{ref:t,className:P("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),...s,children:e.jsx(_e,{className:P("flex items-center justify-center text-current"),children:e.jsx(X,{className:"h-4 w-4"})})}));ee.displayName=Z.displayName;const Fe={pending:{label:"Pendente",icon:ve,color:"bg-yellow-500 hover:bg-yellow-600"},preparing:{label:"Em Preparação",icon:Ne,color:"bg-orange-500 hover:bg-orange-600"},ready:{label:"Pronto",icon:we,color:"bg-green-500 hover:bg-green-600"},delivering:{label:"Em Entrega",icon:ye,color:"bg-indigo-500 hover:bg-indigo-600"},delivered:{label:"Entregue",icon:X,color:"bg-primary hover:bg-primary/90"},cancelled:{label:"Cancelado",icon:Ce,color:"bg-destructive hover:bg-destructive/90"},pending_payment:{label:"Aguardando Pag.",icon:ga,color:"bg-gray-500 hover:bg-gray-600"}},ls=[{value:"pending",label:"Mudar para Pendente"},{value:"preparing",label:"Mudar para Em Preparação"},{value:"ready",label:"Mudar para Pronto"},{value:"delivering",label:"Mudar para Em Entrega"},{value:"delivered",label:"Mudar para Entregue"},{value:"cancelled",label:"Mudar para Cancelado"},{value:"pending_payment",label:"Mudar para Aguardando Pag."},{value:"delete",label:"Excluir Permanentemente"}],G=12,cs=async(a,s,t)=>{const i=t*G,o=i+G-1;let n=L.from("orders").select("*, customer:customers(name, phone)",{count:"exact"}).eq("restaurant_id",a);s!=="all"&&(n=n.eq("status",s));const{data:d,error:m,count:l}=await n.order("created_at",{ascending:!1}).range(i,o);if(m)throw new Error(`Erro ao buscar pedidos: ${m.message}`);return{orders:d,count:l||0}},ds=({order:a,onViewDetails:s,onAccept:t,onDecline:i,onDelete:o,isSelected:n,onSelect:d})=>{var h;const m=Fe[a.status||"pending"],l=((h=a.customer)==null?void 0:h.name)||"Cliente Desconhecido",f=a.created_at?new Date(a.created_at).getTime().toString().slice(-4):"N/A";return e.jsxs(te,{className:"shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col relative",children:[e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx(ee,{checked:n,onCheckedChange:g=>d(a.id,!!g),className:"h-5 w-5"})}),e.jsxs(Oe,{className:"flex flex-row items-center justify-between space-y-0 pb-2 pl-12",children:[e.jsxs(We,{className:"text-lg font-bold flex items-center gap-2",children:["Pedido #",f]}),e.jsxs(Je,{className:P("text-white",m.color),children:[e.jsx(m.icon,{className:"h-3 w-3 mr-1"}),m.label]})]}),e.jsxs(ne,{className:"space-y-2 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",l]}),e.jsx("p",{className:"text-2xl font-extrabold text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.total_amount)})]}),e.jsxs("div",{className:"flex justify-end pt-2 border-t gap-2",children:[(a.status==="pending"||a.status==="pending_payment")&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{variant:"destructive",size:"sm",onClick:()=>i(a.id),children:[e.jsx(la,{className:"h-4 w-4 mr-1"})," Recusar"]}),e.jsxs(D,{variant:"default",size:"sm",onClick:()=>t(a.id),children:[e.jsx(X,{className:"h-4 w-4 mr-1"})," Aceitar"]})]}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>s(a),children:"Detalhes"}),e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",children:e.jsx(ja,{className:"h-4 w-4"})})}),e.jsxs(me,{children:[e.jsxs(ue,{children:[e.jsx(he,{children:"Tem certeza que deseja excluir?"}),e.jsxs(xe,{children:["Esta ação é permanente. O pedido #",f," será excluído permanentemente do sistema, incluindo todos os itens associados."]})]}),e.jsxs(pe,{children:[e.jsx(fe,{children:"Cancelar"}),e.jsx(ge,{onClick:()=>o(a.id),className:"bg-destructive hover:bg-destructive/90",children:"Excluir Permanentemente"})]})]})]})]})]})]})},ms=({status:a,onViewDetails:s,restaurantId:t,selectedOrders:i,setSelectedOrders:o,totalOrdersInView:n})=>{const d=se(),{stopSoundLoop:m}=pa(),[l,f]=u.useState(0),{data:h,isLoading:g,isError:j,error:v,refetch:N}=ze({queryKey:["orders",a,t,l],queryFn:()=>cs(t,a,l),enabled:!!t}),p=(h==null?void 0:h.orders)||[],y=(h==null?void 0:h.count)||0,r=Math.ceil(y/G),x=K({mutationFn:async({orderId:c,newStatus:w})=>{const C=w==="pending"?"preparing":w,{error:F}=await L.from("orders").update({status:C}).eq("id",c);if(F)throw new Error(F.message);return C},onSuccess:c=>{T.success(`Pedido ${c==="preparing"?"aceito":"recusado"} com sucesso!`),d.invalidateQueries({queryKey:["orders"]})},onError:c=>T.error(`Erro ao atualizar pedido: ${c.message}`)}),b=K({mutationFn:async c=>{const{error:w}=await L.from("orders").delete().eq("id",c);if(w)throw new Error(w.message)},onSuccess:()=>{T.success("Pedido excluído permanentemente."),d.invalidateQueries({queryKey:["orders"]})},onError:c=>T.error(`Erro ao excluir pedido: ${c.message}`)}),E=c=>{m(),x.mutate({orderId:c,newStatus:"preparing"})},R=c=>{m(),x.mutate({orderId:c,newStatus:"cancelled"})},I=c=>{m(),s(c)},q=c=>{b.mutate(c)},H=u.useCallback(c=>{f(c-1)},[]),V=u.useCallback((c,w)=>{o(C=>w?[...C,c]:C.filter(F=>F!==c))},[o]),k=u.useCallback(c=>{if(c){const w=p.map(C=>C.id);o(C=>[...new Set([...C,...w])])}else{const w=new Set(p.map(C=>C.id));o(C=>C.filter(F=>!w.has(F)))}},[p,o]),M=p.length>0&&p.every(c=>i.includes(c.id));return g?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((c,w)=>e.jsx(te,{children:e.jsx(ne,{className:"p-4 space-y-3",children:e.jsx(S,{className:"h-32 w-full"})})},w))}):j?e.jsxs(re,{variant:"destructive",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx(oe,{children:"Erro ao carregar pedidos"}),e.jsx(ie,{children:v instanceof Error?v.message:"Ocorreu um erro desconhecido."}),e.jsxs(D,{onClick:()=>N(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(be,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]}):!p||p.length===0?e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg border",children:[e.jsx(Pe,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Nenhum pedido encontrado."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifique o status selecionado ou aguarde novos pedidos."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg bg-muted/50",children:[e.jsx(ee,{checked:M,onCheckedChange:k,className:"h-5 w-5"}),e.jsxs("span",{className:"text-sm font-medium",children:["Selecionar todos (",p.length,") nesta página."]}),n>0&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-auto",children:[n," pedidos selecionados no total."]})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:p.map(c=>e.jsx(ds,{order:c,onViewDetails:I,onAccept:E,onDecline:R,onDelete:q,isSelected:i.includes(c.id),onSelect:V},c.id))}),r>1&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(ts,{currentPage:l+1,totalPages:r,onPageChange:H})})]})},zs=()=>{const{userRestaurantId:a}=Le(),s=se(),[t,i]=u.useState(null),[o,n]=u.useState(!1),[d,m]=u.useState([]),[l,f]=u.useState(""),h=r=>{i(r),n(!0)},g=()=>{n(!1),i(null)},j=()=>{s.invalidateQueries({queryKey:["orders",a]}),T.info("Atualizando pedidos...",{description:"Buscando novos dados no servidor."})},v=K({mutationFn:async({orderIds:r,action:x})=>{if(x==="delete"){const{error:b}=await L.from("orders").delete().in("id",r);if(b)throw new Error(b.message);return"deleted"}else{const b=x==="pending"?"preparing":x,{error:E}=await L.from("orders").update({status:b}).in("id",r);if(E)throw new Error(E.message);return"updated"}},onSuccess:(r,x)=>{if(r==="deleted")T.success(`${x.orderIds.length} pedidos excluídos permanentemente.`);else{const b=Fe[x.action].label;T.success(`${x.orderIds.length} pedidos atualizados para "${b}".`)}m([]),f(""),s.invalidateQueries({queryKey:["orders",a]})},onError:r=>{T.error(`Erro na ação em massa: ${r.message}`)}}),N=()=>{var r;!l||d.length===0||(l==="delete"?(r=document.getElementById("mass-delete-trigger"))==null||r.click():v.mutate({orderIds:d,action:l}))},p=[{value:"pending_payment",label:"Aguardando Pag."},{value:"pending",label:"Pendentes"},{value:"preparing",label:"Em Preparação"},{value:"ready",label:"Prontos"},{value:"delivering",label:"Em Entrega"},{value:"delivered",label:"Entregues"},{value:"cancelled",label:"Cancelados"},{value:"all",label:"Todos"}],y=v.isPending;return a?e.jsxs(e.Fragment,{children:[e.jsx(ss,{order:t,isOpen:o,onClose:g}),e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx("button",{id:"mass-delete-trigger",className:"hidden"})}),e.jsxs(me,{children:[e.jsxs(ue,{children:[e.jsxs(he,{children:["Tem certeza que deseja excluir ",d.length," pedidos?"]}),e.jsxs(xe,{children:["Esta ação é permanente. ",d.length," pedidos serão excluídos permanentemente do sistema."]})]}),e.jsxs(pe,{children:[e.jsx(fe,{children:"Cancelar"}),e.jsx(ge,{onClick:()=>v.mutate({orderIds:d,action:"delete"}),className:"bg-destructive hover:bg-destructive/90",disabled:y,children:y?"Excluindo...":"Excluir Permanentemente"})]})]})]}),e.jsxs("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(D,{variant:"outline",onClick:j,children:[e.jsx(be,{className:"h-4 w-4 mr-2"})," Atualizar Dados"]})}),d.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded-lg bg-card shadow-lg animate-fade-in",children:[e.jsx(Pe,{className:"h-5 w-5 text-primary mr-2"}),e.jsxs("span",{className:"text-sm font-medium mr-4",children:[d.length," selecionado(s)"]}),e.jsxs(He,{value:l,onValueChange:r=>f(r),children:[e.jsx(Ve,{className:"w-[200px]",children:e.jsx(Xe,{placeholder:"Ação em Massa"})}),e.jsx(Qe,{children:ls.map(r=>e.jsx($e,{value:r.value,children:r.label},r.value))})]}),e.jsx(D,{onClick:N,disabled:!l||y,children:y?e.jsx(ta,{className:"h-4 w-4 animate-spin"}):"Aplicar"})]})]}),a?e.jsxs(Ke,{defaultValue:"pending",children:[e.jsx(Ue,{className:"w-full overflow-x-auto justify-start",children:p.map(r=>e.jsx(Ge,{value:r.value,className:"whitespace-nowrap",children:r.label},r.value))}),p.map(r=>e.jsx(Ye,{value:r.value,className:"mt-6",children:e.jsx(ms,{status:r.value,onViewDetails:h,restaurantId:a,selectedOrders:d,setSelectedOrders:m,totalOrdersInView:d.length})},r.value))]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Carregando dados do restaurante..."})]})]})]}):e.jsx("div",{className:"flex h-screen items-center justify-center",children:"Carregando..."})};export{zs as default};
