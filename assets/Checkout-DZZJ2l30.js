import{b as me,j as e,u as ns,c as Fe}from"./tanstack-d4AvmB45.js";import{r as a,u as os,h as as,j as is,L as Me}from"./vendor-CnEXr6gt.js";import{s as I}from"./client-D5i5GwB9.js";import{c as cs,d as yt,e as Le,P as Ee,f as Oe,g as ls,h as ds,i as ms,a as fe,u as S,L as pe,p as us,b as ot}from"./index-CNGolnCh.js";import{L as ps,g as at,c as De}from"./location-DTKe55BI.js";import{u as fs}from"./use-auth-status-b07NBuTX.js";import{o as wt,s as D,e as hs,u as it,C as be,t as ct}from"./types-DKlirIXB.js";import{B as Q}from"./button-DVc_LyvO.js";import{C as X,b as H,c as J,a as W}from"./card-ZfdPw1Dx.js";import{I as ue,L as T}from"./label-DGymdVt7.js";import{T as xs}from"./textarea-BcvmZ58L.js";import{c as jt,R as gs,I as ys}from"./index-JL8Usy7N.js";import{u as ws}from"./index-DrlxvCXN.js";import{u as js}from"./index-KNP7Yozt.js";import{S as lt}from"./separator-BbRYWxnJ.js";import{A as ee,a as ne,b as oe}from"./alert-4e1haCKc.js";import{P as bs,M as vs}from"./PhoneInput-CimUZqaJ.js";import{S as _s,C as Ns,L as Cs}from"./CustomerProfileModal-CXn6-cjn.js";import{D as dt,a as mt,b as Es,c as Rs,d as Ss}from"./dialog-sYYp5GQr.js";import{C as bt}from"./credit-card-CxLd0Z06.js";import{C as Ps}from"./CpfCnpjInput-POhFdcOU.js";import{M as Ve}from"./map-pin-BmAb5i-D.js";import{A as $s,a as As,b as Is,c as ks,d as Fs,e as Ms,g as Ds}from"./alert-dialog-CsyEbno8.js";import{C as Ne}from"./circle-alert-Cs9qYA-D.js";import{F as ut}from"./form-B2jBlwAP.js";import{T as pt}from"./terminal-COabtAMI.js";import{R as Os}from"./pt-BR-DDDXnH7a.js";import{A as Vs}from"./arrow-left-Ck0rMUP4.js";import{U as ft}from"./user-Dl79m3s2.js";import{T as ve}from"./truck-DEVH82JX.js";import{C as Ts}from"./circle-check-big-DuPti9-H.js";import{S as Ls}from"./save-DRI4DqRp.js";import{D as zs}from"./dollar-sign-NgUF691q.js";import"./supabase-BZV_3FV3.js";import"./skeleton-BJDmEsKh.js";import"./store-DqgiNRJc.js";import"./package-CvXXaO58.js";import"./check-6XiWD_Bn.js";import"./circle-x-ByYrn6p_.js";import"./euro-CC_W1uMV.js";import"./format-BeKxgCCE.js";import"./index-mFXF6eqT.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=cs("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Bs=async r=>{const{data:t,error:n}=await I.from("payment_settings").select("mercado_pago_public_key").eq("restaurant_id",r).limit(1).single();if(n&&n.code!=="PGRST116")throw new Error(`Error fetching payment settings: ${n.message}`);return(t==null?void 0:t.mercado_pago_public_key)||null},vt=r=>me({queryKey:["mercadoPagoPublicKey",r],queryFn:()=>Bs(r),enabled:!!r,staleTime:1/0});var ze="Radio",[Gs,_t]=yt(ze),[Ks,Us]=Gs(ze),Nt=a.forwardRef((r,t)=>{const{__scopeRadio:n,name:p,checked:h=!1,required:x,disabled:j,value:i="on",onCheck:C,form:E,...b}=r,[g,F]=a.useState(null),P=Le(t,q=>F(q)),k=a.useRef(!1),M=g?E||!!g.closest("form"):!0;return e.jsxs(Ks,{scope:n,checked:h,disabled:j,children:[e.jsx(Ee.button,{type:"button",role:"radio","aria-checked":h,"data-state":St(h),"data-disabled":j?"":void 0,disabled:j,value:i,...b,ref:P,onClick:Oe(r.onClick,q=>{h||C==null||C(),M&&(k.current=q.isPropagationStopped(),k.current||q.stopPropagation())})}),M&&e.jsx(Rt,{control:g,bubbles:!k.current,name:p,value:i,checked:h,required:x,disabled:j,form:E,style:{transform:"translateX(-100%)"}})]})});Nt.displayName=ze;var Ct="RadioIndicator",Et=a.forwardRef((r,t)=>{const{__scopeRadio:n,forceMount:p,...h}=r,x=Us(Ct,n);return e.jsx(ls,{present:p||x.checked,children:e.jsx(Ee.span,{"data-state":St(x.checked),"data-disabled":x.disabled?"":void 0,...h,ref:t})})});Et.displayName=Ct;var Qs="RadioBubbleInput",Rt=a.forwardRef(({__scopeRadio:r,control:t,checked:n,bubbles:p=!0,...h},x)=>{const j=a.useRef(null),i=Le(j,x),C=js(n),E=ds(t);return a.useEffect(()=>{const b=j.current;if(!b)return;const g=window.HTMLInputElement.prototype,P=Object.getOwnPropertyDescriptor(g,"checked").set;if(C!==n&&P){const k=new Event("click",{bubbles:p});P.call(b,n),b.dispatchEvent(k)}},[C,n,p]),e.jsx(Ee.input,{type:"radio","aria-hidden":!0,defaultChecked:n,...h,tabIndex:-1,ref:i,style:{...h.style,...E,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Rt.displayName=Qs;function St(r){return r?"checked":"unchecked"}var Xs=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Re="RadioGroup",[Hs,dn]=yt(Re,[jt,_t]),Pt=jt(),$t=_t(),[Js,Ws]=Hs(Re),At=a.forwardRef((r,t)=>{const{__scopeRadioGroup:n,name:p,defaultValue:h,value:x,required:j=!1,disabled:i=!1,orientation:C,dir:E,loop:b=!0,onValueChange:g,...F}=r,P=Pt(n),k=ws(E),[M,q]=ms({prop:x,defaultProp:h??null,onChange:g,caller:Re});return e.jsx(Js,{scope:n,name:p,required:j,disabled:i,value:M,onValueChange:q,children:e.jsx(gs,{asChild:!0,...P,orientation:C,dir:k,loop:b,children:e.jsx(Ee.div,{role:"radiogroup","aria-required":j,"aria-orientation":C,"data-disabled":i?"":void 0,dir:k,...F,ref:t})})})});At.displayName=Re;var It="RadioGroupItem",kt=a.forwardRef((r,t)=>{const{__scopeRadioGroup:n,disabled:p,...h}=r,x=Ws(It,n),j=x.disabled||p,i=Pt(n),C=$t(n),E=a.useRef(null),b=Le(t,E),g=x.value===h.value,F=a.useRef(!1);return a.useEffect(()=>{const P=M=>{Xs.includes(M.key)&&(F.current=!0)},k=()=>F.current=!1;return document.addEventListener("keydown",P),document.addEventListener("keyup",k),()=>{document.removeEventListener("keydown",P),document.removeEventListener("keyup",k)}},[]),e.jsx(ys,{asChild:!0,...i,focusable:!j,active:g,children:e.jsx(Nt,{disabled:j,required:x.required,checked:g,...C,...h,name:x.name,ref:b,onCheck:()=>x.onValueChange(h.value),onKeyDown:Oe(P=>{P.key==="Enter"&&P.preventDefault()}),onFocus:Oe(h.onFocus,()=>{var P;F.current&&((P=E.current)==null||P.click())})})})});kt.displayName=It;var Zs="RadioGroupIndicator",Ft=a.forwardRef((r,t)=>{const{__scopeRadioGroup:n,...p}=r,h=$t(n);return e.jsx(Et,{...h,...p,ref:t})});Ft.displayName=Zs;var Mt=At,Dt=kt,Ys=Ft;const Te=a.forwardRef(({className:r,...t},n)=>e.jsx(Mt,{className:fe("grid gap-2",r),...t,ref:n}));Te.displayName=Mt.displayName;const Ce=a.forwardRef(({className:r,...t},n)=>e.jsx(Dt,{ref:n,className:fe("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...t,children:e.jsx(Ys,{className:"flex items-center justify-center",children:e.jsx(qs,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Ce.displayName=Dt.displayName;var qe={};Object.defineProperty(qe,"__esModule",{value:!0});var Ot=qe.loadMercadoPago=void 0;const Vt="https://sdk.mercadopago.com/js/v2",er=/^https:\/\/sdk\.mercadopago\.com\/js\/v2\/?(\?.*)?$/,ht="MercadoPago has already been initialized in your window, please remove the duplicate import",tr="MercadoPago.js not available",sr="Failed to load MercadoPago.js",rr=()=>{for(var r=document.querySelectorAll(`script[src^="${Vt}"`),t=0;t<r.length;t++){var n=r[t];if(er.test(n.src))return n}return null},nr=()=>{const r=document.createElement("script");r.src=Vt;const t=document.head||document.body;if(!t)throw new Error("Expected document.body or document.head not to be null. MercadoPago requires a <body> or a <head> element, please add on your project.");return t.appendChild(r),r};let _e=null;const or=()=>(_e!==null||(_e=new Promise((r,t)=>{if(typeof window>"u"){r(null);return}if(window.MercadoPago){console.warn(ht),r(window.MercadoPago);return}try{let n=rr();n?console.warn(ht):n||(n=nr()),n.addEventListener("load",()=>{window.MercadoPago?r(window.MercadoPago):t(new Error(tr))}),n.addEventListener("error",()=>{t(new Error(sr))})}catch(n){t(n);return}})),_e);Ot=qe.loadMercadoPago=or;var ar=function(r,t,n,p){function h(x){return x instanceof n?x:new n(function(j){j(x)})}return new(n||(n=Promise))(function(x,j){function i(b){try{E(p.next(b))}catch(g){j(g)}}function C(b){try{E(p.throw(b))}catch(g){j(g)}}function E(b){b.done?x(b.value):h(b.value).then(i,C)}E((p=p.apply(r,t||[])).next())})};class G{static getInstance(){return ar(this,void 0,void 0,function*(){if(this.publicKey)return this.loadedInstanceMercadoPago||(yield Ot(),this.loadedInstanceMercadoPago=!0),this.instanceMercadoPago||(this.instanceMercadoPago=new window.MercadoPago(this.publicKey,this.options)),this.instanceMercadoPago;console.error("Expected the PUBLIC_KEY to render the MercadoPago SDK React")})}}G.publicKey=null;G.options={};G.instanceMercadoPago=void 0;G.loadedInstanceMercadoPago=!1;function ir(r,t){return Object.keys(r).length===Object.keys(t).length&&Object.keys(r).every(p=>Object.prototype.hasOwnProperty.call(t,p)&&r[p]===t[p])}const cr=(r,t)=>{const n=Object.assign(Object.assign({},t),{frontEndStack:"react"}),p=!ir(G.options,n);(r!==G.publicKey||p)&&(G.publicKey=r,G.options=n,G.instanceMercadoPago=void 0)},lr=({preferenceId:r,initPoint:t,onClose:n})=>{const{data:p,isLoading:h}=vt();return a.useEffect(()=>{if(p)try{cr(p,{locale:"pt-BR"})}catch(x){console.error("Erro ao inicializar Mercado Pago:",x),S.error("Erro ao carregar o SDK do Mercado Pago."),n();return}t&&(console.log("Redirecionando para o Mercado Pago:",t),window.location.href=t)},[p,n,t]),h||!p?e.jsx(dt,{open:!0,onOpenChange:n,children:e.jsx(mt,{className:"sm:max-w-[425px]",children:e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsx(pe,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{children:"Carregando configurações de pagamento..."})]})})}):e.jsx(dt,{open:!0,onOpenChange:n,children:e.jsxs(mt,{className:"sm:max-w-[425px]",children:[e.jsxs(Es,{children:[e.jsxs(Rs,{className:"flex items-center gap-2",children:[e.jsx(bt,{className:"h-5 w-5 text-primary"}),"Redirecionando para Pagamento"]}),e.jsx(Ss,{children:"Você está sendo redirecionado para o checkout seguro do Mercado Pago."})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(pe,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aguarde..."})]}),e.jsx(Q,{variant:"outline",onClick:n,children:"Cancelar e Voltar"})]})})},dr=({latitude:r,longitude:t,address:n,className:p})=>{const h=a.useMemo(()=>[r,t],[r,t]),x=a.useMemo(()=>[r,t],[r,t]);return e.jsxs(X,{className:fe("w-full",p),children:[e.jsxs(H,{children:[e.jsxs(J,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5 text-primary"}),"Sua Localização"]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:n})]}),e.jsx(W,{className:"p-0",children:e.jsx("div",{className:"h-64 w-full rounded-b-lg overflow-hidden",children:e.jsx(ps,{center:x,markerPosition:h,onMarkerDragEnd:()=>{},zoom:16})})})]})},mr=({isOpen:r,onConfirm:t})=>e.jsx($s,{open:r,children:e.jsxs(As,{children:[e.jsxs(Is,{children:[e.jsxs(ks,{className:"flex items-center gap-2 text-primary",children:[e.jsx(Ne,{className:"h-6 w-6"}),"Atenção ao Pagamento Online!"]}),e.jsxs(Fs,{children:["Você escolheu o pagamento online (Pix ou Cartão).",e.jsx("br",{}),e.jsx("br",{}),"Ao prosseguir, você será redirecionado para o checkout do Mercado Pago.",e.jsx("br",{}),e.jsx("br",{}),'**IMPORTANTE:** Se você escolher **PIX**, após o pagamento, você pode precisar clicar no botão **"Voltar ao site"** na tela do Mercado Pago para que seu pedido seja finalizado e rastreado corretamente.']})]}),e.jsx(Ms,{children:e.jsx(Ds,{onClick:t,className:"w-full",children:"Entendi e Continuar"})})]})}),ur=({onAddressSelect:r,defaultValue:t,disabled:n})=>{const p=a.useRef(null),h=a.useRef(null);return a.useEffect(()=>{!p.current||!window.google||!window.google.maps||!window.google.maps.places||(h.current=new window.google.maps.places.Autocomplete(p.current,{componentRestrictions:{country:"br"},fields:["address_components","geometry","formatted_address"],types:["address"]}),h.current.addListener("place_changed",()=>{var i,C,E;const x=(i=h.current)==null?void 0:i.getPlace();if(!x||!x.address_components||!x.geometry)return;const j={street:"",number:"",neighborhood:"",city:"",state:"",zip_code:"",latitude:((C=x.geometry.location)==null?void 0:C.lat())||0,longitude:((E=x.geometry.location)==null?void 0:E.lng())||0};x.address_components.forEach(b=>{const g=b.types;g.includes("route")&&(j.street=b.long_name),g.includes("street_number")&&(j.number=b.long_name),(g.includes("sublocality_level_1")||g.includes("sublocality"))&&(j.neighborhood=b.long_name),(g.includes("administrative_area_level_2")||g.includes("locality"))&&(j.city=b.long_name),g.includes("administrative_area_level_1")&&(j.state=b.short_name),g.includes("postal_code")&&(j.zip_code=b.long_name.replace(/\D/g,""))}),r(j)}))},[r]),e.jsxs("div",{className:"relative",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ue,{ref:p,placeholder:"Busque seu endereço (Rua, Número...)",defaultValue:t,className:"pl-10 h-12",disabled:n})]})},xt=r=>{if(!r)return"";let t=r.replace(/\D/g,"");return t.length>11&&(t=t.slice(0,11)),t.length>0&&(t=`(${t}`),t.length>3&&(t=`${t.slice(0,3)}) ${t.slice(3)}`),t.length>10&&(t=`${t.slice(0,10)}-${t.slice(10)}`),t},gt=r=>{if(!r)return"";let t=r.replace(/\D/g,"");return t.length>14&&(t=t.slice(0,14)),t.length<=11?(t.length>9&&(t=`${t.slice(0,9)}-${t.slice(9)}`),t.length>6&&(t=`${t.slice(0,6)}.${t.slice(6)}`),t.length>3&&(t=`${t.slice(0,3)}.${t.slice(3)}`)):(t.length>12&&(t=`${t.slice(0,12)}-${t.slice(12)}`),t.length>8&&(t=`${t.slice(0,8)}/${t.slice(8)}`),t.length>5&&(t=`${t.slice(0,5)}.${t.slice(5)}`),t.length>2&&(t=`${t.slice(0,2)}.${t.slice(2)}`)),t},pr=wt({zip_code:D().min(1,"CEP é obrigatório."),street:D().min(1,"Rua é obrigatória."),number:D().min(1,"Número é obrigatório."),complement:D().optional(),neighborhood:D().min(1,"Bairro é obrigatório."),city:D().min(1,"Cidade é obrigatória.")}),fr=wt({name:D().min(1,"Nome é obrigatório."),phone:D().min(1,"Telefone é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length>=10,{message:"O telefone deve ter pelo menos 10 dígitos."}),cpf_cnpj:D().min(1,"CPF/CNPJ é obrigatório.").transform(r=>r.replace(/\D/g,"")).refine(r=>r.length===11||r.length===14,{message:"CPF deve ter 11 dígitos ou CNPJ 14 dígitos."}),delivery_option:hs(["delivery","pickup"],{required_error:"Selecione uma opção de entrega."}),notes:D().optional(),payment_method_id:D().min(1,"Selecione um método de pagamento."),change_for:D().optional()}),hr=async r=>{const{data:t,error:n}=await I.from("restaurants").select("id, name, address, phone, email, street, number, neighborhood, city, zip_code, latitude, longitude, delivery_enabled").eq("id",r).eq("is_active",!0).limit(1).single();if(n)throw new Error(`Erro ao buscar restaurante: ${n.message}`);if(!t)throw new Error("Restaurante não encontrado ou inativo.");return t},xr=async r=>{const{data:t,error:n}=await I.from("delivery_zones").select("*").eq("restaurant_id",r).eq("is_active",!0).order("max_distance_km",{ascending:!0});if(n)throw new Error(`Erro ao buscar zonas de entrega: ${n.message}`);return t},gr=async r=>{const{data:t,error:n}=await I.from("payment_methods").select("*").eq("restaurant_id",r).eq("is_active",!0).order("name",{ascending:!0});if(n)throw new Error(`Erro ao buscar métodos de pagamento: ${n.message}`);return t},yr=async r=>{const{data:t,error:n}=await I.from("customers").select("*").eq("user_id",r).limit(1).single();if(n&&n.code!=="PGRST116")throw new Error(n.message);return t||null},mn=()=>{var Ye,et,tt,st,rt;const r=os(),t=as(),[n]=is(),p=ns(),{items:h,totalAmount:x,clearCart:j}=us(),{data:i,isLoading:C}=fs(),[E]=a.useState((Ye=t.state)==null?void 0:Ye.restaurantId),b=n.get("restaurantId"),g=E||b,{data:F}=vt(g),[P,k]=a.useState(!1),[M,q]=a.useState(!1),[he,ae]=a.useState(0),[ie,xe]=a.useState(null),[Se,te]=a.useState(!0),[Z,ce]=a.useState(null),[Tt,Pe]=a.useState(!1),[Lt,zt]=a.useState(null),[Be,qt]=a.useState(null),[K,se]=a.useState(!1),[Bt,Ge]=a.useState(!1),[Ke,$e]=a.useState(null),[Ae,Ie]=a.useState(null),{data:w,isLoading:Gt,isError:Kt,error:Ue,refetch:Ut}=me({queryKey:["checkoutRestaurantData",g],queryFn:()=>hr(g),enabled:!!g,staleTime:1/0}),{data:L,isLoading:Qt}=me({queryKey:["checkoutDeliveryZones",g],queryFn:()=>xr(w.id),enabled:!!w,staleTime:1/0}),{data:B,isLoading:Xt}=me({queryKey:["checkoutPaymentMethods",g],queryFn:()=>gr(w.id),enabled:!!w,staleTime:1/0}),{data:y,isLoading:Qe,refetch:wr}=me({queryKey:["checkoutCustomerData",i==null?void 0:i.id],queryFn:()=>yr(i.id),enabled:!!i,staleTime:0}),U=a.useMemo(()=>w!=null&&w.latitude&&(w!=null&&w.longitude)?[w.latitude,w.longitude]:null,[w]),Ht=a.useCallback(async(s,o,c,m,u,d,_)=>{const R=[30,45];if(w&&w.delivery_enabled===!1){const A=`${o}, ${c}, ${u}, ${m}, ${s}`;let v=null;if(d&&_?v={lat:d,lng:_}:v=await at(A),!v)return{coords:null,fee:0,time:null,isValid:!1};if(L&&L.length>0&&U){const $=De([v.lat,v.lng],U,L);if($)return{coords:v,fee:0,time:[$.minTime,$.maxTime],isValid:!0}}return{coords:v,fee:0,time:R,isValid:!0}}if(!w||!U)return{coords:null,fee:0,time:R,isValid:!0};const V=`${o}, ${c}, ${u}, ${m}, ${s}`;let N=null;if(d&&_?N={lat:d,lng:_}:N=await at(V),!N)return{coords:null,fee:0,time:null,isValid:!1};if(L&&L.length>0){const A=De([N.lat,N.lng],U,L);return A?{coords:N,fee:A.fee,time:[A.minTime,A.maxTime],isValid:!0}:{coords:N,fee:0,time:null,isValid:!1}}else return{coords:null,fee:0,time:R,isValid:!0}},[w,U,L]),l=it({resolver:ct(fr),defaultValues:{name:"",phone:"",cpf_cnpj:"",delivery_option:"delivery",notes:"",payment_method_id:"",change_for:""},mode:"onBlur"}),f=it({resolver:ct(pr),defaultValues:{zip_code:"",street:"",number:"",complement:"",neighborhood:"",city:""},mode:"onBlur"}),O=l.watch("delivery_option"),Jt=l.watch("payment_method_id"),re=B==null?void 0:B.find(s=>s.id===Jt),ke=(et=re==null?void 0:re.name)==null?void 0:et.includes("online"),le=(tt=re==null?void 0:re.name)==null?void 0:tt.includes("Dinheiro"),z=x+he,ge=f.watch(["zip_code","street","number","city","neighborhood","complement"]),Xe=a.useMemo(()=>{const[s,o,c,m,u,d]=ge;return`${o}|${c}|${d||""}|${u}|${m}|${s}`},[ge]);a.useEffect(()=>{if(se(!1),ce(null),ae(0),xe(null),te(!0),Ie(null),f.reset({zip_code:"",street:"",number:"",complement:"",neighborhood:"",city:""}),y){if(l.reset({...l.getValues(),name:y.name||"",phone:xt(y.phone||""),cpf_cnpj:gt(y.cpf_cnpj||""),change_for:""}),y.latitude&&y.longitude&&y.street&&y.number&&y.zip_code){const s=y.zip_code||"",o=y.street||"",c=y.number||"",m=y.neighborhood||"",u=y.city||"",d=y.complement||"";f.reset({zip_code:s,street:o,number:c,complement:d,neighborhood:m,city:u});const _=`${o}|${c}|${d}|${m}|${u}|${s}`;if(Ie(_),U&&L){const R=De([y.latitude,y.longitude],U,L);R?(ae(R.fee),xe([R.minTime,R.maxTime]),te(!0),se(!0),ce([y.latitude,y.longitude])):(ae(0),te(!1),se(!0),ce([y.latitude,y.longitude]))}}}else if(i&&!Qe){const s=i.user_metadata;l.reset({...l.getValues(),name:s.full_name||"",phone:xt(s.phone||""),cpf_cnpj:gt(s.cpf_cnpj||""),change_for:""})}},[y,l,i,Qe,f,U,L]),a.useEffect(()=>{O==="delivery"&&Ae!==null&&Xe!==Ae&&(se(!1),ae(0),xe(null),te(!0),ce(null))},[Xe,Ae,O]);const ye=l.watch("change_for");a.useEffect(()=>{if(le&&ye&&ye.trim()!==""){const s=ye.replace(",","."),o=parseFloat(s);isNaN(o)?l.setError("change_for",{message:"O troco deve ser um número válido."}):o<z?l.setError("change_for",{message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z)}).`}):l.clearErrors("change_for")}else l.clearErrors("change_for")},[le,ye,z,l]);const we=Fe({mutationFn:async s=>{var nt;q(!0);const o=`${s.street}, ${s.number}${s.complement?` - ${s.complement}`:""}, ${s.neighborhood}, ${s.city}, ${s.zip_code}`,c=await Ht(s.zip_code,s.street,s.number,s.city,s.neighborhood);if(q(!1),!c.isValid)throw new Error((w==null?void 0:w.delivery_enabled)===!1?"O endereço está errado ou incompleto, revise todos os campos.":"Endereço fora da área de entrega.");if(!c.coords)throw new Error("Não foi possível obter as coordenadas para salvar o endereço.");const u=(nt=(await I.auth.getUser()).data.user)==null?void 0:nt.id,d=l.getValues("name"),_=l.getValues("phone"),R=l.getValues("cpf_cnpj"),V=_.replace(/\D/g,""),N=R.replace(/\D/g,"");if(!d||V.length<10||!N||N.length!==11&&N.length!==14)throw new Error("Preencha Nome, Telefone (10+ dígitos) e CPF/CNPJ (11 ou 14 dígitos) nos Seus Dados antes de salvar o endereço.");if(!(y!=null&&y.id)&&!u)return{customer:{id:"anonymous",user_id:null,name:d,phone:V,email:null,address:o,created_at:"",updated_at:"",latitude:c.coords.lat,longitude:c.coords.lng,cpf_cnpj:N,street:s.street,number:s.number,neighborhood:s.neighborhood,city:s.city,zip_code:s.zip_code,complement:s.complement||null},feeResult:c};const A={name:d,phone:V,cpf_cnpj:N||null},v={user_id:(i==null?void 0:i.id)||null,...A,email:(i==null?void 0:i.email)||null,address:o,latitude:c.coords.lat,longitude:c.coords.lng,street:s.street,number:s.number,neighborhood:s.neighborhood,city:s.city,zip_code:s.zip_code,complement:s.complement||null},$="*, street, number, neighborhood, city, zip_code, complement";let Y;if(y!=null&&y.id){const{data:je,error:de}=await I.from("customers").update(v).eq("id",y.id).select($).single();if(de)throw de;Y=je}else if(u){const{data:je,error:de}=await I.from("customers").insert(v).select($).single();if(de)throw de;Y=je}else throw new Error("Não foi possível identificar o cliente para salvar.");return{customer:Y,feeResult:c}},onSuccess:(s,o)=>{const{customer:c,feeResult:m}=s;(c==null?void 0:c.id)!=="anonymous"&&p.invalidateQueries({queryKey:["checkoutCustomerData"]}),ae(m.fee),xe(m.time),te(m.isValid),se(!0),ce([m.coords.lat,m.coords.lng]);const u=`${o.street}|${o.number}|${o.complement||""}|${o.neighborhood}|${o.city}|${o.zip_code}`;Ie(u),S.success("Endereço salvo e taxa de entrega calculada!")},onError:s=>{S.error(`Erro ao salvar endereço: ${s.message}`),te(!1),se(!1)}}),Wt=s=>{l.trigger(["name","phone","cpf_cnpj"]).then(o=>{o?we.mutate(s):S.error("Preencha Nome, Telefone e CPF/CNPJ nos Seus Dados antes de salvar o endereço.")})},He=Fe({mutationFn:async s=>{var V,N;(V=(await I.auth.getUser()).data.user)==null||V.id;const c=s.phone.replace(/\D/g,""),m=((N=s.cpf_cnpj)==null?void 0:N.replace(/\D/g,""))||null;if(!s.name||c.length<10||m&&m.length!==11&&m.length!==14)throw new Error("Dados de contato incompletos ou inválidos.");const u=f.getValues(),d=O==="delivery"?`${u.street}, ${u.number}${u.complement?` - ${u.complement}`:""}, ${u.neighborhood}, ${u.city}, ${u.zip_code}`:null,_={user_id:(i==null?void 0:i.id)||null,name:s.name,phone:c,email:(i==null?void 0:i.email)||null,cpf_cnpj:m,address:d,latitude:Z?Z[0]:null,longitude:Z?Z[1]:null,street:f.getValues("street")||null,number:f.getValues("number")||null,neighborhood:f.getValues("neighborhood")||null,city:f.getValues("city")||null,zip_code:f.getValues("zip_code")||null,complement:f.getValues("complement")||null};i||(_.email=null);const R="*, street, number, neighborhood, city, zip_code, complement";if(i)if(y){const{data:A,error:v}=await I.from("customers").update(_).eq("id",y.id).select(R).single();if(v)throw v;return A}else{const{data:A,error:v}=await I.from("customers").insert(_).select(R).single();if(v)throw v;return A}else{const{data:A,error:v}=await I.from("customers").insert(_).select(R).single();if(v)throw v;return A}},onSuccess:()=>{p.invalidateQueries({queryKey:["checkoutCustomerData"]})},onError:s=>{S.error(`Erro ao salvar dados do cliente: ${s.message}`)}}),Je=Fe({mutationFn:async({customerId:s,data:o})=>{if(!w)throw new Error("Dados do restaurante não disponíveis.");let c=null;if(le&&o.change_for&&o.change_for.trim()!==""){const $=o.change_for.replace(",","."),Y=parseFloat($);!isNaN(Y)&&Y>z&&(c=Y)}let[m,u]=ie||[null,null];if((O==="delivery"||O==="pickup")&&(!m||!u)){const $=O==="pickup"?[15,30]:[30,45];m=$[0],u=$[1]}const d=f.getValues(),_=O==="delivery"?`${d.street}, ${d.number}${d.complement?` - ${d.complement}`:""}, ${d.neighborhood}, ${d.city}, ${d.zip_code}`:null,R={restaurant_id:w.id,customer_id:s,status:ke?"pending_payment":"pending",total_amount:z,delivery_fee:he,delivery_address:_,notes:o.notes,payment_method_id:o.payment_method_id,change_for:c,min_delivery_time_minutes:m,max_delivery_time_minutes:u},{data:V,error:N}=await I.from("orders").insert(R).select("id").single();if(N)throw N;const A=h.map($=>({order_id:V.id,product_id:$.product.id,quantity:parseFloat($.quantity.toFixed(3)),unit_price:parseFloat($.product.price.toFixed(2)),subtotal:parseFloat($.subtotal.toFixed(2)),notes:$.notes})),{error:v}=await I.from("order_items").insert(A);if(v)throw v;return V.id},onSuccess:s=>{p.invalidateQueries({queryKey:["orders"]})},onError:s=>{S.error(`Erro ao criar pedido: ${s.message}`)}}),Zt=async s=>{if(le&&s.change_for&&s.change_for.trim()!==""){const m=s.change_for.replace(",","."),u=parseFloat(m);if(isNaN(u)){S.error("O troco deve ser um número válido.");return}if(u<z){l.setError("change_for",{type:"manual",message:`O troco deve ser maior ou igual ao total do pedido (${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z)}).`});return}}if(h.length===0){S.error("Seu carrinho está vazio."),r(`/menu/${g}`);return}if(O==="delivery"){if(!K){S.error("Você deve salvar e validar o endereço de entrega antes de finalizar o pedido.");return}if(!Se){S.error("O endereço de entrega está fora da área de cobertura.");return}}let o;try{o=(await He.mutateAsync(s)).id}catch(m){S.error(`Falha ao salvar cliente: ${m.message}`);return}let c;try{c=await Je.mutateAsync({customerId:o,data:s})}catch(m){S.error(`Falha ao criar pedido: ${m.message}`);return}ke?await Yt(c,s):(j(),r(`/order-success/${c}`,{replace:!0}))},Yt=async(s,o)=>{if(!w)return;const c=window.location.origin+window.location.pathname,m=h.map(d=>({name:d.product.name,price:d.product.price,quantity:d.quantity})),u=S.loading("Preparando pagamento online...");try{const{data:d,error:_}=await I.functions.invoke("create-payment-preference",{body:{orderId:s,items:m,totalAmount:z,restaurantName:w.name,clientUrl:c,customerEmail:(i==null?void 0:i.email)||"cliente@anonimo.com",customerCpfCnpj:o.cpf_cnpj}});if(_)throw _;const{init_point:R}=d;zt(s),qt(R),Pe(!0),S.dismiss(u)}catch(d){S.dismiss(u),S.error(`Erro no pagamento online: ${d.message}`),Pe(!1)}},es=async()=>{await I.auth.signOut(),S.success("Você saiu da sua conta."),r("/auth",{replace:!0})},ts=(s,o,c)=>{o&&c?($e(s),Ge(!0)):(l.setValue("payment_method_id",s,{shouldValidate:!0}),$e(null))},ss=()=>{Ke&&l.setValue("payment_method_id",Ke,{shouldValidate:!0}),Ge(!1),$e(null)},rs=a.useCallback(s=>{f.setValue("street",s.street),f.setValue("neighborhood",s.neighborhood),f.setValue("city",s.city),f.setValue("zip_code",s.zip_code),f.setValue("number",s.number),f.setValue("complement",""),S.info("Endereço encontrado! Verifique o número e clique em Salvar.")},[f]),We=a.useMemo(()=>{const[s,o,c,m,u,d]=ge;return o&&c&&u&&m&&s?`${o}, ${c}${d?` - ${d}`:""} - ${u}, ${m}, ${s}`:""},[ge]);if(!g)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(ee,{variant:"destructive",className:"max-w-lg",children:[e.jsx(pt,{className:"h-4 w-4"}),e.jsx(ne,{children:"Erro de Rastreamento"}),e.jsx(oe,{children:"Não foi possível identificar o restaurante para o qual o pedido está sendo feito. Por favor, volte ao menu."}),e.jsx(Me,{to:"/",children:e.jsx(Q,{className:"mt-3",variant:"secondary",size:"sm",children:"Voltar"})})]})});if(h.length===0)return a.useEffect(()=>{r(`/menu/${g}`)},[r,g]),e.jsx(ot,{});if(Gt||Qt||Xt||C)return e.jsx(ot,{});if(Kt||!w)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(ee,{variant:"destructive",className:"max-w-lg",children:[e.jsx(pt,{className:"h-4 w-4"}),e.jsx(ne,{children:"Erro Crítico"}),e.jsx(oe,{children:Ue instanceof Error?Ue.message:"Não foi possível carregar os dados do restaurante."}),e.jsxs(Q,{onClick:()=>Ut(),className:"mt-3",variant:"secondary",size:"sm",children:[e.jsx(Os,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]})]})});const Ze=He.isPending||Je.isPending||we.isPending||M||O==="delivery"&&!K;return e.jsx("div",{className:"min-h-screen bg-background w-full overflow-x-hidden",children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-6 py-4 sm:py-8 max-w-5xl space-y-6 sm:space-y-8",children:[e.jsx(Ns,{isOpen:P,onClose:()=>k(!1),customer:y}),e.jsx(mr,{isOpen:Bt,onConfirm:ss}),Tt&&Be&&e.jsx(lr,{preferenceId:Lt,initPoint:Be,onClose:()=>Pe(!1)}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 w-full sm:w-auto",children:[e.jsx(Me,{to:`/menu/${g}`,children:e.jsx(Q,{variant:"ghost",size:"icon","aria-label":"Voltar ao Menu",children:e.jsx(Vs,{className:"h-6 w-6"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg sm:text-3xl font-bold text-foreground",children:"Finalizar Pedido"}),e.jsx("p",{className:"text-xs sm:text-lg text-muted-foreground font-medium truncate max-w-full",children:w.name})]})]}),i&&e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto justify-end",children:[e.jsxs(Q,{variant:"outline",size:"sm",onClick:()=>k(!0),"aria-label":"Meu Perfil e Pedidos",className:"flex-1 sm:flex-none text-xs sm:text-sm h-8 sm:h-9",children:[e.jsx(ft,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"})," ",e.jsx("span",{className:"truncate",children:"Perfil / Pedidos"})]}),e.jsxs(Q,{variant:"outline",size:"sm",onClick:es,className:"flex-shrink-0 text-xs sm:text-sm h-8 sm:h-9",children:[e.jsx(Cs,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"})," Sair"]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 sm:gap-8 w-full",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(X,{className:"w-full overflow-hidden",children:[e.jsx(H,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(J,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(ft,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Seus Dados"]})}),e.jsxs(W,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx("div",{className:"flex justify-between items-center mb-3 sm:mb-4",children:e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:i?`Logado como ${i.email}`:"Pedido anônimo"})}),e.jsx(ut,{...l,children:e.jsx("form",{onSubmit:l.handleSubmit(Zt),id:"checkout-form",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(T,{htmlFor:"name",className:"text-xs sm:text-sm",children:"Nome Completo *"}),e.jsx(ue,{id:"name",...l.register("name"),className:"h-9 sm:h-12 text-sm"}),l.formState.errors.name&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:l.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(T,{htmlFor:"phone",className:"text-xs sm:text-sm",children:"Telefone *"}),e.jsx(be,{name:"phone",control:l.control,render:({field:s})=>e.jsx(bs,{id:"phone",...s,className:"h-9 sm:h-12 text-sm"})}),l.formState.errors.phone&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:l.formState.errors.phone.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(T,{htmlFor:"cpf_cnpj",className:"text-xs sm:text-sm",children:"CPF/CNPJ *"}),e.jsx(be,{name:"cpf_cnpj",control:l.control,render:({field:s})=>e.jsx(Ps,{id:"cpf_cnpj",...s,className:"h-9 sm:h-12 text-sm"})}),l.formState.errors.cpf_cnpj&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:l.formState.errors.cpf_cnpj.message})]})]})})})]})]}),e.jsxs(X,{className:"w-full overflow-hidden",children:[e.jsx(H,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(J,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Opção de Entrega"]})}),e.jsx(W,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsx(be,{name:"delivery_option",control:l.control,render:({field:s})=>e.jsxs(Te,{onValueChange:s.onChange,value:s.value,className:"grid grid-cols-2 gap-2 sm:gap-4 min-w-0",children:[e.jsxs(T,{htmlFor:"delivery",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-2 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer text-center",children:[e.jsx(Ce,{value:"delivery",id:"delivery",className:"sr-only"}),e.jsx(ve,{className:"mb-1.5 sm:mb-3 h-4 w-4 sm:h-6 sm:w-6 flex-shrink-0"}),e.jsx("span",{translate:"no",className:"text-xs sm:text-base break-words w-full",children:"Entrega"})]}),e.jsxs(T,{htmlFor:"pickup",className:"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-2 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer text-center",children:[e.jsx(Ce,{value:"pickup",id:"pickup",className:"sr-only"}),e.jsx(Ve,{className:"mb-1.5 sm:mb-3 h-4 w-4 sm:h-6 sm:w-6 flex-shrink-0"}),e.jsx("span",{translate:"no",className:"text-xs sm:text-base break-words w-full",children:"Retirada no Local"})]})]})})})]}),O==="delivery"&&e.jsxs(X,{className:fe("w-full overflow-hidden",!K&&"border-destructive ring-2 ring-destructive/50"),children:[e.jsxs(H,{className:"px-3 sm:px-6 py-3 sm:py-6",children:[e.jsxs(J,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(Ve,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Endereço de Entrega",K&&e.jsx(Ts,{className:"h-4 w-4 sm:h-5 sm:w-5 text-green-500 ml-2 flex-shrink-0"}),!K&&e.jsx(Ne,{className:"h-4 w-4 sm:h-5 sm:w-5 text-destructive ml-2 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Preencha e salve para calcular a taxa."})]}),e.jsxs(W,{className:"space-y-3 sm:space-y-4 px-3 pb-3 sm:p-6 sm:pt-0",children:[w.delivery_enabled===!1&&e.jsxs(ee,{variant:"default",className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 text-blue-700 p-2 sm:p-4",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx(ne,{className:"text-sm font-semibold",children:"Frete Grátis Ativo"}),e.jsx(oe,{className:"text-xs sm:text-sm",children:"Taxas dinâmicas desativadas. Frete R$ 0,00."})]}),e.jsx(ut,{...f,children:e.jsxs("form",{onSubmit:f.handleSubmit(Wt),id:"address-form-inner",className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(T,{htmlFor:"address-search",className:"text-xs sm:text-sm",children:"Buscar Endereço"}),e.jsx(ur,{onAddressSelect:rs,disabled:M})]}),e.jsx("input",{type:"hidden",...f.register("zip_code")}),e.jsx("input",{type:"hidden",...f.register("street")}),e.jsx("input",{type:"hidden",...f.register("neighborhood")}),e.jsx("input",{type:"hidden",...f.register("city")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 min-w-0",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(T,{htmlFor:"number",className:"text-xs sm:text-sm",children:"Número *"}),e.jsx(ue,{id:"number",...f.register("number"),placeholder:"Nº",className:"h-9 sm:h-12 text-sm"}),f.formState.errors.number&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:f.formState.errors.number.message})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(T,{htmlFor:"complement",className:"text-xs sm:text-sm",children:"Complemento"}),e.jsx(ue,{id:"complement",...f.register("complement"),placeholder:"Apto, Bloco...",className:"h-9 sm:h-12 text-sm"})]})]}),f.watch("street")&&e.jsxs("div",{className:"bg-muted p-2 sm:p-3 rounded text-xs sm:text-sm break-words overflow-hidden",children:[e.jsx("p",{children:e.jsx("strong",{children:"Endereço:"})}),e.jsxs("p",{children:[f.watch("street"),f.watch("number")?`, ${f.watch("number")}`:"",f.watch("complement")?` - ${f.watch("complement")}`:""]}),e.jsxs("p",{children:[f.watch("neighborhood")," - ",f.watch("city")]})]}),e.jsxs(Q,{type:"submit",className:"w-full h-auto py-2 text-xs sm:text-base mt-2 whitespace-normal",disabled:we.isPending||M,children:[we.isPending||M?e.jsx(pe,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin mr-2"}):e.jsx(Ls,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2"}),"Salvar e Calcular"]})]})}),M&&e.jsxs(ee,{className:"flex items-center gap-2 p-2 sm:p-4",children:[e.jsx(pe,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin"}),e.jsx(ne,{className:"text-xs sm:text-sm",children:"Calculando..."})]}),K&&!M&&e.jsxs(e.Fragment,{children:[w.delivery_enabled!==!1&&!Se&&e.jsxs(ee,{variant:"destructive",className:"p-2 sm:p-4",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx(ne,{className:"text-sm",children:"Fora da Área"}),e.jsx(oe,{className:"text-xs",children:"Endereço fora da área de cobertura."})]}),(w.delivery_enabled===!1||Se&&ie)&&e.jsxs(ee,{variant:"default",className:"bg-green-50 dark:bg-green-900/20 border-green-200 text-green-700 p-2 sm:p-4",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx(ne,{className:"text-sm",children:"Entrega Disponível"}),e.jsxs(oe,{className:"text-xs",children:["Taxa: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(he),". Tempo: ",ie?`${ie[0]}-${ie[1]}`:"30-45"," min."]})]})]}),K&&Z&&We&&e.jsx("div",{className:"mt-4 w-full overflow-hidden rounded-md border",children:e.jsx(dr,{latitude:Z[0],longitude:Z[1],address:We,className:"w-full"})})]})]}),e.jsxs(X,{className:"w-full overflow-hidden",children:[e.jsx(H,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(J,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(bt,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Pagamento *"]})}),e.jsxs(W,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx(be,{name:"payment_method_id",control:l.control,render:({field:s})=>e.jsx(Te,{onValueChange:o=>{var d;const c=B==null?void 0:B.find(_=>_.id===o),m=(d=c==null?void 0:c.name)==null?void 0:d.includes("online"),u=!!F&&F.trim()!=="";ts(o,!!m,u)},value:s.value,className:"space-y-2 sm:space-y-3",children:B==null?void 0:B.map(o=>{var d;const c=(d=o.name)==null?void 0:d.includes("online"),m=!!F&&F.trim()!=="",u=c&&!m;return e.jsx(T,{htmlFor:o.id,className:fe("flex items-center justify-between rounded-md border-2 border-muted bg-popover p-2.5 sm:p-4 hover:bg-accent hover:text-accent-foreground [&:has([data-state=checked])]:border-primary cursor-pointer",u&&"opacity-50 cursor-not-allowed"),children:e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 overflow-hidden min-w-0 w-full",children:[e.jsx(Ce,{value:o.id,id:o.id,disabled:u,className:"flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-xs sm:text-base break-words w-full leading-tight",translate:"no",children:o.name}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground truncate",children:o.description}),u&&e.jsx("p",{className:"text-[10px] text-destructive mt-0.5",children:"Indisponível no momento."})]})]})},o.id)})})}),l.formState.errors.payment_method_id&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm mt-2",children:l.formState.errors.payment_method_id.message})]})]}),le&&e.jsxs(X,{className:"w-full overflow-hidden",children:[e.jsx(H,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(J,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(zs,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Troco"]})}),e.jsx(W,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(T,{htmlFor:"change_for",className:"text-xs sm:text-sm",children:"Precisa de troco para quanto?"}),e.jsx(ue,{id:"change_for",type:"number",step:"0.01",placeholder:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z),...l.register("change_for"),className:"h-9 sm:h-12 text-sm"}),((st=l.formState.errors.change_for)==null?void 0:st.message)&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:l.formState.errors.change_for.message}),((rt=l.formState.errors.change_for)==null?void 0:rt.type)==="manual"&&e.jsx("p",{className:"text-destructive text-xs sm:text-sm",children:l.formState.errors.change_for.message})]})})]}),e.jsxs(X,{className:"w-full overflow-hidden",children:[e.jsx(H,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsxs(J,{className:"text-base sm:text-xl flex items-center gap-2",children:[e.jsx(vs,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary"})," Observações"]})}),e.jsx(W,{className:"px-3 pb-3 sm:p-6 sm:pt-0",children:e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx(T,{htmlFor:"notes",className:"text-xs sm:text-sm",children:"Notas para o restaurante"}),e.jsx(xs,{id:"notes",...l.register("notes"),rows:3,placeholder:"Ex: Entregar na portaria, sem pimenta...",className:"text-sm"})]})})]})]}),e.jsx("div",{className:"lg:col-span-1 space-y-6 sticky top-4 self-start",children:e.jsxs(X,{className:"shadow-lg w-full overflow-hidden",children:[e.jsx(H,{className:"px-3 sm:px-6 py-3 sm:py-6",children:e.jsx(J,{className:"text-lg sm:text-2xl",children:"Resumo"})}),e.jsxs(W,{className:"space-y-3 sm:space-y-4 px-3 pb-3 sm:p-6 sm:pt-0",children:[e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:h.map(s=>e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsxs("span",{className:"truncate max-w-[70%]",children:[s.quantity,"x ",s.product.name]}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.subtotal)})]},s.product.id))}),e.jsx(lt,{}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm text-muted-foreground",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x)})]}),e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm text-muted-foreground",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(he)})]})]}),e.jsx(lt,{}),e.jsxs("div",{className:"flex justify-between font-bold text-base sm:text-xl",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(z)})]}),e.jsx(Q,{type:"submit",form:"checkout-form",className:"w-full h-10 sm:h-12 text-sm sm:text-lg",disabled:Ze,children:Ze?e.jsx(pe,{className:"h-4 w-4 sm:h-5 sm:w-5 animate-spin mr-2"}):ke?"Pagar e Finalizar":"Confirmar Pedido"}),O==="delivery"&&!K&&e.jsxs(ee,{variant:"destructive",className:"mt-3 p-2 sm:p-4",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx(oe,{className:"text-xs",children:"Salve o endereço acima para continuar."})]}),e.jsx(Me,{to:`/menu/${w.id}`,className:"block text-center text-xs sm:text-sm text-muted-foreground hover:underline mt-2",children:"Voltar ao Cardápio"})]})]})})]})]})})};export{mn as default};
