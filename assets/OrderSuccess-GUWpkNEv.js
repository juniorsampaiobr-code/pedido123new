import{a as R,j as e}from"./tanstack-E1juXnZE.js";import{d as q,e as A,R as D,r as z,L as d}from"./vendor-nYMJN4lg.js";import{s as E}from"./client-DHSUo4L7.js";import{b as H,d as K,a as V}from"./index-Cf_TXpBF.js";import{B as o}from"./button-DZf5fjUF.js";import{C as m,a as x,b as u,d as p}from"./card-CkBgMLGH.js";import{C as Q}from"./circle-alert-Ck3KL-fX.js";import{T as U}from"./terminal-CTvbif_u.js";import{R as X}from"./refresh-cw-Df9wjuQL.js";import{M as $}from"./map-pin-CJBeS-JT.js";import{C as P}from"./credit-card-C3QYdGp8.js";import{C as G}from"./clock-BJRmX0LS.js";import{P as J}from"./package-CR8XLPeS.js";import{C as W}from"./circle-check-big-CXHfle4r.js";import{T as Y}from"./truck-BTWHndrT.js";import{C as Z}from"./check-DjQG7D3N.js";import{C as ee}from"./circle-x-6q2_FIhd.js";import{f as se}from"./format-BeKxgCCE.js";import{p as re}from"./pt-BR-CbDebePx.js";import"./supabase-CBMN163Q.js";const _={pending:{label:"Pedido Recebido",icon:G,color:"bg-yellow-500"},preparing:{label:"Em Preparação",icon:J,color:"bg-orange-500"},ready:{label:"Pronto para Entrega",icon:W,color:"bg-green-500"},delivering:{label:"Em Entrega",icon:Y,color:"bg-blue-500"},delivered:{label:"Entregue",icon:Z,color:"bg-primary"},cancelled:{label:"Cancelado",icon:ee,color:"bg-destructive"},pending_payment:{label:"Aguardando Pagamento",icon:P,color:"bg-gray-500"}},te=async n=>{const{data:a,error:r}=await E.from("orders").select("*, customer:customers(name, phone, email, cpf_cnpj), payment_methods(name)").eq("id",n).limit(1).single();if(r)throw new Error(`Erro ao buscar pedido: ${r.message}`);if(!a)throw new Error("Pedido não encontrado.");return a},ae=async n=>{const{data:a,error:r}=await E.from("order_items").select("*, products(name, is_price_by_weight)").eq("order_id",n);if(r)throw new Error(r.message);return a},Re=()=>{var w;const{orderId:n}=q(),[a]=A(),r=n||a.get("external_reference");a.get("status");const{clearCart:f}=H(),[h,B]=D.useState(!1),{data:s,isLoading:I,isError:L,error:c,refetch:T}=R({queryKey:["orderSuccessDetails",r],queryFn:()=>te(r),enabled:!!r,staleTime:0}),{data:l,isLoading:S,isError:k}=R({queryKey:["orderSuccessItems",r],queryFn:()=>ae(r),enabled:!!r,staleTime:0});z.useEffect(()=>{r&&!h&&(f(),B(!0))},[r,f,h]);const j=(s==null?void 0:s.status)||"pending_payment",i=_[j]||_.pending_payment,F=s!=null&&s.id?s.id.slice(-4):"N/A",g=(s==null?void 0:s.total_amount)||0,y=(s==null?void 0:s.delivery_fee)||0,O=g-y,b=s!=null&&s.created_at?new Date(s.created_at):null;b&&se(b,"dd 'de' MMMM 'de' yyyy 'às' HH:mm",{locale:re});const N=s!=null&&s.change_for?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.change_for):null,M=((w=s==null?void 0:s.payment_methods)==null?void 0:w.name)||"Não especificado";return r?I||S?e.jsx(K,{}):L||k||!s?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(m,{className:"max-w-lg w-full text-center",children:[e.jsx(x,{children:e.jsxs(u,{className:"text-2xl font-bold text-destructive flex items-center justify-center gap-2",children:[e.jsx(U,{className:"h-6 w-6"}),"Erro ao Carregar Pedido"]})}),e.jsxs(p,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:(c==null?void 0:c.message)||"Ocorreu um erro desconhecido ao buscar os detalhes do pedido."}),e.jsxs(o,{onClick:()=>T(),className:"mr-2",children:[e.jsx(X,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]}),e.jsx(d,{to:"/menu",children:e.jsx(o,{variant:"outline",children:"Voltar ao Cardápio"})})]})]})}):e.jsx("div",{className:"min-h-screen bg-background flex justify-center p-4 sm:p-8",children:e.jsxs(m,{className:"w-full max-w-3xl shadow-xl",children:[e.jsxs(x,{className:"text-center space-y-4",children:[e.jsx("div",{className:V("mx-auto p-3 rounded-full w-16 h-16 flex items-center justify-center",i.color),children:e.jsx(i.icon,{className:"h-8 w-8 text-white"})}),e.jsx(u,{className:"text-3xl font-bold",children:j==="cancelled"?"Pedido Cancelado":"Pedido Realizado com Sucesso!"}),e.jsxs("p",{className:"text-lg text-muted-foreground",children:["Seu pedido #",F," está em ",i.label.toLowerCase(),"."]})]}),e.jsxs(p,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 border-b pb-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Entrega"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.delivery_address||"Retirada no local"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(P,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Pagamento"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:M}),N&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Troco para: ",N]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Resumo do Pedido"}),e.jsx("div",{className:"space-y-2",children:l==null?void 0:l.map(t=>{var v,C;return e.jsxs("div",{className:"flex justify-between items-start p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((v=t.products)==null?void 0:v.name)||"Produto Removido"}),t.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Obs: ",t.notes]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.quantity," ",(C=t.products)!=null&&C.is_price_by_weight?"kg":"x"," ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.unit_price)]}),e.jsx("p",{className:"font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.subtotal)})]})]},t.id)})})]}),e.jsxs("div",{className:"pt-4 border-t space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(O)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(y)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-xl pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(g)})]})]}),e.jsx("div",{className:"pt-6 flex justify-center",children:e.jsx(d,{to:"/menu",children:e.jsx(o,{size:"lg",children:"Fazer Novo Pedido"})})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(m,{className:"max-w-lg w-full text-center",children:[e.jsx(x,{children:e.jsxs(u,{className:"text-2xl font-bold text-destructive flex items-center justify-center gap-2",children:[e.jsx(Q,{className:"h-6 w-6"}),"Erro no Pedido"]})}),e.jsxs(p,{children:[e.jsx("p",{className:"text-muted-foreground mb-6",children:"ID do pedido não encontrado. Por favor, volte ao menu."}),e.jsx(d,{to:"/menu",children:e.jsx(o,{size:"lg",children:"Voltar ao Cardápio"})})]})]})})};export{Re as default};
