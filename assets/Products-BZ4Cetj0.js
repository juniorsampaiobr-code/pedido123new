import{u as R,b as F,j as e,a as I}from"./tanstack-E1juXnZE.js";import{s as y}from"./client-DHSUo4L7.js";import{B as j}from"./button-DZf5fjUF.js";import{C as z,a as he,d as U,b as Pe}from"./card-CkBgMLGH.js";import{S as ge,a as pe,b as fe,c as ve,d as ye,B as K,T as Me,e as Ae,f as xe,g as ue}from"./select-eJpb0BBr.js";import{S as M}from"./switch-BX1vAzAN.js";import{S as w}from"./skeleton-y5dhUFmF.js";import{A as be,a as _e,b as we}from"./alert-DdwIKPi0.js";import{c as B,u as N,L as je,a as Fe}from"./index-Cf_TXpBF.js";import{r as E,b as Oe}from"./vendor-nYMJN4lg.js";import{o as V,s as S,c as W,e as T,u as H,t as G,p as Ne,l as Ce,i as Ee}from"./types-DkmadQTj.js";import{d as J,e as X,f as Y,g as Z,h as ee,i as se,j as re}from"./dialog-Vr-i57Ue.js";import{F as ae,a as m,b as h,e as u,c as x,d as v}from"./form-BcJ-rGFv.js";import{I as q}from"./input-CwnxbN_z.js";import{T as ie}from"./textarea-CTqQwRfA.js";import{P as oe}from"./plus-uoAbwVUx.js";import{U as Se}from"./upload-DILmYOjM.js";import{T as ke}from"./terminal-CTvbif_u.js";import{T as ne}from"./trash-2-DR2TT1ru.js";import{A as Te,a as Le,b as $e,c as ze,d as Ue,e as Ke,f as Re,g as Ie}from"./alert-dialog-z6bXWnuH.js";import"./supabase-CBMN163Q.js";import"./index-DNYFYjXG.js";import"./index-DpcYSu1F.js";import"./check-DjQG7D3N.js";import"./label-akLErNRj.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=B("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=B("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=B("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Ve=V({name:S().min(1,"O nome é obrigatório."),description:S().optional(),display_order:W.number().default(0),is_active:T().default(!0)}),qe=({isOpen:a,onClose:t,restaurantId:r})=>{const g=R(),l=H({resolver:G(Ve),defaultValues:{name:"",description:"",display_order:0,is_active:!0}}),b=F({mutationFn:async n=>{if(!r)throw new Error("ID do restaurante não encontrado.");const{error:o}=await y.from("categories").insert({restaurant_id:r,name:n.name,description:n.description,display_order:n.display_order,is_active:n.is_active});if(o)throw new Error(o.message)},onSuccess:()=>{N.success("Categoria criada com sucesso!"),g.invalidateQueries({queryKey:["categoriesWithProducts",r]}),g.invalidateQueries({queryKey:["categories",r]}),t(),l.reset()},onError:n=>{N.error(`Erro ao criar categoria: ${n.message}`)}}),p=n=>{b.mutate(n)};return e.jsx(J,{open:a,onOpenChange:t,children:e.jsxs(X,{className:"sm:max-w-[425px]",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Nova Categoria"}),e.jsx(ee,{children:"Gerencie as categorias dos seus produtos"})]}),e.jsx(ae,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(p),className:"space-y-4 pt-4",children:[e.jsx(m,{control:l.control,name:"name",render:({field:n})=>e.jsxs(h,{children:[e.jsx(u,{children:"Nome *"}),e.jsx(x,{children:e.jsx(q,{placeholder:"",...n})}),e.jsx(v,{})]})}),e.jsx(m,{control:l.control,name:"description",render:({field:n})=>e.jsxs(h,{children:[e.jsx(u,{children:"Descrição"}),e.jsx(x,{children:e.jsx(ie,{placeholder:"",...n})}),e.jsx(v,{})]})}),e.jsx(m,{control:l.control,name:"display_order",render:({field:n})=>e.jsxs(h,{children:[e.jsx(u,{children:"Ordem de Exibição"}),e.jsx(x,{children:e.jsx(q,{type:"number",...n})}),e.jsx(v,{})]})}),e.jsx(m,{control:l.control,name:"is_active",render:({field:n})=>e.jsxs(h,{className:"flex flex-row items-center space-x-3 space-y-0 pt-2",children:[e.jsx(x,{children:e.jsx(M,{checked:n.value,onCheckedChange:n.onChange,id:"is_active"})}),e.jsx(u,{htmlFor:"is_active",className:"font-normal cursor-pointer",children:"Ativa"})]})}),e.jsxs(se,{className:"pt-4",children:[e.jsx(re,{asChild:!0,children:e.jsx(j,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(j,{type:"submit",disabled:b.isPending||!r,children:b.isPending?"Criando...":"Criar"})]})]})})]})})},We=V({name:S().min(1,"O nome é obrigatório."),description:S().optional(),price:Ne(a=>String(a).replace(",","."),W.number({invalid_type_error:"O preço deve ser um número."}).positive("O preço deve ser maior que zero.")),category_id:S().min(1,"A categoria é obrigatória."),image_url:S().url("URL inválida.").optional().or(Ce("")),image_file:Ee(File).optional(),is_price_by_weight:T().default(!1),is_available:T().default(!0)}).refine(a=>a.image_url||a.image_file,{message:"É necessário enviar uma imagem ou uma URL.",path:["image_file"]}),He=async a=>{const{data:t,error:r}=await y.from("categories").select("id, name").eq("restaurant_id",a).eq("is_active",!0);if(r)throw new Error(r.message);return t},Ge=({isOpen:a,onClose:t,restaurantId:r})=>{const g=R(),[l,b]=E.useState(!1),{data:p,isLoading:n}=I({queryKey:["categories",r],queryFn:()=>He(r),enabled:!!r&&a}),o=H({resolver:G(We),defaultValues:{name:"",description:"",price:0,is_price_by_weight:!1,is_available:!0,image_url:"",category_id:""}}),C=F({mutationFn:async s=>{if(!r)throw new Error("ID do restaurante não encontrado.");let d=s.image_url;if(s.image_file){const f=s.image_file,D=`${r}/${Date.now()}-${f.name}`,{error:P}=await y.storage.from("products").upload(D,f);if(P)throw new Error(`Erro no upload da imagem: ${P.message}`);const{data:A}=y.storage.from("products").getPublicUrl(D);d=A.publicUrl}const{error:c}=await y.from("products").insert({restaurant_id:r,name:s.name,description:s.description,price:s.price,category_id:s.category_id,image_url:d,is_price_by_weight:s.is_price_by_weight,is_available:s.is_available});if(c)throw new Error(c.message)},onSuccess:()=>{N.success("Produto criado com sucesso!"),g.invalidateQueries({queryKey:["products"]}),t(),o.reset()},onError:s=>{N.error(`Erro ao criar produto: ${s.message}`)}}),k=s=>{C.mutate(s)};return e.jsxs(e.Fragment,{children:[e.jsx(qe,{isOpen:l,onClose:()=>b(!1),restaurantId:r}),e.jsx(J,{open:a,onOpenChange:t,children:e.jsxs(X,{className:"sm:max-w-lg",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Novo Produto"}),e.jsx(ee,{children:"Adicione um novo item ao seu cardápio."})]}),e.jsx(ae,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(k),children:[e.jsxs("div",{className:"space-y-4 py-2 pb-4 max-h-[70vh] overflow-y-auto pr-4",children:[e.jsx(m,{control:o.control,name:"name",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"Nome *"}),e.jsx(x,{children:e.jsx(q,{placeholder:"Nome do produto",...s})}),e.jsx(v,{})]})}),e.jsx(m,{control:o.control,name:"description",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"Descrição"}),e.jsx(x,{children:e.jsx(ie,{placeholder:"Ingredientes, detalhes, etc.",...s})}),e.jsx(v,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{control:o.control,name:"price",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"Preço (R$) unitário *"}),e.jsx(x,{children:e.jsx(q,{type:"text",placeholder:"0,00",...s})}),e.jsx(v,{})]})}),e.jsx(m,{control:o.control,name:"category_id",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"Categoria *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ge,{onValueChange:s.onChange,value:s.value,disabled:n||!r,children:[e.jsx(x,{children:e.jsx(pe,{children:e.jsx(fe,{placeholder:"Selecione uma categoria"})})}),e.jsx(ve,{children:p==null?void 0:p.map(d=>e.jsx(ye,{value:d.id,children:d.name},d.id))})]}),e.jsx(j,{type:"button",variant:"outline",size:"icon",onClick:()=>b(!0),disabled:!r,children:e.jsx(oe,{className:"h-4 w-4"})})]}),e.jsx(v,{})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Imagem do Produto"}),e.jsx(m,{control:o.control,name:"image_file",render:({field:s})=>{var d;return e.jsxs(h,{children:[e.jsx(x,{children:e.jsxs("label",{className:"flex items-center justify-center w-full h-12 px-4 border-2 border-dashed rounded-md cursor-pointer hover:bg-muted",children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:((d=s.value)==null?void 0:d.name)||"Escolher Imagem"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:c=>{var f;return s.onChange((f=c.target.files)==null?void 0:f[0])}})]})}),e.jsx(v,{})]})}}),e.jsx(m,{control:o.control,name:"image_url",render:({field:s})=>e.jsxs(h,{children:[e.jsx(x,{children:e.jsx(q,{placeholder:"Ou cole a URL da imagem",...s})}),e.jsx(v,{})]})})]}),e.jsx(m,{control:o.control,name:"is_price_by_weight",render:({field:s})=>e.jsxs(h,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(u,{children:"Produto pesável (preço por kg)"}),e.jsx(x,{children:e.jsx(M,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(m,{control:o.control,name:"is_available",render:({field:s})=>e.jsxs(h,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(u,{children:"Produto disponível"}),e.jsx(x,{children:e.jsx(M,{checked:s.value,onCheckedChange:s.onChange})})]})})]}),e.jsxs(se,{className:"pt-4 border-t",children:[e.jsx(re,{asChild:!0,children:e.jsx(j,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(j,{type:"submit",disabled:C.isPending||!r,children:C.isPending?"Criando...":"Criar Produto"})]})]})})]})})]})},Je=V({name:S().min(1,"O nome é obrigatório."),description:S().optional(),price:Ne(a=>String(a).replace(",","."),W.number({invalid_type_error:"O preço deve ser um número."}).positive("O preço deve ser maior que zero.")),category_id:S().optional(),image_url:S().url("URL inválida.").optional().or(Ce("")),image_file:Ee(File).optional(),is_price_by_weight:T().default(!1),is_available:T().default(!0)}),Xe=async a=>{const{data:t,error:r}=await y.from("categories").select("id, name").eq("restaurant_id",a).eq("is_active",!0);if(r)throw new Error(r.message);return t},Ye=({isOpen:a,onClose:t,product:r})=>{const g=R(),[l,b]=E.useState(null);E.useEffect(()=>{r!=null&&r.restaurant_id&&b(r.restaurant_id)},[r,a]);const{data:p,isLoading:n}=I({queryKey:["categories",l],queryFn:()=>Xe(l),enabled:!!l&&a}),o=H({resolver:G(Je)});E.useEffect(()=>{r&&o.reset({name:r.name,description:r.description||"",price:r.price,category_id:r.category_id||void 0,image_url:r.image_url||"",is_price_by_weight:r.is_price_by_weight||!1,is_available:r.is_available??!0,image_file:void 0})},[r,o,a]);const C=F({mutationFn:async s=>{if(!(r!=null&&r.id)||!l)throw new Error("ID do produto ou restaurante não encontrado.");let d=r.image_url;if(s.image_file){const f=s.image_file,D=`${l}/${Date.now()}-${f.name}`,{error:P}=await y.storage.from("products").upload(D,f);if(P)throw new Error(`Erro no upload da imagem: ${P.message}`);const{data:A}=y.storage.from("products").getPublicUrl(D);d=A.publicUrl}else d=s.image_url||null;const{error:c}=await y.from("products").update({name:s.name,description:s.description,price:s.price,category_id:s.category_id||null,image_url:d,is_price_by_weight:s.is_price_by_weight,is_available:s.is_available}).eq("id",r.id);if(c)throw c},onSuccess:()=>{N.success("Produto atualizado com sucesso!"),g.invalidateQueries({queryKey:["products",l]}),g.invalidateQueries({queryKey:["menuData"]}),t()},onError:s=>{N.error(`Erro ao atualizar produto: ${s.message}`)}}),k=s=>{C.mutate(s)};return e.jsx(J,{open:a,onOpenChange:t,children:e.jsxs(X,{className:"sm:max-w-lg",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Editar Produto"}),e.jsx(ee,{children:"Atualize as informações do item do seu cardápio."})]}),e.jsx(ae,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(k),children:[e.jsxs("div",{className:"space-y-4 py-2 pb-4 max-h-[70vh] overflow-y-auto pr-4",children:[e.jsx(m,{control:o.control,name:"name",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"Nome *"}),e.jsx(x,{children:e.jsx(q,{...s})}),e.jsx(v,{})]})}),e.jsx(m,{control:o.control,name:"description",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"Descrição"}),e.jsx(x,{children:e.jsx(ie,{...s})}),e.jsx(v,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{control:o.control,name:"price",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"Preço (R$) *"}),e.jsx(x,{children:e.jsx(q,{type:"text",...s})}),e.jsx(v,{})]})}),e.jsx(m,{control:o.control,name:"category_id",render:({field:s})=>e.jsxs(h,{children:[e.jsx(u,{children:"Categoria"}),e.jsxs(ge,{onValueChange:s.onChange,value:s.value,disabled:n||!l,children:[e.jsx(x,{children:e.jsx(pe,{children:e.jsx(fe,{placeholder:"Selecione uma categoria"})})}),e.jsx(ve,{children:p==null?void 0:p.map(d=>e.jsx(ye,{value:d.id,children:d.name},d.id))})]}),e.jsx(v,{})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Imagem do Produto"}),e.jsx(m,{control:o.control,name:"image_file",render:({field:s})=>{var d;return e.jsxs(h,{children:[e.jsx(x,{children:e.jsxs("label",{className:"flex items-center justify-center w-full h-12 px-4 border-2 border-dashed rounded-md cursor-pointer hover:bg-muted",children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:((d=s.value)==null?void 0:d.name)||"Escolher Nova Imagem"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:c=>{var f;return s.onChange((f=c.target.files)==null?void 0:f[0])}})]})}),e.jsx(v,{})]})}}),e.jsx(m,{control:o.control,name:"image_url",render:({field:s})=>e.jsxs(h,{children:[e.jsx(x,{children:e.jsx(q,{placeholder:"Ou cole a URL da imagem",...s})}),e.jsx(v,{})]})})]}),e.jsx(m,{control:o.control,name:"is_price_by_weight",render:({field:s})=>e.jsxs(h,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(u,{children:"Produto pesável (preço por kg)"}),e.jsx(x,{children:e.jsx(M,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(m,{control:o.control,name:"is_available",render:({field:s})=>e.jsxs(h,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(u,{children:"Produto disponível"}),e.jsx(x,{children:e.jsx(M,{checked:s.value,onCheckedChange:s.onChange})})]})})]}),e.jsxs(se,{className:"pt-4 border-t",children:[e.jsx(re,{asChild:!0,children:e.jsx(j,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(j,{type:"submit",disabled:C.isPending||!l,children:C.isPending?"Salvando...":"Salvar Alterações"})]})]})})]})})},Ze=async a=>{const{data:t,error:r}=await y.from("categories").select("*").eq("restaurant_id",a).order("display_order",{ascending:!0});if(r)throw new Error(`Erro ao buscar categorias: ${r.message}`);const{data:g,error:l}=await y.from("products").select("id, name, category_id, is_available").eq("restaurant_id",a);if(l)throw new Error(`Erro ao buscar produtos: ${l.message}`);return t.map(p=>({...p,products:g.filter(n=>n.category_id===p.id)}))},es=({restaurantId:a})=>{const[t,r]=E.useState(!1),{data:g,isLoading:l,isError:b,error:p}=I({queryKey:["categoriesWithProducts",a],queryFn:()=>Ze(a),enabled:!!a});return e.jsxs(e.Fragment,{children:[e.jsx(qe,{isOpen:t,onClose:()=>r(!1),restaurantId:a}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Categorias"}),e.jsxs(j,{onClick:()=>r(!0),disabled:!a,children:[e.jsx(oe,{className:"mr-2 h-4 w-4"})," Nova Categoria"]})]}),l&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[...Array(3)].map((n,o)=>e.jsxs(z,{children:[e.jsx(he,{children:e.jsx(w,{className:"h-6 w-3/4"})}),e.jsxs(U,{className:"space-y-4",children:[e.jsx(w,{className:"h-4 w-1/4"}),e.jsx(w,{className:"h-4 w-1/2"}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(w,{className:"h-8 w-full"}),e.jsx(w,{className:"h-8 w-full"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(w,{className:"h-10 w-full"}),e.jsx(w,{className:"h-10 w-10"})]})]})]},o))}),b&&e.jsxs(be,{variant:"destructive",children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx(_e,{children:"Erro ao carregar categorias"}),e.jsx(we,{children:p instanceof Error?p.message:"Ocorreu um erro desconhecido."})]}),g&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:g.map(n=>e.jsxs(z,{children:[e.jsxs(he,{className:"flex flex-row items-start justify-between",children:[e.jsx(Pe,{children:n.name}),n.is_active&&e.jsx(K,{children:"Ativa"})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ordem: ",n.display_order??0]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium mb-2",children:["Produtos (",n.products.length,"):"]}),e.jsx("div",{className:"space-y-2",children:n.products.length>0?n.products.map(o=>e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-2 rounded-md",children:[e.jsx("span",{className:"text-sm",children:o.name}),o.is_available&&e.jsx(K,{variant:"secondary",children:"Disponível"})]},o.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum produto nesta categoria."})})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[e.jsxs(j,{variant:"outline",className:"w-full",children:[e.jsx(te,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsx(j,{variant:"destructive",size:"icon",children:e.jsx(ne,{className:"h-4 w-4"})})]})]})]},n.id))})]})]})},ss=({product:a,onEditClick:t,onUpdateStatus:r,onDeleteClick:g})=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-card hover:bg-accent transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:a.image_url||"/placeholder.svg",alt:a.name,className:"w-16 h-16 object-cover rounded-md border"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.price)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{variant:a.is_available?"default":"secondary",children:a.is_available?"Disponível":"Indisponível"}),e.jsx(M,{checked:a.is_available??!1,onCheckedChange:r}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>t(a),children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>g(a.id),children:e.jsx(ne,{className:"h-4 w-4"})})]})]}),rs=async a=>{const{data:t,error:r}=await y.from("products").select("*").eq("restaurant_id",a).order("created_at",{ascending:!1});if(r)throw new Error(`Erro ao buscar produtos: ${r.message}`);return t},ks=()=>{const a=R(),{userRestaurantId:t}=Oe(),[r,g]=E.useState(!1),[l,b]=E.useState(!1),[p,n]=E.useState(null),[o,C]=E.useState(null),[k,s]=E.useState(()=>{if(typeof window<"u"){const i=localStorage.getItem("productsLayout");return i==="grid"||i==="list"?i:"grid"}return"grid"}),d=E.useCallback(i=>{s(i),localStorage.setItem("productsLayout",i)},[]),{data:c,isLoading:f,isError:D,error:P}=I({queryKey:["products",t],queryFn:()=>rs(t),enabled:!!t}),A=i=>{n(i),b(!0)},le=F({mutationFn:async({id:i,is_available:_})=>{const{error:O}=await y.from("products").update({is_available:_}).eq("id",i);if(O)throw new Error(O.message)},onSuccess:()=>{a.invalidateQueries({queryKey:["products"]}),N.success("Status do produto atualizado!")},onError:i=>{N.error(`Erro ao atualizar produto: ${i.message}`)}}),L=F({mutationFn:async i=>{const{error:_}=await y.from("products").delete().eq("id",i);if(_)throw new Error(_.message)},onSuccess:()=>{a.invalidateQueries({queryKey:["products"]}),a.invalidateQueries({queryKey:["menuData"]}),N.success("Produto excluído com sucesso!"),C(null)},onError:i=>{N.error(`Erro ao excluir produto: ${i.message}`),C(null)}}),ce=F({mutationFn:async i=>{if(!c||c.length===0||!t)return;const _=c.map(De=>De.id),{error:O}=await y.from("products").update({is_available:i}).in("id",_);if(O)throw new Error(O.message)},onSuccess:(i,_)=>{a.invalidateQueries({queryKey:["products"]}),a.invalidateQueries({queryKey:["menuData"]}),N.success(`Todos os produtos foram ${_?"ativados":"desativados"} com sucesso!`)},onError:i=>{N.error(`Erro ao atualizar status em massa: ${i.message}`)}}),de=i=>{if(!c||c.length===0){N.info("Nenhum produto para atualizar.");return}ce.mutate(i)},me=i=>{L.mutate(i)},Q=c==null?void 0:c.find(i=>i.id===o),$=ce.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(Ge,{isOpen:r,onClose:()=>g(!1),restaurantId:t}),e.jsx(Ye,{isOpen:l,onClose:()=>b(!1),product:p}),e.jsx(Te,{open:!!o,onOpenChange:i=>!i&&C(null),children:e.jsxs(Le,{children:[e.jsxs($e,{children:[e.jsx(ze,{children:"Tem certeza que deseja excluir este produto?"}),e.jsxs(Ue,{children:['Esta ação é permanente. O produto "',(Q==null?void 0:Q.name)||"selecionado",'" será removido do cardápio.']})]}),e.jsxs(Ke,{children:[e.jsx(Re,{disabled:L.isPending,children:"Cancelar"}),e.jsx(Ie,{onClick:()=>me(o),className:"bg-destructive hover:bg-destructive/90",disabled:L.isPending,children:L.isPending?"Excluindo...":"Excluir"})]})]})}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:e.jsxs(Me,{defaultValue:"products",children:[e.jsxs(Ae,{children:[e.jsx(xe,{value:"products",children:"Produtos"}),e.jsx(xe,{value:"categories",children:"Categorias"})]}),e.jsxs(ue,{value:"products",className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Produtos"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(j,{variant:"outline",size:"icon",onClick:()=>d(k==="grid"?"list":"grid"),children:k==="grid"?e.jsx(Be,{className:"h-4 w-4"}):e.jsx(Qe,{className:"h-4 w-4"})}),e.jsx(j,{variant:"outline",onClick:()=>de(!0),disabled:$||f||!c||c.length===0,children:$?e.jsx(je,{className:"h-4 w-4 animate-spin mr-2"}):"Ativar Todos"}),e.jsx(j,{variant:"outline",onClick:()=>de(!1),disabled:$||f||!c||c.length===0,children:$?e.jsx(je,{className:"h-4 w-4 animate-spin mr-2"}):"Desativar Todos"}),e.jsxs(j,{onClick:()=>g(!0),children:[e.jsx(oe,{className:"mr-2 h-4 w-4"})," Novo Produto"]})]})]}),f&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((i,_)=>e.jsxs(z,{className:"overflow-hidden",children:[e.jsx(w,{className:"h-48 w-full"}),e.jsxs(U,{className:"p-4 space-y-3",children:[e.jsx(w,{className:"h-5 w-3/4"}),e.jsx(w,{className:"h-6 w-1/3"}),e.jsxs("div",{className:"flex justify-between items-center border-t pt-3 mt-3",children:[e.jsx(w,{className:"h-5 w-1/2"}),e.jsx(w,{className:"h-6 w-12"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(w,{className:"h-10 w-full"}),e.jsx(w,{className:"h-10 w-10"})]})]})]},_))}),D&&e.jsxs(be,{variant:"destructive",children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx(_e,{children:"Erro ao carregar produtos"}),e.jsx(we,{children:P.message})]}),c&&e.jsx("div",{className:Fe(k==="grid"?"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"space-y-4"),children:c.map(i=>k==="grid"?e.jsxs(z,{className:"overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:i.image_url||"/placeholder.svg",alt:i.name,className:"w-full h-48 object-cover"}),i.is_available&&e.jsx(K,{className:"absolute top-2 right-2",children:"Disponível"})]}),e.jsxs(U,{className:"p-4 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"text-lg font-semibold truncate",children:i.name}),e.jsx("p",{className:"text-xl font-bold text-primary mt-1 mb-3",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i.price)})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-t pt-3",children:[e.jsx("label",{htmlFor:`active-${i.id}`,className:"text-sm font-medium",children:"Produto Ativo"}),e.jsx(M,{id:`active-${i.id}`,checked:i.is_available??!1,onCheckedChange:_=>{le.mutate({id:i.id,is_available:_})}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"outline",className:"w-full",onClick:()=>A(i),children:[e.jsx(te,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsx(j,{variant:"destructive",size:"icon",onClick:()=>C(i.id),children:e.jsx(ne,{className:"h-4 w-4"})})]})]})]})]},i.id):e.jsx(ss,{product:i,onEditClick:A,onUpdateStatus:_=>le.mutate({id:i.id,is_available:_}),onDeleteClick:me},i.id))})]}),e.jsx(ue,{value:"categories",children:e.jsx(es,{restaurantId:t})})]})})]})};export{ks as default};
