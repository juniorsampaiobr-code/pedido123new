import{j as e,u as $e}from"./tanstack-DS1wz2fm.js";import{s as H}from"./client-BP8r4skJ.js";import{S as B}from"./skeleton-DEqedZh5.js";import{A as te,a as re,b as se}from"./alert-CC-sQmAr.js";import{r as l,L as Ue}from"./vendor-DPb28zz8.js";import{o as oe,n as Qe,u as ne,t as ae,c as Ge}from"./types-dEzyxwQ3.js";import{B as C}from"./button-7ZUs3ZdT.js";import{D as le,a as ie,b as ce,c as de,d as ue,e as me,B as he,f as Ke}from"./index-BA_hNnZJ.js";import{F as fe,a as xe,b as Je,c as Ze,d as et,e as tt}from"./form-CUqspwQq.js";import{c as rt,a as z,b as w,T as st,d as ot,e as nt,X as at,f as lt,g as it,h as I,P as F,i as V,j as T,k as _,l as ct,u as Z}from"./index-B_Xs51eY.js";import{P as pe}from"./plus-CaWYIEAT.js";import{S as X}from"./shopping-cart-B02Quh5W.js";import{I as dt}from"./label-z6ZyLp45.js";import{C as be,a as ut}from"./card-4upxJB7h.js";import{M as mt}from"./map-pin-BvjDpPoz.js";import{C as ht,a as ft}from"./circle-x-LsvXZl2h.js";import{C as ge}from"./clock-BN9sTMS5.js";import{O as ve,C as we,a as je,T as Se,D as ye,P as xt,R as pt}from"./index-C3PY_-2X.js";import{S as bt}from"./separator-DExHrdA-.js";import{u as gt}from"./index-Dm27xrF8.js";import{T as vt}from"./trash-2-D-PP6SW_.js";import{T as wt}from"./terminal-DAU6_mJ-.js";import"./supabase-BT-vd-uw.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=rt("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),jt=oe({quantity:Qe().min(1,"Mínimo 1 item.")}),St=({product:t,isOpen:s,onClose:r})=>{const{addItem:n}=z(),o=ne({resolver:ae(jt),defaultValues:{quantity:1},values:{quantity:1}}),a=o.watch("quantity"),i=m=>{const u=a+m;u>=1&&o.setValue("quantity",u)},d=m=>{t&&(n({product_id:t.id,name:t.name,price:t.price,quantity:m.quantity,image_url:t.image_url}),r(),o.reset({quantity:1}))};if(!t)return null;const c=t.price*a;return e.jsx(le,{open:s,onOpenChange:r,children:e.jsxs(ie,{className:"sm:max-w-[425px] p-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.image_url||"/placeholder.svg",alt:t.name,className:"w-full h-48 object-cover"}),e.jsxs(ce,{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent p-4 flex flex-col justify-end items-start text-left space-y-0",children:[e.jsx(de,{className:"text-2xl font-bold text-white drop-shadow-md",children:t.name}),e.jsxs(ue,{className:"sr-only",children:["Detalhes e opções de personalização para ",t.name,"."]})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description}),e.jsx(fe,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(d),className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-y py-3",children:[e.jsx(xe,{className:"text-base font-semibold",children:"Quantidade"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{type:"button",variant:"outline",size:"icon",onClick:()=>i(-1),disabled:a<=1,children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-8 text-center font-bold text-lg",children:a}),e.jsx(C,{type:"button",variant:"outline",size:"icon",onClick:()=>i(1),children:e.jsx(pe,{className:"h-4 w-4"})})]})]}),e.jsxs(me,{className:w("pt-4","sm:justify-between sm:space-x-0"),children:[e.jsxs("div",{className:"text-xl font-bold text-foreground hidden sm:block",children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c)]}),e.jsxs(C,{type:"submit",className:"w-full sm:w-auto h-12 text-lg",disabled:o.formState.isSubmitting,children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),"Adicionar ao Pedido"]})]})]})})]})]})})},yt=oe({weight_in_grams:Ge.number({invalid_type_error:"Deve ser um número."}).positive("A quantidade deve ser maior que zero.")}),Nt=({product:t,isOpen:s,onClose:r})=>{const{addItem:n}=z(),o=ne({resolver:ae(yt),defaultValues:{weight_in_grams:500}}),a=o.watch("weight_in_grams"),i=l.useMemo(()=>!t||!a||a<=0?0:t.price/1e3*a,[t,a]),d=c=>{t&&(n({product_id:t.id,name:`${t.name} (${c.weight_in_grams}g)`,price:i,quantity:1,image_url:t.image_url,is_price_by_weight:!0}),r(),o.reset({weight_in_grams:500}))};return t?e.jsx(le,{open:s,onOpenChange:r,children:e.jsxs(ie,{className:"sm:max-w-[425px]",children:[e.jsxs(ce,{className:"text-center",children:[e.jsx(de,{className:"text-2xl",children:"Quanto você deseja?"}),e.jsxs(ue,{children:[e.jsx("span",{className:"block text-lg font-semibold mt-2",children:t.name}),e.jsxs("span",{className:"block text-muted-foreground",children:[new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.price)," por kg"]})]})]}),e.jsx(fe,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(d),className:"space-y-6 pt-4",children:[e.jsx(Je,{control:o.control,name:"weight_in_grams",render:({field:c})=>e.jsxs(Ze,{children:[e.jsx(xe,{className:"text-base",children:"Quantidade em gramas"}),e.jsx(et,{children:e.jsx(dt,{type:"number",placeholder:"Ex: 500",className:"h-12 text-lg text-center",...c,value:c.value===void 0||c.value===null?"":String(c.value),onChange:m=>{const u=m.target.value;c.onChange(u===""?void 0:parseFloat(u))}})}),e.jsx(tt,{})]})}),e.jsxs(me,{className:"flex-col-reverse sm:flex-row sm:justify-between sm:space-x-2 w-full",children:[e.jsxs("div",{className:"text-xl font-bold text-foreground text-center sm:text-left mb-4 sm:mb-0",children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i)]}),e.jsxs(C,{type:"submit",className:"w-full sm:w-auto h-12 text-lg",disabled:o.formState.isSubmitting||!o.formState.isValid,children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),"Adicionar"]})]})]})})]})}):null},U=({src:t,alt:s,placeholder:r="/placeholder.svg",className:n="",...o})=>{const[a,i]=l.useState(!0),[d,c]=l.useState(!1),m=l.useRef(null);return l.useEffect(()=>{if(!t){i(!1);return}const u=new Image;u.src=t,u.onload=()=>{i(!1),c(!1)},u.onerror=()=>{i(!1),c(!0)}},[t]),e.jsxs("div",{className:`relative overflow-hidden ${n}`,children:[a&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 animate-pulse"}),e.jsx("img",{ref:m,src:d?r:t,alt:s,className:`${a?"opacity-0":"opacity-100"} transition-opacity duration-300 w-full h-full object-cover`,...o})]})},Ce=l.memo(({id:t,name:s,description:r,price:n,image_url:o,is_price_by_weight:a,is_available:i,onClick:d})=>{const c=i===!1;return e.jsxs(be,{className:w("overflow-hidden group transition-shadow duration-300 flex flex-col",c?"cursor-not-allowed":"hover:shadow-xl cursor-pointer"),onClick:d,children:[e.jsxs("div",{className:"relative h-48",children:[e.jsx(U,{src:o||"/placeholder.svg",alt:s,className:w("w-full h-full object-cover",!c&&"group-hover:scale-105 transition-transform duration-300",c&&"filter grayscale")}),c&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx(he,{variant:"destructive",className:"text-lg",children:"Indisponível"})})]}),e.jsxs(ut,{className:w("p-4 flex flex-col flex-grow",c&&"opacity-60"),children:[e.jsx("h3",{className:"text-xl font-semibold mb-1 truncate",children:s}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3 flex-grow line-clamp-2",children:r}),e.jsx("p",{className:"text-lg font-bold text-primary text-right mt-2",children:a?`${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)} / kg`:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)})]})]},t)});Ce.displayName="ProductCard";function Ct(t,s){const[r,n]=l.useState(t);return l.useEffect(()=>{const o=setTimeout(()=>{n(t)},s);return()=>{clearTimeout(o)}},[t,s]),r}const Pt=()=>{const t=new Date,s=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0");return`${s}:${r}`},Rt=()=>new Date().getDay(),Pe=t=>{const s=Rt(),r=Pt(),n=t.find(c=>c.day_of_week===s);if(!n||!n.is_open)return{isOpen:!1,todayHours:"Fechado hoje"};const o=n.open_time,a=n.close_time;if(!o||!a)return{isOpen:!1,todayHours:"Horário não configurado"};const i=r>=o&&r<=a,d=`${o.substring(0,5)} - ${a.substring(0,5)}`;return{isOpen:i,todayHours:d}},_t=({restaurant:t,hours:s})=>{const{isOpen:r,todayHours:n}=Pe(s),o=[t.street,t.number,t.neighborhood,t.city,t.zip_code].filter(Boolean).join(", ");return e.jsxs("div",{className:"space-y-3 text-center",children:[o&&e.jsxs("div",{className:"flex items-center justify-center text-sm text-muted-foreground",children:[e.jsx(mt,{className:"h-4 w-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate max-w-full",children:o})]}),e.jsxs("div",{className:"flex items-center justify-center text-sm font-medium",children:[e.jsxs("div",{className:w("flex items-center gap-1 px-3 py-1 rounded-full",r?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"),children:[r?e.jsx(ht,{className:"h-4 w-4"}):e.jsx(ft,{className:"h-4 w-4"}),e.jsx("span",{children:r?"Aberto Agora":"Fechado"})]}),e.jsxs("div",{className:"ml-4 flex items-center text-muted-foreground",children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:n})]})]})]})},Tt=()=>e.jsxs(te,{variant:"destructive",className:"mb-8",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx(re,{className:"font-bold",children:"Loja Fechada no Momento"}),e.jsx(se,{children:"Não é possível adicionar itens ao carrinho ou fazer pedidos fora do nosso horário de funcionamento."})]}),Et=({onClick:t})=>{const{totalItems:s,subtotal:r}=z();return s===0?null:e.jsxs(st,{children:[e.jsx(ot,{asChild:!0,children:e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsxs(C,{size:"lg",className:"relative h-14 w-14 rounded-full shadow-lg",onClick:t,children:[e.jsx(X,{className:"h-6 w-6"}),e.jsx(he,{variant:"destructive",className:"absolute -top-1 -right-1 px-2 py-1 text-xs rounded-full",children:s})]})})}),e.jsxs(nt,{children:[e.jsxs("p",{children:["Total: ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Clique para ver seu carrinho"})]})]})},At=pt,Lt=je,Dt=xt,Re=l.forwardRef(({className:t,...s},r)=>e.jsx(ve,{className:w("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:r}));Re.displayName=ve.displayName;const kt=lt("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),_e=l.forwardRef(({side:t="right",className:s,children:r,...n},o)=>e.jsxs(Dt,{children:[e.jsx(Re,{}),e.jsxs(we,{ref:o,className:w(kt({side:t}),s),...n,children:[r,e.jsxs(je,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(at,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));_e.displayName=we.displayName;const Te=({className:t,...s})=>e.jsx("div",{className:w("flex flex-col space-y-2 text-center sm:text-left",t),...s});Te.displayName="SheetHeader";const Ee=l.forwardRef(({className:t,...s},r)=>e.jsx(Se,{ref:r,className:w("text-lg font-semibold text-foreground",t),...s}));Ee.displayName=Se.displayName;const Ae=l.forwardRef(({className:t,...s},r)=>e.jsx(ye,{ref:r,className:w("text-sm text-muted-foreground",t),...s}));Ae.displayName=ye.displayName;function It(t,s){return l.useReducer((r,n)=>s[r][n]??r,t)}var Q="ScrollArea",[Le,jr]=it(Q),[Ot,j]=Le(Q),De=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,type:n="hover",dir:o,scrollHideDelay:a=600,...i}=t,[d,c]=l.useState(null),[m,u]=l.useState(null),[f,h]=l.useState(null),[x,g]=l.useState(null),[S,E]=l.useState(null),[R,y]=l.useState(0),[O,p]=l.useState(0),[b,A]=l.useState(!1),[L,M]=l.useState(!1),v=I(s,D=>c(D)),N=gt(o);return e.jsx(Ot,{scope:r,type:n,dir:N,scrollHideDelay:a,scrollArea:d,viewport:m,onViewportChange:u,content:f,onContentChange:h,scrollbarX:x,onScrollbarXChange:g,scrollbarXEnabled:b,onScrollbarXEnabledChange:A,scrollbarY:S,onScrollbarYChange:E,scrollbarYEnabled:L,onScrollbarYEnabledChange:M,onCornerWidthChange:y,onCornerHeightChange:p,children:e.jsx(F.div,{dir:N,...i,ref:v,style:{position:"relative","--radix-scroll-area-corner-width":R+"px","--radix-scroll-area-corner-height":O+"px",...t.style}})})});De.displayName=Q;var ke="ScrollAreaViewport",Ie=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,children:n,nonce:o,...a}=t,i=j(ke,r),d=l.useRef(null),c=I(s,d,i.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),e.jsx(F.div,{"data-radix-scroll-area-viewport":"",...a,ref:c,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:i.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});Ie.displayName=ke;var P="ScrollAreaScrollbar",G=l.forwardRef((t,s)=>{const{forceMount:r,...n}=t,o=j(P,t.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:i}=o,d=t.orientation==="horizontal";return l.useEffect(()=>(d?a(!0):i(!0),()=>{d?a(!1):i(!1)}),[d,a,i]),o.type==="hover"?e.jsx(Bt,{...n,ref:s,forceMount:r}):o.type==="scroll"?e.jsx(zt,{...n,ref:s,forceMount:r}):o.type==="auto"?e.jsx(Oe,{...n,ref:s,forceMount:r}):o.type==="always"?e.jsx(K,{...n,ref:s}):null});G.displayName=P;var Bt=l.forwardRef((t,s)=>{const{forceMount:r,...n}=t,o=j(P,t.__scopeScrollArea),[a,i]=l.useState(!1);return l.useEffect(()=>{const d=o.scrollArea;let c=0;if(d){const m=()=>{window.clearTimeout(c),i(!0)},u=()=>{c=window.setTimeout(()=>i(!1),o.scrollHideDelay)};return d.addEventListener("pointerenter",m),d.addEventListener("pointerleave",u),()=>{window.clearTimeout(c),d.removeEventListener("pointerenter",m),d.removeEventListener("pointerleave",u)}}},[o.scrollArea,o.scrollHideDelay]),e.jsx(V,{present:r||a,children:e.jsx(Oe,{"data-state":a?"visible":"hidden",...n,ref:s})})}),zt=l.forwardRef((t,s)=>{const{forceMount:r,...n}=t,o=j(P,t.__scopeScrollArea),a=t.orientation==="horizontal",i=$(()=>c("SCROLL_END"),100),[d,c]=It("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return l.useEffect(()=>{if(d==="idle"){const m=window.setTimeout(()=>c("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(m)}},[d,o.scrollHideDelay,c]),l.useEffect(()=>{const m=o.viewport,u=a?"scrollLeft":"scrollTop";if(m){let f=m[u];const h=()=>{const x=m[u];f!==x&&(c("SCROLL"),i()),f=x};return m.addEventListener("scroll",h),()=>m.removeEventListener("scroll",h)}},[o.viewport,a,c,i]),e.jsx(V,{present:r||d!=="hidden",children:e.jsx(K,{"data-state":d==="hidden"?"hidden":"visible",...n,ref:s,onPointerEnter:T(t.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:T(t.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),Oe=l.forwardRef((t,s)=>{const r=j(P,t.__scopeScrollArea),{forceMount:n,...o}=t,[a,i]=l.useState(!1),d=t.orientation==="horizontal",c=$(()=>{if(r.viewport){const m=r.viewport.offsetWidth<r.viewport.scrollWidth,u=r.viewport.offsetHeight<r.viewport.scrollHeight;i(d?m:u)}},10);return k(r.viewport,c),k(r.content,c),e.jsx(V,{present:n||a,children:e.jsx(K,{"data-state":a?"visible":"hidden",...o,ref:s})})}),K=l.forwardRef((t,s)=>{const{orientation:r="vertical",...n}=t,o=j(P,t.__scopeScrollArea),a=l.useRef(null),i=l.useRef(0),[d,c]=l.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),m=He(d.viewport,d.content),u={...n,sizes:d,onSizesChange:c,hasThumb:m>0&&m<1,onThumbChange:h=>a.current=h,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:h=>i.current=h};function f(h,x){return Vt(h,i.current,d,x)}return r==="horizontal"?e.jsx(Ft,{...u,ref:s,onThumbPositionChange:()=>{if(o.viewport&&a.current){const h=o.viewport.scrollLeft,x=ee(h,d,o.dir);a.current.style.transform=`translate3d(${x}px, 0, 0)`}},onWheelScroll:h=>{o.viewport&&(o.viewport.scrollLeft=h)},onDragScroll:h=>{o.viewport&&(o.viewport.scrollLeft=f(h,o.dir))}}):r==="vertical"?e.jsx(Mt,{...u,ref:s,onThumbPositionChange:()=>{if(o.viewport&&a.current){const h=o.viewport.scrollTop,x=ee(h,d);a.current.style.transform=`translate3d(0, ${x}px, 0)`}},onWheelScroll:h=>{o.viewport&&(o.viewport.scrollTop=h)},onDragScroll:h=>{o.viewport&&(o.viewport.scrollTop=f(h))}}):null}),Ft=l.forwardRef((t,s)=>{const{sizes:r,onSizesChange:n,...o}=t,a=j(P,t.__scopeScrollArea),[i,d]=l.useState(),c=l.useRef(null),m=I(s,c,a.onScrollbarXChange);return l.useEffect(()=>{c.current&&d(getComputedStyle(c.current))},[c]),e.jsx(ze,{"data-orientation":"horizontal",...o,ref:m,sizes:r,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Y(r)+"px",...t.style},onThumbPointerDown:u=>t.onThumbPointerDown(u.x),onDragScroll:u=>t.onDragScroll(u.x),onWheelScroll:(u,f)=>{if(a.viewport){const h=a.viewport.scrollLeft+u.deltaX;t.onWheelScroll(h),qe(h,f)&&u.preventDefault()}},onResize:()=>{c.current&&a.viewport&&i&&n({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:q(i.paddingLeft),paddingEnd:q(i.paddingRight)}})}})}),Mt=l.forwardRef((t,s)=>{const{sizes:r,onSizesChange:n,...o}=t,a=j(P,t.__scopeScrollArea),[i,d]=l.useState(),c=l.useRef(null),m=I(s,c,a.onScrollbarYChange);return l.useEffect(()=>{c.current&&d(getComputedStyle(c.current))},[c]),e.jsx(ze,{"data-orientation":"vertical",...o,ref:m,sizes:r,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Y(r)+"px",...t.style},onThumbPointerDown:u=>t.onThumbPointerDown(u.y),onDragScroll:u=>t.onDragScroll(u.y),onWheelScroll:(u,f)=>{if(a.viewport){const h=a.viewport.scrollTop+u.deltaY;t.onWheelScroll(h),qe(h,f)&&u.preventDefault()}},onResize:()=>{c.current&&a.viewport&&i&&n({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:q(i.paddingTop),paddingEnd:q(i.paddingBottom)}})}})}),[Ht,Be]=Le(P),ze=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,sizes:n,hasThumb:o,onThumbChange:a,onThumbPointerUp:i,onThumbPointerDown:d,onThumbPositionChange:c,onDragScroll:m,onWheelScroll:u,onResize:f,...h}=t,x=j(P,r),[g,S]=l.useState(null),E=I(s,v=>S(v)),R=l.useRef(null),y=l.useRef(""),O=x.viewport,p=n.content-n.viewport,b=_(u),A=_(c),L=$(f,10);function M(v){if(R.current){const N=v.clientX-R.current.left,D=v.clientY-R.current.top;m({x:N,y:D})}}return l.useEffect(()=>{const v=N=>{const D=N.target;(g==null?void 0:g.contains(D))&&b(N,p)};return document.addEventListener("wheel",v,{passive:!1}),()=>document.removeEventListener("wheel",v,{passive:!1})},[O,g,p,b]),l.useEffect(A,[n,A]),k(g,L),k(x.content,L),e.jsx(Ht,{scope:r,scrollbar:g,hasThumb:o,onThumbChange:_(a),onThumbPointerUp:_(i),onThumbPositionChange:A,onThumbPointerDown:_(d),children:e.jsx(F.div,{...h,ref:E,style:{position:"absolute",...h.style},onPointerDown:T(t.onPointerDown,v=>{v.button===0&&(v.target.setPointerCapture(v.pointerId),R.current=g.getBoundingClientRect(),y.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",x.viewport&&(x.viewport.style.scrollBehavior="auto"),M(v))}),onPointerMove:T(t.onPointerMove,M),onPointerUp:T(t.onPointerUp,v=>{const N=v.target;N.hasPointerCapture(v.pointerId)&&N.releasePointerCapture(v.pointerId),document.body.style.webkitUserSelect=y.current,x.viewport&&(x.viewport.style.scrollBehavior=""),R.current=null})})})}),W="ScrollAreaThumb",Fe=l.forwardRef((t,s)=>{const{forceMount:r,...n}=t,o=Be(W,t.__scopeScrollArea);return e.jsx(V,{present:r||o.hasThumb,children:e.jsx(Wt,{ref:s,...n})})}),Wt=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,style:n,...o}=t,a=j(W,r),i=Be(W,r),{onThumbPositionChange:d}=i,c=I(s,f=>i.onThumbChange(f)),m=l.useRef(void 0),u=$(()=>{m.current&&(m.current(),m.current=void 0)},100);return l.useEffect(()=>{const f=a.viewport;if(f){const h=()=>{if(u(),!m.current){const x=Xt(f,d);m.current=x,d()}};return d(),f.addEventListener("scroll",h),()=>f.removeEventListener("scroll",h)}},[a.viewport,u,d]),e.jsx(F.div,{"data-state":i.hasThumb?"visible":"hidden",...o,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:T(t.onPointerDownCapture,f=>{const x=f.target.getBoundingClientRect(),g=f.clientX-x.left,S=f.clientY-x.top;i.onThumbPointerDown({x:g,y:S})}),onPointerUp:T(t.onPointerUp,i.onThumbPointerUp)})});Fe.displayName=W;var J="ScrollAreaCorner",Me=l.forwardRef((t,s)=>{const r=j(J,t.__scopeScrollArea),n=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&n?e.jsx(qt,{...t,ref:s}):null});Me.displayName=J;var qt=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,...n}=t,o=j(J,r),[a,i]=l.useState(0),[d,c]=l.useState(0),m=!!(a&&d);return k(o.scrollbarX,()=>{var f;const u=((f=o.scrollbarX)==null?void 0:f.offsetHeight)||0;o.onCornerHeightChange(u),c(u)}),k(o.scrollbarY,()=>{var f;const u=((f=o.scrollbarY)==null?void 0:f.offsetWidth)||0;o.onCornerWidthChange(u),i(u)}),m?e.jsx(F.div,{...n,ref:s,style:{width:a,height:d,position:"absolute",right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function q(t){return t?parseInt(t,10):0}function He(t,s){const r=t/s;return isNaN(r)?0:r}function Y(t){const s=He(t.viewport,t.content),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,n=(t.scrollbar.size-r)*s;return Math.max(n,18)}function Vt(t,s,r,n="ltr"){const o=Y(r),a=o/2,i=s||a,d=o-i,c=r.scrollbar.paddingStart+i,m=r.scrollbar.size-r.scrollbar.paddingEnd-d,u=r.content-r.viewport,f=n==="ltr"?[0,u]:[u*-1,0];return We([c,m],f)(t)}function ee(t,s,r="ltr"){const n=Y(s),o=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,a=s.scrollbar.size-o,i=s.content-s.viewport,d=a-n,c=r==="ltr"?[0,i]:[i*-1,0],m=Ke(t,c);return We([0,i],[0,d])(m)}function We(t,s){return r=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const n=(s[1]-s[0])/(t[1]-t[0]);return s[0]+n*(r-t[0])}}function qe(t,s){return t>0&&t<s}var Xt=(t,s=()=>{})=>{let r={left:t.scrollLeft,top:t.scrollTop},n=0;return function o(){const a={left:t.scrollLeft,top:t.scrollTop},i=r.left!==a.left,d=r.top!==a.top;(i||d)&&s(),r=a,n=window.requestAnimationFrame(o)}(),()=>window.cancelAnimationFrame(n)};function $(t,s){const r=_(t),n=l.useRef(0);return l.useEffect(()=>()=>window.clearTimeout(n.current),[]),l.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(r,s)},[r,s])}function k(t,s){const r=_(s);ct(()=>{let n=0;if(t){const o=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(r)});return o.observe(t),()=>{window.cancelAnimationFrame(n),o.unobserve(t)}}},[t,r])}var Ve=De,Yt=Ie,$t=Me;const Xe=l.forwardRef(({className:t,children:s,...r},n)=>e.jsxs(Ve,{ref:n,className:w("relative overflow-hidden",t),...r,children:[e.jsx(Yt,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(Ye,{}),e.jsx($t,{})]}));Xe.displayName=Ve.displayName;const Ye=l.forwardRef(({className:t,orientation:s="vertical",...r},n)=>e.jsx(G,{ref:n,orientation:s,className:w("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...r,children:e.jsx(Fe,{className:"relative flex-1 rounded-full bg-border"})}));Ye.displayName=G.displayName;const Ut=({item:t})=>{const{updateQuantity:s,removeItem:r}=z();return e.jsxs("div",{className:"flex items-center gap-4 py-3",children:[e.jsx(U,{src:t.image_url||"/placeholder.svg",alt:t.name,className:"w-16 h-16 rounded-md object-cover"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-semibold leading-tight",children:t.name}),e.jsx("p",{className:"text-sm text-primary font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.price)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!t.is_price_by_weight&&e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>s(t.id,t.quantity-1),children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-6 text-center font-bold",children:t.quantity}),e.jsx(C,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>s(t.id,t.quantity+1),children:e.jsx(pe,{className:"h-4 w-4"})})]}),e.jsx(C,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive hover:text-destructive",onClick:()=>r(t.id),children:e.jsx(vt,{className:"h-4 w-4"})})]})]})},Qt=({isOpen:t,onOpenChange:s})=>{const{items:r,subtotal:n,total:o,clearCart:a}=z();return e.jsx(At,{open:t,onOpenChange:s,children:e.jsxs(_e,{className:"flex flex-col",children:[e.jsxs(Te,{children:[e.jsx(Ee,{className:"text-2xl",children:"Seu Carrinho"}),e.jsx(Ae,{className:"sr-only",children:"Lista de itens no seu carrinho e resumo do pedido."})]}),e.jsx(bt,{}),r.length===0?e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-center",children:[e.jsx(X,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Seu carrinho está vazio"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Adicione produtos do cardápio para começar."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"flex-grow -mx-6 px-6",children:e.jsx("div",{className:"divide-y",children:r.map(i=>e.jsx(Ut,{item:i},i.id))})}),e.jsxs("div",{className:"border-t pt-4 mt-4 space-y-4",children:[e.jsxs("div",{className:"w-full space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-base",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal:"}),e.jsx("span",{className:"font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"text-primary",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o)})]})]}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(C,{variant:"outline",onClick:a,className:"flex-1",children:"Limpar Carrinho"}),e.jsx(Lt,{asChild:!0,children:e.jsx(Ue,{to:"/checkout",className:"flex-1",children:e.jsx(C,{className:"w-full",children:"Finalizar Pedido"})})})]})]})]})]})})},Gt=async()=>{const{data:t,error:s}=await H.from("restaurants").select("*").eq("is_active",!0).limit(1).single();if(s)throw new Error(`Erro ao buscar restaurante: ${s.message}`);if(!t)throw new Error("Nenhum restaurante ativo encontrado.");const r=t.id,[n,o,a]=await Promise.all([H.from("categories").select("*").eq("restaurant_id",r).eq("is_active",!0).order("display_order",{ascending:!0}),H.from("products").select("*").eq("restaurant_id",r),H.from("business_hours").select("*").eq("restaurant_id",r)]);if(n.error)throw new Error(`Erro ao buscar categorias: ${n.error.message}`);if(o.error)throw new Error(`Erro ao buscar produtos: ${o.error.message}`);if(a.error)throw new Error(`Erro ao buscar horários: ${a.error.message}`);const i=(n.data||[]).map(d=>({...d,products:(o.data||[]).filter(c=>c.category_id===d.id)})).filter(d=>d.products.length>0);return{restaurant:t,menu:i,hours:a.data}},Sr=()=>{const{data:t,isLoading:s,isError:r,error:n}=$e({queryKey:["menuData"],queryFn:Gt,staleTime:3e5,gcTime:6e5}),[o,a]=l.useState(null),[i,d]=l.useState(!1),[c,m]=l.useState(!1),[u,f]=l.useState(!1),[h,x]=l.useState(""),g=Ct(h,300),{isOpen:S}=l.useMemo(()=>t!=null&&t.hours?Pe(t.hours):{isOpen:!1,todayHours:"Carregando..."},[t==null?void 0:t.hours]),E=l.useMemo(()=>t!=null&&t.menu?g?t.menu.map(p=>({...p,products:p.products.filter(b=>b.name.toLowerCase().includes(g.toLowerCase())||b.description&&b.description.toLowerCase().includes(g.toLowerCase()))})).filter(p=>p.products.length>0):t.menu:[],[t==null?void 0:t.menu,g]),R=l.useCallback(p=>{if(!S){Z.error("A loja está fechada.",{description:"Não é possível adicionar itens ao carrinho no momento."});return}if(!p.is_available){Z.info("Produto indisponível",{description:"Este item não está disponível no momento."});return}a(p),p.is_price_by_weight?m(!0):d(!0)},[S]);if(s)return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-5xl",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx(B,{className:"h-24 w-24 rounded-full mx-auto mb-4"}),e.jsx(B,{className:"h-10 w-1/2 mx-auto mb-2"}),e.jsx(B,{className:"h-6 w-3/4 mx-auto"})]}),e.jsx("div",{className:"space-y-10",children:[...Array(3)].map((p,b)=>e.jsxs("div",{children:[e.jsx(B,{className:"h-9 w-1/3 mb-6"}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(3)].map((A,L)=>e.jsx(be,{className:"p-4",children:e.jsx(B,{className:"h-48 w-full"})},L))})]},b))})]});if(r)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs(te,{variant:"destructive",children:[e.jsx(wt,{className:"h-4 w-4"}),e.jsx(re,{children:"Erro ao carregar o cardápio"}),e.jsx(se,{children:n instanceof Error?n.message:"Ocorreu um erro desconhecido."})]})});const{restaurant:y,hours:O}=t;return e.jsxs(e.Fragment,{children:[e.jsx(St,{product:o,isOpen:i,onClose:()=>d(!1)}),e.jsx(Nt,{product:o,isOpen:c,onClose:()=>m(!1)}),e.jsx(Qt,{isOpen:u,onOpenChange:f}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-5xl",children:[e.jsxs("header",{className:"text-center mb-8",children:[y.logo_url&&e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full mb-4 overflow-hidden border-4 border-card shadow-lg",children:e.jsx(U,{src:y.logo_url,alt:y.name,className:"w-full h-full object-cover"})}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight mb-2",children:y.name}),e.jsx("p",{className:"text-muted-foreground mb-4",children:y.description}),e.jsx(_t,{restaurant:y,hours:O})]}),!S&&e.jsx(Tt,{}),e.jsx("div",{className:"mb-8",children:e.jsx("input",{type:"text",placeholder:"Buscar produtos...",className:"w-full p-3 border rounded-lg",value:h,onChange:p=>x(p.target.value)})}),e.jsx("main",{className:w(!S&&"opacity-50 pointer-events-none"),children:E.length===0?e.jsx("div",{className:"text-center py-16",children:e.jsx("p",{className:"text-muted-foreground text-lg",children:g?"Nenhum produto encontrado.":"Nenhum item no cardápio no momento."})}):e.jsx("div",{className:"space-y-10",children:E.map(p=>e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold border-b-2 border-primary pb-2 mb-6",children:p.name}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.products.map(b=>e.jsx(Ce,{id:b.id,name:b.name,description:b.description,price:b.price,image_url:b.image_url,is_price_by_weight:b.is_price_by_weight,is_available:b.is_available,onClick:()=>R(b)},b.id))})]},p.id))})})]}),S&&e.jsx(Et,{onClick:()=>f(!0)})]})};export{Sr as default};
