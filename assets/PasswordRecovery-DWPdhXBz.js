import{j as e}from"./tanstack-C7aOFagJ.js";import{h as b,k,r as t}from"./vendor-DjsPZZVP.js";import{s as d,j as r,L as w,C as L,e as A,f as D,g as E,b as I,h as j,I as v,B as g,a2 as R}from"./index-B9y75x8T.js";import{L as T}from"./Logo-D8OMddHV.js";import{L as U}from"./lock-CJb0kimn.js";import{A as _}from"./arrow-left-D_kSCnu8.js";import"./supabase-BAEEEeUB.js";const G=()=>{const o=b(),[n]=k(),[N,m]=t.useState(!0),[u,h]=t.useState(!1),[i,y]=t.useState(""),[p,S]=t.useState(""),[f,x]=t.useState(!1);t.useEffect(()=>{const s=n.get("access_token"),a=n.get("refresh_token"),C=n.get("type");s&&a&&C==="recovery"?(async()=>{try{const{error:l}=await d.auth.setSession({access_token:s,refresh_token:a});if(l)throw l;h(!0),r.success("Sessão de recuperação ativada. Defina sua nova senha."),o(window.location.pathname,{replace:!0})}catch(l){console.error("Erro ao definir sessão:",l),r.error("Link de recuperação inválido ou expirado."),o("/admin-auth",{replace:!0})}finally{m(!1)}})():d.auth.getSession().then(({data:{session:c}})=>{c!=null&&c.user&&(h(!0),r.info("Você já está logado. Defina sua nova senha abaixo.")),m(!1)})},[n,o]);const P=async s=>{if(s.preventDefault(),i.length<6){r.error("A nova senha deve ter pelo menos 6 caracteres.");return}if(i!==p){r.error("As senhas não coincidem.");return}x(!0);try{const{error:a}=await d.auth.updateUser({password:i});if(a)throw a;r.success("Senha redefinida com sucesso! Redirecionando para o login."),await d.auth.signOut(),o("/admin-auth",{replace:!0})}catch(a){r.error(a.message||"Erro ao redefinir a senha."),x(!1)}};return N?e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4",children:[e.jsx(w,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-3 text-muted-foreground",children:"Verificando link de recuperação..."})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(T,{className:"justify-center mb-4"})}),e.jsxs(L,{className:"shadow-xl border-2",children:[e.jsxs(A,{className:"space-y-1",children:[e.jsxs(D,{className:"text-2xl font-bold text-center flex items-center justify-center gap-2",children:[e.jsx(U,{className:"h-6 w-6 text-primary"}),"Redefinir Senha"]}),e.jsx(E,{className:"text-center",children:u?"Digite e confirme sua nova senha.":"Link inválido ou expirado. Tente novamente."})]}),e.jsx(I,{className:"space-y-4",children:u?e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"newPassword",children:"Nova Senha *"}),e.jsx(v,{id:"newPassword",type:"password",placeholder:"••••••••",value:i,onChange:s=>y(s.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"confirmPassword",children:"Confirmar Nova Senha *"}),e.jsx(v,{id:"confirmPassword",type:"password",placeholder:"••••••••",value:p,onChange:s=>S(s.target.value),required:!0,className:"h-12"})]}),e.jsxs(g,{type:"submit",className:"w-full",size:"lg",disabled:f,children:[f?e.jsx(w,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(R,{className:"h-4 w-4 mr-2"}),"Atualizar Senha"]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-destructive mb-4",children:"Não foi possível ativar a sessão de recuperação."}),e.jsxs(g,{variant:"outline",onClick:()=>o("/admin-auth",{replace:!0}),children:[e.jsx(_,{className:"h-4 w-4 mr-1"})," Voltar para o Login"]})]})})]})]})})};export{G as default};
