import{j as e}from"./tanstack-C7aOFagJ.js";import{h as q,i as A,r as s,L as z}from"./vendor-DjsPZZVP.js";import{L as R}from"./Logo-wjMc2rum.js";import{s as h,C as O,d as T,e as B,f as H,b as J,L as f,I as j,P as V,B as b,g as W,u as o}from"./index-CecmIwNz.js";import{S as _}from"./separator-BRXjl2qe.js";import"./supabase-BAEEEeUB.js";const w=n=>n.replace(/\D/g,""),ae=()=>{var C;const n=q(),i=A(),[N,u]=s.useState(!1),[l,L]=s.useState(!1),[d,I]=s.useState(""),[m,k]=s.useState(""),[p,E]=s.useState(""),[g,P]=s.useState(""),[G,v]=s.useState(null),[K,S]=s.useState(null),F=(C=i.state)==null?void 0:C.restaurantId,[y,M]=s.useState(!1);s.useEffect(()=>{const{data:{subscription:t}}=h.auth.onAuthStateChange((r,a)=>{var c;S(a),v((a==null?void 0:a.user)??null),a!=null&&a.user&&(((c=i.state)==null?void 0:c.from)==="/checkout"?(console.log("Redirecting customer to checkout after login."),n("/checkout",{replace:!0})):(console.log("Redirecting customer to index after login."),n("/",{replace:!0})))});return h.auth.getSession().then(({data:{session:r}})=>{var a;if(S(r),v((r==null?void 0:r.user)??null),r!=null&&r.user){const c=(a=i.state)==null?void 0:a.from;c==="/checkout"?(console.log("User already logged in, redirecting to checkout:",c),n("/checkout",{replace:!0})):(console.log("User already logged in, redirecting to index."),n("/",{replace:!0}))}}),()=>t.unsubscribe()},[n,i.state]);const U=()=>p.trim()?w(g).length!==11?(o.error("O Telefone deve conter 11 dígitos (DDD + 9 dígitos)."),!1):d.trim()?m.length<6?(o.error("A Senha deve ter pelo menos 6 caracteres."),!1):!0:(o.error("O Email é obrigatório."),!1):(o.error("O Nome Completo é obrigatório."),!1),D=async t=>{var r;if(t.preventDefault(),u(!0),((r=i.state)==null?void 0:r.from)==="/checkout"&&!F){o.error("Erro: ID do restaurante de origem não encontrado."),u(!1);return}try{if(l){if(!U()){u(!1);return}const a=w(g),{data:c,error:x}=await h.auth.signUp({email:d,password:m,options:{data:{full_name:p,phone:a}}});if(x)throw x;c.session?o.success("Conta criada e login efetuado com sucesso!"):o.success("Conta criada! Verifique seu email para confirmar.")}else{const{error:a}=await h.auth.signInWithPassword({email:d,password:m});if(a)throw a;o.success("Login realizado com sucesso!")}}catch(a){a.message.includes("Email not confirmed")?o.error("Por favor, verifique seu e-mail para confirmar sua conta antes de fazer login."):o.error(a.message||"Erro ao processar autenticação")}finally{u(!1)}};return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(R,{className:"justify-center mb-4"})}),e.jsxs(O,{className:"shadow-xl border-2",children:[e.jsxs(T,{className:"space-y-1",children:[e.jsx(B,{className:"text-2xl font-bold text-center",children:l?"Crie sua conta":"Acesse sua conta"}),e.jsx(H,{className:"text-center",children:l?"Preencha os campos para começar":"Utilize seu email e senha para fazer login"})]}),e.jsxs(J,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"fullName",children:"Nome Completo *"}),e.jsx(j,{id:"fullName",type:"text",placeholder:"Seu nome completo",value:p,onChange:t=>E(t.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"phone",children:"Telefone *"}),e.jsx(V,{id:"phone",value:g,onChange:t=>P(t.target.value),required:!0,className:"h-12"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formato: (99) 99999-9999"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"email",children:"Email *"}),e.jsx(j,{id:"email",type:"email",placeholder:"seu@email.com",value:d,onChange:t=>I(t.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"password",children:"Senha *"}),e.jsx(j,{id:"password",type:"password",placeholder:"••••••••",value:m,onChange:t=>k(t.target.value),required:!0,className:"h-12"})]}),e.jsx(b,{type:"submit",className:"w-full",size:"lg",disabled:N||y,children:N||y?e.jsx(W,{className:"h-4 w-4 animate-spin mr-2"}):l?"Criar conta":"Entrar"})]}),e.jsx("div",{className:"text-center",children:e.jsx(b,{variant:"link",type:"button",className:"p-0 h-auto",onClick:()=>L(!l),children:l?"Já tem uma conta? Faça login":"Não tem uma conta? Crie uma agora"})}),e.jsx(_,{className:"my-4"}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["É o dono de uma loja? ",e.jsx(z,{to:"/admin-auth",className:"text-primary hover:underline",children:"Acesse o painel de administração"})]})]})]})]})})};export{ae as default};
