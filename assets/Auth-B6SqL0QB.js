import{j as e}from"./tanstack-LlX0VwFj.js";import{h as q,i as D,r as s,L as z}from"./vendor-DjsPZZVP.js";import{L as k}from"./Logo-DUPXFcjP.js";import{s as m,C as T,d as O,e as _,f as $,b as B,I as j,B as y,L as G,u as n}from"./index-C0r1h4jq.js";import{L as p}from"./label-CNAijYL-.js";import{S as H}from"./separator-DG0VTRoz.js";import{P as J}from"./PhoneInput-CkzLGqBt.js";import"./supabase-BAEEEeUB.js";const C=o=>o.replace(/\D/g,""),M=async()=>{const{data:o,error:i}=await m.from("restaurants").select("id").eq("is_active",!0).order("created_at",{ascending:!1}).limit(1).single();return i&&i.code!=="PGRST116"?(console.error("Error fetching active restaurant ID:",i),null):(o==null?void 0:o.id)||null},re=()=>{const o=q();D();const[i,d]=s.useState(!1),[l,b]=s.useState(!1),[h,L]=s.useState(""),[f,I]=s.useState(""),[g,E]=s.useState(""),[x,P]=s.useState(""),[V,N]=s.useState(null),[W,v]=s.useState(null),[c,U]=s.useState(null),[w,A]=s.useState(!0);s.useEffect(()=>{M().then(t=>{U(t),A(!1)})},[]);const S=t=>{const a=window.location.origin,r=window.location.pathname;return`${a}${r}#/menu/${t}`};s.useEffect(()=>{const{data:{subscription:t}}=m.auth.onAuthStateChange((a,r)=>{if(v(r),N((r==null?void 0:r.user)??null),r!=null&&r.user&&c){const u=S(c);console.log("Redirecting customer to menu:",u),window.location.href=u}});return m.auth.getSession().then(({data:{session:a}})=>{if(v(a),N((a==null?void 0:a.user)??null),a!=null&&a.user&&c){const r=S(c);console.log("User already logged in, redirecting to menu:",r),window.location.href=r}}),()=>t.unsubscribe()},[o,c]);const F=()=>g.trim()?C(x).length!==11?(n.error("O Telefone deve conter 11 dígitos (DDD + 9 dígitos)."),!1):h.trim()?f.length<6?(n.error("A Senha deve ter pelo menos 6 caracteres."),!1):!0:(n.error("O Email é obrigatório."),!1):(n.error("O Nome Completo é obrigatório."),!1),R=async t=>{if(t.preventDefault(),d(!0),!c){n.error("Nenhum restaurante ativo encontrado para redirecionamento."),d(!1);return}try{if(l){if(!F()){d(!1);return}const a=C(x),{data:r,error:u}=await m.auth.signUp({email:h,password:f,options:{data:{full_name:g,phone:a}}});if(u)throw u;r.session?n.success("Conta criada e login efetuado com sucesso!"):n.success("Conta criada! Verifique seu email para confirmar.")}else{const{error:a}=await m.auth.signInWithPassword({email:h,password:f});if(a)throw a;n.success("Login realizado com sucesso!")}}catch(a){a.message.includes("Email not confirmed")?n.error("Por favor, verifique seu e-mail para confirmar sua conta antes de fazer login."):n.error(a.message||"Erro ao processar autenticação")}finally{d(!1)}};return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(k,{className:"justify-center mb-4"})}),e.jsxs(T,{className:"shadow-xl border-2",children:[e.jsxs(O,{className:"space-y-1",children:[e.jsx(_,{className:"text-2xl font-bold text-center",children:l?"Crie sua conta":"Acesse sua conta"}),e.jsx($,{className:"text-center",children:l?"Preencha os campos para começar":"Utilize seu email e senha para fazer login"})]}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"fullName",children:"Nome Completo *"}),e.jsx(j,{id:"fullName",type:"text",placeholder:"Seu nome completo",value:g,onChange:t=>E(t.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"phone",children:"Telefone *"}),e.jsx(J,{id:"phone",value:x,onChange:t=>P(t.target.value),required:!0,className:"h-12"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formato: (99) 99999-9999"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"email",children:"Email *"}),e.jsx(j,{id:"email",type:"email",placeholder:"seu@email.com",value:h,onChange:t=>L(t.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"password",children:"Senha *"}),e.jsx(j,{id:"password",type:"password",placeholder:"••••••••",value:f,onChange:t=>I(t.target.value),required:!0,className:"h-12"})]}),e.jsx(y,{type:"submit",className:"w-full",size:"lg",disabled:i||w,children:i||w?e.jsx(G,{className:"h-4 w-4 animate-spin mr-2"}):l?"Criar conta":"Entrar"})]}),e.jsx("div",{className:"text-center",children:e.jsx(y,{variant:"link",type:"button",className:"p-0 h-auto",onClick:()=>b(!l),children:l?"Já tem uma conta? Faça login":"Não tem uma conta? Crie uma agora"})}),e.jsx(H,{className:"my-4"}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["É o dono de uma loja? ",e.jsx(z,{to:"/admin-auth",className:"text-primary hover:underline",children:"Acesse o painel de administração"})]})]})]})]})})};export{re as default};
