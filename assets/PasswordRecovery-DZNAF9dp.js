import{j as e}from"./tanstack-d4AvmB45.js";import{u as C,r as n}from"./vendor-CnEXr6gt.js";import{s as u}from"./client-D5i5GwB9.js";import{u as t,L as w}from"./index-DP9_6Unb.js";import{C as b,b as P,c as L,d as T,a as A}from"./card-DZCt5pxj.js";import{B as j}from"./button-CBUymQX0.js";import{L as v,I as g}from"./label-C5Ibx0mR.js";import{L as D}from"./Logo-0eJzyNIn.js";import{L as E}from"./lock-a_Aq9GKS.js";import{C as I}from"./circle-check-big-QGYug8k9.js";import{A as R}from"./arrow-left-BLkWGHaI.js";import"./supabase-BZV_3FV3.js";import"./shopping-cart-eUWqSIkB.js";const U=a=>{const i=a.substring(1).split("#"),c=i.length>1?i[1]:i[0],o=new URLSearchParams(c);return{accessToken:o.get("access_token"),refreshToken:o.get("refresh_token"),type:o.get("type")}},W=()=>{const a=C(),[i,c]=n.useState(!0),[o,h]=n.useState(!1),[l,N]=n.useState(""),[p,y]=n.useState(""),[f,x]=n.useState(!1);n.useEffect(()=>{const{accessToken:s,refreshToken:r,type:k}=U(window.location.hash);s&&r&&k==="recovery"?(async()=>{try{const{error:m}=await u.auth.setSession({access_token:s,refresh_token:r});if(m)throw m;h(!0),t.success("Sessão de recuperação ativada. Defina sua nova senha."),a("/password-recovery",{replace:!0})}catch(m){console.error("Erro ao definir sessão:",m),t.error("Link de recuperação inválido ou expirado."),a("/admin-auth",{replace:!0})}finally{c(!1)}})():u.auth.getSession().then(({data:{session:d}})=>{d!=null&&d.user&&(h(!0),t.info("Você já está logado. Defina sua nova senha abaixo.")),c(!1)})},[a]);const S=async s=>{if(s.preventDefault(),l.length<6){t.error("A nova senha deve ter pelo menos 6 caracteres.");return}if(l!==p){t.error("As senhas não coincidem.");return}x(!0);try{const{error:r}=await u.auth.updateUser({password:l});if(r)throw r;t.success("Senha redefinida com sucesso! Redirecionando para o login."),await u.auth.signOut(),a("/admin-auth",{replace:!0})}catch(r){t.error(r.message||"Erro ao redefinir a senha."),x(!1)}};return i?e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4",children:[e.jsx(w,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-3 text-muted-foreground",children:"Verificando link de recuperação..."})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx(D,{className:"justify-center mb-4"})}),e.jsxs(b,{className:"shadow-xl border-2",children:[e.jsxs(P,{className:"space-y-1",children:[e.jsxs(L,{className:"text-2xl font-bold text-center flex items-center justify-center gap-2",children:[e.jsx(E,{className:"h-6 w-6 text-primary"}),"Redefinir Senha"]}),e.jsx(T,{className:"text-center",children:o?"Digite e confirme sua nova senha.":"Link inválido ou expirado. Tente novamente."})]}),e.jsx(A,{className:"space-y-4",children:o?e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"newPassword",children:"Nova Senha *"}),e.jsx(g,{id:"newPassword",type:"password",placeholder:"••••••••",value:l,onChange:s=>N(s.target.value),required:!0,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"confirmPassword",children:"Confirmar Nova Senha *"}),e.jsx(g,{id:"confirmPassword",type:"password",placeholder:"••••••••",value:p,onChange:s=>y(s.target.value),required:!0,className:"h-12"})]}),e.jsxs(j,{type:"submit",className:"w-full",size:"lg",disabled:f,children:[f?e.jsx(w,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(I,{className:"h-4 w-4 mr-2"}),"Atualizar Senha"]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-destructive mb-4",children:"Não foi possível ativar a sessão de recuperação."}),e.jsxs(j,{variant:"outline",onClick:()=>a("/admin-auth",{replace:!0}),children:[e.jsx(R,{className:"h-4 w-4 mr-1"})," Voltar para o Login"]})]})})]})]})})};export{W as default};
