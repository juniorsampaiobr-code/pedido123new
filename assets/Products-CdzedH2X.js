import{u as R,c as M,j as e,b as T}from"./tanstack-QxCZ3Wpf.js";import{s as p}from"./client-BskZ_u5h.js";import{B as v}from"./button-DuO9Z4o5.js";import{C as $,b as me,a as U,c as $e}from"./card-5KmiaDvA.js";import{S as je,a as ge,b as pe,c as fe,d as ve,T as Le,e as ze,f as he,g as ue}from"./select-CcUeJO7U.js";import{S as A}from"./switch-Dy1JwOFo.js";import{B as K}from"./index-CakQitwb.js";import{S as N}from"./skeleton-Cj2ATps_.js";import{A as ye,a as be,b as we}from"./alert-BYu4Mbx1.js";import{c as B,u as _,L as xe,b as Ue}from"./index-mlp4t_-s.js";import{r as E}from"./vendor-CIxFcw7z.js";import{o as V,s as k,c as W,b as L,u as H,t as G,p as Ne,l as _e,i as Ce}from"./types-C33Up_9v.js";import{D as J,a as X,b as Y,c as Z,d as ee,e as se,f as re}from"./dialog-Cgo-8GVY.js";import{F as ae,b as x,c as j,a as f,d as g,e as y}from"./form-CU2sNk5d.js";import{I as D}from"./label-B8KN4cTU.js";import{T as ie}from"./textarea-6PMZy7Hn.js";import{P as te}from"./plus-CXd_vMHg.js";import{U as Ee}from"./upload-AQ5q0rOU.js";import{T as Se}from"./terminal-CBQEjflc.js";import{T as oe}from"./trash-2-Bt6Pz1DB.js";import{A as ke,a as Ke,b as qe,c as De,d as Pe,e as Fe,f as Ae,g as Ie,h as Me}from"./alert-dialog-Dz5hwP5j.js";import"./supabase-DGFirUEE.js";import"./index-DKULI8lQ.js";import"./index-BvB5LvD-.js";import"./index-CZ4oPHCl.js";import"./index-ClxNZ_uN.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=B("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=B("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=B("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Be=V({name:k().min(1,"O nome é obrigatório."),description:k().optional(),display_order:W.number().default(0),is_active:L().default(!0)}),Te=({isOpen:a,onClose:n,restaurantId:t})=>{const c=R(),d=H({resolver:G(Be),defaultValues:{name:"",description:"",display_order:0,is_active:!0}}),b=M({mutationFn:async o=>{if(!t)throw new Error("ID do restaurante não encontrado.");const{error:l}=await p.from("categories").insert({restaurant_id:t,name:o.name,description:o.description,display_order:o.display_order,is_active:o.is_active});if(l)throw new Error(l.message)},onSuccess:()=>{_.success("Categoria criada com sucesso!"),c.invalidateQueries({queryKey:["categoriesWithProducts"]}),c.invalidateQueries({queryKey:["categories"]}),n(),d.reset()},onError:o=>{_.error(`Erro ao criar categoria: ${o.message}`)}}),m=o=>{b.mutate(o)};return e.jsx(J,{open:a,onOpenChange:n,children:e.jsxs(X,{className:"sm:max-w-[425px]",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Nova Categoria"}),e.jsx(ee,{children:"Gerencie as categorias dos seus produtos"})]}),e.jsx(ae,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(m),className:"space-y-4 pt-4",children:[e.jsx(x,{control:d.control,name:"name",render:({field:o})=>e.jsxs(j,{children:[e.jsx(f,{children:"Nome *"}),e.jsx(g,{children:e.jsx(D,{placeholder:"",...o})}),e.jsx(y,{})]})}),e.jsx(x,{control:d.control,name:"description",render:({field:o})=>e.jsxs(j,{children:[e.jsx(f,{children:"Descrição"}),e.jsx(g,{children:e.jsx(ie,{placeholder:"",...o})}),e.jsx(y,{})]})}),e.jsx(x,{control:d.control,name:"display_order",render:({field:o})=>e.jsxs(j,{children:[e.jsx(f,{children:"Ordem de Exibição"}),e.jsx(g,{children:e.jsx(D,{type:"number",...o})}),e.jsx(y,{})]})}),e.jsx(x,{control:d.control,name:"is_active",render:({field:o})=>e.jsxs(j,{className:"flex flex-row items-center space-x-3 space-y-0 pt-2",children:[e.jsx(g,{children:e.jsx(A,{checked:o.value,onCheckedChange:o.onChange,id:"is_active"})}),e.jsx(f,{htmlFor:"is_active",className:"font-normal cursor-pointer",children:"Ativa"})]})}),e.jsxs(se,{className:"pt-4",children:[e.jsx(re,{asChild:!0,children:e.jsx(v,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(v,{type:"submit",disabled:b.isPending||!t,children:b.isPending?"Criando...":"Criar"})]})]})})]})})},Ve=V({name:k().min(1,"O nome é obrigatório."),description:k().optional(),price:Ne(a=>String(a).replace(",","."),W.number({invalid_type_error:"O preço deve ser um número."}).positive("O preço deve ser maior que zero.")),category_id:k().min(1,"A categoria é obrigatória."),image_url:k().url("URL inválida.").optional().or(_e("")),image_file:Ce(File).optional(),is_price_by_weight:L().default(!1),is_available:L().default(!0)}).refine(a=>a.image_url||a.image_file,{message:"É necessário enviar uma imagem ou uma URL.",path:["image_file"]}),We=async a=>{const{data:n,error:t}=await p.from("categories").select("id, name").eq("restaurant_id",a).eq("is_active",!0);if(t)throw new Error(t.message);return n},He=({isOpen:a,onClose:n})=>{const t=R(),[c,d]=E.useState(null),[b,m]=E.useState(!1);T({queryKey:["restaurantId"],queryFn:async()=>{const{data:s,error:u}=await p.from("restaurants").select("id").limit(1).single();if(u)throw new Error(u.message);return d(s.id),s.id},staleTime:1/0,enabled:a});const{data:o,isLoading:l}=T({queryKey:["categories",c],queryFn:()=>We(c),enabled:!!c}),h=H({resolver:G(Ve),defaultValues:{name:"",description:"",price:0,is_price_by_weight:!1,is_available:!0,image_url:"",category_id:""}}),P=M({mutationFn:async s=>{if(!c)throw new Error("ID do restaurante não encontrado.");let u=s.image_url;if(s.image_file){const S=s.image_file,q=`${c}/${Date.now()}-${S.name}`,{error:F}=await p.storage.from("products").upload(q,S);if(F)throw new Error(`Erro no upload da imagem: ${F.message}`);const{data:I}=p.storage.from("products").getPublicUrl(q);u=I.publicUrl}const{error:C}=await p.from("products").insert({restaurant_id:c,name:s.name,description:s.description,price:s.price,category_id:s.category_id,image_url:u,is_price_by_weight:s.is_price_by_weight,is_available:s.is_available});if(C)throw new Error(C.message)},onSuccess:()=>{_.success("Produto criado com sucesso!"),t.invalidateQueries({queryKey:["products"]}),n(),h.reset()},onError:s=>{_.error(`Erro ao criar produto: ${s.message}`)}}),i=s=>{P.mutate(s)};return e.jsxs(e.Fragment,{children:[e.jsx(Te,{isOpen:b,onClose:()=>m(!1),restaurantId:c}),e.jsx(J,{open:a,onOpenChange:n,children:e.jsxs(X,{className:"sm:max-w-lg",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Novo Produto"}),e.jsx(ee,{children:"Adicione um novo item ao seu cardápio."})]}),e.jsx(ae,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(i),children:[e.jsxs("div",{className:"space-y-4 py-2 pb-4 max-h-[70vh] overflow-y-auto pr-4",children:[e.jsx(x,{control:h.control,name:"name",render:({field:s})=>e.jsxs(j,{children:[e.jsx(f,{children:"Nome *"}),e.jsx(g,{children:e.jsx(D,{placeholder:"Nome do produto",...s})}),e.jsx(y,{})]})}),e.jsx(x,{control:h.control,name:"description",render:({field:s})=>e.jsxs(j,{children:[e.jsx(f,{children:"Descrição"}),e.jsx(g,{children:e.jsx(ie,{placeholder:"Ingredientes, detalhes, etc.",...s})}),e.jsx(y,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(x,{control:h.control,name:"price",render:({field:s})=>e.jsxs(j,{children:[e.jsx(f,{children:"Preço (R$) unitário *"}),e.jsx(g,{children:e.jsx(D,{type:"text",placeholder:"0,00",...s})}),e.jsx(y,{})]})}),e.jsx(x,{control:h.control,name:"category_id",render:({field:s})=>e.jsxs(j,{children:[e.jsx(f,{children:"Categoria *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(je,{onValueChange:s.onChange,value:s.value,disabled:l,children:[e.jsx(g,{children:e.jsx(ge,{children:e.jsx(pe,{placeholder:"Selecione uma categoria"})})}),e.jsx(fe,{children:o==null?void 0:o.map(u=>e.jsx(ve,{value:u.id,children:u.name},u.id))})]}),e.jsx(v,{type:"button",variant:"outline",size:"icon",onClick:()=>m(!0),children:e.jsx(te,{className:"h-4 w-4"})})]}),e.jsx(y,{})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Imagem do Produto"}),e.jsx(x,{control:h.control,name:"image_file",render:({field:s})=>{var u;return e.jsxs(j,{children:[e.jsx(g,{children:e.jsxs("label",{className:"flex items-center justify-center w-full h-12 px-4 border-2 border-dashed rounded-md cursor-pointer hover:bg-muted",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:((u=s.value)==null?void 0:u.name)||"Escolher Imagem"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:C=>{var S;return s.onChange((S=C.target.files)==null?void 0:S[0])}})]})}),e.jsx(y,{})]})}}),e.jsx(x,{control:h.control,name:"image_url",render:({field:s})=>e.jsxs(j,{children:[e.jsx(g,{children:e.jsx(D,{placeholder:"Ou cole a URL da imagem",...s})}),e.jsx(y,{})]})})]}),e.jsx(x,{control:h.control,name:"is_price_by_weight",render:({field:s})=>e.jsxs(j,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(f,{children:"Produto pesável (preço por kg)"}),e.jsx(g,{children:e.jsx(A,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(x,{control:h.control,name:"is_available",render:({field:s})=>e.jsxs(j,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(f,{children:"Produto disponível"}),e.jsx(g,{children:e.jsx(A,{checked:s.value,onCheckedChange:s.onChange})})]})})]}),e.jsxs(se,{className:"pt-4 border-t",children:[e.jsx(re,{asChild:!0,children:e.jsx(v,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(v,{type:"submit",disabled:P.isPending,children:P.isPending?"Criando...":"Criar Produto"})]})]})})]})})]})},Ge=V({name:k().min(1,"O nome é obrigatório."),description:k().optional(),price:Ne(a=>String(a).replace(",","."),W.number({invalid_type_error:"O preço deve ser um número."}).positive("O preço deve ser maior que zero.")),category_id:k().optional(),image_url:k().url("URL inválida.").optional().or(_e("")),image_file:Ce(File).optional(),is_price_by_weight:L().default(!1),is_available:L().default(!0)}),Je=async a=>{const{data:n,error:t}=await p.from("categories").select("id, name").eq("restaurant_id",a).eq("is_active",!0);if(t)throw new Error(t.message);return n},Xe=({isOpen:a,onClose:n,product:t})=>{const c=R(),[d,b]=E.useState(null);T({queryKey:["restaurantId"],queryFn:async()=>{const{data:i,error:s}=await p.from("restaurants").select("id").limit(1).single();if(s)throw new Error(s.message);return b(i.id),i.id},enabled:a});const{data:m,isLoading:o}=T({queryKey:["categories",d],queryFn:()=>Je(d),enabled:!!d}),l=H({resolver:G(Ge)});E.useEffect(()=>{t&&l.reset({name:t.name,description:t.description||"",price:t.price,category_id:t.category_id||void 0,image_url:t.image_url||"",is_price_by_weight:t.is_price_by_weight||!1,is_available:t.is_available??!0,image_file:void 0})},[t,l,a]);const h=M({mutationFn:async i=>{if(!(t!=null&&t.id)||!d)throw new Error("ID do produto ou restaurante não encontrado.");let s=t.image_url;if(i.image_file){const C=i.image_file,S=`${d}/${Date.now()}-${C.name}`,{error:q}=await p.storage.from("products").upload(S,C);if(q)throw new Error(`Erro no upload da imagem: ${q.message}`);const{data:F}=p.storage.from("products").getPublicUrl(S);s=F.publicUrl}else s=i.image_url||null;const{error:u}=await p.from("products").update({name:i.name,description:i.description,price:i.price,category_id:i.category_id||null,image_url:s,is_price_by_weight:i.is_price_by_weight,is_available:i.is_available}).eq("id",t.id);if(u)throw u},onSuccess:()=>{_.success("Produto atualizado com sucesso!"),c.invalidateQueries({queryKey:["products"]}),c.invalidateQueries({queryKey:["menuData"]}),n()},onError:i=>{_.error(`Erro ao atualizar produto: ${i.message}`)}}),P=i=>{h.mutate(i)};return e.jsx(J,{open:a,onOpenChange:n,children:e.jsxs(X,{className:"sm:max-w-lg",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Editar Produto"}),e.jsx(ee,{children:"Atualize as informações do item do seu cardápio."})]}),e.jsx(ae,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(P),children:[e.jsxs("div",{className:"space-y-4 py-2 pb-4 max-h-[70vh] overflow-y-auto pr-4",children:[e.jsx(x,{control:l.control,name:"name",render:({field:i})=>e.jsxs(j,{children:[e.jsx(f,{children:"Nome *"}),e.jsx(g,{children:e.jsx(D,{...i})}),e.jsx(y,{})]})}),e.jsx(x,{control:l.control,name:"description",render:({field:i})=>e.jsxs(j,{children:[e.jsx(f,{children:"Descrição"}),e.jsx(g,{children:e.jsx(ie,{...i})}),e.jsx(y,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(x,{control:l.control,name:"price",render:({field:i})=>e.jsxs(j,{children:[e.jsx(f,{children:"Preço (R$) *"}),e.jsx(g,{children:e.jsx(D,{type:"text",...i})}),e.jsx(y,{})]})}),e.jsx(x,{control:l.control,name:"category_id",render:({field:i})=>e.jsxs(j,{children:[e.jsx(f,{children:"Categoria"}),e.jsxs(je,{onValueChange:i.onChange,value:i.value,disabled:o,children:[e.jsx(g,{children:e.jsx(ge,{children:e.jsx(pe,{placeholder:"Selecione uma categoria"})})}),e.jsx(fe,{children:m==null?void 0:m.map(s=>e.jsx(ve,{value:s.id,children:s.name},s.id))})]}),e.jsx(y,{})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Imagem do Produto"}),e.jsx(x,{control:l.control,name:"image_file",render:({field:i})=>{var s;return e.jsxs(j,{children:[e.jsx(g,{children:e.jsxs("label",{className:"flex items-center justify-center w-full h-12 px-4 border-2 border-dashed rounded-md cursor-pointer hover:bg-muted",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:((s=i.value)==null?void 0:s.name)||"Escolher Nova Imagem"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:u=>{var C;return i.onChange((C=u.target.files)==null?void 0:C[0])}})]})}),e.jsx(y,{})]})}}),e.jsx(x,{control:l.control,name:"image_url",render:({field:i})=>e.jsxs(j,{children:[e.jsx(g,{children:e.jsx(D,{placeholder:"Ou cole a URL da imagem",...i})}),e.jsx(y,{})]})})]}),e.jsx(x,{control:l.control,name:"is_price_by_weight",render:({field:i})=>e.jsxs(j,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(f,{children:"Produto pesável (preço por kg)"}),e.jsx(g,{children:e.jsx(A,{checked:i.value,onCheckedChange:i.onChange})})]})}),e.jsx(x,{control:l.control,name:"is_available",render:({field:i})=>e.jsxs(j,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[e.jsx(f,{children:"Produto disponível"}),e.jsx(g,{children:e.jsx(A,{checked:i.value,onCheckedChange:i.onChange})})]})})]}),e.jsxs(se,{className:"pt-4 border-t",children:[e.jsx(re,{asChild:!0,children:e.jsx(v,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(v,{type:"submit",disabled:h.isPending,children:h.isPending?"Salvando...":"Salvar Alterações"})]})]})})]})})},Ye=async()=>{const{data:a,error:n}=await p.from("restaurants").select("id").limit(1).single();if(n)throw new Error(`Erro ao buscar restaurante: ${n.message}`);if(!a)throw new Error("Nenhum restaurante ativo encontrado.");const t=a.id,{data:c,error:d}=await p.from("categories").select("*").eq("restaurant_id",t).order("display_order",{ascending:!0});if(d)throw new Error(`Erro ao buscar categorias: ${d.message}`);const{data:b,error:m}=await p.from("products").select("id, name, category_id, is_available").eq("restaurant_id",t);if(m)throw new Error(`Erro ao buscar produtos: ${m.message}`);return c.map(l=>({...l,products:b.filter(h=>h.category_id===l.id)}))},Ze=()=>{const[a,n]=E.useState(!1),{data:t,isLoading:c,isError:d,error:b}=T({queryKey:["categoriesWithProducts"],queryFn:Ye});return e.jsxs(e.Fragment,{children:[e.jsx(Te,{isOpen:a,onClose:()=>n(!1)}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Categorias"}),e.jsxs(v,{onClick:()=>n(!0),children:[e.jsx(te,{className:"mr-2 h-4 w-4"})," Nova Categoria"]})]}),c&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[...Array(3)].map((m,o)=>e.jsxs($,{children:[e.jsx(me,{children:e.jsx(N,{className:"h-6 w-3/4"})}),e.jsxs(U,{className:"space-y-4",children:[e.jsx(N,{className:"h-4 w-1/4"}),e.jsx(N,{className:"h-4 w-1/2"}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(N,{className:"h-8 w-full"}),e.jsx(N,{className:"h-8 w-full"})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(N,{className:"h-10 w-full"}),e.jsx(N,{className:"h-10 w-10"})]})]})]},o))}),d&&e.jsxs(ye,{variant:"destructive",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(be,{children:"Erro ao carregar categorias"}),e.jsx(we,{children:b instanceof Error?b.message:"Ocorreu um erro desconhecido."})]}),t&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:t.map(m=>e.jsxs($,{children:[e.jsxs(me,{className:"flex flex-row items-start justify-between",children:[e.jsx($e,{children:m.name}),m.is_active&&e.jsx(K,{children:"Ativa"})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ordem: ",m.display_order??0]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium mb-2",children:["Produtos (",m.products.length,"):"]}),e.jsx("div",{className:"space-y-2",children:m.products.length>0?m.products.map(o=>e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-2 rounded-md",children:[e.jsx("span",{className:"text-sm",children:o.name}),o.is_available&&e.jsx(K,{variant:"secondary",children:"Disponível"})]},o.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum produto nesta categoria."})})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[e.jsxs(v,{variant:"outline",className:"w-full",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsx(v,{variant:"destructive",size:"icon",children:e.jsx(oe,{className:"h-4 w-4"})})]})]})]},m.id))})]})]})},es=({product:a,onEditClick:n,onUpdateStatus:t,onDeleteClick:c})=>e.jsxs($,{className:"flex items-center gap-4 p-4",children:[e.jsx("img",{src:a.image_url||"/placeholder.svg",alt:a.name,className:"w-24 h-24 object-cover rounded-md"}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:a.name}),a.is_available&&e.jsx(K,{children:"Disponível"})]}),e.jsx("p",{className:"text-lg font-bold text-primary mt-1",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.price)})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:`list-active-${a.id}`,className:"text-sm font-medium",children:"Ativo"}),e.jsx(A,{id:`list-active-${a.id}`,checked:a.is_available??!1,onCheckedChange:t})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{variant:"outline",size:"icon",onClick:()=>n(a),children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsxs(ke,{children:[e.jsx(Ke,{asChild:!0,children:e.jsx(v,{variant:"destructive",size:"icon",children:e.jsx(oe,{className:"h-4 w-4"})})}),e.jsxs(qe,{children:[e.jsxs(De,{children:[e.jsx(Pe,{children:"Tem certeza que deseja excluir este produto?"}),e.jsxs(Fe,{children:['Esta ação é permanente. O produto "',a.name,'" será removido do cardápio e de todos os pedidos futuros.']})]}),e.jsxs(Ae,{children:[e.jsx(Ie,{children:"Cancelar"}),e.jsx(Me,{onClick:()=>c(a.id),className:"bg-destructive hover:bg-destructive/90",children:"Excluir"})]})]})]})]})]})]}),ss=async()=>{const{data:a,error:n}=await p.from("restaurants").select("id").eq("is_active",!0).limit(1).single();if(n)throw new Error(`Erro ao buscar restaurante: ${n.message}`);if(!a)throw new Error("Nenhum restaurante ativo encontrado.");const{data:t,error:c}=await p.from("products").select("*").eq("restaurant_id",a.id).order("created_at",{ascending:!1});if(c)throw new Error(`Erro ao buscar produtos: ${c.message}`);return t},ks=()=>{const a=R(),[n,t]=E.useState(!1),[c,d]=E.useState(!1),[b,m]=E.useState(null),[o,l]=E.useState(null),[h,P]=E.useState(()=>{if(typeof window<"u"){const r=localStorage.getItem("productsLayout");return r==="grid"||r==="list"?r:"grid"}return"grid"}),i=E.useCallback(r=>{P(r),localStorage.setItem("productsLayout",r)},[]),{data:s,isLoading:u,isError:C,error:S}=T({queryKey:["products"],queryFn:ss}),q=r=>{m(r),d(!0)},F=M({mutationFn:async({id:r,is_available:w})=>{const{error:O}=await p.from("products").update({is_available:w}).eq("id",r);if(O)throw new Error(O.message)},onSuccess:()=>{a.invalidateQueries({queryKey:["products"]}),_.success("Status do produto atualizado!")},onError:r=>{_.error(`Erro ao atualizar produto: ${r.message}`)}}),I=M({mutationFn:async r=>{const{error:w}=await p.from("products").delete().eq("id",r);if(w)throw new Error(w.message)},onSuccess:()=>{a.invalidateQueries({queryKey:["products"]}),a.invalidateQueries({queryKey:["menuData"]}),_.success("Produto excluído com sucesso!"),l(null)},onError:r=>{_.error(`Erro ao excluir produto: ${r.message}`),l(null)}}),le=M({mutationFn:async r=>{if(!s||s.length===0)return;const w=s.map(Oe=>Oe.id),{error:O}=await p.from("products").update({is_available:r}).in("id",w);if(O)throw new Error(O.message)},onSuccess:(r,w)=>{a.invalidateQueries({queryKey:["products"]}),a.invalidateQueries({queryKey:["menuData"]}),_.success(`Todos os produtos foram ${w?"ativados":"desativados"} com sucesso!`)},onError:r=>{_.error(`Erro ao atualizar status em massa: ${r.message}`)}}),ce=r=>{if(!s||s.length===0){_.info("Nenhum produto para atualizar.");return}le.mutate(r)},de=r=>{I.mutate(r)},Q=s==null?void 0:s.find(r=>r.id===o),z=le.isPending;return e.jsxs(e.Fragment,{children:[e.jsx(He,{isOpen:n,onClose:()=>t(!1)}),e.jsx(Xe,{isOpen:c,onClose:()=>d(!1),product:b}),e.jsx(ke,{open:!!o,onOpenChange:r=>!r&&l(null),children:e.jsxs(qe,{children:[e.jsxs(De,{children:[e.jsx(Pe,{children:"Tem certeza que deseja excluir este produto?"}),e.jsxs(Fe,{children:['Esta ação é permanente. O produto "',(Q==null?void 0:Q.name)||"selecionado",'" será removido do cardápio.']})]}),e.jsxs(Ae,{children:[e.jsx(Ie,{disabled:I.isPending,children:"Cancelar"}),e.jsx(Me,{onClick:()=>de(o),className:"bg-destructive hover:bg-destructive/90",disabled:I.isPending,children:I.isPending?"Excluindo...":"Excluir"})]})]})}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:e.jsxs(Le,{defaultValue:"products",children:[e.jsxs(ze,{children:[e.jsx(he,{value:"products",children:"Produtos"}),e.jsx(he,{value:"categories",children:"Categorias"})]}),e.jsxs(ue,{value:"products",className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Produtos"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(v,{variant:"outline",size:"icon",onClick:()=>i(h==="grid"?"list":"grid"),children:h==="grid"?e.jsx(Qe,{className:"h-4 w-4"}):e.jsx(Re,{className:"h-4 w-4"})}),e.jsx(v,{variant:"outline",onClick:()=>ce(!0),disabled:z||u||!s||s.length===0,children:z?e.jsx(xe,{className:"h-4 w-4 animate-spin mr-2"}):"Ativar Todos"}),e.jsx(v,{variant:"outline",onClick:()=>ce(!1),disabled:z||u||!s||s.length===0,children:z?e.jsx(xe,{className:"h-4 w-4 animate-spin mr-2"}):"Desativar Todos"}),e.jsxs(v,{onClick:()=>t(!0),children:[e.jsx(te,{className:"mr-2 h-4 w-4"})," Novo Produto"]})]})]}),u&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[...Array(4)].map((r,w)=>e.jsxs($,{className:"overflow-hidden",children:[e.jsx(N,{className:"h-48 w-full"}),e.jsxs(U,{className:"p-4 space-y-3",children:[e.jsx(N,{className:"h-5 w-3/4"}),e.jsx(N,{className:"h-6 w-1/3"}),e.jsxs("div",{className:"flex justify-between items-center border-t pt-3 mt-3",children:[e.jsx(N,{className:"h-5 w-1/2"}),e.jsx(N,{className:"h-6 w-12"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(N,{className:"h-10 w-full"}),e.jsx(N,{className:"h-10 w-10"})]})]})]},w))}),C&&e.jsxs(ye,{variant:"destructive",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(be,{children:"Erro ao carregar produtos"}),e.jsx(we,{children:S.message})]}),s&&e.jsx("div",{className:Ue(h==="grid"?"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"space-y-4"),children:s.map(r=>h==="grid"?e.jsxs($,{className:"overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.image_url||"/placeholder.svg",alt:r.name,className:"w-full h-48 object-cover"}),r.is_available&&e.jsx(K,{className:"absolute top-2 right-2",children:"Disponível"})]}),e.jsxs(U,{className:"p-4 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"text-lg font-semibold truncate",children:r.name}),e.jsx("p",{className:"text-xl font-bold text-primary mt-1 mb-3",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.price)})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-t pt-3",children:[e.jsx("label",{htmlFor:`active-${r.id}`,className:"text-sm font-medium",children:"Produto Ativo"}),e.jsx(A,{id:`active-${r.id}`,checked:r.is_available??!1,onCheckedChange:w=>{F.mutate({id:r.id,is_available:w})}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{variant:"outline",className:"w-full",onClick:()=>q(r),children:[e.jsx(ne,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsx(v,{variant:"destructive",size:"icon",onClick:()=>l(r.id),children:e.jsx(oe,{className:"h-4 w-4"})})]})]})]})]},r.id):e.jsx(es,{product:r,onEditClick:q,onUpdateStatus:w=>F.mutate({id:r.id,is_available:w}),onDeleteClick:de},r.id))})]}),e.jsx(ue,{value:"categories",children:e.jsx(Ze,{})})]})})]})};export{ks as default};
