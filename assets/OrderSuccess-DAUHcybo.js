import{u as ne,b as $,c as ce,j as e}from"./tanstack-d4AvmB45.js";import{k as ie,j as le,r as f,R as oe,L as g}from"./vendor-CnEXr6gt.js";import{s as v}from"./client-D5i5GwB9.js";import{c as de,p as me,b as xe,a as ue,L as pe,u as z}from"./index-iuYFWvRc.js";import{B as o}from"./button-D_vNnRms.js";import{C as j,b as y,c as N,a as b}from"./card-5zdX1mCS.js";import{A as he,h as fe,a as ge,b as je,c as ye,d as Ne,e as be,f as ve,g as we}from"./alert-dialog-Ch27uuhu.js";import{C as Ce}from"./circle-alert-DV_yGhlv.js";import{T as _e}from"./terminal-DAzwiwI6.js";import{R as Pe,p as Ee}from"./pt-BR-Igj8lrA6.js";import{S as Re}from"./store-Ctxp-fDY.js";import{P as Te}from"./phone-F9KJlSj8.js";import{M as Q}from"./map-pin-CPcG0sO3.js";import{C as K}from"./credit-card-Br8oFSPU.js";import{C as U}from"./circle-x-DuS-P_zK.js";import{C as Ae,T as Se}from"./truck-BPbWQFX4.js";import{P as Ie}from"./package-sktuQV4z.js";import{C as Le}from"./circle-check-big-DXxDgjus.js";import{C as ke}from"./check-Cf7giVyK.js";import{f as Be}from"./format-BeKxgCCE.js";import"./supabase-BZV_3FV3.js";import"./index-C0VYRz7I.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=de("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]),H={pending:{label:"Pedido Recebido",icon:Ae,color:"bg-yellow-500"},preparing:{label:"Em Preparação",icon:Ie,color:"bg-orange-500"},ready:{label:"Pronto para Entrega",icon:Le,color:"bg-green-500"},delivering:{label:"Em Entrega",icon:Se,color:"bg-blue-500"},delivered:{label:"Entregue",icon:ke,color:"bg-primary"},cancelled:{label:"Cancelado",icon:U,color:"bg-destructive"},pending_payment:{label:"Aguardando Pagamento",icon:K,color:"bg-gray-500"}},Fe=["pending_payment","pending","preparing","ready"],Oe=async i=>{const{data:t,error:n}=await v.from("orders").select(`
      *, 
      customer:customers(name, phone, email, cpf_cnpj), 
      payment_methods(name),
      restaurant:restaurants(name, phone, address)
    `).eq("id",i).limit(1).single();if(n)throw new Error(`Erro ao buscar pedido: ${n.message}`);if(!t)throw new Error("Pedido não encontrado.");return t},Me=async i=>{const{data:t,error:n}=await v.from("order_items").select("*, products(name, is_price_by_weight)").eq("order_id",i);if(n)throw new Error(n.message);return t},ls=()=>{var D,F,O,M;const{orderId:i}=ie(),[t]=le(),n=ne(),[V,x]=f.useState(!1),r=i||t.get("external_reference"),X=t.get("restaurantId"),w=t.get("status"),{clearCart:C}=me(),[_,G]=oe.useState(!1),{data:s,isLoading:J,isError:W,error:u,refetch:Y}=$({queryKey:["orderSuccessDetails",r],queryFn:()=>Oe(r),enabled:!!r,staleTime:0}),{data:p,isLoading:Z,isError:ee}=$({queryKey:["orderSuccessItems",r],queryFn:()=>Me(r),enabled:!!r,staleTime:0}),c=ce({mutationFn:async a=>{const{error:l}=await v.from("orders").update({status:"cancelled"}).eq("id",a);if(l)throw new Error(l.message)},onSuccess:()=>{x(!1),z.success("Pedido cancelado com sucesso."),n.invalidateQueries({queryKey:["orderSuccessDetails",r]}),n.invalidateQueries({queryKey:["orders"]})},onError:a=>{z.error(`Falha ao cancelar pedido: ${a.message}`),x(!1)}});f.useEffect(()=>{r&&!_&&(C(),G(!0))},[r,C,_]);const d=f.useMemo(()=>w==="pending"?"pending_payment":(s==null?void 0:s.status)||"pending_payment",[s==null?void 0:s.status,w]),h=H[d]||H.pending_payment,P=s!=null&&s.id?s.id.slice(-4):"N/A",m=(s==null?void 0:s.restaurant_id)||X,E=(s==null?void 0:s.total_amount)||0,R=(s==null?void 0:s.delivery_fee)||0,se=E-R,T=s!=null&&s.created_at?new Date(s.created_at):null;T&&Be(T,"dd 'de' MMMM 'de' yyyy 'às' HH:mm",{locale:Ee});const A=s!=null&&s.change_for?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.change_for):null,ae=((D=s==null?void 0:s.payment_methods)==null?void 0:D.name)||"Não especificado",S=Fe.includes(d),I=s==null?void 0:s.min_delivery_time_minutes,L=s==null?void 0:s.max_delivery_time_minutes,re=I&&L?`${I} - ${L} minutos`:"Em breve",te=((F=s==null?void 0:s.restaurant)==null?void 0:F.name)||"Restaurante",k=(O=s==null?void 0:s.restaurant)==null?void 0:O.phone,B=(M=s==null?void 0:s.restaurant)==null?void 0:M.address;return r?J||Z?e.jsx(xe,{}):W||ee||!s?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(j,{className:"max-w-lg w-full text-center",children:[e.jsx(y,{children:e.jsxs(N,{className:"text-2xl font-bold text-destructive flex items-center justify-center gap-2",children:[e.jsx(_e,{className:"h-6 w-6"}),"Erro ao Carregar Pedido"]})}),e.jsxs(b,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:(u==null?void 0:u.message)||"Ocorreu um erro desconhecido ao buscar os detalhes do pedido."}),e.jsxs(o,{onClick:()=>Y(),className:"mr-2",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"})," Tentar Novamente"]}),e.jsx(g,{to:m?`/menu/${m}`:"/",children:e.jsx(o,{variant:"outline",children:"Voltar ao Cardápio"})})]})]})}):e.jsx("div",{className:"min-h-screen bg-background flex justify-center p-4 sm:p-8",children:e.jsxs(j,{className:"w-full max-w-3xl shadow-xl",children:[e.jsxs(y,{className:"text-center space-y-4",children:[e.jsx("div",{className:ue("mx-auto p-3 rounded-full w-16 h-16 flex items-center justify-center",h.color),children:e.jsx(h.icon,{className:"h-8 w-8 text-white"})}),e.jsx(N,{className:"text-3xl font-bold",children:d==="cancelled"?"Pedido Cancelado":"Pedido Realizado com Sucesso!"}),e.jsxs("p",{className:"text-lg text-muted-foreground",children:["Seu pedido #",P," está em ",h.label.toLowerCase(),"."]})]}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs("div",{className:"border-b pb-4 space-y-3",children:[e.jsxs("h3",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-primary"}),te]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[k&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Te,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Telefone"}),e.jsx("p",{className:"text-muted-foreground",children:k})]})]}),B&&e.jsxs("div",{className:"flex items-start gap-3 md:col-span-1",children:[e.jsx(Q,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Endereço"}),e.jsx("p",{className:"text-muted-foreground",children:B})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 border-b pb-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",translate:"no",children:"Entrega"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.delivery_address||"Retirada no local"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(K,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",translate:"no",children:"Pagamento"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:ae}),A&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Troco para: ",A]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(De,{className:"h-5 w-5 text-primary flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",translate:"no",children:"Tempo Estimado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:re})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Resumo do Pedido"}),e.jsx("div",{className:"space-y-2",children:p==null?void 0:p.map(a=>{var l,q;return e.jsxs("div",{className:"flex justify-between items-start p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((l=a.products)==null?void 0:l.name)||"Produto Removido"}),a.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Obs: ",a.notes]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.quantity," ",(q=a.products)!=null&&q.is_price_by_weight?"kg":"x"," ",new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.unit_price)]}),e.jsx("p",{className:"font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.subtotal)})]})]},a.id)})})]}),e.jsxs("div",{className:"pt-4 border-t space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(se)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Taxa de Entrega"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(R)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-xl pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(E)})]})]}),e.jsxs("div",{className:"pt-6 flex flex-col sm:flex-row justify-center gap-4",children:[S&&e.jsxs(he,{open:V,onOpenChange:x,children:[e.jsx(fe,{asChild:!0,children:e.jsxs(o,{variant:"destructive",disabled:c.isPending,children:[c.isPending?e.jsx(pe,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(U,{className:"h-4 w-4 mr-2"}),"Cancelar Pedido"]})}),e.jsxs(ge,{children:[e.jsxs(je,{children:[e.jsxs(ye,{children:["Tem certeza que deseja cancelar o pedido #",P,"?"]}),e.jsx(Ne,{children:"O cancelamento só é possível se o restaurante ainda não tiver iniciado a entrega. Esta ação não pode ser desfeita."})]}),e.jsxs(be,{children:[e.jsx(ve,{disabled:c.isPending,children:"Não, Manter Pedido"}),e.jsx(we,{onClick:()=>c.mutate(r),className:"bg-destructive hover:bg-destructive/90",disabled:c.isPending,children:c.isPending?"Cancelando...":"Sim, Cancelar"})]})]})]}),e.jsx(g,{to:m?`/menu/${m}`:"/",children:e.jsx(o,{size:"lg",className:"w-full sm:w-auto",children:"Fazer Novo Pedido"})})]}),!S&&d!=="cancelled"&&e.jsx("p",{className:"text-center text-sm text-muted-foreground mt-4",children:"O pedido não pode mais ser cancelado, pois está em fase de entrega ou já foi entregue."})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(j,{className:"max-w-lg w-full text-center",children:[e.jsx(y,{children:e.jsxs(N,{className:"text-2xl font-bold text-destructive flex items-center justify-center gap-2",children:[e.jsx(Ce,{className:"h-6 w-6"}),"Erro no Pedido"]})}),e.jsxs(b,{children:[e.jsx("p",{className:"text-muted-foreground mb-6",children:"ID do pedido não encontrado na URL. Por favor, volte ao menu."}),e.jsx(g,{to:"/",children:e.jsx(o,{size:"lg",children:"Voltar ao Início"})})]})]})})};export{ls as default};
