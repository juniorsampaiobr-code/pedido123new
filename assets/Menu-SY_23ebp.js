import{j as e,u as Fe,b as oe}from"./tanstack-Ch7Ewlpa.js";import{r as d,R as ce,L as de,k as He}from"./vendor-CCvq-0xx.js";import{s as E}from"./client-3S0ugJ5L.js";import{A as me,a as he,b as ue}from"./alert-DowwkJVK.js";import{C as fe}from"./truck-i4a8H2sc.js";import{C as xe,a as We}from"./card--GNGk7Zp.js";import{B as g}from"./button-6zUu_1vM.js";import{c as q,a as R,p as $,u as K,d as Be,e as z,P as O,g as X,f as L,n as A,l as qe}from"./index-DREBoXd7.js";import{D as pe,a as be,X as ge,b as we,c as ve,d as je,e as ye}from"./dialog-BZzRvaIh.js";import{I as Y}from"./label-DMFQL3U4.js";import{T as $e}from"./textarea-DxpMXUp_.js";import{D as Se}from"./dollar-sign-BZr7rWip.js";import{P as U}from"./plus-D-UUkfe3.js";import{S as M}from"./shopping-cart-b2OG2fpr.js";import{S as Xe,b as Ye}from"./sheet-YQAqaQA4.js";import{u as Ue}from"./index-MFjXM7kG.js";import{c as Ve}from"./index-BdQq_4o_.js";import{u as Qe}from"./use-auth-status-_H4u97lH.js";import{C as Ke,L as Ge}from"./CustomerProfileModal-BXJVns1i.js";import{T as Ze}from"./terminal-anFNvdWF.js";import{U as Je}from"./user-BddAEh4x.js";import{M as et}from"./map-pin-DW80SZFY.js";import{P as tt}from"./phone-C8e_eMpN.js";import{S as ne}from"./search-D8gjUZ5n.js";import"./supabase-t-NbcSY6.js";import"./index-Ct8fKzKj.js";import"./types-CtpoKdVi.js";import"./form-C0GGW2Yb.js";import"./PhoneInput-5GrjqwVF.js";import"./CpfCnpjInput-7xQcM6Cc.js";import"./skeleton-DQyJW0yI.js";import"./save-B5eI8yD5.js";import"./credit-card-iKyp8Lyx.js";import"./package-CARPTdP7.js";import"./circle-check-big-PvhgLNJP.js";import"./check-C1UvgdyX.js";import"./circle-x-BVF57Ib4.js";import"./euro-C1uA7t2Q.js";import"./format-BeKxgCCE.js";import"./pt-BR-CbDebePx.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=q("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=q("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=q("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=q("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]),rt=({todayHours:t})=>e.jsxs(me,{variant:"destructive",className:"mb-6",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx(he,{children:"Loja Fechada"}),e.jsx(ue,{children:"A loja está fechada."})]}),st=({src:t,alt:o,className:r,...a})=>{const[s,n]=d.useState(!0),[l,i]=d.useState(!1),[c,m]=d.useState(t);d.useEffect(()=>{n(!0),i(!1),m(t)},[t]);const h=()=>{n(!1)},u=()=>{n(!1),i(!0),m("/placeholder.svg")};return e.jsxs("div",{className:R("relative overflow-hidden",r),children:[s&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-muted animate-pulse",children:e.jsx(ae,{className:"h-8 w-8 text-muted-foreground"})}),l&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-muted",children:e.jsx(ae,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("img",{src:c,alt:o,onLoad:h,onError:u,className:R("w-full h-full object-cover transition-opacity duration-500",s?"opacity-0":"opacity-100"),...a})]})},ot=({isOpen:t,onClose:o,product:r,onAddToCart:a,isCheckoutBlocked:s})=>{const[n,l]=d.useState(r.is_price_by_weight?.5:1),[i,c]=d.useState("");ce.useEffect(()=>{t&&(l(r.is_price_by_weight?.5:1),c(""))},[t,r.is_price_by_weight]);const m=x=>{l(p=>{const w=r.is_price_by_weight?.1:1,_=Math.max(w,p+x);return r.is_price_by_weight?parseFloat(_.toFixed(1)):Math.round(_)})},h=()=>{n<=0||(a(n,i),o())},u=r.price*n,f=x=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x);return e.jsx(pe,{open:t,onOpenChange:o,children:e.jsxs(be,{className:"sm:max-w-[425px] p-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.image_url||"/placeholder.svg",alt:r.name,className:"w-full h-48 object-cover"}),e.jsx(g,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 bg-background/80 hover:bg-background",onClick:o,children:e.jsx(ge,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs(we,{className:"p-0",children:[e.jsx(ve,{className:"text-2xl font-bold",children:r.name}),e.jsx(je,{className:"text-sm",children:r.description||"Sem descrição disponível."})]}),e.jsxs("div",{className:"flex items-center justify-between border-y py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5 text-primary"}),e.jsxs("span",{className:"text-lg font-semibold",children:[f(r.price),r.is_price_by_weight&&e.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:" / kg"})]})]}),e.jsxs("div",{className:"flex items-center border rounded-md h-10",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"h-10 w-10",onClick:()=>m(r.is_price_by_weight?-.1:-1),disabled:n<=(r.is_price_by_weight?.1:1)||s,children:e.jsx(G,{className:"h-5 w-5"})}),e.jsx(Y,{type:r.is_price_by_weight?"number":"text",step:r.is_price_by_weight?"0.1":"1",value:r.is_price_by_weight?n.toFixed(1):n,onChange:x=>{const p=parseFloat(x.target.value);p>0&&l(p)},className:"w-16 h-10 text-center border-y-0 rounded-none p-0 focus-visible:ring-0",readOnly:!r.is_price_by_weight,disabled:s}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-10 w-10",onClick:()=>m(r.is_price_by_weight?.1:1),disabled:s,children:e.jsx(U,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"notes",className:"text-sm font-medium",children:"Observações (Opcional)"}),e.jsx($e,{id:"notes",placeholder:"Ex: Sem cebola, molho extra...",value:i,onChange:x=>c(x.target.value),rows:2,disabled:s})]}),e.jsx(ye,{className:"pt-4",children:e.jsxs(g,{type:"button",className:"w-full h-12 text-lg flex items-center justify-between px-6",onClick:h,disabled:n<=0||s,children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Adicionar"]}),e.jsx("span",{className:"font-bold",children:f(u)})]})})]})]})})},nt=({isOpen:t,onClose:o,product:r,onAddToCart:a,isCheckoutBlocked:s})=>{const[n,l]=d.useState(0);ce.useEffect(()=>{t&&l(0)},[t]);const i=u=>{l(f=>{const x=Math.max(0,f+u);return parseFloat(x.toFixed(1))})},c=()=>{n<=0||(a(n,""),o())},m=r.price*n,h=u=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(u);return e.jsx(pe,{open:t,onOpenChange:o,children:e.jsxs(be,{className:"sm:max-w-[425px]",children:[e.jsxs(we,{children:[e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5 text-primary"}),r.name," (Por Peso)"]}),e.jsxs(je,{children:["Informe a quantidade em quilogramas (kg). Preço: ",h(r.price),"/kg."]})]}),e.jsx("div",{className:"space-y-4 py-2",children:e.jsxs("div",{className:"flex items-center justify-between border-y py-3",children:[e.jsx("label",{className:"text-lg font-semibold",children:"Quantidade (kg)"}),e.jsxs("div",{className:"flex items-center border rounded-md h-10",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"h-10 w-10",onClick:()=>i(-.1),disabled:n<=0||s,children:e.jsx(G,{className:"h-5 w-5"})}),e.jsx(Y,{type:"number",step:"0.1",value:n.toFixed(1),onChange:u=>{const f=parseFloat(u.target.value);f>=0&&l(parseFloat(f.toFixed(1)))},className:"w-16 h-10 text-center border-y-0 rounded-none p-0 focus-visible:ring-0",disabled:s}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-10 w-10",onClick:()=>i(.1),disabled:s,children:e.jsx(U,{className:"h-5 w-5"})})]})]})}),e.jsx(ye,{className:"pt-4",children:e.jsxs(g,{type:"button",className:"w-full h-12 text-lg flex items-center justify-between px-6",onClick:c,disabled:n<=0||s,children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Adicionar ao Carrinho"]}),e.jsx("span",{className:"font-bold",children:h(m)})]})})]})})},at=({product:t,isCheckoutBlocked:o})=>{const{addItem:r}=$(),[a,s]=d.useState(!1),[n,l]=d.useState(!1),i=(h=1,u="")=>{if(o){K.error("A loja está fechada.",{description:"Não é possível adicionar itens ao carrinho ou finalizar o pedido no momento."});return}r(t,h,u)},c=()=>{if(o){K.error("A loja está fechada.",{description:"Não é possível adicionar itens ao carrinho ou finalizar o pedido no momento."});return}t.is_price_by_weight?l(!0):i(1,"")},m=h=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(h);return e.jsxs(e.Fragment,{children:[e.jsx(ot,{isOpen:a,onClose:()=>s(!1),product:t,onAddToCart:i,isCheckoutBlocked:o}),e.jsx(nt,{isOpen:n,onClose:()=>l(!1),product:t,onAddToCart:i,isCheckoutBlocked:o}),e.jsxs(xe,{className:"overflow-hidden shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col",children:[e.jsxs("div",{className:"relative cursor-pointer",onClick:()=>s(!0),children:[e.jsx(st,{src:t.image_url||"/placeholder.svg",alt:t.name,className:"w-full h-48 object-cover"}),t.is_price_by_weight&&e.jsxs("div",{className:"absolute top-2 left-2 bg-primary text-primary-foreground text-xs font-bold px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(Ce,{className:"h-3 w-3"})," Preço por Peso"]})]}),e.jsxs(We,{className:"p-4 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-1 truncate",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mb-3",children:t.description})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[e.jsxs("p",{className:"text-xl font-bold text-primary flex items-center gap-1",children:[e.jsx(Se,{className:"h-5 w-5"}),m(t.price),t.is_price_by_weight&&e.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:"/kg"})]}),e.jsx(g,{size:"icon",onClick:c,disabled:o,children:e.jsx(U,{className:"h-5 w-5"})})]})]})]})]})},lt=({totalItems:t,onClick:o,isCheckoutBlocked:r})=>e.jsxs(g,{onClick:o,size:"icon",className:R("rounded-full shadow-md transition-transform duration-300 flex-shrink-0",t>0?"scale-100":"scale-0 pointer-events-none"),"aria-label":`Ver carrinho com ${t} itens`,disabled:r,children:[e.jsx(M,{className:"h-6 w-6"}),t>0&&e.jsx("span",{className:"absolute top-0 right-0 transform translate-x-1/4 -translate-y-1/4 bg-destructive text-destructive-foreground text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center",children:t})]});function it(t,o){return d.useReducer((r,a)=>o[r][a]??r,t)}var Z="ScrollArea",[_e,xr]=Be(Z),[ct,v]=_e(Z),Pe=d.forwardRef((t,o)=>{const{__scopeScrollArea:r,type:a="hover",dir:s,scrollHideDelay:n=600,...l}=t,[i,c]=d.useState(null),[m,h]=d.useState(null),[u,f]=d.useState(null),[x,p]=d.useState(null),[w,_]=d.useState(null),[C,S]=d.useState(0),[P,j]=d.useState(0),[T,I]=d.useState(!1),[F,H]=d.useState(!1),b=z(o,D=>c(D)),y=Ue(s);return e.jsx(ct,{scope:r,type:a,dir:y,scrollHideDelay:n,scrollArea:i,viewport:m,onViewportChange:h,content:u,onContentChange:f,scrollbarX:x,onScrollbarXChange:p,scrollbarXEnabled:T,onScrollbarXEnabledChange:I,scrollbarY:w,onScrollbarYChange:_,scrollbarYEnabled:F,onScrollbarYEnabledChange:H,onCornerWidthChange:S,onCornerHeightChange:j,children:e.jsx(O.div,{dir:y,...l,ref:b,style:{position:"relative","--radix-scroll-area-corner-width":C+"px","--radix-scroll-area-corner-height":P+"px",...t.style}})})});Pe.displayName=Z;var Ee="ScrollAreaViewport",Re=d.forwardRef((t,o)=>{const{__scopeScrollArea:r,children:a,nonce:s,...n}=t,l=v(Ee,r),i=d.useRef(null),c=z(o,i,l.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),e.jsx(O.div,{"data-radix-scroll-area-viewport":"",...n,ref:c,style:{overflowX:l.scrollbarXEnabled?"scroll":"hidden",overflowY:l.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:l.onContentChange,style:{minWidth:"100%",display:"table"},children:a})})]})});Re.displayName=Ee;var N="ScrollAreaScrollbar",J=d.forwardRef((t,o)=>{const{forceMount:r,...a}=t,s=v(N,t.__scopeScrollArea),{onScrollbarXEnabledChange:n,onScrollbarYEnabledChange:l}=s,i=t.orientation==="horizontal";return d.useEffect(()=>(i?n(!0):l(!0),()=>{i?n(!1):l(!1)}),[i,n,l]),s.type==="hover"?e.jsx(dt,{...a,ref:o,forceMount:r}):s.type==="scroll"?e.jsx(mt,{...a,ref:o,forceMount:r}):s.type==="auto"?e.jsx(Te,{...a,ref:o,forceMount:r}):s.type==="always"?e.jsx(ee,{...a,ref:o}):null});J.displayName=N;var dt=d.forwardRef((t,o)=>{const{forceMount:r,...a}=t,s=v(N,t.__scopeScrollArea),[n,l]=d.useState(!1);return d.useEffect(()=>{const i=s.scrollArea;let c=0;if(i){const m=()=>{window.clearTimeout(c),l(!0)},h=()=>{c=window.setTimeout(()=>l(!1),s.scrollHideDelay)};return i.addEventListener("pointerenter",m),i.addEventListener("pointerleave",h),()=>{window.clearTimeout(c),i.removeEventListener("pointerenter",m),i.removeEventListener("pointerleave",h)}}},[s.scrollArea,s.scrollHideDelay]),e.jsx(X,{present:r||n,children:e.jsx(Te,{"data-state":n?"visible":"hidden",...a,ref:o})})}),mt=d.forwardRef((t,o)=>{const{forceMount:r,...a}=t,s=v(N,t.__scopeScrollArea),n=t.orientation==="horizontal",l=Q(()=>c("SCROLL_END"),100),[i,c]=it("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return d.useEffect(()=>{if(i==="idle"){const m=window.setTimeout(()=>c("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(m)}},[i,s.scrollHideDelay,c]),d.useEffect(()=>{const m=s.viewport,h=n?"scrollLeft":"scrollTop";if(m){let u=m[h];const f=()=>{const x=m[h];u!==x&&(c("SCROLL"),l()),u=x};return m.addEventListener("scroll",f),()=>m.removeEventListener("scroll",f)}},[s.viewport,n,c,l]),e.jsx(X,{present:r||i!=="hidden",children:e.jsx(ee,{"data-state":i==="hidden"?"hidden":"visible",...a,ref:o,onPointerEnter:L(t.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:L(t.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),Te=d.forwardRef((t,o)=>{const r=v(N,t.__scopeScrollArea),{forceMount:a,...s}=t,[n,l]=d.useState(!1),i=t.orientation==="horizontal",c=Q(()=>{if(r.viewport){const m=r.viewport.offsetWidth<r.viewport.scrollWidth,h=r.viewport.offsetHeight<r.viewport.scrollHeight;l(i?m:h)}},10);return k(r.viewport,c),k(r.content,c),e.jsx(X,{present:a||n,children:e.jsx(ee,{"data-state":n?"visible":"hidden",...s,ref:o})})}),ee=d.forwardRef((t,o)=>{const{orientation:r="vertical",...a}=t,s=v(N,t.__scopeScrollArea),n=d.useRef(null),l=d.useRef(0),[i,c]=d.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),m=ke(i.viewport,i.content),h={...a,sizes:i,onSizesChange:c,hasThumb:m>0&&m<1,onThumbChange:f=>n.current=f,onThumbPointerUp:()=>l.current=0,onThumbPointerDown:f=>l.current=f};function u(f,x){return bt(f,l.current,i,x)}return r==="horizontal"?e.jsx(ht,{...h,ref:o,onThumbPositionChange:()=>{if(s.viewport&&n.current){const f=s.viewport.scrollLeft,x=le(f,i,s.dir);n.current.style.transform=`translate3d(${x}px, 0, 0)`}},onWheelScroll:f=>{s.viewport&&(s.viewport.scrollLeft=f)},onDragScroll:f=>{s.viewport&&(s.viewport.scrollLeft=u(f,s.dir))}}):r==="vertical"?e.jsx(ut,{...h,ref:o,onThumbPositionChange:()=>{if(s.viewport&&n.current){const f=s.viewport.scrollTop,x=le(f,i);n.current.style.transform=`translate3d(0, ${x}px, 0)`}},onWheelScroll:f=>{s.viewport&&(s.viewport.scrollTop=f)},onDragScroll:f=>{s.viewport&&(s.viewport.scrollTop=u(f))}}):null}),ht=d.forwardRef((t,o)=>{const{sizes:r,onSizesChange:a,...s}=t,n=v(N,t.__scopeScrollArea),[l,i]=d.useState(),c=d.useRef(null),m=z(o,c,n.onScrollbarXChange);return d.useEffect(()=>{c.current&&i(getComputedStyle(c.current))},[c]),e.jsx(Le,{"data-orientation":"horizontal",...s,ref:m,sizes:r,style:{bottom:0,left:n.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:n.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":V(r)+"px",...t.style},onThumbPointerDown:h=>t.onThumbPointerDown(h.x),onDragScroll:h=>t.onDragScroll(h.x),onWheelScroll:(h,u)=>{if(n.viewport){const f=n.viewport.scrollLeft+h.deltaX;t.onWheelScroll(f),Ie(f,u)&&h.preventDefault()}},onResize:()=>{c.current&&n.viewport&&l&&a({content:n.viewport.scrollWidth,viewport:n.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:B(l.paddingLeft),paddingEnd:B(l.paddingRight)}})}})}),ut=d.forwardRef((t,o)=>{const{sizes:r,onSizesChange:a,...s}=t,n=v(N,t.__scopeScrollArea),[l,i]=d.useState(),c=d.useRef(null),m=z(o,c,n.onScrollbarYChange);return d.useEffect(()=>{c.current&&i(getComputedStyle(c.current))},[c]),e.jsx(Le,{"data-orientation":"vertical",...s,ref:m,sizes:r,style:{top:0,right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":V(r)+"px",...t.style},onThumbPointerDown:h=>t.onThumbPointerDown(h.y),onDragScroll:h=>t.onDragScroll(h.y),onWheelScroll:(h,u)=>{if(n.viewport){const f=n.viewport.scrollTop+h.deltaY;t.onWheelScroll(f),Ie(f,u)&&h.preventDefault()}},onResize:()=>{c.current&&n.viewport&&l&&a({content:n.viewport.scrollHeight,viewport:n.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:B(l.paddingTop),paddingEnd:B(l.paddingBottom)}})}})}),[ft,Ae]=_e(N),Le=d.forwardRef((t,o)=>{const{__scopeScrollArea:r,sizes:a,hasThumb:s,onThumbChange:n,onThumbPointerUp:l,onThumbPointerDown:i,onThumbPositionChange:c,onDragScroll:m,onWheelScroll:h,onResize:u,...f}=t,x=v(N,r),[p,w]=d.useState(null),_=z(o,b=>w(b)),C=d.useRef(null),S=d.useRef(""),P=x.viewport,j=a.content-a.viewport,T=A(h),I=A(c),F=Q(u,10);function H(b){if(C.current){const y=b.clientX-C.current.left,D=b.clientY-C.current.top;m({x:y,y:D})}}return d.useEffect(()=>{const b=y=>{const D=y.target;(p==null?void 0:p.contains(D))&&T(y,j)};return document.addEventListener("wheel",b,{passive:!1}),()=>document.removeEventListener("wheel",b,{passive:!1})},[P,p,j,T]),d.useEffect(I,[a,I]),k(p,F),k(x.content,F),e.jsx(ft,{scope:r,scrollbar:p,hasThumb:s,onThumbChange:A(n),onThumbPointerUp:A(l),onThumbPositionChange:I,onThumbPointerDown:A(i),children:e.jsx(O.div,{...f,ref:_,style:{position:"absolute",...f.style},onPointerDown:L(t.onPointerDown,b=>{b.button===0&&(b.target.setPointerCapture(b.pointerId),C.current=p.getBoundingClientRect(),S.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",x.viewport&&(x.viewport.style.scrollBehavior="auto"),H(b))}),onPointerMove:L(t.onPointerMove,H),onPointerUp:L(t.onPointerUp,b=>{const y=b.target;y.hasPointerCapture(b.pointerId)&&y.releasePointerCapture(b.pointerId),document.body.style.webkitUserSelect=S.current,x.viewport&&(x.viewport.style.scrollBehavior=""),C.current=null})})})}),W="ScrollAreaThumb",De=d.forwardRef((t,o)=>{const{forceMount:r,...a}=t,s=Ae(W,t.__scopeScrollArea);return e.jsx(X,{present:r||s.hasThumb,children:e.jsx(xt,{ref:o,...a})})}),xt=d.forwardRef((t,o)=>{const{__scopeScrollArea:r,style:a,...s}=t,n=v(W,r),l=Ae(W,r),{onThumbPositionChange:i}=l,c=z(o,u=>l.onThumbChange(u)),m=d.useRef(void 0),h=Q(()=>{m.current&&(m.current(),m.current=void 0)},100);return d.useEffect(()=>{const u=n.viewport;if(u){const f=()=>{if(h(),!m.current){const x=gt(u,i);m.current=x,i()}};return i(),u.addEventListener("scroll",f),()=>u.removeEventListener("scroll",f)}},[n.viewport,h,i]),e.jsx(O.div,{"data-state":l.hasThumb?"visible":"hidden",...s,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:L(t.onPointerDownCapture,u=>{const x=u.target.getBoundingClientRect(),p=u.clientX-x.left,w=u.clientY-x.top;l.onThumbPointerDown({x:p,y:w})}),onPointerUp:L(t.onPointerUp,l.onThumbPointerUp)})});De.displayName=W;var te="ScrollAreaCorner",Me=d.forwardRef((t,o)=>{const r=v(te,t.__scopeScrollArea),a=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&a?e.jsx(pt,{...t,ref:o}):null});Me.displayName=te;var pt=d.forwardRef((t,o)=>{const{__scopeScrollArea:r,...a}=t,s=v(te,r),[n,l]=d.useState(0),[i,c]=d.useState(0),m=!!(n&&i);return k(s.scrollbarX,()=>{var u;const h=((u=s.scrollbarX)==null?void 0:u.offsetHeight)||0;s.onCornerHeightChange(h),c(h)}),k(s.scrollbarY,()=>{var u;const h=((u=s.scrollbarY)==null?void 0:u.offsetWidth)||0;s.onCornerWidthChange(h),l(h)}),m?e.jsx(O.div,{...a,ref:o,style:{width:n,height:i,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function B(t){return t?parseInt(t,10):0}function ke(t,o){const r=t/o;return isNaN(r)?0:r}function V(t){const o=ke(t.viewport,t.content),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=(t.scrollbar.size-r)*o;return Math.max(a,18)}function bt(t,o,r,a="ltr"){const s=V(r),n=s/2,l=o||n,i=s-l,c=r.scrollbar.paddingStart+l,m=r.scrollbar.size-r.scrollbar.paddingEnd-i,h=r.content-r.viewport,u=a==="ltr"?[0,h]:[h*-1,0];return ze([c,m],u)(t)}function le(t,o,r="ltr"){const a=V(o),s=o.scrollbar.paddingStart+o.scrollbar.paddingEnd,n=o.scrollbar.size-s,l=o.content-o.viewport,i=n-a,c=r==="ltr"?[0,l]:[l*-1,0],m=Ve(t,c);return ze([0,l],[0,i])(m)}function ze(t,o){return r=>{if(t[0]===t[1]||o[0]===o[1])return o[0];const a=(o[1]-o[0])/(t[1]-t[0]);return o[0]+a*(r-t[0])}}function Ie(t,o){return t>0&&t<o}var gt=(t,o=()=>{})=>{let r={left:t.scrollLeft,top:t.scrollTop},a=0;return function s(){const n={left:t.scrollLeft,top:t.scrollTop},l=r.left!==n.left,i=r.top!==n.top;(l||i)&&o(),r=n,a=window.requestAnimationFrame(s)}(),()=>window.cancelAnimationFrame(a)};function Q(t,o){const r=A(t),a=d.useRef(0);return d.useEffect(()=>()=>window.clearTimeout(a.current),[]),d.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(r,o)},[r,o])}function k(t,o){const r=A(o);qe(()=>{let a=0;if(t){const s=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(r)});return s.observe(t),()=>{window.cancelAnimationFrame(a),s.unobserve(t)}}},[t,r])}var Oe=Pe,wt=Re,vt=Me;const re=d.forwardRef(({className:t,children:o,...r},a)=>e.jsxs(Oe,{ref:a,className:R("relative overflow-hidden",t),...r,children:[e.jsx(wt,{className:"h-full w-full rounded-[inherit]",children:o}),e.jsx(se,{}),e.jsx(vt,{})]}));re.displayName=Oe.displayName;const se=d.forwardRef(({className:t,orientation:o="vertical",...r},a)=>e.jsx(J,{ref:a,orientation:o,className:R("flex touch-none select-none transition-colors",o==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",o==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...r,children:e.jsx(De,{className:"relative flex-1 rounded-full bg-border"})}));se.displayName=J.displayName;const jt=({item:t})=>{const{removeItem:o,updateItemQuantity:r}=$(),{product:a,quantity:s,subtotal:n,notes:l}=t,i=m=>{r(a.id,m)},c=m=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(m);return e.jsxs("div",{className:"flex items-start gap-3 border-b pb-3",children:[e.jsx("img",{src:a.image_url||"/placeholder.svg",alt:a.name,className:"w-16 h-16 object-cover rounded-md flex-shrink-0"}),e.jsxs("div",{className:"flex-grow space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"font-medium text-sm pr-2",children:a.name}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0",onClick:()=>o(a.id),children:e.jsx(ge,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.is_price_by_weight?`${s} kg`:`${s} x ${c(a.price)}`}),l&&e.jsxs("p",{className:"text-xs text-muted-foreground italic max-w-full truncate",children:["Obs: ",l]}),e.jsxs("div",{className:"flex items-center justify-between pt-1",children:[e.jsxs("div",{className:"flex items-center border rounded-md h-8",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>i(s-1),disabled:s<=(a.is_price_by_weight?.1:1),children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx(Y,{type:a.is_price_by_weight?"number":"text",step:a.is_price_by_weight?"0.1":"1",value:a.is_price_by_weight?s.toFixed(1):s,onChange:m=>{const h=parseFloat(m.target.value);h>0&&i(h)},className:"w-12 h-8 text-center border-y-0 rounded-none p-0 focus-visible:ring-0",readOnly:!a.is_price_by_weight}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>i(s+(a.is_price_by_weight?.1:1)),children:e.jsx(U,{className:"h-4 w-4"})})]}),e.jsx("span",{className:"font-bold text-base",children:c(n)})]})]})]})},yt=({totalAmount:t,totalItems:o,isCheckoutBlocked:r,restaurantId:a})=>o===0?null:e.jsxs("div",{className:R("fixed bottom-0 left-0 right-0 bg-card border-t shadow-2xl p-4 z-50","lg:hidden"),children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:["Total do Pedido (",o," itens):"]}),e.jsx("span",{className:"text-xl font-bold text-foreground",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)})]}),e.jsx(de,{to:`/pre-checkout?restaurantId=${a}`,children:e.jsxs(g,{className:"w-full h-12 text-lg",disabled:r||!a,children:["Finalizar Pedido ",e.jsx(Ne,{className:"ml-2 h-5 w-5"})]})})]}),ie=({isOpen:t=!0,onClose:o,isCheckoutBlocked:r=!1,restaurantId:a})=>{const{items:s,totalAmount:n,totalItems:l}=$(),i=e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("h2",{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(M,{className:"h-5 w-5 text-primary"}),"Seu Pedido (",l,")"]})}),s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center flex-grow p-8 text-center",children:[e.jsx(M,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Seu carrinho está vazio"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Adicione alguns itens deliciosos!"})]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"flex-grow p-4",children:e.jsx("div",{className:"space-y-4",children:s.map(c=>e.jsx(jt,{item:c},c.product.id))})}),e.jsxs("div",{className:"p-4 border-t space-y-3",children:[e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)})]}),e.jsx(de,{to:`/pre-checkout?restaurantId=${a}`,onClick:o,children:e.jsxs(g,{className:"w-full h-12 text-lg",disabled:r||!a,children:["Finalizar Pedido ",e.jsx(Ne,{className:"ml-2 h-5 w-5"})]})})]})]})]});return t===!0&&!o?e.jsx(xe,{className:"shadow-lg h-[calc(100vh-5rem)] flex flex-col",children:i}):e.jsx(Xe,{open:t,onOpenChange:o,children:e.jsxs(Ye,{side:"right",className:"w-full sm:max-w-sm p-0",children:[i,t&&l>0&&e.jsx(yt,{totalAmount:n,totalItems:l,isCheckoutBlocked:r,restaurantId:a})]})})},St=(t=1024)=>{const[o,r]=d.useState(!1);return d.useEffect(()=>{const a=()=>{r(window.innerWidth<t)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[t]),o},Nt=t=>{const o=Fe(),[r,a]=d.useState([]),[s,n]=d.useState(!0),[l,i]=d.useState(!1),c=async m=>{const{data:h,error:u}=await E.from("business_hours").select("*").eq("restaurant_id",m).order("day_of_week",{ascending:!0});return u?(console.error("Error fetching initial business hours:",u),i(!0),[]):h};return d.useEffect(()=>{if(!t){n(!1);return}let m=!0;c(t).then(u=>{m&&(a(u),n(!1))});const h=E.channel(`business_hours_changes_${t}`).on("postgres_changes",{event:"*",schema:"public",table:"business_hours",filter:`restaurant_id=eq.${t}`},u=>{console.log("[Realtime] Business Hours change detected:",u.eventType),o.invalidateQueries({queryKey:["businessHours",t]}),c(t).then(f=>{m&&a(f)})}).subscribe(u=>{u==="SUBSCRIBED"&&console.log(`[Realtime] Subscribed to business_hours for ${t}`)});return()=>{m=!1,E.removeChannel(h)}},[t,o]),{hours:r,isLoading:s,isError:l}},Ct=({categories:t})=>{const[o,r]=d.useState(null),a=d.useCallback(s=>{const n=document.getElementById(`category-${s}`);if(n){const c=n.getBoundingClientRect().top+window.scrollY-120;window.scrollTo({top:c,behavior:"smooth"}),r(s)}},[]);return d.useEffect(()=>{const s=new IntersectionObserver(n=>{n.forEach(l=>{if(l.isIntersecting){const i=l.target.id.replace("category-","");r(i)}})},{rootMargin:"-120px 0px -50% 0px",threshold:0});return t.forEach(n=>{const l=document.getElementById(`category-${n.id}`);l&&s.observe(l)}),()=>{t.forEach(n=>{const l=document.getElementById(`category-${n.id}`);l&&s.unobserve(l)})}},[t]),e.jsx("div",{className:"sticky top-16 z-20 bg-card border-b shadow-md",children:e.jsxs(re,{className:"w-full whitespace-nowrap",children:[e.jsx("div",{className:"flex space-x-2 p-3 container mx-auto px-4",children:t.map(s=>e.jsx(g,{variant:o===s.id?"default":"outline",onClick:()=>a(s.id),className:R("flex-shrink-0",o===s.id?"bg-primary text-primary-foreground":"bg-muted hover:bg-accent/50"),children:s.name},s.id))}),e.jsx(se,{orientation:"horizontal"})]})})},_t=async t=>{var i;const{data:o,error:r}=await E.from("restaurants").select("*").eq("id",t).eq("is_active",!0).limit(1).single();if(r&&r.code!=="PGRST116")throw new Error(`Erro ao buscar restaurante: ${r.message}`);if(!o)throw new Error("Restaurante não encontrado ou inativo.");const[a,s]=await Promise.all([E.from("categories").select("*").eq("restaurant_id",o.id).eq("is_active",!0).order("display_order",{ascending:!0}),E.from("products").select("*").eq("restaurant_id",o.id)]);if(a.error)throw new Error(`Erro ao buscar categorias: ${a.error.message}`);if(s.error)throw new Error(`Erro ao buscar produtos: ${s.error.message}`);const n=new Map;(i=s.data)==null||i.forEach(c=>{if(c.category_id){const m=n.get(c.category_id)||[];m.push(c),n.set(c.category_id,m)}});const l=a.data.map(c=>({...c,products:n.get(c.id)||[]})).filter(c=>c.products.length>0);return{restaurant:o,categories:l}},Pt=async t=>{const{data:o,error:r}=await E.from("customers").select("*").eq("user_id",t).limit(1).single();if(r&&r.code!=="PGRST116")throw new Error(r.message);return o||null},pr=()=>{const{restaurantId:t}=He(),o=St(),{totalItems:r}=$(),[a,s]=d.useState(!1),{data:n}=Qe(),[l,i]=d.useState(!1),[c,m]=d.useState("");oe({queryKey:["menuData",t],queryFn:()=>_t(t),enabled:!1,staleTime:1e3*60*1}),Nt(t);const{data:h,isLoading:u}=oe({queryKey:["menuCustomerData",n==null?void 0:n.id],queryFn:()=>Pt(n.id),enabled:!1,staleTime:0}),{isOpen:f,todayHours:x}={isOpen:!0,todayHours:"09:00 - 18:00"},p=!f,w={name:"Restaurante Teste",description:"Menu de Teste",phone:"11999999999"},_=[],C=async()=>{await E.auth.signOut(),K.success("Você saiu da sua conta."),window.location.reload()};if(!t)return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs(me,{variant:"destructive",className:"max-w-lg",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx(he,{children:"Erro de Acesso"}),e.jsx(ue,{children:"O link do cardápio está incompleto. Por favor, use o link fornecido no painel de administração."})]})});const S=c.length>0,P=_;return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(Ke,{isOpen:l,onClose:()=>i(!1),customer:h}),e.jsx("header",{className:"border-b bg-card sticky top-0 z-30 shadow-sm",children:e.jsxs("div",{className:"container mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:w.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:w.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n&&e.jsxs(e.Fragment,{children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>i(!0),"aria-label":"Meu Perfil e Pedidos",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"})," Perfil / Pedidos"]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:C,children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"})," Sair"]})]}),o&&r>0&&e.jsx(lt,{onClick:()=>s(!0),totalItems:r,isCheckoutBlocked:p})]})]}),e.jsxs("div",{className:"mt-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"space-y-3 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center text-sm text-muted-foreground",children:[e.jsx(et,{className:"h-4 w-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate max-w-full",children:"Endereço de Teste"})]}),e.jsxs("div",{className:"flex items-center justify-center text-sm font-medium",children:[e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1 rounded-full bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",children:[e.jsx(CheckCircle,{className:"h-4 w-4"}),e.jsx("span",{children:"Aberto Agora"})]}),e.jsxs("div",{className:"ml-4 flex items-center text-muted-foreground",children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:x})]})]})]}),e.jsxs("a",{href:`tel:${w.phone.replace(/\D/g,"")}`,className:"flex items-center text-sm font-medium text-primary hover:text-primary/80 transition-colors",children:[e.jsx(tt,{className:"h-4 w-4 mr-1"}),w.phone]})]}),e.jsxs("div",{className:"relative mt-4",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{placeholder:"Buscar produto...",className:"pl-10 h-10",value:c,onChange:j=>m(j.target.value)})]})]})}),!S&&P.length>1&&e.jsx(Ct,{categories:P}),e.jsxs("main",{className:"flex-1 container mx-auto px-4 py-8 flex",children:[e.jsxs("div",{className:"flex-1 w-full lg:max-w-3xl xl:max-w-4xl",children:[!f&&e.jsx(rt,{todayHours:x}),S&&P.length===0&&e.jsxs("div",{className:"text-center py-12 bg-card rounded-lg border",children:[e.jsx(ne,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-semibold",children:"Nenhum produto encontrado."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tente um termo de pesquisa diferente."})]}),e.jsx("div",{className:"space-y-10",children:P.map(j=>e.jsxs("section",{id:S?void 0:`category-${j.id}`,className:R("scroll-mt-20",S&&"pt-0"),children:[e.jsx("h2",{className:"text-3xl font-bold mb-6 border-b pb-2",children:S?"Resultados da Pesquisa":j.name}),e.jsx("div",{className:"grid gap-6 grid-cols-2 lg:grid-cols-3",children:j.products.map(T=>e.jsx(at,{product:T,isCheckoutBlocked:p},T.id))})]},j.id))})]}),e.jsx("div",{className:"hidden lg:block lg:w-96 lg:ml-8 flex-shrink-0 sticky top-20 self-start",children:e.jsx(ie,{isCheckoutBlocked:p,restaurantId:t})})]}),o&&e.jsx(ie,{isOpen:a,onClose:()=>s(!1),isCheckoutBlocked:p,restaurantId:t})]})};export{pr as default};
